!function(f,O){"object"==typeof exports&&"object"==typeof module?module.exports=O():"function"==typeof define&&define.amd?define([],O):"object"==typeof exports?exports.Tone=O():f.Tone=O()}("undefined"!=typeof self?self:void 0,(()=>(()=>{var f={382:function(f,O,I){!function(f,O,I,V){var i=function(f,O,I){return{endTime:O,insertTime:I,type:"exponentialRampToValue",value:f}},o=function(f,O,I){return{endTime:O,insertTime:I,type:"linearRampToValue",value:f}},r=function(f,O){return{startTime:O,type:"setValue",value:f}},a=function(f,O,I){return{duration:I,startTime:O,type:"setValueCurve",values:f}},c=function(f,O,I){var V=I.startTime,F=I.target,P=I.timeConstant;return F+(O-F)*Math.exp((V-f)/P)},h=function(f){return"exponentialRampToValue"===f.type},l=function(f){return"linearRampToValue"===f.type},u=function(f){return h(f)||l(f)},p=function(f){return"setValue"===f.type},d=function(f){return"setValueCurve"===f.type},F=function t(f,O,I,V){var F=f[O];return void 0===F?V:u(F)||p(F)?F.value:d(F)?F.values[F.values.length-1]:c(I,t(f,O-1,F.startTime,V),F)},_=function(f,O,I,V,P){return void 0===I?[V.insertTime,P]:u(I)?[I.endTime,I.value]:p(I)?[I.startTime,I.value]:d(I)?[I.startTime+I.duration,I.values[I.values.length-1]]:[I.startTime,F(f,O-1,I.startTime,P)]},m=function(f){return"cancelAndHold"===f.type},g=function(f){return"cancelScheduledValues"===f.type},v=function(f){return m(f)||g(f)?f.cancelTime:h(f)||l(f)?f.endTime:f.startTime},y=function(f,O,I,V){var F=V.endTime,P=V.value;return I===P?P:0<I&&0<P||I<0&&P<0?I*Math.pow(P/I,(f-O)/(F-O)):0},x=function(f,O,I,V){return I+(f-O)/(V.endTime-O)*(V.value-I)},w=function(f,O){var I=O.duration,V=O.startTime,F=O.values;return function(f,O){var I=Math.floor(O),V=Math.ceil(O);return I===V?f[I]:(1-(O-I))*f[I]+(1-(V-O))*f[V]}(F,(f-V)/I*(F.length-1))},b=function(f){return"setTarget"===f.type},P=function(){return V((function t(f){I(this,t),this._automationEvents=[],this._currenTime=0,this._defaultValue=f}),[{key:Symbol.iterator,value:function(){return this._automationEvents[Symbol.iterator]()}},{key:"add",value:function(f){var O=v(f);if(m(f)||g(f)){var I=this._automationEvents.findIndex((function(I){return g(f)&&d(I)?I.startTime+I.duration>=O:v(I)>=O})),V=this._automationEvents[I];if(-1!==I&&(this._automationEvents=this._automationEvents.slice(0,I)),m(f)){var F=this._automationEvents[this._automationEvents.length-1];if(void 0!==V&&u(V)){if(void 0!==F&&b(F))throw new Error("The internal list is malformed.");var P=void 0===F?V.insertTime:d(F)?F.startTime+F.duration:v(F),ut=void 0===F?this._defaultValue:d(F)?F.values[F.values.length-1]:F.value,mt=h(V)?y(O,P,ut,V):x(O,P,ut,V),gt=h(V)?i(mt,O,this._currenTime):o(mt,O,this._currenTime);this._automationEvents.push(gt)}if(void 0!==F&&b(F)&&this._automationEvents.push(r(this.getValue(O),O)),void 0!==F&&d(F)&&F.startTime+F.duration>O){var vt=O-F.startTime,yt=(F.values.length-1)/F.duration,xt=Math.max(2,1+Math.ceil(vt*yt)),bt=vt/(xt-1)*yt,St=F.values.slice(0,xt);if(bt<1)for(var kt=1;kt<xt;kt+=1){var Dt=bt*kt%1;St[kt]=F.values[kt-1]*(1-Dt)+F.values[kt]*Dt}this._automationEvents[this._automationEvents.length-1]=a(St,F.startTime,vt)}}}else{var Mt=this._automationEvents.findIndex((function(f){return v(f)>O})),Yt=-1===Mt?this._automationEvents[this._automationEvents.length-1]:this._automationEvents[Mt-1];if(void 0!==Yt&&d(Yt)&&v(Yt)+Yt.duration>O)return!1;var Xt=h(f)?i(f.value,f.endTime,this._currenTime):l(f)?o(f.value,O,this._currenTime):f;if(-1===Mt)this._automationEvents.push(Xt);else{if(d(f)&&O+f.duration>v(this._automationEvents[Mt]))return!1;this._automationEvents.splice(Mt,0,Xt)}}return!0}},{key:"flush",value:function(f){var O=this._automationEvents.findIndex((function(O){return v(O)>f}));if(O>1){var I=this._automationEvents.slice(O-1),V=I[0];b(V)&&I.unshift(r(F(this._automationEvents,O-2,V.startTime,this._defaultValue),V.startTime)),this._automationEvents=I}}},{key:"getValue",value:function(f){if(0===this._automationEvents.length)return this._defaultValue;var I=this._automationEvents.findIndex((function(O){return v(O)>f})),V=this._automationEvents[I],P=(-1===I?this._automationEvents.length:I)-1,ut=this._automationEvents[P];if(void 0!==ut&&b(ut)&&(void 0===V||!u(V)||V.insertTime>f))return c(f,F(this._automationEvents,P-1,ut.startTime,this._defaultValue),ut);if(void 0!==ut&&p(ut)&&(void 0===V||!u(V)))return ut.value;if(void 0!==ut&&d(ut)&&(void 0===V||!u(V)||ut.startTime+ut.duration>f))return f<ut.startTime+ut.duration?w(f,ut):ut.values[ut.values.length-1];if(void 0!==ut&&u(ut)&&(void 0===V||!u(V)))return ut.value;if(void 0!==V&&h(V)){var mt=_(this._automationEvents,P,ut,V,this._defaultValue),gt=O(mt,2),vt=gt[0],yt=gt[1];return y(f,vt,yt,V)}if(void 0!==V&&l(V)){var xt=_(this._automationEvents,P,ut,V,this._defaultValue),bt=O(xt,2),St=bt[0],kt=bt[1];return x(f,St,kt,V)}return this._defaultValue}}])}();f.AutomationEventList=P,f.createCancelAndHoldAutomationEvent=function(f){return{cancelTime:f,type:"cancelAndHold"}},f.createCancelScheduledValuesAutomationEvent=function(f){return{cancelTime:f,type:"cancelScheduledValues"}},f.createExponentialRampToValueAutomationEvent=function(f,O){return{endTime:O,type:"exponentialRampToValue",value:f}},f.createLinearRampToValueAutomationEvent=function(f,O){return{endTime:O,type:"linearRampToValue",value:f}},f.createSetTargetAutomationEvent=function(f,O,I){return{startTime:O,target:f,timeConstant:I,type:"setTarget"}},f.createSetValueAutomationEvent=r,f.createSetValueCurveAutomationEvent=a}(O,I(424),I(690),I(728))},897:f=>{f.exports=function(f,O){(null==O||O>f.length)&&(O=f.length);for(var I=0,V=new Array(O);I<O;I++)V[I]=f[I];return V},f.exports.__esModule=!0,f.exports.default=f.exports},372:f=>{f.exports=function(f){if(Array.isArray(f))return f},f.exports.__esModule=!0,f.exports.default=f.exports},690:f=>{f.exports=function(f,O){if(!(f instanceof O))throw new TypeError("Cannot call a class as a function")},f.exports.__esModule=!0,f.exports.default=f.exports},728:(f,O,I)=>{var V=I(62);function i(f,O){for(var I=0;I<O.length;I++){var F=O[I];F.enumerable=F.enumerable||!1,F.configurable=!0,"value"in F&&(F.writable=!0),Object.defineProperty(f,V(F.key),F)}}f.exports=function(f,O,I){return O&&i(f.prototype,O),I&&i(f,I),Object.defineProperty(f,"prototype",{writable:!1}),f},f.exports.__esModule=!0,f.exports.default=f.exports},872:f=>{f.exports=function(f,O){var I=null==f?null:"undefined"!=typeof Symbol&&f[Symbol.iterator]||f["@@iterator"];if(null!=I){var V,F,P,ut,mt=[],gt=!0,vt=!1;try{if(P=(I=I.call(f)).next,0===O){if(Object(I)!==I)return;gt=!1}else for(;!(gt=(V=P.call(I)).done)&&(mt.push(V.value),mt.length!==O);gt=!0);}catch(f){vt=!0,F=f}finally{try{if(!gt&&null!=I.return&&(ut=I.return(),Object(ut)!==ut))return}finally{if(vt)throw F}}return mt}},f.exports.__esModule=!0,f.exports.default=f.exports},218:f=>{f.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},f.exports.__esModule=!0,f.exports.default=f.exports},424:(f,O,I)=>{var V=I(372),F=I(872),P=I(116),ut=I(218);f.exports=function(f,O){return V(f)||F(f,O)||P(f,O)||ut()},f.exports.__esModule=!0,f.exports.default=f.exports},36:(f,O,I)=>{var V=I(698).default;f.exports=function(f,O){if("object"!=V(f)||!f)return f;var I=f[Symbol.toPrimitive];if(void 0!==I){var F=I.call(f,O||"default");if("object"!=V(F))return F;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===O?String:Number)(f)},f.exports.__esModule=!0,f.exports.default=f.exports},62:(f,O,I)=>{var V=I(698).default,F=I(36);f.exports=function(f){var O=F(f,"string");return"symbol"==V(O)?O:O+""},f.exports.__esModule=!0,f.exports.default=f.exports},698:f=>{function e(O){return f.exports=e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(f){return typeof f}:function(f){return f&&"function"==typeof Symbol&&f.constructor===Symbol&&f!==Symbol.prototype?"symbol":typeof f},f.exports.__esModule=!0,f.exports.default=f.exports,e(O)}f.exports=e,f.exports.__esModule=!0,f.exports.default=f.exports},116:(f,O,I)=>{var V=I(897);f.exports=function(f,O){if(f){if("string"==typeof f)return V(f,O);var I=Object.prototype.toString.call(f).slice(8,-1);return"Object"===I&&f.constructor&&(I=f.constructor.name),"Map"===I||"Set"===I?Array.from(f):"Arguments"===I||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(I)?V(f,O):void 0}},f.exports.__esModule=!0,f.exports.default=f.exports}},O={};function s(I){var V=O[I];if(void 0!==V)return V.exports;var F=O[I]={exports:{}};return f[I].call(F.exports,F,F.exports,s),F.exports}s.d=(f,O)=>{for(var I in O)s.o(O,I)&&!s.o(f,I)&&Object.defineProperty(f,I,{enumerable:!0,get:O[I]})},s.o=(f,O)=>Object.prototype.hasOwnProperty.call(f,O),s.r=f=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(f,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(f,"__esModule",{value:!0})};var I={};return(()=>{s.r(I),s.d(I,{AMOscillator:()=>$o,AMSynth:()=>Cr,Abs:()=>pr,Add:()=>nr,AmplitudeEnvelope:()=>Sr,Analyser:()=>Xa,AudioToGain:()=>Xo,AutoFilter:()=>ua,AutoPanner:()=>da,AutoWah:()=>_a,BaseContext:()=>Ci,BiquadFilter:()=>Dr,BitCrusher:()=>ga,Buffer:()=>Uc,BufferSource:()=>Yc,Buffers:()=>Gc,Channel:()=>sc,Chebyshev:()=>ya,Chorus:()=>Sa,Clock:()=>vo,Compressor:()=>cc,Context:()=>Di,Convolver:()=>fc,CrossFade:()=>ca,DCMeter:()=>Ja,Delay:()=>yo,Destination:()=>jc,Distortion:()=>ka,Draw:()=>zc,DuoSynth:()=>Rr,EQ3:()=>dc,Emitter:()=>Ai,Envelope:()=>xr,FFT:()=>Ha,FMOscillator:()=>Ho,FMSynth:()=>qr,FatOscillator:()=>Ko,FeedbackCombFilter:()=>Br,FeedbackDelay:()=>Ca,Filter:()=>Or,Follower:()=>fa,Freeverb:()=>Ra,Frequency:()=>Ji,FrequencyClass:()=>Yi,FrequencyEnvelope:()=>Mr,FrequencyShifter:()=>Oa,Gain:()=>ho,GainToAudio:()=>dr,Gate:()=>hc,GrainPlayer:()=>ur,GreaterThan:()=>gr,GreaterThanZero:()=>mr,IntervalTimeline:()=>Co,JCReverb:()=>Va,LFO:()=>rr,Limiter:()=>lc,Listener:()=>Bc,Loop:()=>$r,LowpassCombFilter:()=>Gr,Master:()=>Lc,MembraneSynth:()=>Vr,Merge:()=>wa,MetalSynth:()=>Ir,Meter:()=>$a,MidSideCompressor:()=>uc,MidSideMerge:()=>Ba,MidSideSplit:()=>Wa,Midi:()=>To,MidiClass:()=>bo,Mono:()=>nc,MonoSynth:()=>Er,MultibandCompressor:()=>pc,MultibandSplit:()=>ic,Multiply:()=>Yo,Negate:()=>fr,Noise:()=>Lo,NoiseSynth:()=>Nr,Offline:()=>xo,OfflineContext:()=>qi,OmniOscillator:()=>sr,OnePoleFilter:()=>Ur,Oscillator:()=>Zo,PWMOscillator:()=>tr,PanVol:()=>ec,Panner:()=>pa,Panner3D:()=>rc,Param:()=>no,Part:()=>Hr,Pattern:()=>ra,Phaser:()=>La,PingPongDelay:()=>Pa,PitchShift:()=>ja,Player:()=>hr,Players:()=>lr,PluckSynth:()=>Qr,PolySynth:()=>Zr,Pow:()=>Fo,PulseOscillator:()=>Jo,Recorder:()=>ac,Reverb:()=>za,Sampler:()=>Xr,Scale:()=>ir,ScaleExp:()=>vr,Sequence:()=>aa,Signal:()=>po,Solo:()=>tc,Split:()=>xa,StateTimeline:()=>so,StereoWidener:()=>Ga,Subtract:()=>_r,SyncedSignal:()=>yr,Synth:()=>kr,Ticks:()=>ko,TicksClass:()=>So,Time:()=>Xi,TimeClass:()=>Zi,Timeline:()=>wi,ToneAudioBuffer:()=>Ri,ToneAudioBuffers:()=>wo,ToneAudioNode:()=>io,ToneBufferSource:()=>jo,ToneEvent:()=>Yr,ToneOscillatorNode:()=>Qo,Transport:()=>Nc,TransportTime:()=>to,TransportTimeClass:()=>Ki,Tremolo:()=>Qa,Unit:()=>O,UserMedia:()=>Uo,Vibrato:()=>Za,Volume:()=>Oo,WaveShaper:()=>qo,Waveform:()=>Ka,Zero:()=>or,connect:()=>ro,connectSeries:()=>oo,connectSignal:()=>fo,context:()=>Wc,dbToGain:()=>ji,debug:()=>f,defaultArg:()=>pi,disconnect:()=>ao,fanIn:()=>co,ftom:()=>Bi,gainToDb:()=>Li,getContext:()=>Vi,getDestination:()=>wc,getDraw:()=>kc,getListener:()=>Tc,getTransport:()=>vc,immediate:()=>mc,intervalToFrequencyRatio:()=>zi,isArray:()=>Ln,isBoolean:()=>jn,isDefined:()=>In,isFunction:()=>Vn,isNote:()=>Wn,isNumber:()=>Nn,isObject:()=>Pn,isString:()=>zn,isUndef:()=>Fn,loaded:()=>Cc,mtof:()=>Gi,now:()=>_c,optionsFromArguments:()=>ui,setContext:()=>Ni,start:()=>Pi,supported:()=>qn,version:()=>V});var f={};s.r(f),s.d(f,{assert:()=>Bn,assertContextRunning:()=>Gn,assertRange:()=>Un,assertUsedScheduleTime:()=>Yn,enterScheduledCallback:()=>Xn,log:()=>Jn,setLogger:()=>Hn,warn:()=>Kn});var O={};s.r(O);const V="14.9.17";var F=s(382);const P=new WeakSet,ut=new WeakMap,mt=new WeakMap,gt=new WeakMap,vt=new WeakMap,yt=new WeakMap,xt=new WeakMap,bt=new WeakMap,St=new WeakMap,kt=new WeakMap,Dt={construct:()=>Dt},Mt=/^import(?:(?:[\s]+[\w]+|(?:[\s]+[\w]+[\s]*,)?[\s]*\{[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?(?:[\s]*,[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?)*[\s]*}|(?:[\s]+[\w]+[\s]*,)?[\s]*\*[\s]+as[\s]+[\w]+)[\s]+from)?(?:[\s]*)("([^"\\]|\\.)+"|'([^'\\]|\\.)+')(?:[\s]*);?/,v=(f,O)=>{const I=[];let V=f.replace(/^[\s]+/,""),F=V.match(Mt);for(;null!==F;){const f=F[1].slice(1,-1),P=F[0].replace(/([\s]+)?;?$/,"").replace(f,new URL(f,O).toString());I.push(P),V=V.slice(F[0].length).replace(/^[\s]+/,""),F=V.match(Mt)}return[I.join(";"),V]},y=f=>{if(void 0!==f&&!Array.isArray(f))throw new TypeError("The parameterDescriptors property of given value for processorCtor is not an array.")},x=f=>{if(!(f=>{try{new new Proxy(f,Dt)}catch{return!1}return!0})(f))throw new TypeError("The given value for processorCtor should be a constructor.");if(null===f.prototype||"object"!=typeof f.prototype)throw new TypeError("The given value for processorCtor should have a prototype.")},w=(f,O)=>{const I=f.get(O);if(void 0===I)throw new Error("A value with the given key could not be found.");return I},b=(f,O)=>{const I=Array.from(f).filter(O);if(I.length>1)throw Error("More than one element was found.");if(0===I.length)throw Error("No element was found.");const[V]=I;return f.delete(V),V},T=(f,O,I,V)=>{const F=w(f,O),P=b(F,(f=>f[0]===I&&f[1]===V));return 0===F.size&&f.delete(O),P},S=f=>w(xt,f),k=f=>{if(P.has(f))throw new Error("The AudioNode is already stored.");P.add(f),S(f).forEach((f=>f(!0)))},A=f=>"port"in f,C=f=>{if(!P.has(f))throw new Error("The AudioNode is not stored.");P.delete(f),S(f).forEach((f=>f(!1)))},D=(f,O)=>{!A(f)&&O.every((f=>0===f.size))&&C(f)},Yt={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",fftSize:2048,maxDecibels:-30,minDecibels:-100,smoothingTimeConstant:.8},M=(f,O)=>f.context===O,E=f=>{try{f.copyToChannel(new Float32Array(1),0,-1)}catch{return!1}return!0},R=()=>new DOMException("","IndexSizeError"),q=f=>{var O;f.getChannelData=(O=f.getChannelData,I=>{try{return O.call(f,I)}catch(f){if(12===f.code)throw R();throw f}})},Xt={numberOfChannels:1},Ht=-34028234663852886e22,$t=-Ht,N=f=>P.has(f),Jt={buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1},j=f=>w(ut,f),L=f=>w(gt,f),z=(f,O)=>{const{activeInputs:I}=j(f);I.forEach((I=>I.forEach((([I])=>{O.includes(f)||z(I,[...O,f])}))));const V=(f=>"playbackRate"in f)(f)?[f.playbackRate]:A(f)?Array.from(f.parameters.values()):(f=>"frequency"in f&&"gain"in f)(f)?[f.Q,f.detune,f.frequency,f.gain]:(f=>"offset"in f)(f)?[f.offset]:(f=>!("frequency"in f)&&"gain"in f)(f)?[f.gain]:(f=>"detune"in f&&"frequency"in f)(f)?[f.detune,f.frequency]:(f=>"pan"in f)(f)?[f.pan]:[];for(const f of V){const I=L(f);void 0!==I&&I.activeInputs.forEach((([f])=>z(f,O)))}N(f)&&C(f)},W=f=>{z(f.destination,[])},B=f=>"context"in f,U=f=>B(f[0]),G=(f,O,I,V)=>{for(const O of f)if(I(O)){if(V)return!1;throw Error("The set contains at least one similar element.")}return f.add(O),!0},Q=(f,O,[I,V],F)=>{G(f,[O,I,V],(f=>f[0]===O&&f[1]===I),F)},Z=(f,[O,I,V],F)=>{const P=f.get(O);void 0===P?f.set(O,new Set([[I,V]])):G(P,[I,V],(f=>f[0]===I),F)},X=f=>"inputs"in f,Y=(f,O,I,V)=>{if(X(O)){const F=O.inputs[V];return f.connect(F,I,0),[F,I,0]}return f.connect(O,I,V),[O,I,V]},$=(f,O,I)=>{for(const V of f)if(V[0]===O&&V[1]===I)return f.delete(V),V;return null},H=(f,O)=>{if(!S(f).delete(O))throw new Error("Missing the expected event listener.")},J=(f,O,I)=>{const V=w(f,O),F=b(V,(f=>f[0]===I));return 0===V.size&&f.delete(O),F},K=(f,O,I,V)=>{X(O)?f.disconnect(O.inputs[V],I,0):f.disconnect(O,I,V)},tt=f=>w(mt,f),et=f=>w(vt,f),st=f=>bt.has(f),nt=f=>!P.has(f),it=(f,O)=>new Promise((I=>{if(null!==O)I(!0);else{const O=f.createScriptProcessor(256,1,1),V=f.createGain(),F=f.createBuffer(1,2,44100),P=F.getChannelData(0);P[0]=1,P[1]=1;const ut=f.createBufferSource();ut.buffer=F,ut.loop=!0,ut.connect(O).connect(f.destination),ut.connect(V),ut.disconnect(V),O.onaudioprocess=V=>{const F=V.inputBuffer.getChannelData(0);Array.prototype.some.call(F,(f=>1===f))?I(!0):I(!1),ut.stop(),O.onaudioprocess=null,ut.disconnect(O),O.disconnect(f.destination)},ut.start()}})),ot=(f,O)=>{const I=new Map;for(const O of f)for(const f of O){const O=I.get(f);I.set(f,void 0===O?1:O+1)}I.forEach(((f,I)=>O(I,f)))},rt=f=>"context"in f,at=f=>{const O=new Map;f.connect=(f=>(I,V=0,F=0)=>{const P=rt(I)?f(I,V,F):f(I,V),ut=O.get(I);return void 0===ut?O.set(I,[{input:F,output:V}]):ut.every((f=>f.input!==F||f.output!==V))&&ut.push({input:F,output:V}),P})(f.connect.bind(f)),f.disconnect=(I=>(V,F,P)=>{if(I.apply(f),void 0===V)O.clear();else if("number"==typeof V)for(const[f,I]of O){const F=I.filter((f=>f.output!==V));0===F.length?O.delete(f):O.set(f,F)}else if(O.has(V))if(void 0===F)O.delete(V);else{const f=O.get(V);if(void 0!==f){const I=f.filter((f=>f.output!==F&&(f.input!==P||void 0===P)));0===I.length?O.delete(V):O.set(V,I)}}for(const[I,V]of O)V.forEach((O=>{rt(I)?f.connect(I,O.output,O.input):f.connect(I,O.output)}))})(f.disconnect)},ct=(f,O,I,V,F)=>{const[P,ut]=((f,O,I,V)=>{const{activeInputs:F,passiveInputs:P}=j(O),ut=$(F[V],f,I);return null===ut?[T(P,f,I,V)[2],!1]:[ut[2],!0]})(f,I,V,F);if(null!==P&&(H(f,P),!ut||O||st(f)||K(tt(f),tt(I),V,F)),N(I)){const{activeInputs:f}=j(I);D(I,f)}},ht=(f,O,I,V)=>{const[F,P]=((f,O,I)=>{const{activeInputs:V,passiveInputs:F}=L(O),P=$(V,f,I);return null===P?[J(F,f,I)[1],!1]:[P[2],!0]})(f,I,V);null!==F&&(H(f,F),!P||O||st(f)||tt(f).disconnect(et(I),V))};class lt{constructor(f){this._map=new Map(f)}get size(){return this._map.size}entries(){return this._map.entries()}forEach(f,O=null){return this._map.forEach(((I,V)=>f.call(O,I,V,this)))}get(f){return this._map.get(f)}has(f){return this._map.has(f)}keys(){return this._map.keys()}values(){return this._map.values()}}const te={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:1,numberOfOutputs:1,parameterData:{},processorOptions:{}};function pt(f,O,I,V,F){if("function"==typeof f.copyFromChannel)0===O[I].byteLength&&(O[I]=new Float32Array(128)),f.copyFromChannel(O[I],V,F);else{const P=f.getChannelData(V);if(0===O[I].byteLength)O[I]=P.slice(F,F+128);else{const f=new Float32Array(P.buffer,F*Float32Array.BYTES_PER_ELEMENT,128);O[I].set(f)}}}const dt=(f,O,I,V,F)=>{"function"==typeof f.copyToChannel?0!==O[I].byteLength&&f.copyToChannel(O[I],V,F):0!==O[I].byteLength&&f.getChannelData(V).set(O[I],F)},ft=(f,O)=>{const I=[];for(let V=0;V<f;V+=1){const f=[],F="number"==typeof O?O:O[V];for(let O=0;O<F;O+=1)f.push(new Float32Array(128));I.push(f)}return I},_t=async(f,O,I,V,F,P,ut)=>{const mt=null===O?128*Math.ceil(f.context.length/128):O.length,gt=V.channelCount*V.numberOfInputs,vt=F.reduce(((f,O)=>f+O),0),yt=0===vt?null:I.createBuffer(vt,mt,I.sampleRate);if(void 0===P)throw new Error("Missing the processor constructor.");const xt=j(f),bt=await((f,O)=>{const I=w(kt,f),V=tt(O);return w(I,V)})(I,f),St=ft(V.numberOfInputs,V.channelCount),Dt=ft(V.numberOfOutputs,F),Mt=Array.from(f.parameters.keys()).reduce(((f,O)=>({...f,[O]:new Float32Array(128)})),{});for(let vt=0;vt<mt;vt+=128){if(V.numberOfInputs>0&&null!==O)for(let f=0;f<V.numberOfInputs;f+=1)for(let I=0;I<V.channelCount;I+=1)pt(O,St[f],I,I,vt);void 0!==P.parameterDescriptors&&null!==O&&P.parameterDescriptors.forEach((({name:f},I)=>{pt(O,Mt,f,gt+I,vt)}));for(let f=0;f<V.numberOfInputs;f+=1)for(let O=0;O<F[f];O+=1)0===Dt[f][O].byteLength&&(Dt[f][O]=new Float32Array(128));try{const f=St.map(((f,O)=>0===xt.activeInputs[O].size?[]:f)),O=ut(vt/I.sampleRate,I.sampleRate,(()=>bt.process(f,Dt,Mt)));if(null!==yt)for(let f=0,O=0;f<V.numberOfOutputs;f+=1){for(let I=0;I<F[f];I+=1)dt(yt,Dt[f],I,O+I,vt);O+=F[f]}if(!O)break}catch(O){f.dispatchEvent(new ErrorEvent("processorerror",{colno:O.colno,filename:O.filename,lineno:O.lineno,message:O.message}));break}}return yt},pe={Q:1,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:350,gain:0,type:"lowpass"},de={channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6},fe={channelCount:6,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:6},_e={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",offset:1},me={buffer:null,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",disableNormalization:!1},wt=f=>{const{port1:O,port2:I}=new MessageChannel;return new Promise((V=>{const i=()=>{I.onmessage=null,O.close(),I.close(),V()};I.onmessage=()=>i();try{O.postMessage(f,[f])}catch{}finally{i()}}))},ge={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",delayTime:0,maxDelayTime:1},Tt=(f,O,I)=>{const V=O[I];if(void 0===V)throw f();return V},ve={attack:.003,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",knee:30,ratio:12,release:.25,threshold:-24},ye={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",gain:1},At=()=>new DOMException("","InvalidStateError"),Ct=()=>new DOMException("","InvalidAccessError"),xe={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers"},Ot=(f,O,I,V,F,P,ut,mt,gt,vt,yt)=>{const xt=vt.length;let bt=mt;for(let mt=0;mt<xt;mt+=1){let xt=I[0]*vt[mt];for(let O=1;O<F;O+=1){const V=bt-O&gt-1;xt+=I[O]*P[V],xt-=f[O]*ut[V]}for(let f=F;f<V;f+=1)xt+=I[f]*P[bt-f&gt-1];for(let I=F;I<O;I+=1)xt-=f[I]*ut[bt-I&gt-1];P[bt]=vt[mt],ut[bt]=xt,bt=bt+1&gt-1,yt[mt]=xt}return bt},we={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers"},Et=f=>{const O=new Uint32Array([1179011410,40,1163280727,544501094,16,131073,44100,176400,1048580,1635017060,4,0]);try{const I=f.decodeAudioData(O.buffer,(()=>{}));return void 0!==I&&(I.catch((()=>{})),!0)}catch{}return!1},Rt=(f,O,I)=>{const V=O[I];void 0!==V&&V!==f[I]&&(f[I]=V)},qt=(f,O)=>{Rt(f,O,"channelCount"),Rt(f,O,"channelCountMode"),Rt(f,O,"channelInterpretation")},Ft=f=>"function"==typeof f.getFloatTimeDomainData,It=(f,O,I)=>{const V=O[I];void 0!==V&&V!==f[I].value&&(f[I].value=V)},Vt=f=>{f.start=(O=>(I=0,V=0,F)=>{if("number"==typeof F&&F<0||V<0||I<0)throw new RangeError("The parameters can't be negative.");O.call(f,I,V,F)})(f.start)},Nt=f=>{var O;f.stop=(O=f.stop,(I=0)=>{if(I<0)throw new RangeError("The parameter can't be negative.");O.call(f,I)})},Pt=(f,O)=>null===f?512:Math.max(512,Math.min(16384,Math.pow(2,Math.round(Math.log2(f*O))))),jt=(f,O)=>{const I=f.createBiquadFilter();return qt(I,O),It(I,O,"Q"),It(I,O,"detune"),It(I,O,"frequency"),It(I,O,"gain"),Rt(I,O,"type"),I},Lt=(f,O)=>{const I=f.createChannelSplitter(O.numberOfOutputs);return qt(I,O),(f=>{const O=f.numberOfOutputs;Object.defineProperty(f,"channelCount",{get:()=>O,set:f=>{if(f!==O)throw At()}}),Object.defineProperty(f,"channelCountMode",{get:()=>"explicit",set:f=>{if("explicit"!==f)throw At()}}),Object.defineProperty(f,"channelInterpretation",{get:()=>"discrete",set:f=>{if("discrete"!==f)throw At()}})})(I),I},zt=(f,O)=>(f.connect=O.connect.bind(O),f.disconnect=O.disconnect.bind(O),f),Wt=(f,O)=>{const I=f.createDelay(O.maxDelayTime);return qt(I,O),It(I,O,"delayTime"),I},Bt=(f,O)=>{const I=f.createGain();return qt(I,O),It(I,O,"gain"),I};function Ut(f,O){const I=O[0]*O[0]+O[1]*O[1];return[(f[0]*O[0]+f[1]*O[1])/I,(f[1]*O[0]-f[0]*O[1])/I]}function Gt(f,O){let I=[0,0];for(let P=f.length-1;P>=0;P-=1)F=O,I=[(V=I)[0]*F[0]-V[1]*F[1],V[0]*F[1]+V[1]*F[0]],I[0]+=f[P];var V,F;return I}const Qt=(f,O,I,V)=>f.createScriptProcessor(O,I,V),Zt=()=>new DOMException("","NotSupportedError"),be={numberOfChannels:1},Te={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:440,periodicWave:void 0,type:"sine"},Se={channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",coneInnerAngle:360,coneOuterAngle:360,coneOuterGain:0,distanceModel:"inverse",maxDistance:1e4,orientationX:1,orientationY:0,orientationZ:0,panningModel:"equalpower",positionX:0,positionY:0,positionZ:0,refDistance:1,rolloffFactor:1},ke={disableNormalization:!1},Ae={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",pan:0},Kt=()=>new DOMException("","UnknownError"),Ce={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",curve:null,oversample:"none"},ee=(f,O,I)=>void 0===f.copyFromChannel?f.getChannelData(I)[0]:(f.copyFromChannel(O,I),O[0]),se=f=>{if(null===f)return!1;const O=f.length;return O%2!=0?0!==f[Math.floor(O/2)]:f[O/2-1]+f[O/2]!==0},ne=(f,O,I,V)=>{let F=f;for(;!F.hasOwnProperty(O);)F=Object.getPrototypeOf(F);const{get:P,set:ut}=Object.getOwnPropertyDescriptor(F,O);Object.defineProperty(f,O,{get:I(P),set:V(ut)})},ie=(f,O,I)=>{try{f.setValueAtTime(O,I)}catch(V){if(9!==V.code)throw V;ie(f,O,I+1e-7)}},oe=f=>{const O=f.createOscillator();try{O.start(-1)}catch(f){return f instanceof RangeError}return!1},re=f=>{const O=f.createBuffer(1,1,44100),I=f.createBufferSource();I.buffer=O,I.start(),I.stop();try{return I.stop(),!0}catch{return!1}},ae=f=>{const O=f.createOscillator();try{O.stop(-1)}catch(f){return f instanceof RangeError}return!1},ce=()=>{try{new DOMException}catch{return!1}return!0},he=()=>new Promise((f=>{const O=new ArrayBuffer(0),{port1:I,port2:V}=new MessageChannel;I.onmessage=({data:O})=>f(null!==O),V.postMessage(O,[O])})),le=(f,O)=>{const I=O.createGain();f.connect(I);const V=(O=>()=>{O.call(f,I),f.removeEventListener("ended",V)})(f.disconnect);f.addEventListener("ended",V),zt(f,I),f.stop=(O=>{let V=!1;return(F=0)=>{if(V)try{O.call(f,F)}catch{I.gain.setValueAtTime(0,F)}else O.call(f,F),V=!0}})(f.stop)},ue=(f,O)=>I=>{const V={value:f};return Object.defineProperties(I,{currentTarget:V,target:V}),"function"==typeof O?O.call(f,I):O.handleEvent.call(f,I)},Oe=(f=>(O,I,[V,F,P],ut)=>{f(O[F],[I,V,P],(f=>f[0]===I&&f[1]===V),ut)})(G),De=(f=>(O,I,[V,F,P],ut)=>{const mt=O.get(V);void 0===mt?O.set(V,new Set([[F,I,P]])):f(mt,[F,I,P],(f=>f[0]===F&&f[1]===I),ut)})(G),Me=(f=>(O,I,V,F)=>f(O[F],(f=>f[0]===I&&f[1]===V)))(b),Re=new WeakMap,Ee=(f=>O=>{var I;return null!==(I=f.get(O))&&void 0!==I?I:0})(Re),qe=(Ie=new Map,Ve=new WeakMap,(f,O)=>{const I=Ve.get(f);if(void 0!==I)return I;const V=Ie.get(f);if(void 0!==V)return V;try{const I=O();return I instanceof Promise?(Ie.set(f,I),I.catch((()=>!1)).then((O=>(Ie.delete(f),Ve.set(f,O),O)))):(Ve.set(f,I),I)}catch{return Ve.set(f,!1),!1}});var Ie,Ve;const Fe="undefined"==typeof window?null:window,Pe=((f,O)=>(I,V)=>{const F=I.createAnalyser();if(qt(F,V),!(V.maxDecibels>V.minDecibels))throw O();return Rt(F,V,"fftSize"),Rt(F,V,"maxDecibels"),Rt(F,V,"minDecibels"),Rt(F,V,"smoothingTimeConstant"),f(Ft,(()=>Ft(F)))||(f=>{f.getFloatTimeDomainData=O=>{const I=new Uint8Array(O.length);f.getByteTimeDomainData(I);const V=Math.max(I.length,f.fftSize);for(let f=0;f<V;f+=1)O[f]=.0078125*(I[f]-128);return O}})(F),F})(qe,R),Ne=(f=>O=>{const I=f(O);if(null===I.renderer)throw new Error("Missing the renderer of the given AudioNode in the audio graph.");return I.renderer})(j),je=((f,O,I)=>async(V,F,P)=>{const ut=f(V);await Promise.all(ut.activeInputs.map(((f,ut)=>Array.from(f).map((async([f,mt])=>{const gt=O(f),vt=await gt.render(f,F),yt=V.context.destination;I(f)||V===yt&&I(V)||vt.connect(P,mt,ut)})))).reduce(((f,O)=>[...f,...O]),[]))})(j,Ne,st),Le=((f,O,I)=>()=>{const V=new WeakMap;return{render(F,P){const ut=V.get(P);return void 0!==ut?Promise.resolve(ut):(async(F,P)=>{let ut=O(F);if(!M(ut,P)){const O={channelCount:ut.channelCount,channelCountMode:ut.channelCountMode,channelInterpretation:ut.channelInterpretation,fftSize:ut.fftSize,maxDecibels:ut.maxDecibels,minDecibels:ut.minDecibels,smoothingTimeConstant:ut.smoothingTimeConstant};ut=f(P,O)}return V.set(P,ut),await I(F,P,ut),ut})(F,P)}}})(Pe,tt,je),Be=(ze=yt,f=>{const O=ze.get(f);if(void 0===O)throw At();return O});var ze;const We=(f=>null===f?null:f.hasOwnProperty("OfflineAudioContext")?f.OfflineAudioContext:f.hasOwnProperty("webkitOfflineAudioContext")?f.webkitOfflineAudioContext:null)(Fe),Ue=(f=>O=>null!==f&&O instanceof f)(We),Ge=new WeakMap,Ye=(f=>class{constructor(f){this._nativeEventTarget=f,this._listeners=new WeakMap}addEventListener(O,I,V){if(null!==I){let F=this._listeners.get(I);void 0===F&&(F=f(this,I),"function"==typeof I&&this._listeners.set(I,F)),this._nativeEventTarget.addEventListener(O,F,V)}}dispatchEvent(f){return this._nativeEventTarget.dispatchEvent(f)}removeEventListener(f,O,I){const V=null===O?void 0:this._listeners.get(O);this._nativeEventTarget.removeEventListener(f,void 0===V?null:V,I)}})(ue),Ze=(f=>null===f?null:f.hasOwnProperty("AudioContext")?f.AudioContext:f.hasOwnProperty("webkitAudioContext")?f.webkitAudioContext:null)(Fe),Xe=(f=>O=>null!==f&&O instanceof f)(Ze),Qe=(f=>O=>null!==f&&"function"==typeof f.AudioNode&&O instanceof f.AudioNode)(Fe),He=(f=>O=>null!==f&&"function"==typeof f.AudioParam&&O instanceof f.AudioParam)(Fe),$e=(f=>null===f?null:f.hasOwnProperty("AudioWorkletNode")?f.AudioWorkletNode:null)(Fe),Ke=((f,O,I,V,F,P,ut,gt,vt,yt,bt,St,kt,Dt,Mt,Yt)=>class extends yt{constructor(O,V,F,P){super(F),this._context=O,this._nativeAudioNode=F;const ut=bt(O);St(ut)&&!0!==I(it,(()=>it(ut,Yt)))&&at(F),mt.set(this,F),xt.set(this,new Set),"closed"!==O.state&&V&&k(this),f(this,P,F)}get channelCount(){return this._nativeAudioNode.channelCount}set channelCount(f){this._nativeAudioNode.channelCount=f}get channelCountMode(){return this._nativeAudioNode.channelCountMode}set channelCountMode(f){this._nativeAudioNode.channelCountMode=f}get channelInterpretation(){return this._nativeAudioNode.channelInterpretation}set channelInterpretation(f){this._nativeAudioNode.channelInterpretation=f}get context(){return this._context}get numberOfInputs(){return this._nativeAudioNode.numberOfInputs}get numberOfOutputs(){return this._nativeAudioNode.numberOfOutputs}connect(f,I=0,mt=0){if(I<0||I>=this._nativeAudioNode.numberOfOutputs)throw F();const gt=bt(this._context),yt=Mt(gt);if(kt(f)||Dt(f))throw P();if(B(f)){const F=tt(f);try{const O=Y(this._nativeAudioNode,F,I,mt),V=nt(this);(yt||V)&&this._nativeAudioNode.disconnect(...O),"closed"!==this.context.state&&!V&&nt(f)&&k(f)}catch(f){if(12===f.code)throw P();throw f}if(O(this,f,I,mt,yt)){const O=vt([this],f);ot(O,V(yt))}return f}const xt=et(f);if("playbackRate"===xt.name&&1024===xt.maxValue)throw ut();try{this._nativeAudioNode.connect(xt,I),(yt||nt(this))&&this._nativeAudioNode.disconnect(xt,I)}catch(f){if(12===f.code)throw P();throw f}if(((f,O,I,V)=>{const{activeInputs:F,passiveInputs:P}=L(O),{outputs:ut}=j(f),mt=S(f),c=ut=>{const mt=tt(f),gt=et(O);if(ut){const O=J(P,f,I);Q(F,f,O,!1),V||st(f)||mt.connect(gt,I)}else{const O=((f,O,I)=>b(f,(f=>f[0]===O&&f[1]===I)))(F,f,I);Z(P,O,!1),V||st(f)||mt.disconnect(gt,I)}};return!!G(ut,[O,I],(f=>f[0]===O&&f[1]===I),!0)&&(mt.add(c),N(f)?Q(F,f,[I,c],!0):Z(P,[f,I,c],!0),!0)})(this,f,I,yt)){const O=vt([this],f);ot(O,V(yt))}}disconnect(f,O,I){let V;const ut=bt(this._context),mt=Mt(ut);if(void 0===f)V=((f,O)=>{const I=j(f),V=[];for(const F of I.outputs)U(F)?ct(f,O,...F):ht(f,O,...F),V.push(F[0]);return I.outputs.clear(),V})(this,mt);else if("number"==typeof f){if(f<0||f>=this.numberOfOutputs)throw F();V=((f,O,I)=>{const V=j(f),F=[];for(const P of V.outputs)P[1]===I&&(U(P)?ct(f,O,...P):ht(f,O,...P),F.push(P[0]),V.outputs.delete(P));return F})(this,mt,f)}else{if(void 0!==O&&(O<0||O>=this.numberOfOutputs))throw F();if(B(f)&&void 0!==I&&(I<0||I>=f.numberOfInputs))throw F();if(V=((f,O,I,V,F)=>{const P=j(f);return Array.from(P.outputs).filter((f=>!(f[0]!==I||void 0!==V&&f[1]!==V||void 0!==F&&f[2]!==F))).map((I=>(U(I)?ct(f,O,...I):ht(f,O,...I),P.outputs.delete(I),I[0])))})(this,mt,f,O,I),0===V.length)throw P()}for(const f of V){const O=vt([this],f);ot(O,gt)}}})((Je=ut,(f,O,I)=>{const V=[];for(let f=0;f<I.numberOfInputs;f+=1)V.push(new Set);Je.set(f,{activeInputs:V,outputs:new Set,passiveInputs:new WeakMap,renderer:O})}),((f,O,I,V,F,P,ut,mt,gt,vt,yt,xt,bt)=>{const St=new WeakMap;return(kt,Dt,Mt,Yt,Xt)=>{const{activeInputs:Ht,passiveInputs:$t}=P(Dt),{outputs:Jt}=P(kt),te=mt(kt),S=P=>{const mt=gt(Dt),vt=gt(kt);if(P){const O=T($t,kt,Mt,Yt);f(Ht,kt,O,!1),Xt||xt(kt)||I(vt,mt,Mt,Yt),bt(Dt)&&k(Dt)}else{const f=V(Ht,kt,Mt,Yt);O($t,Yt,f,!1),Xt||xt(kt)||F(vt,mt,Mt,Yt);const I=ut(Dt);if(0===I)yt(Dt)&&D(Dt,Ht);else{const f=St.get(Dt);void 0!==f&&clearTimeout(f),St.set(Dt,setTimeout((()=>{yt(Dt)&&D(Dt,Ht)}),1e3*I))}}};return!!vt(Jt,[Dt,Mt,Yt],(f=>f[0]===Dt&&f[1]===Mt&&f[2]===Yt),!0)&&(te.add(S),yt(kt)?f(Ht,kt,[Mt,Yt,S],!0):O($t,Yt,[kt,Mt,S],!0),!0)}})(Oe,De,Y,Me,K,j,Ee,S,tt,G,N,st,nt),qe,((f,O,I,V,F,P)=>ut=>(mt,gt)=>{const vt=f.get(mt);if(void 0===vt){if(!ut&&P(mt)){const f=V(mt),{outputs:P}=I(mt);for(const I of P)if(U(I)){const F=V(I[0]);O(f,F,I[1],I[2])}else{const O=F(I[0]);f.disconnect(O,I[1])}}f.set(mt,gt)}else f.set(mt,vt+gt)})(bt,K,j,tt,et,N),R,Ct,Zt,((f,O,I,V,F,P,ut,mt)=>(gt,vt)=>{const yt=O.get(gt);if(void 0===yt)throw new Error("Missing the expected cycle count.");const xt=P(gt.context),bt=mt(xt);if(yt===vt){if(O.delete(gt),!bt&&ut(gt)){const O=V(gt),{outputs:P}=I(gt);for(const I of P)if(U(I)){const F=V(I[0]);f(O,F,I[1],I[2])}else{const f=F(I[0]);O.connect(f,I[1])}}}else O.set(gt,yt-vt)})(Y,bt,j,tt,et,Be,N,Ue),((f,O,I)=>function n(V,F){const P=B(F)?F:I(f,F);if((f=>"delayTime"in f)(P))return[];if(V[0]===P)return[V];if(V.includes(P))return[];const{outputs:ut}=O(P);return Array.from(ut).map((f=>n([...V,P],f[0]))).reduce(((f,O)=>f.concat(O)),[])})(Ge,j,w),Ye,Be,Xe,Qe,He,Ue,$e);var Je;const ts=((f,O,I,V,F,P)=>class extends f{constructor(f,I){const ut=F(f),mt={...Yt,...I},gt=V(ut,mt);super(f,!1,gt,P(ut)?O():null),this._nativeAnalyserNode=gt}get fftSize(){return this._nativeAnalyserNode.fftSize}set fftSize(f){this._nativeAnalyserNode.fftSize=f}get frequencyBinCount(){return this._nativeAnalyserNode.frequencyBinCount}get maxDecibels(){return this._nativeAnalyserNode.maxDecibels}set maxDecibels(f){const O=this._nativeAnalyserNode.maxDecibels;if(this._nativeAnalyserNode.maxDecibels=f,!(f>this._nativeAnalyserNode.minDecibels))throw this._nativeAnalyserNode.maxDecibels=O,I()}get minDecibels(){return this._nativeAnalyserNode.minDecibels}set minDecibels(f){const O=this._nativeAnalyserNode.minDecibels;if(this._nativeAnalyserNode.minDecibels=f,!(this._nativeAnalyserNode.maxDecibels>f))throw this._nativeAnalyserNode.minDecibels=O,I()}get smoothingTimeConstant(){return this._nativeAnalyserNode.smoothingTimeConstant}set smoothingTimeConstant(f){this._nativeAnalyserNode.smoothingTimeConstant=f}getByteFrequencyData(f){this._nativeAnalyserNode.getByteFrequencyData(f)}getByteTimeDomainData(f){this._nativeAnalyserNode.getByteTimeDomainData(f)}getFloatFrequencyData(f){this._nativeAnalyserNode.getFloatFrequencyData(f)}getFloatTimeDomainData(f){this._nativeAnalyserNode.getFloatTimeDomainData(f)}})(Ke,Le,R,Pe,Be,Ue),es=new WeakSet,ss=(f=>null===f?null:f.hasOwnProperty("AudioBuffer")?f.AudioBuffer:null)(Fe),ns=(is=new Uint32Array(1),f=>(is[0]=f,is[0]));var is;const os=((f,O)=>I=>{I.copyFromChannel=(V,F,P=0)=>{const ut=f(P),mt=f(F);if(mt>=I.numberOfChannels)throw O();const gt=I.length,vt=I.getChannelData(mt),yt=V.length;for(let f=ut<0?-ut:0;f+ut<gt&&f<yt;f+=1)V[f]=vt[f+ut]},I.copyToChannel=(V,F,P=0)=>{const ut=f(P),mt=f(F);if(mt>=I.numberOfChannels)throw O();const gt=I.length,vt=I.getChannelData(mt),yt=V.length;for(let f=ut<0?-ut:0;f+ut<gt&&f<yt;f+=1)vt[f+ut]=V[f]}})(ns,R),rs=(f=>O=>{O.copyFromChannel=(I=>(V,F,P=0)=>{const ut=f(P),mt=f(F);if(ut<O.length)return I.call(O,V,mt,ut)})(O.copyFromChannel),O.copyToChannel=(I=>(V,F,P=0)=>{const ut=f(P),mt=f(F);if(ut<O.length)return I.call(O,V,mt,ut)})(O.copyToChannel)})(ns),as=((f,O,I,V,F,P,ut,mt)=>{let gt=null;return class h{constructor(vt){if(null===F)throw new Error("Missing the native OfflineAudioContext constructor.");const{length:yt,numberOfChannels:xt,sampleRate:bt}={...Xt,...vt};null===gt&&(gt=new F(1,1,44100));const St=null!==V&&O(P,P)?new V({length:yt,numberOfChannels:xt,sampleRate:bt}):gt.createBuffer(xt,yt,bt);if(0===St.numberOfChannels)throw I();return"function"!=typeof St.copyFromChannel?(ut(St),q(St)):O(E,(()=>E(St)))||mt(St),f.add(St),St}static[Symbol.hasInstance](O){return null!==O&&"object"==typeof O&&Object.getPrototypeOf(O)===h.prototype||f.has(O)}}})(es,qe,Zt,ss,We,(f=>()=>{if(null===f)return!1;try{new f({length:1,sampleRate:44100})}catch{return!1}return!0})(ss),os,rs),cs=(f=>(O,I)=>{const V=f(O,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});I.connect(V).connect(O.destination);const i=()=>{I.removeEventListener("ended",i),I.disconnect(V),V.disconnect()};I.addEventListener("ended",i)})(Bt),hs=((f,O,I)=>async(V,F,P)=>{const ut=O(V);await Promise.all(Array.from(ut.activeInputs).map((async([O,V])=>{const ut=f(O),mt=await ut.render(O,F);I(O)||mt.connect(P,V)})))})(Ne,L,st),us=(f=>(O,I,V)=>f(I,O,V))(hs),ls=((f,O,I,V,F,P,ut,mt,gt,vt,yt)=>(gt,xt)=>{const bt=gt.createBufferSource();return qt(bt,xt),It(bt,xt,"playbackRate"),Rt(bt,xt,"buffer"),Rt(bt,xt,"loop"),Rt(bt,xt,"loopEnd"),Rt(bt,xt,"loopStart"),O(I,(()=>I(gt)))||(f=>{f.start=(O=>{let I=!1;return(V=0,F=0,P)=>{if(I)throw At();O.call(f,V,F,P),I=!0}})(f.start)})(bt),O(V,(()=>V(gt)))||(f=>{f.start=(O=>(I=0,V=0,F)=>{const P=f.buffer,ut=null===P?V:Math.min(P.duration,V);null!==P&&ut>P.duration-.5/f.context.sampleRate?O.call(f,I,0,0):O.call(f,I,ut,F)})(f.start)})(bt),O(F,(()=>F(gt)))||vt(bt,gt),O(P,(()=>P(gt)))||Vt(bt),O(ut,(()=>ut(gt)))||yt(bt,gt),O(mt,(()=>mt(gt)))||Nt(bt),f(gt,bt),bt})(cs,qe,(f=>{const O=f.createBufferSource();O.start();try{O.start()}catch{return!0}return!1}),(f=>{const O=f.createBufferSource(),I=f.createBuffer(1,1,44100);O.buffer=I;try{O.start(0,1)}catch{return!1}return!0}),(f=>{const O=f.createBufferSource();O.start();try{O.stop()}catch{return!1}return!0}),oe,re,ae,0,(f=>(O,I)=>{const V=I.createBuffer(1,1,44100);null===O.buffer&&(O.buffer=V),f(O,"buffer",(f=>()=>{const I=f.call(O);return I===V?null:I}),(f=>I=>f.call(O,null===I?V:I)))})(ne),le),ps=((f,O)=>(I,V,F)=>(f(V).replay(F),O(V,I,F)))((f=>O=>{const I=f(O);if(null===I.renderer)throw new Error("Missing the renderer of the given AudioParam in the audio graph.");return I.renderer})(L),hs),ds=((f,O,I,V,F)=>()=>{const P=new WeakMap;let ut=null,mt=null;return{set start(f){ut=f},set stop(f){mt=f},render(gt,vt){const yt=P.get(vt);return void 0!==yt?Promise.resolve(yt):(async(gt,vt)=>{let yt=I(gt);const xt=M(yt,vt);if(!xt){const f={buffer:yt.buffer,channelCount:yt.channelCount,channelCountMode:yt.channelCountMode,channelInterpretation:yt.channelInterpretation,loop:yt.loop,loopEnd:yt.loopEnd,loopStart:yt.loopStart,playbackRate:yt.playbackRate.value};yt=O(vt,f),null!==ut&&yt.start(...ut),null!==mt&&yt.stop(mt)}return P.set(vt,yt),xt?await f(vt,gt.playbackRate,yt.playbackRate):await V(vt,gt.playbackRate,yt.playbackRate),await F(gt,vt,yt),yt})(gt,vt)}}})(us,ls,tt,ps,je),fs=((f,O,I,V,P,ut,mt,gt,vt,yt,xt,bt,St)=>(V,kt,Dt,Mt=null,Yt=null)=>{const Xt=Dt.value,Ht=new F.AutomationEventList(Xt),$t=kt?(f=>({replay(O){for(const I of f)if("exponentialRampToValue"===I.type){const{endTime:f,value:V}=I;O.exponentialRampToValueAtTime(V,f)}else if("linearRampToValue"===I.type){const{endTime:f,value:V}=I;O.linearRampToValueAtTime(V,f)}else if("setTarget"===I.type){const{startTime:f,target:V,timeConstant:F}=I;O.setTargetAtTime(V,f,F)}else if("setValue"===I.type){const{startTime:f,value:V}=I;O.setValueAtTime(V,f)}else{if("setValueCurve"!==I.type)throw new Error("Can't apply an unknown automation.");{const{duration:f,startTime:V,values:F}=I;O.setValueCurveAtTime(F,V,f)}}}}))(Ht):null,Jt={get defaultValue(){return Xt},get maxValue(){return null===Mt?Dt.maxValue:Mt},get minValue(){return null===Yt?Dt.minValue:Yt},get value(){return Dt.value},set value(f){Dt.value=f,Jt.setValueAtTime(f,V.context.currentTime)},cancelAndHoldAtTime(f){if("function"==typeof Dt.cancelAndHoldAtTime)null===$t&&Ht.flush(V.context.currentTime),Ht.add(P(f)),Dt.cancelAndHoldAtTime(f);else{const O=Array.from(Ht).pop();null===$t&&Ht.flush(V.context.currentTime),Ht.add(P(f));const I=Array.from(Ht).pop();Dt.cancelScheduledValues(f),O!==I&&void 0!==I&&("exponentialRampToValue"===I.type?Dt.exponentialRampToValueAtTime(I.value,I.endTime):"linearRampToValue"===I.type?Dt.linearRampToValueAtTime(I.value,I.endTime):"setValue"===I.type?Dt.setValueAtTime(I.value,I.startTime):"setValueCurve"===I.type&&Dt.setValueCurveAtTime(I.values,I.startTime,I.duration))}return Jt},cancelScheduledValues:f=>(null===$t&&Ht.flush(V.context.currentTime),Ht.add(ut(f)),Dt.cancelScheduledValues(f),Jt),exponentialRampToValueAtTime(f,O){if(0===f)throw new RangeError;if(!Number.isFinite(O)||O<0)throw new RangeError;const I=V.context.currentTime;return null===$t&&Ht.flush(I),0===Array.from(Ht).length&&(Ht.add(yt(Xt,I)),Dt.setValueAtTime(Xt,I)),Ht.add(mt(f,O)),Dt.exponentialRampToValueAtTime(f,O),Jt},linearRampToValueAtTime(f,O){const I=V.context.currentTime;return null===$t&&Ht.flush(I),0===Array.from(Ht).length&&(Ht.add(yt(Xt,I)),Dt.setValueAtTime(Xt,I)),Ht.add(gt(f,O)),Dt.linearRampToValueAtTime(f,O),Jt},setTargetAtTime:(f,O,I)=>(null===$t&&Ht.flush(V.context.currentTime),Ht.add(vt(f,O,I)),Dt.setTargetAtTime(f,O,I),Jt),setValueAtTime:(f,O)=>(null===$t&&Ht.flush(V.context.currentTime),Ht.add(yt(f,O)),Dt.setValueAtTime(f,O),Jt),setValueCurveAtTime(f,O,I){const F=f instanceof Float32Array?f:new Float32Array(f);if(null!==bt&&"webkitAudioContext"===bt.name){const f=O+I,P=V.context.sampleRate,ut=Math.ceil(O*P),mt=Math.floor(f*P),gt=mt-ut,vt=new Float32Array(gt);for(let f=0;f<gt;f+=1){const V=(F.length-1)/I*((ut+f)/P-O),mt=Math.floor(V),gt=Math.ceil(V);vt[f]=mt===gt?F[mt]:(1-(V-mt))*F[mt]+(1-(gt-V))*F[gt]}null===$t&&Ht.flush(V.context.currentTime),Ht.add(xt(vt,O,I)),Dt.setValueCurveAtTime(vt,O,I);const yt=mt/P;yt<f&&St(Jt,vt[vt.length-1],yt),St(Jt,F[F.length-1],f)}else null===$t&&Ht.flush(V.context.currentTime),Ht.add(xt(F,O,I)),Dt.setValueCurveAtTime(F,O,I);return Jt}};return I.set(Jt,Dt),O.set(Jt,V),f(Jt,$t),Jt})((_s=gt,(f,O)=>{_s.set(f,{activeInputs:new Set,passiveInputs:new WeakMap,renderer:O})}),Ge,vt,0,F.createCancelAndHoldAutomationEvent,F.createCancelScheduledValuesAutomationEvent,F.createExponentialRampToValueAutomationEvent,F.createLinearRampToValueAutomationEvent,F.createSetTargetAutomationEvent,F.createSetValueAutomationEvent,F.createSetValueCurveAutomationEvent,Ze,ie);var _s;const ms=((f,O,I,V,F,P,ut,mt)=>class extends f{constructor(f,V){const mt=P(f),gt={...Jt,...V},vt=F(mt,gt),yt=ut(mt),xt=yt?O():null;super(f,!1,vt,xt),this._audioBufferSourceNodeRenderer=xt,this._isBufferNullified=!1,this._isBufferSet=null!==gt.buffer,this._nativeAudioBufferSourceNode=vt,this._onended=null,this._playbackRate=I(this,yt,vt.playbackRate,$t,Ht)}get buffer(){return this._isBufferNullified?null:this._nativeAudioBufferSourceNode.buffer}set buffer(f){if(this._nativeAudioBufferSourceNode.buffer=f,null!==f){if(this._isBufferSet)throw V();this._isBufferSet=!0}}get loop(){return this._nativeAudioBufferSourceNode.loop}set loop(f){this._nativeAudioBufferSourceNode.loop=f}get loopEnd(){return this._nativeAudioBufferSourceNode.loopEnd}set loopEnd(f){this._nativeAudioBufferSourceNode.loopEnd=f}get loopStart(){return this._nativeAudioBufferSourceNode.loopStart}set loopStart(f){this._nativeAudioBufferSourceNode.loopStart=f}get onended(){return this._onended}set onended(f){const O="function"==typeof f?mt(this,f):null;this._nativeAudioBufferSourceNode.onended=O;const I=this._nativeAudioBufferSourceNode.onended;this._onended=null!==I&&I===O?f:I}get playbackRate(){return this._playbackRate}start(f=0,O=0,I){if(this._nativeAudioBufferSourceNode.start(f,O,I),null!==this._audioBufferSourceNodeRenderer&&(this._audioBufferSourceNodeRenderer.start=void 0===I?[f,O]:[f,O,I]),"closed"!==this.context.state){k(this);const t=()=>{this._nativeAudioBufferSourceNode.removeEventListener("ended",t),N(this)&&C(this)};this._nativeAudioBufferSourceNode.addEventListener("ended",t)}}stop(f=0){this._nativeAudioBufferSourceNode.stop(f),null!==this._audioBufferSourceNodeRenderer&&(this._audioBufferSourceNodeRenderer.stop=f)}})(Ke,ds,fs,At,ls,Be,Ue,ue),gs=((f,O,I,V,F,P,ut,mt)=>class extends f{constructor(f,O){const I=P(f),V=ut(I),gt=F(I,O,V);super(f,!1,gt,V?(f=>{const O=new WeakMap;return{render(I,V){const F=O.get(V);return void 0!==F?Promise.resolve(F):(async(I,V)=>{const F=V.destination;return O.set(V,F),await f(I,V,F),F})(I,V)}}})(mt):null),this._isNodeOfNativeOfflineAudioContext=V,this._nativeAudioDestinationNode=gt}get channelCount(){return this._nativeAudioDestinationNode.channelCount}set channelCount(f){if(this._isNodeOfNativeOfflineAudioContext)throw V();if(f>this._nativeAudioDestinationNode.maxChannelCount)throw I();this._nativeAudioDestinationNode.channelCount=f}get channelCountMode(){return this._nativeAudioDestinationNode.channelCountMode}set channelCountMode(f){if(this._isNodeOfNativeOfflineAudioContext)throw V();this._nativeAudioDestinationNode.channelCountMode=f}get maxChannelCount(){return this._nativeAudioDestinationNode.maxChannelCount}})(Ke,0,R,At,((f,O)=>(I,V,F)=>{const P=I.destination;if(P.channelCount!==V)try{P.channelCount=V}catch{}F&&"explicit"!==P.channelCountMode&&(P.channelCountMode="explicit"),0===P.maxChannelCount&&Object.defineProperty(P,"maxChannelCount",{value:V});const ut=f(I,{channelCount:V,channelCountMode:P.channelCountMode,channelInterpretation:P.channelInterpretation,gain:1});return O(ut,"channelCount",(f=>()=>f.call(ut)),(f=>O=>{f.call(ut,O);try{P.channelCount=O}catch(f){if(O>P.maxChannelCount)throw f}})),O(ut,"channelCountMode",(f=>()=>f.call(ut)),(f=>O=>{f.call(ut,O),P.channelCountMode=O})),O(ut,"channelInterpretation",(f=>()=>f.call(ut)),(f=>O=>{f.call(ut,O),P.channelInterpretation=O})),Object.defineProperty(ut,"maxChannelCount",{get:()=>P.maxChannelCount}),ut.connect(P),ut})(Bt,ne),Be,Ue,je),vs=((f,O,I,V,F)=>()=>{const P=new WeakMap;return{render(ut,mt){const gt=P.get(mt);return void 0!==gt?Promise.resolve(gt):(async(ut,mt)=>{let gt=I(ut);const vt=M(gt,mt);if(!vt){const f={Q:gt.Q.value,channelCount:gt.channelCount,channelCountMode:gt.channelCountMode,channelInterpretation:gt.channelInterpretation,detune:gt.detune.value,frequency:gt.frequency.value,gain:gt.gain.value,type:gt.type};gt=O(mt,f)}return P.set(mt,gt),vt?(await f(mt,ut.Q,gt.Q),await f(mt,ut.detune,gt.detune),await f(mt,ut.frequency,gt.frequency),await f(mt,ut.gain,gt.gain)):(await V(mt,ut.Q,gt.Q),await V(mt,ut.detune,gt.detune),await V(mt,ut.frequency,gt.frequency),await V(mt,ut.gain,gt.gain)),await F(ut,mt,gt),gt})(ut,mt)}}})(us,jt,tt,ps,je),ys=(f=>(O,I)=>f.set(O,I))(Re),xs=((f,O,I,V,F,P,ut,mt)=>class extends f{constructor(f,V){const gt=P(f),vt={...pe,...V},yt=F(gt,vt),xt=ut(gt);super(f,!1,yt,xt?I():null),this._Q=O(this,xt,yt.Q,$t,Ht),this._detune=O(this,xt,yt.detune,1200*Math.log2($t),-1200*Math.log2($t)),this._frequency=O(this,xt,yt.frequency,f.sampleRate/2,0),this._gain=O(this,xt,yt.gain,40*Math.log10($t),Ht),this._nativeBiquadFilterNode=yt,mt(this,1)}get detune(){return this._detune}get frequency(){return this._frequency}get gain(){return this._gain}get Q(){return this._Q}get type(){return this._nativeBiquadFilterNode.type}set type(f){this._nativeBiquadFilterNode.type=f}getFrequencyResponse(f,O,I){try{this._nativeBiquadFilterNode.getFrequencyResponse(f,O,I)}catch(f){if(11===f.code)throw V();throw f}if(f.length!==O.length||O.length!==I.length)throw V()}})(Ke,fs,vs,Ct,jt,Be,Ue,ys),ws=((f,O)=>(I,V,F)=>{const P=new Set;return I.connect=(F=>(ut,mt=0,gt=0)=>{const vt=0===P.size;if(O(ut))return F.call(I,ut,mt,gt),f(P,[ut,mt,gt],(f=>f[0]===ut&&f[1]===mt&&f[2]===gt),!0),vt&&V(),ut;F.call(I,ut,mt),f(P,[ut,mt],(f=>f[0]===ut&&f[1]===mt),!0),vt&&V()})(I.connect),I.disconnect=(f=>(V,ut,mt)=>{const gt=P.size>0;if(void 0===V)f.apply(I),P.clear();else if("number"==typeof V){f.call(I,V);for(const f of P)f[1]===V&&P.delete(f)}else{O(V)?f.call(I,V,ut,mt):f.call(I,V,ut);for(const f of P)f[0]!==V||void 0!==ut&&f[1]!==ut||void 0!==mt&&f[2]!==mt||P.delete(f)}const vt=0===P.size;gt&&vt&&F()})(I.disconnect),I})(G,Qe),bs=((f,O)=>(I,V)=>{V.channelCount=1,V.channelCountMode="explicit",Object.defineProperty(V,"channelCount",{get:()=>1,set:()=>{throw f()}}),Object.defineProperty(V,"channelCountMode",{get:()=>"explicit",set:()=>{throw f()}});const F=I.createBufferSource();O(V,(()=>{const f=V.numberOfInputs;for(let O=0;O<f;O+=1)F.connect(V,0,O)}),(()=>F.disconnect(V)))})(At,ws),Ts=((f,O)=>(I,V)=>{const F=I.createChannelMerger(V.numberOfInputs);return null!==f&&"webkitAudioContext"===f.name&&O(I,F),qt(F,V),F})(Ze,bs),Ss=((f,O,I)=>()=>{const V=new WeakMap;return{render(F,P){const ut=V.get(P);return void 0!==ut?Promise.resolve(ut):(async(F,P)=>{let ut=O(F);if(!M(ut,P)){const O={channelCount:ut.channelCount,channelCountMode:ut.channelCountMode,channelInterpretation:ut.channelInterpretation,numberOfInputs:ut.numberOfInputs};ut=f(P,O)}return V.set(P,ut),await I(F,P,ut),ut})(F,P)}}})(Ts,tt,je),ks=((f,O,I,V,F)=>class extends f{constructor(f,P){const ut=V(f),mt={...de,...P};super(f,!1,I(ut,mt),F(ut)?O():null)}})(Ke,Ss,Ts,Be,Ue),As=((f,O,I)=>()=>{const V=new WeakMap;return{render(F,P){const ut=V.get(P);return void 0!==ut?Promise.resolve(ut):(async(F,P)=>{let ut=O(F);if(!M(ut,P)){const O={channelCount:ut.channelCount,channelCountMode:ut.channelCountMode,channelInterpretation:ut.channelInterpretation,numberOfOutputs:ut.numberOfOutputs};ut=f(P,O)}return V.set(P,ut),await I(F,P,ut),ut})(F,P)}}})(Lt,tt,je),Cs=((f,O,I,V,F,P)=>class extends f{constructor(f,P){const ut=V(f),mt=(f=>({...f,channelCount:f.numberOfOutputs}))({...fe,...P});super(f,!1,I(ut,mt),F(ut)?O():null)}})(Ke,As,Lt,Be,Ue),Os=((f,O,I,V)=>(F,{offset:P,...ut})=>{const mt=F.createBuffer(1,2,44100),gt=O(F,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),vt=I(F,{...ut,gain:P}),yt=mt.getChannelData(0);yt[0]=1,yt[1]=1,gt.buffer=mt,gt.loop=!0;const xt={get bufferSize(){},get channelCount(){return vt.channelCount},set channelCount(f){vt.channelCount=f},get channelCountMode(){return vt.channelCountMode},set channelCountMode(f){vt.channelCountMode=f},get channelInterpretation(){return vt.channelInterpretation},set channelInterpretation(f){vt.channelInterpretation=f},get context(){return vt.context},get inputs(){return[]},get numberOfInputs(){return gt.numberOfInputs},get numberOfOutputs(){return vt.numberOfOutputs},get offset(){return vt.gain},get onended(){return gt.onended},set onended(f){gt.onended=f},addEventListener:(...f)=>gt.addEventListener(f[0],f[1],f[2]),dispatchEvent:(...f)=>gt.dispatchEvent(f[0]),removeEventListener:(...f)=>gt.removeEventListener(f[0],f[1],f[2]),start(f=0){gt.start.call(gt,f)},stop(f=0){gt.stop.call(gt,f)}};return f(F,gt),V(zt(xt,vt),(()=>gt.connect(vt)),(()=>gt.disconnect(vt)))})(cs,ls,Bt,ws),Ds=((f,O,I,V,F)=>(P,ut)=>{if(void 0===P.createConstantSource)return I(P,ut);const mt=P.createConstantSource();return qt(mt,ut),It(mt,ut,"offset"),O(V,(()=>V(P)))||Vt(mt),O(F,(()=>F(P)))||Nt(mt),f(P,mt),mt})(cs,qe,Os,oe,ae),Ms=((f,O,I,V,F)=>()=>{const P=new WeakMap;let ut=null,mt=null;return{set start(f){ut=f},set stop(f){mt=f},render(gt,vt){const yt=P.get(vt);return void 0!==yt?Promise.resolve(yt):(async(gt,vt)=>{let yt=I(gt);const xt=M(yt,vt);if(!xt){const f={channelCount:yt.channelCount,channelCountMode:yt.channelCountMode,channelInterpretation:yt.channelInterpretation,offset:yt.offset.value};yt=O(vt,f),null!==ut&&yt.start(ut),null!==mt&&yt.stop(mt)}return P.set(vt,yt),xt?await f(vt,gt.offset,yt.offset):await V(vt,gt.offset,yt.offset),await F(gt,vt,yt),yt})(gt,vt)}}})(us,Ds,tt,ps,je),Rs=((f,O,I,V,F,P,ut)=>class extends f{constructor(f,ut){const mt=F(f),gt={..._e,...ut},vt=V(mt,gt),yt=P(mt),xt=yt?I():null;super(f,!1,vt,xt),this._constantSourceNodeRenderer=xt,this._nativeConstantSourceNode=vt,this._offset=O(this,yt,vt.offset,$t,Ht),this._onended=null}get offset(){return this._offset}get onended(){return this._onended}set onended(f){const O="function"==typeof f?ut(this,f):null;this._nativeConstantSourceNode.onended=O;const I=this._nativeConstantSourceNode.onended;this._onended=null!==I&&I===O?f:I}start(f=0){if(this._nativeConstantSourceNode.start(f),null!==this._constantSourceNodeRenderer&&(this._constantSourceNodeRenderer.start=f),"closed"!==this.context.state){k(this);const t=()=>{this._nativeConstantSourceNode.removeEventListener("ended",t),N(this)&&C(this)};this._nativeConstantSourceNode.addEventListener("ended",t)}}stop(f=0){this._nativeConstantSourceNode.stop(f),null!==this._constantSourceNodeRenderer&&(this._constantSourceNodeRenderer.stop=f)}})(Ke,fs,Ms,Ds,Be,Ue,ue),Es=((f,O)=>(I,V)=>{const F=I.createConvolver();if(qt(F,V),V.disableNormalization===F.normalize&&(F.normalize=!V.disableNormalization),Rt(F,V,"buffer"),V.channelCount>2)throw f();if(O(F,"channelCount",(f=>()=>f.call(F)),(O=>I=>{if(I>2)throw f();return O.call(F,I)})),"max"===V.channelCountMode)throw f();return O(F,"channelCountMode",(f=>()=>f.call(F)),(O=>I=>{if("max"===I)throw f();return O.call(F,I)})),F})(Zt,ne),qs=((f,O,I)=>()=>{const V=new WeakMap;return{render(F,P){const ut=V.get(P);return void 0!==ut?Promise.resolve(ut):(async(F,P)=>{let ut=O(F);if(!M(ut,P)){const O={buffer:ut.buffer,channelCount:ut.channelCount,channelCountMode:ut.channelCountMode,channelInterpretation:ut.channelInterpretation,disableNormalization:!ut.normalize};ut=f(P,O)}return V.set(P,ut),X(ut)?await I(F,P,ut.inputs[0]):await I(F,P,ut),ut})(F,P)}}})(Es,tt,je),Is=((f,O,I,V,F,P)=>class extends f{constructor(f,ut){const mt=V(f),gt={...me,...ut},vt=I(mt,gt);super(f,!1,vt,F(mt)?O():null),this._isBufferNullified=!1,this._nativeConvolverNode=vt,null!==gt.buffer&&P(this,gt.buffer.duration)}get buffer(){return this._isBufferNullified?null:this._nativeConvolverNode.buffer}set buffer(f){if(this._nativeConvolverNode.buffer=f,null===f&&null!==this._nativeConvolverNode.buffer){const f=this._nativeConvolverNode.context;this._nativeConvolverNode.buffer=f.createBuffer(1,1,f.sampleRate),this._isBufferNullified=!0,P(this,0)}else this._isBufferNullified=!1,P(this,null===this._nativeConvolverNode.buffer?0:this._nativeConvolverNode.buffer.duration)}get normalize(){return this._nativeConvolverNode.normalize}set normalize(f){this._nativeConvolverNode.normalize=f}})(Ke,qs,Es,Be,Ue,ys),Vs=((f,O,I,V,F)=>P=>{const ut=new WeakMap;return{render(mt,gt){const vt=ut.get(gt);return void 0!==vt?Promise.resolve(vt):(async(mt,gt)=>{let vt=I(mt);const yt=M(vt,gt);if(!yt){const f={channelCount:vt.channelCount,channelCountMode:vt.channelCountMode,channelInterpretation:vt.channelInterpretation,delayTime:vt.delayTime.value,maxDelayTime:P};vt=O(gt,f)}return ut.set(gt,vt),yt?await f(gt,mt.delayTime,vt.delayTime):await V(gt,mt.delayTime,vt.delayTime),await F(mt,gt,vt),vt})(mt,gt)}}})(us,Wt,tt,ps,je),Fs=((f,O,I,V,F,P,ut)=>class extends f{constructor(f,mt){const gt=F(f),vt={...ge,...mt},yt=V(gt,vt),xt=P(gt);super(f,!1,yt,xt?I(vt.maxDelayTime):null),this._delayTime=O(this,xt,yt.delayTime),ut(this,vt.maxDelayTime)}get delayTime(){return this._delayTime}})(Ke,fs,Vs,Wt,Be,Ue,ys),Ps=(f=>(O,I)=>{const V=O.createDynamicsCompressor();if(qt(V,I),I.channelCount>2)throw f();if("max"===I.channelCountMode)throw f();return It(V,I,"attack"),It(V,I,"knee"),It(V,I,"ratio"),It(V,I,"release"),It(V,I,"threshold"),V})(Zt),Ns=((f,O,I,V,F)=>()=>{const P=new WeakMap;return{render(ut,mt){const gt=P.get(mt);return void 0!==gt?Promise.resolve(gt):(async(ut,mt)=>{let gt=I(ut);const vt=M(gt,mt);if(!vt){const f={attack:gt.attack.value,channelCount:gt.channelCount,channelCountMode:gt.channelCountMode,channelInterpretation:gt.channelInterpretation,knee:gt.knee.value,ratio:gt.ratio.value,release:gt.release.value,threshold:gt.threshold.value};gt=O(mt,f)}return P.set(mt,gt),vt?(await f(mt,ut.attack,gt.attack),await f(mt,ut.knee,gt.knee),await f(mt,ut.ratio,gt.ratio),await f(mt,ut.release,gt.release),await f(mt,ut.threshold,gt.threshold)):(await V(mt,ut.attack,gt.attack),await V(mt,ut.knee,gt.knee),await V(mt,ut.ratio,gt.ratio),await V(mt,ut.release,gt.release),await V(mt,ut.threshold,gt.threshold)),await F(ut,mt,gt),gt})(ut,mt)}}})(us,Ps,tt,ps,je),js=((f,O,I,V,F,P,ut,mt)=>class extends f{constructor(f,F){const gt=P(f),vt={...ve,...F},yt=V(gt,vt),xt=ut(gt);super(f,!1,yt,xt?I():null),this._attack=O(this,xt,yt.attack),this._knee=O(this,xt,yt.knee),this._nativeDynamicsCompressorNode=yt,this._ratio=O(this,xt,yt.ratio),this._release=O(this,xt,yt.release),this._threshold=O(this,xt,yt.threshold),mt(this,.006)}get attack(){return this._attack}get channelCount(){return this._nativeDynamicsCompressorNode.channelCount}set channelCount(f){const O=this._nativeDynamicsCompressorNode.channelCount;if(this._nativeDynamicsCompressorNode.channelCount=f,f>2)throw this._nativeDynamicsCompressorNode.channelCount=O,F()}get channelCountMode(){return this._nativeDynamicsCompressorNode.channelCountMode}set channelCountMode(f){const O=this._nativeDynamicsCompressorNode.channelCountMode;if(this._nativeDynamicsCompressorNode.channelCountMode=f,"max"===f)throw this._nativeDynamicsCompressorNode.channelCountMode=O,F()}get knee(){return this._knee}get ratio(){return this._ratio}get reduction(){return"number"==typeof this._nativeDynamicsCompressorNode.reduction.value?this._nativeDynamicsCompressorNode.reduction.value:this._nativeDynamicsCompressorNode.reduction}get release(){return this._release}get threshold(){return this._threshold}})(Ke,fs,Ns,Ps,Zt,Be,Ue,ys),Ls=((f,O,I,V,F)=>()=>{const P=new WeakMap;return{render(ut,mt){const gt=P.get(mt);return void 0!==gt?Promise.resolve(gt):(async(ut,mt)=>{let gt=I(ut);const vt=M(gt,mt);if(!vt){const f={channelCount:gt.channelCount,channelCountMode:gt.channelCountMode,channelInterpretation:gt.channelInterpretation,gain:gt.gain.value};gt=O(mt,f)}return P.set(mt,gt),vt?await f(mt,ut.gain,gt.gain):await V(mt,ut.gain,gt.gain),await F(ut,mt,gt),gt})(ut,mt)}}})(us,Bt,tt,ps,je),Bs=((f,O,I,V,F,P)=>class extends f{constructor(f,ut){const mt=F(f),gt={...ye,...ut},vt=V(mt,gt),yt=P(mt);super(f,!1,vt,yt?I():null),this._gain=O(this,yt,vt.gain,$t,Ht)}get gain(){return this._gain}})(Ke,fs,Ls,Bt,Be,Ue),zs=((f,O,I,V)=>(F,P,{channelCount:ut,channelCountMode:mt,channelInterpretation:gt,feedback:vt,feedforward:yt})=>{const xt=Pt(P,F.sampleRate),bt=vt instanceof Float64Array?vt:new Float64Array(vt),St=yt instanceof Float64Array?yt:new Float64Array(yt),kt=bt.length,Dt=St.length,Mt=Math.min(kt,Dt);if(0===kt||kt>20)throw V();if(0===bt[0])throw O();if(0===Dt||Dt>20)throw V();if(0===St[0])throw O();if(1!==bt[0]){for(let f=0;f<Dt;f+=1)St[f]/=bt[0];for(let f=1;f<kt;f+=1)bt[f]/=bt[0]}const Yt=I(F,xt,ut,ut);Yt.channelCount=ut,Yt.channelCountMode=mt,Yt.channelInterpretation=gt;const Xt=[],Ht=[],$t=[];for(let f=0;f<ut;f+=1){Xt.push(0);const f=new Float32Array(32),O=new Float32Array(32);f.fill(0),O.fill(0),Ht.push(f),$t.push(O)}Yt.onaudioprocess=f=>{const O=f.inputBuffer,I=f.outputBuffer,V=O.numberOfChannels;for(let f=0;f<V;f+=1){const V=O.getChannelData(f),F=I.getChannelData(f);Xt[f]=Ot(bt,kt,St,Dt,Mt,Ht[f],$t[f],Xt[f],32,V,F)}};const Jt=F.sampleRate/2;return zt({get bufferSize(){return xt},get channelCount(){return Yt.channelCount},set channelCount(f){Yt.channelCount=f},get channelCountMode(){return Yt.channelCountMode},set channelCountMode(f){Yt.channelCountMode=f},get channelInterpretation(){return Yt.channelInterpretation},set channelInterpretation(f){Yt.channelInterpretation=f},get context(){return Yt.context},get inputs(){return[Yt]},get numberOfInputs(){return Yt.numberOfInputs},get numberOfOutputs(){return Yt.numberOfOutputs},addEventListener:(...f)=>Yt.addEventListener(f[0],f[1],f[2]),dispatchEvent:(...f)=>Yt.dispatchEvent(f[0]),getFrequencyResponse(O,I,V){if(O.length!==I.length||I.length!==V.length)throw f();const F=O.length;for(let f=0;f<F;f+=1){const F=-Math.PI*(O[f]/Jt),P=[Math.cos(F),Math.sin(F)],ut=Ut(Gt(St,P),Gt(bt,P));I[f]=Math.sqrt(ut[0]*ut[0]+ut[1]*ut[1]),V[f]=Math.atan2(ut[1],ut[0])}},removeEventListener:(...f)=>Yt.removeEventListener(f[0],f[1],f[2])},Yt)})(Ct,At,Qt,Zt),Ws=((f,O,I,V)=>F=>f(Et,(()=>Et(F)))?Promise.resolve(f(V,V)).then((f=>{if(!f){const f=I(F,512,0,1);F.oncomplete=()=>{f.onaudioprocess=null,f.disconnect()},f.onaudioprocess=()=>F.currentTime,f.connect(F.destination)}return F.startRendering()})):new Promise((f=>{const I=O(F,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});F.oncomplete=O=>{I.disconnect(),f(O.renderedBuffer)},I.connect(F.destination),F.startRendering()})))(qe,Bt,Qt,((f,O)=>()=>{if(null===O)return Promise.resolve(!1);const I=new O(1,1,44100),V=f(I,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return new Promise((f=>{I.oncomplete=()=>{V.disconnect(),f(0!==I.currentTime)},I.startRendering()}))})(Bt,We)),Us=((f,O,I,V,F)=>(P,ut)=>{const mt=new WeakMap;let gt=null;return{render(vt,yt){const xt=mt.get(yt);return void 0!==xt?Promise.resolve(xt):(async(vt,yt)=>{let xt=null,bt=O(vt);const St=M(bt,yt);if(void 0===yt.createIIRFilter?xt=f(yt,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}):St||(bt=yt.createIIRFilter(ut,P)),mt.set(yt,null===xt?bt:xt),null!==xt){if(null===gt){if(null===I)throw new Error("Missing the native OfflineAudioContext constructor.");const f=new I(vt.context.destination.channelCount,vt.context.length,yt.sampleRate);gt=(async()=>(await V(vt,f,f.destination),((f,O,I,V)=>{const F=I instanceof Float64Array?I:new Float64Array(I),P=V instanceof Float64Array?V:new Float64Array(V),ut=F.length,mt=P.length,gt=Math.min(ut,mt);if(1!==F[0]){for(let f=0;f<ut;f+=1)P[f]/=F[0];for(let f=1;f<mt;f+=1)F[f]/=F[0]}const vt=new Float32Array(32),yt=new Float32Array(32),xt=O.createBuffer(f.numberOfChannels,f.length,f.sampleRate),bt=f.numberOfChannels;for(let O=0;O<bt;O+=1){const I=f.getChannelData(O),V=xt.getChannelData(O);vt.fill(0),yt.fill(0),Ot(F,ut,P,mt,gt,vt,yt,0,32,I,V)}return xt})(await F(f),yt,P,ut)))()}const f=await gt;return xt.buffer=f,xt.start(0),xt}return await V(vt,yt,bt),bt})(vt,yt)}}})(ls,tt,We,je,Ws),Gs=(f=>(O,I,V)=>{if(void 0===O.createIIRFilter)return f(O,I,V);const F=O.createIIRFilter(V.feedforward,V.feedback);return qt(F,V),F})(zs),Ys=((f,O,I,V,F,P)=>class extends f{constructor(f,ut){const mt=V(f),gt=F(mt),vt={...xe,...ut},yt=O(mt,gt?null:f.baseLatency,vt);super(f,!1,yt,gt?I(vt.feedback,vt.feedforward):null),(f=>{var O;f.getFrequencyResponse=(O=f.getFrequencyResponse,(I,V,F)=>{if(I.length!==V.length||V.length!==F.length)throw Ct();return O.call(f,I,V,F)})})(yt),this._nativeIIRFilterNode=yt,P(this,1)}getFrequencyResponse(f,O,I){return this._nativeIIRFilterNode.getFrequencyResponse(f,O,I)}})(Ke,Gs,Us,Be,Ue,ys),Zs=((f,O,I,V,F,P,ut,mt)=>(gt,vt)=>{const yt=vt.listener,{forwardX:xt,forwardY:bt,forwardZ:St,positionX:kt,positionY:Dt,positionZ:Mt,upX:Yt,upY:Xt,upZ:Jt}=void 0===yt.forwardX?(()=>{const xt=new Float32Array(1),bt=O(vt,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:9}),St=ut(vt);let kt=!1,Dt=[0,0,-1,0,1,0],Mt=[0,0,0];const g=()=>{if(kt)return;kt=!0;const f=V(vt,256,9,0);f.onaudioprocess=({inputBuffer:f})=>{const O=[P(f,xt,0),P(f,xt,1),P(f,xt,2),P(f,xt,3),P(f,xt,4),P(f,xt,5)];O.some(((f,O)=>f!==Dt[O]))&&(yt.setOrientation(...O),Dt=O);const I=[P(f,xt,6),P(f,xt,7),P(f,xt,8)];I.some(((f,O)=>f!==Mt[O]))&&(yt.setPosition(...I),Mt=I)},bt.connect(f)},v=f=>O=>{O!==Dt[f]&&(Dt[f]=O,yt.setOrientation(...Dt))},y=f=>O=>{O!==Mt[f]&&(Mt[f]=O,yt.setPosition(...Mt))},x=(O,V,P)=>{const ut=I(vt,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:V});ut.connect(bt,0,O),ut.start(),Object.defineProperty(ut.offset,"defaultValue",{get:()=>V});const yt=f({context:gt},St,ut.offset,$t,Ht);var xt,kt,Dt,Mt,Yt,Xt,Jt;return mt(yt,"value",(f=>()=>f.call(yt)),(f=>O=>{try{f.call(yt,O)}catch(f){if(9!==f.code)throw f}g(),St&&P(O)})),yt.cancelAndHoldAtTime=(xt=yt.cancelAndHoldAtTime,St?()=>{throw F()}:(...f)=>{const O=xt.apply(yt,f);return g(),O}),yt.cancelScheduledValues=(kt=yt.cancelScheduledValues,St?()=>{throw F()}:(...f)=>{const O=kt.apply(yt,f);return g(),O}),yt.exponentialRampToValueAtTime=(Dt=yt.exponentialRampToValueAtTime,St?()=>{throw F()}:(...f)=>{const O=Dt.apply(yt,f);return g(),O}),yt.linearRampToValueAtTime=(Mt=yt.linearRampToValueAtTime,St?()=>{throw F()}:(...f)=>{const O=Mt.apply(yt,f);return g(),O}),yt.setTargetAtTime=(Yt=yt.setTargetAtTime,St?()=>{throw F()}:(...f)=>{const O=Yt.apply(yt,f);return g(),O}),yt.setValueAtTime=(Xt=yt.setValueAtTime,St?()=>{throw F()}:(...f)=>{const O=Xt.apply(yt,f);return g(),O}),yt.setValueCurveAtTime=(Jt=yt.setValueCurveAtTime,St?()=>{throw F()}:(...f)=>{const O=Jt.apply(yt,f);return g(),O}),yt};return{forwardX:x(0,0,v(0)),forwardY:x(1,0,v(1)),forwardZ:x(2,-1,v(2)),positionX:x(6,0,y(0)),positionY:x(7,0,y(1)),positionZ:x(8,0,y(2)),upX:x(3,0,v(3)),upY:x(4,1,v(4)),upZ:x(5,0,v(5))}})():yt;return{get forwardX(){return xt},get forwardY(){return bt},get forwardZ(){return St},get positionX(){return kt},get positionY(){return Dt},get positionZ(){return Mt},get upX(){return Yt},get upY(){return Xt},get upZ(){return Jt}}})(fs,Ts,Ds,Qt,Zt,ee,Ue,ne),Xs=new WeakMap,Qs=((f,O,I,V,F,P)=>class extends I{constructor(I,P){super(I),this._nativeContext=I,yt.set(this,I),V(I)&&F.set(I,new Set),this._destination=new f(this,P),this._listener=O(this,I),this._onstatechange=null}get currentTime(){return this._nativeContext.currentTime}get destination(){return this._destination}get listener(){return this._listener}get onstatechange(){return this._onstatechange}set onstatechange(f){const O="function"==typeof f?P(this,f):null;this._nativeContext.onstatechange=O;const I=this._nativeContext.onstatechange;this._onstatechange=null!==I&&I===O?f:I}get sampleRate(){return this._nativeContext.sampleRate}get state(){return this._nativeContext.state}})(gs,Zs,Ye,Ue,Xs,ue),Hs=((f,O,I,V,F,P)=>(ut,mt)=>{const gt=ut.createOscillator();return qt(gt,mt),It(gt,mt,"detune"),It(gt,mt,"frequency"),void 0!==mt.periodicWave?gt.setPeriodicWave(mt.periodicWave):Rt(gt,mt,"type"),O(I,(()=>I(ut)))||Vt(gt),O(V,(()=>V(ut)))||P(gt,ut),O(F,(()=>F(ut)))||Nt(gt),f(ut,gt),gt})(cs,qe,oe,re,ae,le),$s=((f,O,I,V,F)=>()=>{const P=new WeakMap;let ut=null,mt=null,gt=null;return{set periodicWave(f){ut=f},set start(f){mt=f},set stop(f){gt=f},render(vt,yt){const xt=P.get(yt);return void 0!==xt?Promise.resolve(xt):(async(vt,yt)=>{let xt=I(vt);const bt=M(xt,yt);if(!bt){const f={channelCount:xt.channelCount,channelCountMode:xt.channelCountMode,channelInterpretation:xt.channelInterpretation,detune:xt.detune.value,frequency:xt.frequency.value,periodicWave:null===ut?void 0:ut,type:xt.type};xt=O(yt,f),null!==mt&&xt.start(mt),null!==gt&&xt.stop(gt)}return P.set(yt,xt),bt?(await f(yt,vt.detune,xt.detune),await f(yt,vt.frequency,xt.frequency)):(await V(yt,vt.detune,xt.detune),await V(yt,vt.frequency,xt.frequency)),await F(vt,yt,xt),xt})(vt,yt)}}})(us,Hs,tt,ps,je),Ks=((f,O,I,V,F,P,ut)=>class extends f{constructor(f,ut){const mt=F(f),gt={...Te,...ut},vt=I(mt,gt),yt=P(mt),xt=yt?V():null,bt=f.sampleRate/2;super(f,!1,vt,xt),this._detune=O(this,yt,vt.detune,153600,-153600),this._frequency=O(this,yt,vt.frequency,bt,-bt),this._nativeOscillatorNode=vt,this._onended=null,this._oscillatorNodeRenderer=xt,null!==this._oscillatorNodeRenderer&&void 0!==gt.periodicWave&&(this._oscillatorNodeRenderer.periodicWave=gt.periodicWave)}get detune(){return this._detune}get frequency(){return this._frequency}get onended(){return this._onended}set onended(f){const O="function"==typeof f?ut(this,f):null;this._nativeOscillatorNode.onended=O;const I=this._nativeOscillatorNode.onended;this._onended=null!==I&&I===O?f:I}get type(){return this._nativeOscillatorNode.type}set type(f){this._nativeOscillatorNode.type=f,null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.periodicWave=null)}setPeriodicWave(f){this._nativeOscillatorNode.setPeriodicWave(f),null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.periodicWave=f)}start(f=0){if(this._nativeOscillatorNode.start(f),null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.start=f),"closed"!==this.context.state){k(this);const t=()=>{this._nativeOscillatorNode.removeEventListener("ended",t),N(this)&&C(this)};this._nativeOscillatorNode.addEventListener("ended",t)}}stop(f=0){this._nativeOscillatorNode.stop(f),null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.stop=f)}})(Ke,fs,Hs,$s,Be,Ue,ue),Js=(f=>(O,I)=>{const V=f(O,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),F=O.createBuffer(1,2,44100);return V.buffer=F,V.loop=!0,V.connect(I),V.start(),()=>{V.stop(),V.disconnect(I)}})(ls),tn=((f,O,I,V,F)=>(P,{curve:ut,oversample:mt,...gt})=>{const vt=P.createWaveShaper(),yt=P.createWaveShaper();qt(vt,gt),qt(yt,gt);const xt=I(P,{...gt,gain:1}),bt=I(P,{...gt,gain:-1}),St=I(P,{...gt,gain:1}),kt=I(P,{...gt,gain:-1});let Dt=null,Mt=!1,Yt=null;const Xt={get bufferSize(){},get channelCount(){return vt.channelCount},set channelCount(f){xt.channelCount=f,bt.channelCount=f,vt.channelCount=f,St.channelCount=f,yt.channelCount=f,kt.channelCount=f},get channelCountMode(){return vt.channelCountMode},set channelCountMode(f){xt.channelCountMode=f,bt.channelCountMode=f,vt.channelCountMode=f,St.channelCountMode=f,yt.channelCountMode=f,kt.channelCountMode=f},get channelInterpretation(){return vt.channelInterpretation},set channelInterpretation(f){xt.channelInterpretation=f,bt.channelInterpretation=f,vt.channelInterpretation=f,St.channelInterpretation=f,yt.channelInterpretation=f,kt.channelInterpretation=f},get context(){return vt.context},get curve(){return Yt},set curve(I){if(null!==I&&I.length<2)throw O();if(null===I)vt.curve=I,yt.curve=I;else{const f=I.length,O=new Float32Array(f+2-f%2),V=new Float32Array(f+2-f%2);O[0]=I[0],V[0]=-I[f-1];const F=Math.ceil((f+1)/2),P=(f+1)/2-1;for(let ut=1;ut<F;ut+=1){const mt=ut/F*P,gt=Math.floor(mt),vt=Math.ceil(mt);O[ut]=gt===vt?I[gt]:(1-(mt-gt))*I[gt]+(1-(vt-mt))*I[vt],V[ut]=gt===vt?-I[f-1-gt]:-(1-(mt-gt))*I[f-1-gt]-(1-(vt-mt))*I[f-1-vt]}O[F]=f%2==1?I[F-1]:(I[F-2]+I[F-1])/2,vt.curve=O,yt.curve=V}Yt=I,Mt&&(V(Yt)&&null===Dt?Dt=f(P,xt):null!==Dt&&(Dt(),Dt=null))},get inputs(){return[xt]},get numberOfInputs(){return vt.numberOfInputs},get numberOfOutputs(){return vt.numberOfOutputs},get oversample(){return vt.oversample},set oversample(f){vt.oversample=f,yt.oversample=f},addEventListener:(...f)=>xt.addEventListener(f[0],f[1],f[2]),dispatchEvent:(...f)=>xt.dispatchEvent(f[0]),removeEventListener:(...f)=>xt.removeEventListener(f[0],f[1],f[2])};return null!==ut&&(Xt.curve=ut instanceof Float32Array?ut:new Float32Array(ut)),mt!==Xt.oversample&&(Xt.oversample=mt),F(zt(Xt,St),(()=>{xt.connect(vt).connect(St),xt.connect(bt).connect(yt).connect(kt).connect(St),Mt=!0,V(Yt)&&(Dt=f(P,xt))}),(()=>{xt.disconnect(vt),vt.disconnect(St),xt.disconnect(bt),bt.disconnect(yt),yt.disconnect(kt),kt.disconnect(St),Mt=!1,null!==Dt&&(Dt(),Dt=null)}))})(Js,At,Bt,se,ws),en=((f,O,I,V,F,P,ut)=>(mt,gt)=>{const vt=mt.createWaveShaper();if(null!==P&&"webkitAudioContext"===P.name&&void 0===mt.createGain().gain.automationRate)return I(mt,gt);qt(vt,gt);const yt=null===gt.curve||gt.curve instanceof Float32Array?gt.curve:new Float32Array(gt.curve);if(null!==yt&&yt.length<2)throw O();Rt(vt,{curve:yt},"curve"),Rt(vt,gt,"oversample");let xt=null,bt=!1;return ut(vt,"curve",(f=>()=>f.call(vt)),(O=>I=>(O.call(vt,I),bt&&(V(I)&&null===xt?xt=f(mt,vt):V(I)||null===xt||(xt(),xt=null)),I))),F(vt,(()=>{bt=!0,V(vt.curve)&&(xt=f(mt,vt))}),(()=>{bt=!1,null!==xt&&(xt(),xt=null)}))})(Js,At,tn,se,ws,Ze,ne),sn=((f,O,I,V,F,P,ut,mt,gt,vt)=>(yt,{coneInnerAngle:xt,coneOuterAngle:bt,coneOuterGain:St,distanceModel:kt,maxDistance:Dt,orientationX:Mt,orientationY:Yt,orientationZ:Xt,panningModel:Ht,positionX:$t,positionY:Jt,positionZ:te,refDistance:pe,rolloffFactor:de,...fe})=>{const _e=yt.createPanner();if(fe.channelCount>2)throw ut();if("max"===fe.channelCountMode)throw ut();qt(_e,fe);const me={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},ge=I(yt,{...me,channelInterpretation:"speakers",numberOfInputs:6}),ve=V(yt,{...fe,gain:1}),ye=V(yt,{...me,gain:1}),xe=V(yt,{...me,gain:0}),we=V(yt,{...me,gain:0}),be=V(yt,{...me,gain:0}),Te=V(yt,{...me,gain:0}),Se=V(yt,{...me,gain:0}),ke=F(yt,256,6,1),Ae=P(yt,{...me,curve:new Float32Array([1,1]),oversample:"none"});let Ce=[Mt,Yt,Xt],Oe=[$t,Jt,te];const De=new Float32Array(1);ke.onaudioprocess=({inputBuffer:f})=>{const O=[gt(f,De,0),gt(f,De,1),gt(f,De,2)];O.some(((f,O)=>f!==Ce[O]))&&(_e.setOrientation(...O),Ce=O);const I=[gt(f,De,3),gt(f,De,4),gt(f,De,5)];I.some(((f,O)=>f!==Oe[O]))&&(_e.setPosition(...I),Oe=I)},Object.defineProperty(xe.gain,"defaultValue",{get:()=>0}),Object.defineProperty(we.gain,"defaultValue",{get:()=>0}),Object.defineProperty(be.gain,"defaultValue",{get:()=>0}),Object.defineProperty(Te.gain,"defaultValue",{get:()=>0}),Object.defineProperty(Se.gain,"defaultValue",{get:()=>0});const Me={get bufferSize(){},get channelCount(){return _e.channelCount},set channelCount(f){if(f>2)throw ut();ve.channelCount=f,_e.channelCount=f},get channelCountMode(){return _e.channelCountMode},set channelCountMode(f){if("max"===f)throw ut();ve.channelCountMode=f,_e.channelCountMode=f},get channelInterpretation(){return _e.channelInterpretation},set channelInterpretation(f){ve.channelInterpretation=f,_e.channelInterpretation=f},get coneInnerAngle(){return _e.coneInnerAngle},set coneInnerAngle(f){_e.coneInnerAngle=f},get coneOuterAngle(){return _e.coneOuterAngle},set coneOuterAngle(f){_e.coneOuterAngle=f},get coneOuterGain(){return _e.coneOuterGain},set coneOuterGain(f){if(f<0||f>1)throw O();_e.coneOuterGain=f},get context(){return _e.context},get distanceModel(){return _e.distanceModel},set distanceModel(f){_e.distanceModel=f},get inputs(){return[ve]},get maxDistance(){return _e.maxDistance},set maxDistance(f){if(f<0)throw new RangeError;_e.maxDistance=f},get numberOfInputs(){return _e.numberOfInputs},get numberOfOutputs(){return _e.numberOfOutputs},get orientationX(){return ye.gain},get orientationY(){return xe.gain},get orientationZ(){return we.gain},get panningModel(){return _e.panningModel},set panningModel(f){_e.panningModel=f},get positionX(){return be.gain},get positionY(){return Te.gain},get positionZ(){return Se.gain},get refDistance(){return _e.refDistance},set refDistance(f){if(f<0)throw new RangeError;_e.refDistance=f},get rolloffFactor(){return _e.rolloffFactor},set rolloffFactor(f){if(f<0)throw new RangeError;_e.rolloffFactor=f},addEventListener:(...f)=>ve.addEventListener(f[0],f[1],f[2]),dispatchEvent:(...f)=>ve.dispatchEvent(f[0]),removeEventListener:(...f)=>ve.removeEventListener(f[0],f[1],f[2])};return xt!==Me.coneInnerAngle&&(Me.coneInnerAngle=xt),bt!==Me.coneOuterAngle&&(Me.coneOuterAngle=bt),St!==Me.coneOuterGain&&(Me.coneOuterGain=St),kt!==Me.distanceModel&&(Me.distanceModel=kt),Dt!==Me.maxDistance&&(Me.maxDistance=Dt),Mt!==Me.orientationX.value&&(Me.orientationX.value=Mt),Yt!==Me.orientationY.value&&(Me.orientationY.value=Yt),Xt!==Me.orientationZ.value&&(Me.orientationZ.value=Xt),Ht!==Me.panningModel&&(Me.panningModel=Ht),$t!==Me.positionX.value&&(Me.positionX.value=$t),Jt!==Me.positionY.value&&(Me.positionY.value=Jt),te!==Me.positionZ.value&&(Me.positionZ.value=te),pe!==Me.refDistance&&(Me.refDistance=pe),de!==Me.rolloffFactor&&(Me.rolloffFactor=de),1===Ce[0]&&0===Ce[1]&&0===Ce[2]||_e.setOrientation(...Ce),0===Oe[0]&&0===Oe[1]&&0===Oe[2]||_e.setPosition(...Oe),vt(zt(Me,_e),(()=>{ve.connect(_e),f(ve,Ae,0,0),Ae.connect(ye).connect(ge,0,0),Ae.connect(xe).connect(ge,0,1),Ae.connect(we).connect(ge,0,2),Ae.connect(be).connect(ge,0,3),Ae.connect(Te).connect(ge,0,4),Ae.connect(Se).connect(ge,0,5),ge.connect(ke).connect(yt.destination)}),(()=>{ve.disconnect(_e),mt(ve,Ae,0,0),Ae.disconnect(ye),ye.disconnect(ge),Ae.disconnect(xe),xe.disconnect(ge),Ae.disconnect(we),we.disconnect(ge),Ae.disconnect(be),be.disconnect(ge),Ae.disconnect(Te),Te.disconnect(ge),Ae.disconnect(Se),Se.disconnect(ge),ge.disconnect(ke),ke.disconnect(yt.destination)}))})(Y,At,Ts,Bt,Qt,en,Zt,K,ee,ws),nn=(f=>(O,I)=>{const V=O.createPanner();return void 0===V.orientationX?f(O,I):(qt(V,I),It(V,I,"orientationX"),It(V,I,"orientationY"),It(V,I,"orientationZ"),It(V,I,"positionX"),It(V,I,"positionY"),It(V,I,"positionZ"),Rt(V,I,"coneInnerAngle"),Rt(V,I,"coneOuterAngle"),Rt(V,I,"coneOuterGain"),Rt(V,I,"distanceModel"),Rt(V,I,"maxDistance"),Rt(V,I,"panningModel"),Rt(V,I,"refDistance"),Rt(V,I,"rolloffFactor"),V)})(sn),on=((f,O,I,V,F,P,ut,mt,gt,vt)=>()=>{const yt=new WeakMap;let xt=null;return{render(bt,St){const kt=yt.get(St);return void 0!==kt?Promise.resolve(kt):(async(bt,St)=>{let kt=null,Dt=P(bt);const Mt={channelCount:Dt.channelCount,channelCountMode:Dt.channelCountMode,channelInterpretation:Dt.channelInterpretation},Yt={...Mt,coneInnerAngle:Dt.coneInnerAngle,coneOuterAngle:Dt.coneOuterAngle,coneOuterGain:Dt.coneOuterGain,distanceModel:Dt.distanceModel,maxDistance:Dt.maxDistance,panningModel:Dt.panningModel,refDistance:Dt.refDistance,rolloffFactor:Dt.rolloffFactor},Xt=M(Dt,St);if("bufferSize"in Dt)kt=V(St,{...Mt,gain:1});else if(!Xt){const f={...Yt,orientationX:Dt.orientationX.value,orientationY:Dt.orientationY.value,orientationZ:Dt.orientationZ.value,positionX:Dt.positionX.value,positionY:Dt.positionY.value,positionZ:Dt.positionZ.value};Dt=F(St,f)}if(yt.set(St,null===kt?Dt:kt),null!==kt){if(null===xt){if(null===ut)throw new Error("Missing the native OfflineAudioContext constructor.");const f=new ut(6,bt.context.length,St.sampleRate),V=O(f,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6});V.connect(f.destination),xt=(async()=>{const O=await Promise.all([bt.orientationX,bt.orientationY,bt.orientationZ,bt.positionX,bt.positionY,bt.positionZ].map((async(O,V)=>{const F=I(f,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:0===V?1:0});return await mt(f,O,F.offset),F})));for(let f=0;f<6;f+=1)O[f].connect(V,0,f),O[f].start(0);return vt(f)})()}const f=await xt,P=V(St,{...Mt,gain:1});await gt(bt,St,P);const yt=[];for(let O=0;O<f.numberOfChannels;O+=1)yt.push(f.getChannelData(O));let Dt=[yt[0][0],yt[1][0],yt[2][0]],Xt=[yt[3][0],yt[4][0],yt[5][0]],Ht=V(St,{...Mt,gain:1}),$t=F(St,{...Yt,orientationX:Dt[0],orientationY:Dt[1],orientationZ:Dt[2],positionX:Xt[0],positionY:Xt[1],positionZ:Xt[2]});P.connect(Ht).connect($t.inputs[0]),$t.connect(kt);for(let O=128;O<f.length;O+=128){const f=[yt[0][O],yt[1][O],yt[2][O]],I=[yt[3][O],yt[4][O],yt[5][O]];if(f.some(((f,O)=>f!==Dt[O]))||I.some(((f,O)=>f!==Xt[O]))){Dt=f,Xt=I;const ut=O/St.sampleRate;Ht.gain.setValueAtTime(0,ut),Ht=V(St,{...Mt,gain:0}),$t=F(St,{...Yt,orientationX:Dt[0],orientationY:Dt[1],orientationZ:Dt[2],positionX:Xt[0],positionY:Xt[1],positionZ:Xt[2]}),Ht.gain.setValueAtTime(1,ut),P.connect(Ht).connect($t.inputs[0]),$t.connect(kt)}}return kt}return Xt?(await f(St,bt.orientationX,Dt.orientationX),await f(St,bt.orientationY,Dt.orientationY),await f(St,bt.orientationZ,Dt.orientationZ),await f(St,bt.positionX,Dt.positionX),await f(St,bt.positionY,Dt.positionY),await f(St,bt.positionZ,Dt.positionZ)):(await mt(St,bt.orientationX,Dt.orientationX),await mt(St,bt.orientationY,Dt.orientationY),await mt(St,bt.orientationZ,Dt.orientationZ),await mt(St,bt.positionX,Dt.positionX),await mt(St,bt.positionY,Dt.positionY),await mt(St,bt.positionZ,Dt.positionZ)),X(Dt)?await gt(bt,St,Dt.inputs[0]):await gt(bt,St,Dt),Dt})(bt,St)}}})(us,Ts,Ds,Bt,nn,tt,We,ps,je,Ws),rn=((f,O,I,V,F,P,ut)=>class extends f{constructor(f,mt){const gt=F(f),vt={...Se,...mt},yt=I(gt,vt),xt=P(gt);super(f,!1,yt,xt?V():null),this._nativePannerNode=yt,this._orientationX=O(this,xt,yt.orientationX,$t,Ht),this._orientationY=O(this,xt,yt.orientationY,$t,Ht),this._orientationZ=O(this,xt,yt.orientationZ,$t,Ht),this._positionX=O(this,xt,yt.positionX,$t,Ht),this._positionY=O(this,xt,yt.positionY,$t,Ht),this._positionZ=O(this,xt,yt.positionZ,$t,Ht),ut(this,1)}get coneInnerAngle(){return this._nativePannerNode.coneInnerAngle}set coneInnerAngle(f){this._nativePannerNode.coneInnerAngle=f}get coneOuterAngle(){return this._nativePannerNode.coneOuterAngle}set coneOuterAngle(f){this._nativePannerNode.coneOuterAngle=f}get coneOuterGain(){return this._nativePannerNode.coneOuterGain}set coneOuterGain(f){this._nativePannerNode.coneOuterGain=f}get distanceModel(){return this._nativePannerNode.distanceModel}set distanceModel(f){this._nativePannerNode.distanceModel=f}get maxDistance(){return this._nativePannerNode.maxDistance}set maxDistance(f){this._nativePannerNode.maxDistance=f}get orientationX(){return this._orientationX}get orientationY(){return this._orientationY}get orientationZ(){return this._orientationZ}get panningModel(){return this._nativePannerNode.panningModel}set panningModel(f){this._nativePannerNode.panningModel=f}get positionX(){return this._positionX}get positionY(){return this._positionY}get positionZ(){return this._positionZ}get refDistance(){return this._nativePannerNode.refDistance}set refDistance(f){this._nativePannerNode.refDistance=f}get rolloffFactor(){return this._nativePannerNode.rolloffFactor}set rolloffFactor(f){this._nativePannerNode.rolloffFactor=f}})(Ke,fs,nn,on,Be,Ue,ys),an=(f=>(O,{disableNormalization:I,imag:V,real:F})=>{const P=V instanceof Float32Array?V:new Float32Array(V),ut=F instanceof Float32Array?F:new Float32Array(F),mt=O.createPeriodicWave(ut,P,{disableNormalization:I});if(Array.from(V).length<2)throw f();return mt})(R),cn=((f,O,I,V)=>class n{constructor(V,F){const P=O(V),ut=(f=>{const{imag:O,real:I}=f;return void 0===O?void 0===I?{...f,imag:[0,0],real:[0,0]}:{...f,imag:Array.from(I,(()=>0)),real:I}:void 0===I?{...f,imag:O,real:Array.from(O,(()=>0))}:{...f,imag:O,real:I}})({...ke,...F}),mt=f(P,ut);return I.add(mt),mt}static[Symbol.hasInstance](f){return null!==f&&"object"==typeof f&&Object.getPrototypeOf(f)===n.prototype||I.has(f)}})(an,Be,new WeakSet),hn=((f,O,I,V,F,P)=>{const ut=16385,mt=new Float32Array([1,1]),gt=Math.PI/2,vt={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},yt={...vt,oversample:"none"},u=(f,P,xt,bt,St)=>{if(1===P)return((f,O,F,P)=>{const xt=new Float32Array(ut),bt=new Float32Array(ut);for(let f=0;f<ut;f+=1){const O=f/16384*gt;xt[f]=Math.cos(O),bt[f]=Math.sin(O)}const St=I(f,{...vt,gain:0}),kt=V(f,{...yt,curve:xt}),Dt=V(f,{...yt,curve:mt}),Mt=I(f,{...vt,gain:0}),Yt=V(f,{...yt,curve:bt});return{connectGraph(){O.connect(St),O.connect(void 0===Dt.inputs?Dt:Dt.inputs[0]),O.connect(Mt),Dt.connect(F),F.connect(void 0===kt.inputs?kt:kt.inputs[0]),F.connect(void 0===Yt.inputs?Yt:Yt.inputs[0]),kt.connect(St.gain),Yt.connect(Mt.gain),St.connect(P,0,0),Mt.connect(P,0,1)},disconnectGraph(){O.disconnect(St),O.disconnect(void 0===Dt.inputs?Dt:Dt.inputs[0]),O.disconnect(Mt),Dt.disconnect(F),F.disconnect(void 0===kt.inputs?kt:kt.inputs[0]),F.disconnect(void 0===Yt.inputs?Yt:Yt.inputs[0]),kt.disconnect(St.gain),Yt.disconnect(Mt.gain),St.disconnect(P,0,0),Mt.disconnect(P,0,1)}}})(f,xt,bt,St);if(2===P)return((f,F,P,xt)=>{const bt=new Float32Array(ut),St=new Float32Array(ut),kt=new Float32Array(ut),Dt=new Float32Array(ut),Mt=Math.floor(8192.5);for(let f=0;f<ut;f+=1)if(f>Mt){const O=(f-Mt)/(16384-Mt)*gt;bt[f]=Math.cos(O),St[f]=Math.sin(O),kt[f]=0,Dt[f]=1}else{const O=f/(16384-Mt)*gt;bt[f]=1,St[f]=0,kt[f]=Math.cos(O),Dt[f]=Math.sin(O)}const Yt=O(f,{channelCount:2,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:2}),Xt=I(f,{...vt,gain:0}),Ht=V(f,{...yt,curve:bt}),$t=I(f,{...vt,gain:0}),Jt=V(f,{...yt,curve:St}),te=V(f,{...yt,curve:mt}),pe=I(f,{...vt,gain:0}),de=V(f,{...yt,curve:kt}),fe=I(f,{...vt,gain:0}),_e=V(f,{...yt,curve:Dt});return{connectGraph(){F.connect(Yt),F.connect(void 0===te.inputs?te:te.inputs[0]),Yt.connect(Xt,0),Yt.connect($t,0),Yt.connect(pe,1),Yt.connect(fe,1),te.connect(P),P.connect(void 0===Ht.inputs?Ht:Ht.inputs[0]),P.connect(void 0===Jt.inputs?Jt:Jt.inputs[0]),P.connect(void 0===de.inputs?de:de.inputs[0]),P.connect(void 0===_e.inputs?_e:_e.inputs[0]),Ht.connect(Xt.gain),Jt.connect($t.gain),de.connect(pe.gain),_e.connect(fe.gain),Xt.connect(xt,0,0),pe.connect(xt,0,0),$t.connect(xt,0,1),fe.connect(xt,0,1)},disconnectGraph(){F.disconnect(Yt),F.disconnect(void 0===te.inputs?te:te.inputs[0]),Yt.disconnect(Xt,0),Yt.disconnect($t,0),Yt.disconnect(pe,1),Yt.disconnect(fe,1),te.disconnect(P),P.disconnect(void 0===Ht.inputs?Ht:Ht.inputs[0]),P.disconnect(void 0===Jt.inputs?Jt:Jt.inputs[0]),P.disconnect(void 0===de.inputs?de:de.inputs[0]),P.disconnect(void 0===_e.inputs?_e:_e.inputs[0]),Ht.disconnect(Xt.gain),Jt.disconnect($t.gain),de.disconnect(pe.gain),_e.disconnect(fe.gain),Xt.disconnect(xt,0,0),pe.disconnect(xt,0,0),$t.disconnect(xt,0,1),fe.disconnect(xt,0,1)}}})(f,xt,bt,St);throw F()};return(O,{channelCount:V,channelCountMode:ut,pan:mt,...gt})=>{if("max"===ut)throw F();const vt=f(O,{...gt,channelCount:1,channelCountMode:ut,numberOfInputs:2}),yt=I(O,{...gt,channelCount:V,channelCountMode:ut,gain:1}),xt=I(O,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:mt});let{connectGraph:bt,disconnectGraph:St}=u(O,V,yt,xt,vt);Object.defineProperty(xt.gain,"defaultValue",{get:()=>0}),Object.defineProperty(xt.gain,"maxValue",{get:()=>1}),Object.defineProperty(xt.gain,"minValue",{get:()=>-1});const kt={get bufferSize(){},get channelCount(){return yt.channelCount},set channelCount(f){yt.channelCount!==f&&(Dt&&St(),({connectGraph:bt,disconnectGraph:St}=u(O,f,yt,xt,vt)),Dt&&bt()),yt.channelCount=f},get channelCountMode(){return yt.channelCountMode},set channelCountMode(f){if("clamped-max"===f||"max"===f)throw F();yt.channelCountMode=f},get channelInterpretation(){return yt.channelInterpretation},set channelInterpretation(f){yt.channelInterpretation=f},get context(){return yt.context},get inputs(){return[yt]},get numberOfInputs(){return yt.numberOfInputs},get numberOfOutputs(){return yt.numberOfOutputs},get pan(){return xt.gain},addEventListener:(...f)=>yt.addEventListener(f[0],f[1],f[2]),dispatchEvent:(...f)=>yt.dispatchEvent(f[0]),removeEventListener:(...f)=>yt.removeEventListener(f[0],f[1],f[2])};let Dt=!1;return P(zt(kt,vt),(()=>{bt(),Dt=!0}),(()=>{St(),Dt=!1}))}})(Ts,Lt,Bt,en,Zt,ws),un=((f,O)=>(I,V)=>{const F=V.channelCountMode;if("clamped-max"===F)throw O();if(void 0===I.createStereoPanner)return f(I,V);const P=I.createStereoPanner();return qt(P,V),It(P,V,"pan"),Object.defineProperty(P,"channelCountMode",{get:()=>F,set:f=>{if(f!==F)throw O()}}),P})(hn,Zt),ln=((f,O,I,V,F)=>()=>{const P=new WeakMap;return{render(ut,mt){const gt=P.get(mt);return void 0!==gt?Promise.resolve(gt):(async(ut,mt)=>{let gt=I(ut);const vt=M(gt,mt);if(!vt){const f={channelCount:gt.channelCount,channelCountMode:gt.channelCountMode,channelInterpretation:gt.channelInterpretation,pan:gt.pan.value};gt=O(mt,f)}return P.set(mt,gt),vt?await f(mt,ut.pan,gt.pan):await V(mt,ut.pan,gt.pan),X(gt)?await F(ut,mt,gt.inputs[0]):await F(ut,mt,gt),gt})(ut,mt)}}})(us,un,tt,ps,je),pn=((f,O,I,V,F,P)=>class extends f{constructor(f,ut){const mt=F(f),gt={...Ae,...ut},vt=I(mt,gt),yt=P(mt);super(f,!1,vt,yt?V():null),this._pan=O(this,yt,vt.pan)}get pan(){return this._pan}})(Ke,fs,un,ln,Be,Ue),dn=((f,O,I)=>()=>{const V=new WeakMap;return{render(F,P){const ut=V.get(P);return void 0!==ut?Promise.resolve(ut):(async(F,P)=>{let ut=O(F);if(!M(ut,P)){const O={channelCount:ut.channelCount,channelCountMode:ut.channelCountMode,channelInterpretation:ut.channelInterpretation,curve:ut.curve,oversample:ut.oversample};ut=f(P,O)}return V.set(P,ut),X(ut)?await I(F,P,ut.inputs[0]):await I(F,P,ut),ut})(F,P)}}})(en,tt,je),fn=((f,O,I,V,F,P,ut)=>class extends f{constructor(f,O){const mt=F(f),gt={...Ce,...O},vt=I(mt,gt);super(f,!0,vt,P(mt)?V():null),this._isCurveNullified=!1,this._nativeWaveShaperNode=vt,ut(this,1)}get curve(){return this._isCurveNullified?null:this._nativeWaveShaperNode.curve}set curve(f){if(null===f)this._isCurveNullified=!0,this._nativeWaveShaperNode.curve=new Float32Array([0,0]);else{if(f.length<2)throw O();this._isCurveNullified=!1,this._nativeWaveShaperNode.curve=f}}get oversample(){return this._nativeWaveShaperNode.oversample}set oversample(f){this._nativeWaveShaperNode.oversample=f}})(Ke,At,en,dn,Be,Ue,ys),_n=(f=>null!==f&&f.isSecureContext)(Fe),mn=(f=>(O,I,V)=>{Object.defineProperties(f,{currentFrame:{configurable:!0,get:()=>Math.round(O*I)},currentTime:{configurable:!0,get:()=>O}});try{return V()}finally{null!==f&&(delete f.currentFrame,delete f.currentTime)}})(Fe),gn=new WeakMap,vn=((f,O)=>I=>{let V=f.get(I);if(void 0!==V)return V;if(null===O)throw new Error("Missing the native OfflineAudioContext constructor.");return V=new O(1,1,44100),f.set(I,V),V})(gn,We),yn=_n?((f,O,I,V,F,P,ut,mt,gt,vt,yt,xt,bt)=>{let kt=0;return(Dt,Mt,Yt={credentials:"omit"})=>{const Xt=yt.get(Dt);if(void 0!==Xt&&Xt.has(Mt))return Promise.resolve();const Ht=vt.get(Dt);if(void 0!==Ht){const f=Ht.get(Mt);if(void 0!==f)return f}const $t=P(Dt),Jt=void 0===$t.audioWorklet?F(Mt).then((([f,O])=>{const[V,F]=v(f,O);return I(`${V};((a,b)=>{(a[b]=a[b]||[]).push((AudioWorkletProcessor,global,registerProcessor,sampleRate,self,window)=>{${F}\n})})(window,'_AWGS')`)})).then((()=>{const f=bt._AWGS.pop();if(void 0===f)throw new SyntaxError;V($t.currentTime,$t.sampleRate,(()=>f(class{},void 0,((f,I)=>{if(""===f.trim())throw O();const V=St.get($t);if(void 0!==V){if(V.has(f))throw O();x(I),y(I.parameterDescriptors),V.set(f,I)}else x(I),y(I.parameterDescriptors),St.set($t,new Map([[f,I]]))}),$t.sampleRate,void 0,void 0)))})):Promise.all([F(Mt),Promise.resolve(f(xt,xt))]).then((([[f,O],I])=>{const V=kt+1;kt=V;const[F,P]=v(f,O),vt=new Blob([`${F};((AudioWorkletProcessor,registerProcessor)=>{${P}\n})(${I?"AudioWorkletProcessor":"class extends AudioWorkletProcessor {__b=new WeakSet();constructor(){super();(p=>p.postMessage=(q=>(m,t)=>q.call(p,m,t?t.filter(u=>!this.__b.has(u)):t))(p.postMessage))(this.port)}}"},(n,p)=>registerProcessor(n,class extends p{${I?"":"__c = (a) => a.forEach(e=>this.__b.add(e.buffer));"}process(i,o,p){${I?"":"i.forEach(this.__c);o.forEach(this.__c);this.__c(Object.values(p));"}return super.process(i.map(j=>j.some(k=>k.length===0)?[]:j),o,p)}}));registerProcessor('__sac${V}',class extends AudioWorkletProcessor{process(){return !1}})`],{type:"application/javascript; charset=utf-8"}),yt=URL.createObjectURL(vt);return $t.audioWorklet.addModule(yt,Yt).then((()=>{if(mt($t))return $t;const f=ut($t);return f.audioWorklet.addModule(yt,Yt).then((()=>f))})).then((f=>{if(null===gt)throw new SyntaxError;try{new gt(f,`__sac${V}`)}catch{throw new SyntaxError}})).finally((()=>URL.revokeObjectURL(yt)))}));return void 0===Ht?vt.set(Dt,new Map([[Mt,Jt]])):Ht.set(Mt,Jt),Jt.then((()=>{const f=yt.get(Dt);void 0===f?yt.set(Dt,new Set([Mt])):f.add(Mt)})).finally((()=>{const f=vt.get(Dt);void 0!==f&&f.delete(Mt)})),Jt}})(qe,Zt,(f=>O=>new Promise(((I,V)=>{if(null===f)return void V(new SyntaxError);const F=f.document.head;if(null===F)V(new SyntaxError);else{const P=f.document.createElement("script"),ut=new Blob([O],{type:"application/javascript"}),mt=URL.createObjectURL(ut),gt=f.onerror,h=()=>{f.onerror=gt,URL.revokeObjectURL(mt)};f.onerror=(O,I,F,P,ut)=>I===mt||I===f.location.href&&1===F&&1===P?(h(),V(ut),!1):null!==gt?gt(O,I,F,P,ut):void 0,P.onerror=()=>{h(),V(new SyntaxError)},P.onload=()=>{h(),I()},P.src=mt,P.type="module",F.appendChild(P)}})))(Fe),mn,(async f=>{try{const O=await fetch(f);if(O.ok)return[await O.text(),O.url]}catch{}throw new DOMException("","AbortError")}),Be,vn,Ue,$e,new WeakMap,new WeakMap,((f,O)=>async()=>{if(null===f)return!0;if(null===O)return!1;const I=new Blob(['class A extends AudioWorkletProcessor{process(i){this.port.postMessage(i,[i[0][0].buffer])}}registerProcessor("a",A)'],{type:"application/javascript; charset=utf-8"}),V=new O(1,128,44100),F=URL.createObjectURL(I);let P=!1,ut=!1;try{await V.audioWorklet.addModule(F);const O=new f(V,"a",{numberOfOutputs:0}),I=V.createOscillator();O.port.onmessage=()=>P=!0,O.onprocessorerror=()=>ut=!0,I.connect(O),I.start(0),await V.startRendering(),await new Promise((f=>setTimeout(f)))}catch{}finally{URL.revokeObjectURL(F)}return P&&!ut})($e,We),Fe):void 0,xn=((f,O)=>I=>f(I)||O(I))(Xe,Ue),wn=((f,O,I,V,F,P,ut,mt,gt,vt,yt)=>(I,V)=>{const xt=ut(I)?I:P(I);if(F.has(V)){const f=new DOMException("","DataCloneError");return Promise.reject(f)}try{F.add(V)}catch{}return O(gt,(()=>gt(xt)))?xt.decodeAudioData(V).then((I=>(wt(V).catch((()=>{})),O(mt,(()=>mt(I)))||yt(I),f.add(I),I))):new Promise(((O,I)=>{const i=async()=>{try{await wt(V)}catch{}},o=f=>{I(f),i()};try{xt.decodeAudioData(V,(I=>{"function"!=typeof I.copyFromChannel&&(vt(I),q(I)),f.add(I),i().then((()=>O(I)))}),(f=>{o(null===f?new DOMException("","EncodingError"):f)}))}catch(f){o(f)}}))})(es,qe,0,0,new WeakSet,Be,xn,E,Et,os,rs),bn=((f,O,I,V,F,P,ut,mt,gt,vt,yt,xt,bt,St,kt,Dt,Mt,Yt,Xt,Ht)=>class extends kt{constructor(O,I){super(O,I),this._nativeContext=O,this._audioWorklet=void 0===f?void 0:{addModule:(O,I)=>f(this,O,I)}}get audioWorklet(){return this._audioWorklet}createAnalyser(){return new O(this)}createBiquadFilter(){return new F(this)}createBuffer(f,O,V){return new I({length:O,numberOfChannels:f,sampleRate:V})}createBufferSource(){return new V(this)}createChannelMerger(f=6){return new P(this,{numberOfInputs:f})}createChannelSplitter(f=6){return new ut(this,{numberOfOutputs:f})}createConstantSource(){return new mt(this)}createConvolver(){return new gt(this)}createDelay(f=1){return new yt(this,{maxDelayTime:f})}createDynamicsCompressor(){return new xt(this)}createGain(){return new bt(this)}createIIRFilter(f,O){return new St(this,{feedback:O,feedforward:f})}createOscillator(){return new Dt(this)}createPanner(){return new Mt(this)}createPeriodicWave(f,O,I={disableNormalization:!1}){return new Yt(this,{...I,imag:O,real:f})}createStereoPanner(){return new Xt(this)}createWaveShaper(){return new Ht(this)}decodeAudioData(f,O,I){return vt(this._nativeContext,f).then((f=>("function"==typeof O&&O(f),f)),(f=>{throw"function"==typeof I&&I(f),f}))}})(yn,ts,as,ms,xs,ks,Cs,Rs,Is,wn,Fs,js,Bs,Ys,Qs,Ks,rn,cn,pn,fn),Tn=((f,O,I,V)=>class extends f{constructor(f,O){const F=I(f),P=((f,O)=>f.createMediaElementSource(O.mediaElement))(F,O);if(V(F))throw TypeError();super(f,!0,P,null),this._nativeMediaElementAudioSourceNode=P}get mediaElement(){return this._nativeMediaElementAudioSourceNode.mediaElement}})(Ke,0,Be,Ue),Sn=((f,O,I,V)=>class extends f{constructor(f,O){const F=I(f);if(V(F))throw new TypeError;const P=((f,O)=>{const I=f.createMediaStreamDestination();return qt(I,O),1===I.numberOfOutputs&&Object.defineProperty(I,"numberOfOutputs",{get:()=>0}),I})(F,{...we,...O});super(f,!1,P,null),this._nativeMediaStreamAudioDestinationNode=P}get stream(){return this._nativeMediaStreamAudioDestinationNode.stream}})(Ke,0,Be,Ue),kn=((f,O,I,V)=>class extends f{constructor(f,O){const F=I(f),P=((f,{mediaStream:O})=>{const I=O.getAudioTracks();I.sort(((f,O)=>f.id<O.id?-1:f.id>O.id?1:0));const V=I.slice(0,1),F=f.createMediaStreamSource(new MediaStream(V));return Object.defineProperty(F,"mediaStream",{value:O}),F})(F,O);if(V(F))throw new TypeError;super(f,!0,P,null),this._nativeMediaStreamAudioSourceNode=P}get mediaStream(){return this._nativeMediaStreamAudioSourceNode.mediaStream}})(Ke,0,Be,Ue),An=((f,O)=>(I,{mediaStreamTrack:V})=>{if("function"==typeof I.createMediaStreamTrackSource)return I.createMediaStreamTrackSource(V);const F=new MediaStream([V]),P=I.createMediaStreamSource(F);if("audio"!==V.kind)throw f();if(O(I))throw new TypeError;return P})(At,Ue),Cn=((f,O,I)=>class extends f{constructor(f,V){const F=I(f);super(f,!0,O(F,V),null)}})(Ke,An,Be),On=((f,O,I,V,F,P,ut,mt,gt)=>class extends f{constructor(f={}){if(null===gt)throw new Error("Missing the native AudioContext constructor.");let O;try{O=new gt(f)}catch(f){if(12===f.code&&"sampleRate is not in range"===f.message)throw I();throw f}if(null===O)throw V();if(!(f=>void 0===f||"number"==typeof f||"string"==typeof f&&("balanced"===f||"interactive"===f||"playback"===f))(f.latencyHint))throw new TypeError(`The provided value '${f.latencyHint}' is not a valid enum value of type AudioContextLatencyCategory.`);if(void 0!==f.sampleRate&&O.sampleRate!==f.sampleRate)throw I();super(O,2);const{latencyHint:F}=f,{sampleRate:P}=O;if(this._baseLatency="number"==typeof O.baseLatency?O.baseLatency:"balanced"===F?512/P:"interactive"===F||void 0===F?256/P:"playback"===F?1024/P:128*Math.max(2,Math.min(128,Math.round(F*P/128)))/P,this._nativeAudioContext=O,"webkitAudioContext"===gt.name?(this._nativeGainNode=O.createGain(),this._nativeOscillatorNode=O.createOscillator(),this._nativeGainNode.gain.value=1e-37,this._nativeOscillatorNode.connect(this._nativeGainNode).connect(O.destination),this._nativeOscillatorNode.start()):(this._nativeGainNode=null,this._nativeOscillatorNode=null),this._state=null,"running"===O.state){this._state="suspended";const t=()=>{"suspended"===this._state&&(this._state=null),O.removeEventListener("statechange",t)};O.addEventListener("statechange",t)}}get baseLatency(){return this._baseLatency}get state(){return null!==this._state?this._state:this._nativeAudioContext.state}close(){return"closed"===this.state?this._nativeAudioContext.close().then((()=>{throw O()})):("suspended"===this._state&&(this._state=null),this._nativeAudioContext.close().then((()=>{null!==this._nativeGainNode&&null!==this._nativeOscillatorNode&&(this._nativeOscillatorNode.stop(),this._nativeGainNode.disconnect(),this._nativeOscillatorNode.disconnect()),W(this)})))}createMediaElementSource(f){return new F(this,{mediaElement:f})}createMediaStreamDestination(){return new P(this)}createMediaStreamSource(f){return new ut(this,{mediaStream:f})}createMediaStreamTrackSource(f){return new mt(this,{mediaStreamTrack:f})}resume(){return"suspended"===this._state?new Promise(((f,O)=>{const s=()=>{this._nativeAudioContext.removeEventListener("statechange",s),"running"===this._nativeAudioContext.state?f():this.resume().then(f,O)};this._nativeAudioContext.addEventListener("statechange",s)})):this._nativeAudioContext.resume().catch((f=>{if(void 0===f||15===f.code)throw O();throw f}))}suspend(){return this._nativeAudioContext.suspend().catch((f=>{if(void 0===f)throw O();throw f}))}})(bn,At,Zt,Kt,Tn,Sn,kn,Cn,Ze),Dn=(f=>O=>{const I=f.get(O);if(void 0===I)throw new Error("The context has no set of AudioWorkletNodes.");return I})(Xs),Mn=(f=>(O,I)=>{f(O).add(I)})(Dn),Rn=(f=>(O,I,V=0,F=0)=>{const P=O[V];if(void 0===P)throw f();return rt(I)?P.connect(I,0,F):P.connect(I,0)})(R),En=(f=>(O,I)=>{f(O).delete(I)})(Dn),Zn=(f=>(O,I,V,F=0)=>void 0===I?O.forEach((f=>f.disconnect())):"number"==typeof I?Tt(f,O,I).disconnect():rt(I)?void 0===V?O.forEach((f=>f.disconnect(I))):void 0===F?Tt(f,O,V).disconnect(I,0):Tt(f,O,V).disconnect(I,0,F):void 0===V?O.forEach((f=>f.disconnect(I))):Tt(f,O,V).disconnect(I,0))(R),Qn=new WeakMap,$n=((f,O)=>I=>O(f,I))(Qn,w),ti=((f,O,I,V,F,P,ut,mt,gt,vt,yt,xt,bt)=>(St,Dt,Mt,Yt)=>{if(0===Yt.numberOfInputs&&0===Yt.numberOfOutputs)throw gt();const Xt=Array.isArray(Yt.outputChannelCount)?Yt.outputChannelCount:Array.from(Yt.outputChannelCount);if(Xt.some((f=>f<1)))throw gt();if(Xt.length!==Yt.numberOfOutputs)throw O();if("explicit"!==Yt.channelCountMode)throw gt();const Jt=Yt.channelCount*Yt.numberOfInputs,te=Xt.reduce(((f,O)=>f+O),0),pe=void 0===Mt.parameterDescriptors?0:Mt.parameterDescriptors.length;if(Jt+pe>6||te>6)throw gt();const de=new MessageChannel,fe=[],_e=[];for(let f=0;f<Yt.numberOfInputs;f+=1)fe.push(ut(St,{channelCount:Yt.channelCount,channelCountMode:Yt.channelCountMode,channelInterpretation:Yt.channelInterpretation,gain:1})),_e.push(F(St,{channelCount:Yt.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Yt.channelCount}));const me=[];if(void 0!==Mt.parameterDescriptors)for(const{defaultValue:f,maxValue:O,minValue:I,name:V}of Mt.parameterDescriptors){const F=P(St,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:void 0!==Yt.parameterData[V]?Yt.parameterData[V]:void 0===f?0:f});Object.defineProperties(F.offset,{defaultValue:{get:()=>void 0===f?0:f},maxValue:{get:()=>void 0===O?$t:O},minValue:{get:()=>void 0===I?Ht:I}}),me.push(F)}const ge=V(St,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,Jt+pe)}),ve=Pt(Dt,St.sampleRate),ye=mt(St,ve,Jt+pe,Math.max(1,te)),xe=F(St,{channelCount:Math.max(1,te),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,te)}),we=[];for(let f=0;f<Yt.numberOfOutputs;f+=1)we.push(V(St,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Xt[f]}));for(let f=0;f<Yt.numberOfInputs;f+=1){fe[f].connect(_e[f]);for(let O=0;O<Yt.channelCount;O+=1)_e[f].connect(ge,O,f*Yt.channelCount+O)}const be=new lt(void 0===Mt.parameterDescriptors?[]:Mt.parameterDescriptors.map((({name:f},O)=>{const I=me[O];return I.connect(ge,0,Jt+O),I.start(0),[f,I.offset]})));ge.connect(ye);let Te=Yt.channelInterpretation,Se=null;const ke=0===Yt.numberOfOutputs?[ye]:we,Ae={get bufferSize(){return ve},get channelCount(){return Yt.channelCount},set channelCount(f){throw I()},get channelCountMode(){return Yt.channelCountMode},set channelCountMode(f){throw I()},get channelInterpretation(){return Te},set channelInterpretation(f){for(const O of fe)O.channelInterpretation=f;Te=f},get context(){return ye.context},get inputs(){return fe},get numberOfInputs(){return Yt.numberOfInputs},get numberOfOutputs(){return Yt.numberOfOutputs},get onprocessorerror(){return Se},set onprocessorerror(f){"function"==typeof Se&&Ae.removeEventListener("processorerror",Se),Se="function"==typeof f?f:null,"function"==typeof Se&&Ae.addEventListener("processorerror",Se)},get parameters(){return be},get port(){return de.port2},addEventListener:(...f)=>ye.addEventListener(f[0],f[1],f[2]),connect:f.bind(null,ke),disconnect:vt.bind(null,ke),dispatchEvent:(...f)=>ye.dispatchEvent(f[0]),removeEventListener:(...f)=>ye.removeEventListener(f[0],f[1],f[2])},Ce=new Map;var Oe,De;de.port1.addEventListener=(Oe=de.port1.addEventListener,(...f)=>{if("message"===f[0]){const O="function"==typeof f[1]?f[1]:"object"==typeof f[1]&&null!==f[1]&&"function"==typeof f[1].handleEvent?f[1].handleEvent:null;if(null!==O){const I=Ce.get(f[1]);void 0!==I?f[1]=I:(f[1]=f=>{yt(St.currentTime,St.sampleRate,(()=>O(f)))},Ce.set(O,f[1]))}}return Oe.call(de.port1,f[0],f[1],f[2])}),de.port1.removeEventListener=(De=de.port1.removeEventListener,(...f)=>{if("message"===f[0]){const O=Ce.get(f[1]);void 0!==O&&(Ce.delete(f[1]),f[1]=O)}return De.call(de.port1,f[0],f[1],f[2])});let Me=null;Object.defineProperty(de.port1,"onmessage",{get:()=>Me,set:f=>{"function"==typeof Me&&de.port1.removeEventListener("message",Me),Me="function"==typeof f?f:null,"function"==typeof Me&&(de.port1.addEventListener("message",Me),de.port1.start())}}),Mt.prototype.port=de.port1;let Re=null;const Ee=((f,O,I,V)=>{let F=kt.get(f);void 0===F&&(F=new WeakMap,kt.set(f,F));const P=(async(f,O)=>{const I=await(f=>new Promise(((O,I)=>{const{port1:V,port2:F}=new MessageChannel;V.onmessage=({data:f})=>{V.close(),F.close(),O(f)},V.onmessageerror=({data:f})=>{V.close(),F.close(),I(f)},F.postMessage(f)})))(O);return new f(I)})(I,V);return F.set(O,P),P})(St,Ae,Mt,Yt);Ee.then((f=>Re=f));const qe=ft(Yt.numberOfInputs,Yt.channelCount),Ie=ft(Yt.numberOfOutputs,Xt),Ve=void 0===Mt.parameterDescriptors?[]:Mt.parameterDescriptors.reduce(((f,{name:O})=>({...f,[O]:new Float32Array(128)})),{});let Fe=!0;const X=()=>{Yt.numberOfOutputs>0&&ye.disconnect(xe);for(let f=0,O=0;f<Yt.numberOfOutputs;f+=1){const I=we[f];for(let V=0;V<Xt[f];V+=1)xe.disconnect(I,O+V,V);O+=Xt[f]}},Pe=new Map;ye.onaudioprocess=({inputBuffer:f,outputBuffer:O})=>{if(null!==Re){const I=xt(Ae);for(let V=0;V<ve;V+=128){for(let O=0;O<Yt.numberOfInputs;O+=1)for(let I=0;I<Yt.channelCount;I+=1)pt(f,qe[O],I,I,V);void 0!==Mt.parameterDescriptors&&Mt.parameterDescriptors.forEach((({name:O},I)=>{pt(f,Ve,O,Jt+I,V)}));for(let f=0;f<Yt.numberOfInputs;f+=1)for(let O=0;O<Xt[f];O+=1)0===Ie[f][O].byteLength&&(Ie[f][O]=new Float32Array(128));try{const f=qe.map(((f,O)=>{if(I[O].size>0)return Pe.set(O,ve/128),f;const V=Pe.get(O);return void 0===V?[]:(f.every((f=>f.every((f=>0===f))))&&(1===V?Pe.delete(O):Pe.set(O,V-1)),f)})),F=yt(St.currentTime+V/St.sampleRate,St.sampleRate,(()=>Re.process(f,Ie,Ve)));Fe=F;for(let f=0,I=0;f<Yt.numberOfOutputs;f+=1){for(let F=0;F<Xt[f];F+=1)dt(O,Ie[f],F,I+F,V);I+=Xt[f]}}catch(f){Fe=!1,Ae.dispatchEvent(new ErrorEvent("processorerror",{colno:f.colno,filename:f.filename,lineno:f.lineno,message:f.message}))}if(!Fe){for(let f=0;f<Yt.numberOfInputs;f+=1){fe[f].disconnect(_e[f]);for(let O=0;O<Yt.channelCount;O+=1)_e[V].disconnect(ge,O,f*Yt.channelCount+O)}if(void 0!==Mt.parameterDescriptors){const f=Mt.parameterDescriptors.length;for(let O=0;O<f;O+=1){const f=me[O];f.disconnect(ge,0,Jt+O),f.stop()}}ge.disconnect(ye),ye.onaudioprocess=null,Ne?X():K();break}}}};let Ne=!1;const je=ut(St,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0}),J=()=>ye.connect(je).connect(St.destination),K=()=>{ye.disconnect(je),je.disconnect()};return J(),bt(Ae,(()=>{if(Fe){K(),Yt.numberOfOutputs>0&&ye.connect(xe);for(let f=0,O=0;f<Yt.numberOfOutputs;f+=1){const I=we[f];for(let V=0;V<Xt[f];V+=1)xe.connect(I,O+V,V);O+=Xt[f]}}Ne=!0}),(()=>{Fe&&(J(),X()),Ne=!1}))})(Rn,R,At,Ts,Lt,Ds,Bt,Qt,Zt,Zn,mn,$n,ws),ei=((f,O,I,V,F)=>(P,ut,mt,gt,vt,yt)=>{if(null!==mt)try{const O=new mt(P,gt,yt),V=new Map;let ut=null;if(Object.defineProperties(O,{channelCount:{get:()=>yt.channelCount,set:()=>{throw f()}},channelCountMode:{get:()=>"explicit",set:()=>{throw f()}},onprocessorerror:{get:()=>ut,set:f=>{"function"==typeof ut&&O.removeEventListener("processorerror",ut),ut="function"==typeof f?f:null,"function"==typeof ut&&O.addEventListener("processorerror",ut)}}}),O.addEventListener=(bt=O.addEventListener,(...f)=>{if("processorerror"===f[0]){const O="function"==typeof f[1]?f[1]:"object"==typeof f[1]&&null!==f[1]&&"function"==typeof f[1].handleEvent?f[1].handleEvent:null;if(null!==O){const I=V.get(f[1]);void 0!==I?f[1]=I:(f[1]=I=>{"error"===I.type?(Object.defineProperties(I,{type:{value:"processorerror"}}),O(I)):O(new ErrorEvent(f[0],{...I}))},V.set(O,f[1]))}}return bt.call(O,"error",f[1],f[2]),bt.call(O,...f)}),O.removeEventListener=(xt=O.removeEventListener,(...f)=>{if("processorerror"===f[0]){const O=V.get(f[1]);void 0!==O&&(V.delete(f[1]),f[1]=O)}return xt.call(O,"error",f[1],f[2]),xt.call(O,f[0],f[1],f[2])}),0!==yt.numberOfOutputs){const f=I(P,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return O.connect(f).connect(P.destination),F(O,(()=>f.disconnect()),(()=>f.connect(P.destination)))}return O}catch(f){if(11===f.code)throw V();throw f}var xt,bt;if(void 0===vt)throw V();return(f=>{const{port1:O}=new MessageChannel;try{O.postMessage(f)}finally{O.close()}})(yt),O(P,ut,vt,yt)})(At,ti,Bt,Zt,ws),_i=((f,O,I,V,F,P,ut,mt,gt,vt,yt,xt,bt,St,kt,Dt)=>(Mt,Yt,Xt)=>{const Ht=new WeakMap;let $t=null;return{render(Jt,te){mt(te,Jt);const pe=Ht.get(te);return void 0!==pe?Promise.resolve(pe):(async(mt,Jt)=>{let te=yt(mt),pe=null;const de=M(te,Jt),fe=Array.isArray(Yt.outputChannelCount)?Yt.outputChannelCount:Array.from(Yt.outputChannelCount);if(null===xt){const f=fe.reduce(((f,O)=>f+O),0),I=F(Jt,{channelCount:Math.max(1,f),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,f)}),P=[];for(let f=0;f<mt.numberOfOutputs;f+=1)P.push(V(Jt,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:fe[f]}));const vt=ut(Jt,{channelCount:Yt.channelCount,channelCountMode:Yt.channelCountMode,channelInterpretation:Yt.channelInterpretation,gain:1});vt.connect=O.bind(null,P),vt.disconnect=gt.bind(null,P),pe=[I,P,vt]}else de||(te=new xt(Jt,Mt));if(Ht.set(Jt,null===pe?te:pe[2]),null!==pe){if(null===$t){if(void 0===Xt)throw new Error("Missing the processor constructor.");if(null===bt)throw new Error("Missing the native OfflineAudioContext constructor.");const f=mt.channelCount*mt.numberOfInputs,O=void 0===Xt.parameterDescriptors?0:Xt.parameterDescriptors.length,I=f+O,c=async()=>{const gt=new bt(I,128*Math.ceil(mt.context.length/128),Jt.sampleRate),vt=[],yt=[];for(let f=0;f<Yt.numberOfInputs;f+=1)vt.push(ut(gt,{channelCount:Yt.channelCount,channelCountMode:Yt.channelCountMode,channelInterpretation:Yt.channelInterpretation,gain:1})),yt.push(F(gt,{channelCount:Yt.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Yt.channelCount}));const xt=await Promise.all(Array.from(mt.parameters.values()).map((async f=>{const O=P(gt,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:f.value});return await St(gt,f,O.offset),O}))),Mt=V(gt,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,f+O)});for(let f=0;f<Yt.numberOfInputs;f+=1){vt[f].connect(yt[f]);for(let O=0;O<Yt.channelCount;O+=1)yt[f].connect(Mt,O,f*Yt.channelCount+O)}for(const[O,I]of xt.entries())I.connect(Mt,0,f+O),I.start(0);return Mt.connect(gt.destination),await Promise.all(vt.map((f=>kt(mt,gt,f)))),Dt(gt)};$t=_t(mt,0===I?null:await c(),Jt,Yt,fe,Xt,vt)}const f=await $t,O=I(Jt,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),[gt,yt,xt]=pe;null!==f&&(O.buffer=f,O.start(0)),O.connect(gt);for(let f=0,O=0;f<mt.numberOfOutputs;f+=1){const I=yt[f];for(let V=0;V<fe[f];V+=1)gt.connect(I,O+V,V);O+=fe[f]}return xt}if(de)for(const[O,I]of mt.parameters.entries())await f(Jt,I,te.parameters.get(O));else for(const[f,O]of mt.parameters.entries())await St(Jt,O,te.parameters.get(f));return await kt(mt,Jt,te),te})(Jt,te)}}})(us,Rn,ls,Ts,Lt,Ds,Bt,En,Zn,mn,tt,$e,We,ps,je,Ws),bi=(f=>O=>f.get(O))(gn),Si=(f=>(O,I)=>{f.set(O,I)})(Qn),Ii=_n?((f,O,I,V,F,P,ut,mt,gt,vt,yt,xt,bt,kt)=>class extends O{constructor(O,yt,bt){var kt;const Dt=mt(O),Mt=gt(Dt),Yt=(f=>({...f,outputChannelCount:void 0!==f.outputChannelCount?f.outputChannelCount:1===f.numberOfInputs&&1===f.numberOfOutputs?[f.channelCount]:Array.from({length:f.numberOfOutputs},(()=>1))}))({...te,...bt});(f=>{const{port1:O,port2:I}=new MessageChannel;try{O.postMessage(f)}finally{O.close(),I.close()}})(Yt);const Xt=St.get(Dt),Ht=null==Xt?void 0:Xt.get(yt),$t=Mt||"closed"!==Dt.state?Dt:null!==(kt=ut(Dt))&&void 0!==kt?kt:Dt,Jt=F($t,Mt?null:O.baseLatency,vt,yt,Ht,Yt);super(O,!0,Jt,Mt?V(yt,Yt,Ht):null);const pe=[];Jt.parameters.forEach(((f,O)=>{const V=I(this,Mt,f);pe.push([O,V])})),this._nativeAudioWorkletNode=Jt,this._onprocessorerror=null,this._parameters=new lt(pe),Mt&&f(Dt,this);const{activeInputs:de}=P(this);xt(Jt,de)}get onprocessorerror(){return this._onprocessorerror}set onprocessorerror(f){const O="function"==typeof f?kt(this,f):null;this._nativeAudioWorkletNode.onprocessorerror=O;const I=this._nativeAudioWorkletNode.onprocessorerror;this._onprocessorerror=null!==I&&I===O?f:I}get parameters(){return null===this._parameters?this._nativeAudioWorkletNode.parameters:this._parameters}get port(){return this._nativeAudioWorkletNode.port}})(Mn,Ke,fs,_i,ei,j,bi,Be,Ue,$e,0,Si,0,ue):void 0,Fi=((f,O)=>(I,V,F)=>{if(null===O)throw new Error("Missing the native OfflineAudioContext constructor.");try{return new O(I,V,F)}catch(O){if("SyntaxError"===O.name)throw f();throw O}})(Zt,We),Wi=((f,O,I,V,F,P,ut,mt)=>(gt,vt)=>I(gt).render(gt,vt).then((()=>Promise.all(Array.from(V(vt)).map((f=>I(f).render(f,vt)))))).then((()=>F(vt))).then((I=>("function"!=typeof I.copyFromChannel?(ut(I),q(I)):O(P,(()=>P(I)))||mt(I),f.add(I),I))))(es,qe,Ne,Dn,Ws,E,os,rs),Hi=((f,O,I,V,F)=>class extends f{constructor(f,I,F){let P;if("number"==typeof f&&void 0!==I&&void 0!==F)P={length:I,numberOfChannels:f,sampleRate:F};else{if("object"!=typeof f)throw new Error("The given parameters are not valid.");P=f}const{length:ut,numberOfChannels:mt,sampleRate:gt}={...be,...P},vt=V(mt,ut,gt);O(Et,(()=>Et(vt)))||vt.addEventListener("statechange",(()=>{let f=0;const e=O=>{"running"===this._state&&(f>0?(vt.removeEventListener("statechange",e),O.stopImmediatePropagation(),this._waitForThePromiseToSettle(O)):f+=1)};return e})()),super(vt,mt),this._length=ut,this._nativeOfflineAudioContext=vt,this._state=null}get length(){return void 0===this._nativeOfflineAudioContext.length?this._length:this._nativeOfflineAudioContext.length}get state(){return null===this._state?this._nativeOfflineAudioContext.state:this._state}startRendering(){return"running"===this._state?Promise.reject(I()):(this._state="running",F(this.destination,this._nativeOfflineAudioContext).finally((()=>{this._state=null,W(this)})))}_waitForThePromiseToSettle(f){null===this._state?this._nativeOfflineAudioContext.dispatchEvent(f):setTimeout((()=>this._waitForThePromiseToSettle(f)))}})(bn,qe,At,Fi,Wi),$i=((f,O)=>I=>{const V=f.get(I);return O(V)||O(I)})(yt,Xe),Bo=((f,O)=>I=>f.has(I)||O(I))(mt,Qe),zo=((f,O)=>I=>f.has(I)||O(I))(vt,He),Wo=((f,O)=>I=>{const V=f.get(I);return O(V)||O(I)})(yt,Ue),qn=()=>(async(f,O,I,V,F,P,ut,mt,gt,vt,yt,xt,bt,St,kt,Dt)=>!!(f(O,O)&&f(I,I)&&f(F,F)&&f(P,P)&&f(mt,mt)&&f(gt,gt)&&f(vt,vt)&&f(yt,yt)&&f(xt,xt)&&f(bt,bt)&&f(St,St))&&(await Promise.all([f(V,V),f(ut,ut),f(kt,kt),f(Dt,Dt)])).every((f=>f)))(qe,(f=>()=>{if(null===f)return!1;const O=new f(1,1,44100).createBuffer(1,1,44100);if(void 0===O.copyToChannel)return!0;const I=new Float32Array(2);try{O.copyFromChannel(I,0,0)}catch{return!1}return!0})(We),(f=>()=>{if(null===f)return!1;if(void 0!==f.prototype&&void 0!==f.prototype.close)return!0;const O=new f,I=void 0!==O.close;try{O.close()}catch{}return I})(Ze),(f=>()=>{if(null===f)return Promise.resolve(!1);const O=new f(1,1,44100);return new Promise((f=>{let I=!0;const n=V=>{I&&(I=!1,O.startRendering(),f(V instanceof TypeError))};let V;try{V=O.decodeAudioData(null,(()=>{}),n)}catch(f){n(f)}void 0!==V&&V.catch(n)}))})(We),(f=>()=>{if(null===f)return!1;let O;try{O=new f({latencyHint:"balanced"})}catch{return!1}return O.close(),!0})(Ze),(f=>()=>{if(null===f)return!1;const O=new f(1,1,44100).createGain(),I=O.connect(O)===O;return O.disconnect(O),I})(We),((f,O)=>async()=>{if(null===f)return!0;if(null===O)return!1;const I=new Blob(['let c,p;class A extends AudioWorkletProcessor{constructor(){super();this.port.onmessage=(e)=>{p=e.data;p.onmessage=()=>{p.postMessage(c);p.close()};this.port.postMessage(0)}}process(){c=1}}registerProcessor("a",A)'],{type:"application/javascript; charset=utf-8"}),V=new MessageChannel,F=new O(1,128,44100),P=URL.createObjectURL(I);let ut=!1;try{await F.audioWorklet.addModule(P);const O=new f(F,"a",{numberOfOutputs:0}),I=F.createOscillator();await new Promise((f=>{O.port.onmessage=()=>f(),O.port.postMessage(V.port2,[V.port2])})),O.port.onmessage=()=>ut=!0,I.connect(O),I.start(0),await F.startRendering(),ut=await new Promise((f=>{V.port1.onmessage=({data:O})=>f(1===O),V.port1.postMessage(0)}))}catch{}finally{V.port1.close(),URL.revokeObjectURL(P)}return ut})($e,We),(f=>()=>{if(null===f)return!1;const O=new f(1,1,44100).createChannelMerger();if("max"===O.channelCountMode)return!0;try{O.channelCount=2}catch{return!0}return!1})(We),(f=>()=>{if(null===f)return!1;const O=new f(1,1,44100);return void 0===O.createConstantSource||O.createConstantSource().offset.maxValue!==Number.POSITIVE_INFINITY})(We),(f=>()=>{if(null===f)return!1;const O=new f(1,1,44100),I=O.createConvolver();I.buffer=O.createBuffer(1,1,O.sampleRate);try{I.buffer=O.createBuffer(1,1,O.sampleRate)}catch{return!1}return!0})(We),(f=>()=>{if(null===f)return!1;const O=new f(1,1,44100).createConvolver();try{O.channelCount=1}catch{return!1}return!0})(We),ce,(f=>()=>null!==f&&f.hasOwnProperty("isSecureContext"))(Fe),(f=>()=>{if(null===f)return!1;const O=new f;try{return O.createMediaStreamSource(new MediaStream),!1}catch(f){return!0}finally{O.close()}})(Ze),(f=>()=>{if(null===f)return Promise.resolve(!1);const O=new f(1,1,44100);if(void 0===O.createStereoPanner)return Promise.resolve(!0);if(void 0===O.createConstantSource)return Promise.resolve(!0);const I=O.createConstantSource(),V=O.createStereoPanner();return I.channelCount=1,I.offset.value=1,V.channelCount=1,I.start(),I.connect(V).connect(O.destination),O.startRendering().then((f=>1!==f.getChannelData(0)[0]))})(We),he);function Fn(f){return void 0===f}function In(f){return void 0!==f}function Vn(f){return"function"==typeof f}function Nn(f){return"number"==typeof f}function Pn(f){return"[object Object]"===Object.prototype.toString.call(f)&&f.constructor===Object}function jn(f){return"boolean"==typeof f}function Ln(f){return Array.isArray(f)}function zn(f){return"string"==typeof f}function Wn(f){return zn(f)&&/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i.test(f)}function Bn(f,O){if(!f)throw new Error(O)}function Un(f,O,I=1/0){if(!(O<=f&&f<=I))throw new RangeError(`Value must be within [${O}, ${I}], got: ${f}`)}function Gn(f){f.isOffline||"running"===f.state||Kn('The AudioContext is "suspended". Invoke Tone.start() from a user action to start the audio.')}let er=!1,wr=!1;function Xn(f){er=f}function Yn(f){Fn(f)&&er&&!wr&&(wr=!0,Kn("Events scheduled inside of scheduled callbacks should use the passed in scheduling time. See https://github.com/Tonejs/Tone.js/wiki/Accurate-Timing"))}let Fr=console;function Hn(f){Fr=f}function Jn(...f){Fr.log(...f)}function Kn(...f){Fr.warn(...f)}const Pr="object"==typeof self?self:null,Wr=Pr&&(Pr.hasOwnProperty("AudioContext")||Pr.hasOwnProperty("webkitAudioContext"));function si(f,O,I,V){var F,P=arguments.length,ut=P<3?O:null===V?V=Object.getOwnPropertyDescriptor(O,I):V;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)ut=Reflect.decorate(f,O,I,V);else for(var mt=f.length-1;mt>=0;mt--)(F=f[mt])&&(ut=(P<3?F(ut):P>3?F(O,I,ut):F(O,I))||ut);return P>3&&ut&&Object.defineProperty(O,I,ut),ut}function ni(f,O,I,V){return new(I||(I=Promise))((function(F,P){function r(f){try{c(V.next(f))}catch(f){P(f)}}function a(f){try{c(V.throw(f))}catch(f){P(f)}}function c(f){var O;f.done?F(f.value):(O=f.value,O instanceof I?O:new I((function(f){f(O)}))).then(r,a)}c((V=V.apply(f,O||[])).next())}))}Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError;class ii{constructor(f,O,I,V){this._callback=f,this._type=O,this._minimumUpdateInterval=Math.max(128/(V||44100),.001),this.updateInterval=I,this._createClock()}_createWorker(){const f=new Blob([`\n\t\t\t// the initial timeout time\n\t\t\tlet timeoutTime =  ${(1e3*this._updateInterval).toFixed(1)};\n\t\t\t// onmessage callback\n\t\t\tself.onmessage = function(msg){\n\t\t\t\ttimeoutTime = parseInt(msg.data);\n\t\t\t};\n\t\t\t// the tick function which posts a message\n\t\t\t// and schedules a new tick\n\t\t\tfunction tick(){\n\t\t\t\tsetTimeout(tick, timeoutTime);\n\t\t\t\tself.postMessage('tick');\n\t\t\t}\n\t\t\t// call tick initially\n\t\t\ttick();\n\t\t\t`],{type:"text/javascript"}),O=URL.createObjectURL(f),I=new Worker(O);I.onmessage=this._callback.bind(this),this._worker=I}_createTimeout(){this._timeout=setTimeout((()=>{this._createTimeout(),this._callback()}),1e3*this._updateInterval)}_createClock(){if("worker"===this._type)try{this._createWorker()}catch(f){this._type="timeout",this._createClock()}else"timeout"===this._type&&this._createTimeout()}_disposeClock(){this._timeout&&clearTimeout(this._timeout),this._worker&&(this._worker.terminate(),this._worker.onmessage=null)}get updateInterval(){return this._updateInterval}set updateInterval(f){var O;this._updateInterval=Math.max(f,this._minimumUpdateInterval),"worker"===this._type&&(null===(O=this._worker)||void 0===O||O.postMessage(1e3*this._updateInterval))}get type(){return this._type}set type(f){this._disposeClock(),this._type=f,this._createClock()}dispose(){this._disposeClock()}}function oi(f){return zo(f)}function ri(f){return Bo(f)}function ai(f){return Wo(f)}function ci(f){return $i(f)}function hi(f,O){return"value"===f||oi(O)||ri(O)||function(f){return f instanceof as}(O)}function li(f,...O){if(!O.length)return f;const I=O.shift();if(Pn(f)&&Pn(I))for(const O in I)hi(O,I[O])?f[O]=I[O]:Pn(I[O])?(f[O]||Object.assign(f,{[O]:{}}),li(f[O],I[O])):Object.assign(f,{[O]:I[O]});return li(f,...O)}function ui(f,O,I=[],V){const F={},P=Array.from(O);if(Pn(P[0])&&V&&!Reflect.has(P[0],V)&&(Object.keys(P[0]).some((O=>Reflect.has(f,O)))||(li(F,{[V]:P[0]}),I.splice(I.indexOf(V),1),P.shift())),1===P.length&&Pn(P[0]))li(F,P[0]);else for(let f=0;f<I.length;f++)In(P[f])&&(F[I[f]]=P[f]);return li(f,F)}function pi(f,O){return Fn(f)?O:f}function di(f,O){return O.forEach((O=>{Reflect.has(f,O)&&delete f[O]})),f}class fi{constructor(){this.debug=!1,this._wasDisposed=!1}static getDefaults(){return{}}log(...f){(this.debug||Pr&&this.toString()===Pr.TONE_DEBUG_CLASS)&&Jn(this,...f)}dispose(){return this._wasDisposed=!0,this}get disposed(){return this._wasDisposed}toString(){return this.name}}fi.version=V;const ma=1e-6;function mi(f,O){return f>O+ma}function gi(f,O){return mi(f,O)||yi(f,O)}function vi(f,O){return f+ma<O}function yi(f,O){return Math.abs(f-O)<ma}function xi(f,O,I){return Math.max(Math.min(f,I),O)}class wi extends fi{constructor(){super(),this.name="Timeline",this._timeline=[];const f=ui(wi.getDefaults(),arguments,["memory"]);this.memory=f.memory,this.increasing=f.increasing}static getDefaults(){return{memory:1/0,increasing:!1}}get length(){return this._timeline.length}add(f){if(Bn(Reflect.has(f,"time"),"Timeline: events must have a time attribute"),f.time=f.time.valueOf(),this.increasing&&this.length){const O=this._timeline[this.length-1];Bn(gi(f.time,O.time),"The time must be greater than or equal to the last scheduled time"),this._timeline.push(f)}else{const O=this._search(f.time);this._timeline.splice(O+1,0,f)}if(this.length>this.memory){const f=this.length-this.memory;this._timeline.splice(0,f)}return this}remove(f){const O=this._timeline.indexOf(f);return-1!==O&&this._timeline.splice(O,1),this}get(f,O="time"){const I=this._search(f,O);return-1!==I?this._timeline[I]:null}peek(){return this._timeline[0]}shift(){return this._timeline.shift()}getAfter(f,O="time"){const I=this._search(f,O);return I+1<this._timeline.length?this._timeline[I+1]:null}getBefore(f){const O=this._timeline.length;if(O>0&&this._timeline[O-1].time<f)return this._timeline[O-1];const I=this._search(f);return I-1>=0?this._timeline[I-1]:null}cancel(f){if(this._timeline.length>1){let O=this._search(f);if(O>=0)if(yi(this._timeline[O].time,f)){for(let I=O;I>=0&&yi(this._timeline[I].time,f);I--)O=I;this._timeline=this._timeline.slice(0,O)}else this._timeline=this._timeline.slice(0,O+1);else this._timeline=[]}else 1===this._timeline.length&&gi(this._timeline[0].time,f)&&(this._timeline=[]);return this}cancelBefore(f){const O=this._search(f);return O>=0&&(this._timeline=this._timeline.slice(O+1)),this}previousEvent(f){const O=this._timeline.indexOf(f);return O>0?this._timeline[O-1]:null}_search(f,O="time"){if(0===this._timeline.length)return-1;let I=0;const V=this._timeline.length;let F=V;if(V>0&&this._timeline[V-1][O]<=f)return V-1;for(;I<F;){let V=Math.floor(I+(F-I)/2);const P=this._timeline[V],ut=this._timeline[V+1];if(yi(P[O],f)){for(let I=V;I<this._timeline.length&&yi(this._timeline[I][O],f);I++)V=I;return V}if(vi(P[O],f)&&mi(ut[O],f))return V;mi(P[O],f)?F=V:I=V+1}return-1}_iterate(f,O=0,I=this._timeline.length-1){this._timeline.slice(O,I+1).forEach(f)}forEach(f){return this._iterate(f),this}forEachBefore(f,O){const I=this._search(f);return-1!==I&&this._iterate(O,0,I),this}forEachAfter(f,O){const I=this._search(f);return this._iterate(O,I+1),this}forEachBetween(f,O,I){let V=this._search(f),F=this._search(O);return-1!==V&&-1!==F?(this._timeline[V].time!==f&&(V+=1),this._timeline[F].time===O&&(F-=1),this._iterate(I,V,F)):-1===V&&this._iterate(I,0,F),this}forEachFrom(f,O){let I=this._search(f);for(;I>=0&&this._timeline[I].time>=f;)I--;return this._iterate(O,I+1),this}forEachAtTime(f,O){const I=this._search(f);if(-1!==I&&yi(this._timeline[I].time,f)){let V=I;for(let O=I;O>=0&&yi(this._timeline[O].time,f);O--)V=O;this._iterate((f=>{O(f)}),V,I)}return this}dispose(){return super.dispose(),this._timeline=[],this}}const Ma=[];function Ti(f){Ma.push(f)}const Ea=[];function ki(f){Ea.push(f)}class Ai extends fi{constructor(){super(...arguments),this.name="Emitter"}on(f,O){return f.split(/\W+/).forEach((f=>{Fn(this._events)&&(this._events={}),this._events.hasOwnProperty(f)||(this._events[f]=[]),this._events[f].push(O)})),this}once(f,O){const s=(...I)=>{O(...I),this.off(f,s)};return this.on(f,s),this}off(f,O){return f.split(/\W+/).forEach((f=>{if(Fn(this._events)&&(this._events={}),this._events.hasOwnProperty(f))if(Fn(O))this._events[f]=[];else{const I=this._events[f];for(let f=I.length-1;f>=0;f--)I[f]===O&&I.splice(f,1)}})),this}emit(f,...O){if(this._events&&this._events.hasOwnProperty(f)){const I=this._events[f].slice(0);for(let f=0,V=I.length;f<V;f++)I[f].apply(this,O)}return this}static mixin(f){["on","once","off","emit"].forEach((O=>{const I=Object.getOwnPropertyDescriptor(Ai.prototype,O);Object.defineProperty(f.prototype,O,I)}))}dispose(){return super.dispose(),this._events=void 0,this}}class Ci extends Ai{constructor(){super(...arguments),this.isOffline=!1}toJSON(){return{}}}class Di extends Ci{constructor(){var f,O;super(),this.name="Context",this._constants=new Map,this._timeouts=new wi,this._timeoutIds=0,this._initialized=!1,this._closeStarted=!1,this.isOffline=!1,this._workletPromise=null;const I=ui(Di.getDefaults(),arguments,["context"]);I.context?(this._context=I.context,this._latencyHint=(null===(f=arguments[0])||void 0===f?void 0:f.latencyHint)||""):(this._context=function(f){return new On(f)}({latencyHint:I.latencyHint}),this._latencyHint=I.latencyHint),this._ticker=new ii(this.emit.bind(this,"tick"),I.clockSource,I.updateInterval,this._context.sampleRate),this.on("tick",this._timeoutLoop.bind(this)),this._context.onstatechange=()=>{this.emit("statechange",this.state)},this[(null===(O=arguments[0])||void 0===O?void 0:O.hasOwnProperty("updateInterval"))?"_lookAhead":"lookAhead"]=I.lookAhead}static getDefaults(){return{clockSource:"worker",latencyHint:"interactive",lookAhead:.1,updateInterval:.05}}initialize(){var f;return this._initialized||(f=this,Ma.forEach((O=>O(f))),this._initialized=!0),this}createAnalyser(){return this._context.createAnalyser()}createOscillator(){return this._context.createOscillator()}createBufferSource(){return this._context.createBufferSource()}createBiquadFilter(){return this._context.createBiquadFilter()}createBuffer(f,O,I){return this._context.createBuffer(f,O,I)}createChannelMerger(f){return this._context.createChannelMerger(f)}createChannelSplitter(f){return this._context.createChannelSplitter(f)}createConstantSource(){return this._context.createConstantSource()}createConvolver(){return this._context.createConvolver()}createDelay(f){return this._context.createDelay(f)}createDynamicsCompressor(){return this._context.createDynamicsCompressor()}createGain(){return this._context.createGain()}createIIRFilter(f,O){return this._context.createIIRFilter(f,O)}createPanner(){return this._context.createPanner()}createPeriodicWave(f,O,I){return this._context.createPeriodicWave(f,O,I)}createStereoPanner(){return this._context.createStereoPanner()}createWaveShaper(){return this._context.createWaveShaper()}createMediaStreamSource(f){return Bn(ci(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamSource(f)}createMediaElementSource(f){return Bn(ci(this._context),"Not available if OfflineAudioContext"),this._context.createMediaElementSource(f)}createMediaStreamDestination(){return Bn(ci(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamDestination()}decodeAudioData(f){return this._context.decodeAudioData(f)}get currentTime(){return this._context.currentTime}get state(){return this._context.state}get sampleRate(){return this._context.sampleRate}get listener(){return this.initialize(),this._listener}set listener(f){Bn(!this._initialized,"The listener cannot be set after initialization."),this._listener=f}get transport(){return this.initialize(),this._transport}set transport(f){Bn(!this._initialized,"The transport cannot be set after initialization."),this._transport=f}get draw(){return this.initialize(),this._draw}set draw(f){Bn(!this._initialized,"Draw cannot be set after initialization."),this._draw=f}get destination(){return this.initialize(),this._destination}set destination(f){Bn(!this._initialized,"The destination cannot be set after initialization."),this._destination=f}createAudioWorkletNode(f,O){return function(f,O,I){return Bn(In(Ii),"This node only works in a secure context (https or localhost)"),new Ii(f,O,I)}(this.rawContext,f,O)}addAudioWorkletModule(f){return ni(this,void 0,void 0,(function*(){Bn(In(this.rawContext.audioWorklet),"AudioWorkletNode is only available in a secure context (https or localhost)"),this._workletPromise||(this._workletPromise=this.rawContext.audioWorklet.addModule(f)),yield this._workletPromise}))}workletsAreReady(){return ni(this,void 0,void 0,(function*(){(yield this._workletPromise)?this._workletPromise:Promise.resolve()}))}get updateInterval(){return this._ticker.updateInterval}set updateInterval(f){this._ticker.updateInterval=f}get clockSource(){return this._ticker.type}set clockSource(f){this._ticker.type=f}get lookAhead(){return this._lookAhead}set lookAhead(f){this._lookAhead=f,this.updateInterval=f?f/2:.01}get latencyHint(){return this._latencyHint}get rawContext(){return this._context}now(){return this._context.currentTime+this._lookAhead}immediate(){return this._context.currentTime}resume(){return ci(this._context)?this._context.resume():Promise.resolve()}close(){return ni(this,void 0,void 0,(function*(){var f;ci(this._context)&&"closed"!==this.state&&!this._closeStarted&&(this._closeStarted=!0,yield this._context.close()),this._initialized&&(f=this,Ea.forEach((O=>O(f))))}))}getConstant(f){if(this._constants.has(f))return this._constants.get(f);{const O=this._context.createBuffer(1,128,this._context.sampleRate),I=O.getChannelData(0);for(let O=0;O<I.length;O++)I[O]=f;const V=this._context.createBufferSource();return V.channelCount=1,V.channelCountMode="explicit",V.buffer=O,V.loop=!0,V.start(0),this._constants.set(f,V),V}}dispose(){return super.dispose(),this._ticker.dispose(),this._timeouts.dispose(),Object.keys(this._constants).map((f=>this._constants[f].disconnect())),this.close(),this}_timeoutLoop(){const f=this.now();let O=this._timeouts.peek();for(;this._timeouts.length&&O&&O.time<=f;)O.callback(),this._timeouts.shift(),O=this._timeouts.peek()}setTimeout(f,O){this._timeoutIds++;const I=this.now();return this._timeouts.add({callback:f,id:this._timeoutIds,time:I+O}),this._timeoutIds}clearTimeout(f){return this._timeouts.forEach((O=>{O.id===f&&this._timeouts.remove(O)})),this}clearInterval(f){return this.clearTimeout(f)}setInterval(f,O){const I=++this._timeoutIds,n=()=>{const V=this.now();this._timeouts.add({callback:()=>{f(),n()},id:I,time:V+O})};return n(),I}}function Oi(f,O){Ln(O)?O.forEach((O=>Oi(f,O))):Object.defineProperty(f,O,{enumerable:!0,writable:!1})}function Mi(f,O){Ln(O)?O.forEach((O=>Mi(f,O))):Object.defineProperty(f,O,{writable:!0})}const Ei=()=>{};class Ri extends fi{constructor(){super(),this.name="ToneAudioBuffer",this.onload=Ei;const f=ui(Ri.getDefaults(),arguments,["url","onload","onerror"]);this.reverse=f.reverse,this.onload=f.onload,zn(f.url)?this.load(f.url).catch(f.onerror):f.url&&this.set(f.url)}static getDefaults(){return{onerror:Ei,onload:Ei,reverse:!1}}get sampleRate(){return this._buffer?this._buffer.sampleRate:Vi().sampleRate}set(f){return f instanceof Ri?f.loaded?this._buffer=f.get():f.onload=()=>{this.set(f),this.onload(this)}:this._buffer=f,this._reversed&&this._reverse(),this}get(){return this._buffer}load(f){return ni(this,void 0,void 0,(function*(){const O=Ri.load(f).then((f=>{this.set(f),this.onload(this)}));Ri.downloads.push(O);try{yield O}finally{const f=Ri.downloads.indexOf(O);Ri.downloads.splice(f,1)}return this}))}dispose(){return super.dispose(),this._buffer=void 0,this}fromArray(f){const O=Ln(f)&&f[0].length>0,I=O?f.length:1,V=O?f[0].length:f.length,F=Vi(),P=F.createBuffer(I,V,F.sampleRate),ut=O||1!==I?f:[f];for(let f=0;f<I;f++)P.copyToChannel(ut[f],f);return this._buffer=P,this}toMono(f){if(Nn(f))this.fromArray(this.toArray(f));else{let f=new Float32Array(this.length);const O=this.numberOfChannels;for(let I=0;I<O;I++){const O=this.toArray(I);for(let I=0;I<O.length;I++)f[I]+=O[I]}f=f.map((f=>f/O)),this.fromArray(f)}return this}toArray(f){if(Nn(f))return this.getChannelData(f);if(1===this.numberOfChannels)return this.toArray(0);{const f=[];for(let O=0;O<this.numberOfChannels;O++)f[O]=this.getChannelData(O);return f}}getChannelData(f){return this._buffer?this._buffer.getChannelData(f):new Float32Array(0)}slice(f,O=this.duration){Bn(this.loaded,"Buffer is not loaded");const I=Math.floor(f*this.sampleRate),V=Math.floor(O*this.sampleRate);Bn(I<V,"The start time must be less than the end time");const F=V-I,P=Vi().createBuffer(this.numberOfChannels,F,this.sampleRate);for(let f=0;f<this.numberOfChannels;f++)P.copyToChannel(this.getChannelData(f).subarray(I,V),f);return new Ri(P)}_reverse(){if(this.loaded)for(let f=0;f<this.numberOfChannels;f++)this.getChannelData(f).reverse();return this}get loaded(){return this.length>0}get duration(){return this._buffer?this._buffer.duration:0}get length(){return this._buffer?this._buffer.length:0}get numberOfChannels(){return this._buffer?this._buffer.numberOfChannels:0}get reverse(){return this._reversed}set reverse(f){this._reversed!==f&&(this._reversed=f,this._reverse())}static fromArray(f){return(new Ri).fromArray(f)}static fromUrl(f){return ni(this,void 0,void 0,(function*(){const O=new Ri;return yield O.load(f)}))}static load(f){return ni(this,void 0,void 0,(function*(){const O=f.match(/\[([^\]\[]+\|.+)\]$/);if(O){const I=O[1].split("|");let V=I[0];for(const f of I)if(Ri.supportsType(f)){V=f;break}f=f.replace(O[0],V)}const I=""===Ri.baseUrl||Ri.baseUrl.endsWith("/")?Ri.baseUrl:Ri.baseUrl+"/",V=document.createElement("a");V.href=I+f,V.pathname=(V.pathname+V.hash).split("/").map(encodeURIComponent).join("/");const F=yield fetch(V.href);if(!F.ok)throw new Error(`could not load url: ${f}`);const P=yield F.arrayBuffer();return yield Vi().decodeAudioData(P)}))}static supportsType(f){const O=f.split("."),I=O[O.length-1];return""!==document.createElement("audio").canPlayType("audio/"+I)}static loaded(){return ni(this,void 0,void 0,(function*(){for(yield Promise.resolve();Ri.downloads.length;)yield Ri.downloads[0]}))}}Ri.baseUrl="",Ri.downloads=[];class qi extends Di{constructor(){var f,O,I;super({clockSource:"offline",context:ai(arguments[0])?arguments[0]:(f=arguments[0],O=arguments[1]*arguments[2],I=arguments[2],new Hi(f,O,I)),lookAhead:0,updateInterval:ai(arguments[0])?128/arguments[0].sampleRate:128/arguments[2]}),this.name="OfflineContext",this._currentTime=0,this.isOffline=!0,this._duration=ai(arguments[0])?arguments[0].length/arguments[0].sampleRate:arguments[1]}now(){return this._currentTime}get currentTime(){return this._currentTime}_renderClock(f){return ni(this,void 0,void 0,(function*(){let O=0;for(;this._duration-this._currentTime>=0;){this.emit("tick"),this._currentTime+=128/this.sampleRate,O++;const I=Math.floor(this.sampleRate/128);f&&O%I==0&&(yield new Promise((f=>setTimeout(f,1))))}}))}render(f=!0){return ni(this,void 0,void 0,(function*(){yield this.workletsAreReady(),yield this._renderClock(f);const O=yield this._context.startRendering();return new Ri(O)}))}close(){return Promise.resolve()}}const qa=new class extends Ci{constructor(){super(...arguments),this.lookAhead=0,this.latencyHint=0,this.isOffline=!1}createAnalyser(){return{}}createOscillator(){return{}}createBufferSource(){return{}}createBiquadFilter(){return{}}createBuffer(f,O,I){return{}}createChannelMerger(f){return{}}createChannelSplitter(f){return{}}createConstantSource(){return{}}createConvolver(){return{}}createDelay(f){return{}}createDynamicsCompressor(){return{}}createGain(){return{}}createIIRFilter(f,O){return{}}createPanner(){return{}}createPeriodicWave(f,O,I){return{}}createStereoPanner(){return{}}createWaveShaper(){return{}}createMediaStreamSource(f){return{}}createMediaElementSource(f){return{}}createMediaStreamDestination(){return{}}decodeAudioData(f){return Promise.resolve({})}createAudioWorkletNode(f,O){return{}}get rawContext(){return{}}addAudioWorkletModule(f){return ni(this,void 0,void 0,(function*(){return Promise.resolve()}))}resume(){return Promise.resolve()}setTimeout(f,O){return 0}clearTimeout(f){return this}setInterval(f,O){return 0}clearInterval(f){return this}getConstant(f){return{}}get currentTime(){return 0}get state(){return{}}get sampleRate(){return 0}get listener(){return{}}get transport(){return{}}get draw(){return{}}set draw(f){}get destination(){return{}}set destination(f){}now(){return 0}immediate(){return 0}};let Ia=qa;function Vi(){return Ia===qa&&Wr&&Ni(new Di),Ia}function Ni(f,O=!1){O&&Ia.dispose(),Ia=ci(f)?new Di(f):ai(f)?new qi(f):f}function Pi(){return Ia.resume()}if(Pr&&!Pr.TONE_SILENCE_LOGGING){let f="v";"dev"===V&&(f="");const O=` * Tone.js ${f}${V} * `;console.log(`%c${O}`,"background: #000; color: #fff")}function ji(f){return Math.pow(10,f/20)}function Li(f){return Math.log(f)/Math.LN10*20}function zi(f){return Math.pow(2,f/12)}let Fa=440;function Bi(f){return Math.round(Ui(f))}function Ui(f){return 69+12*Math.log2(f/Fa)}function Gi(f){return Fa*Math.pow(2,(f-69)/12)}class Qi extends fi{constructor(f,O,I){super(),this.defaultUnits="s",this._val=O,this._units=I,this.context=f,this._expressions=this._getExpressions()}_getExpressions(){return{hz:{method:f=>this._frequencyToUnits(parseFloat(f)),regexp:/^(\d+(?:\.\d+)?)hz$/i},i:{method:f=>this._ticksToUnits(parseInt(f,10)),regexp:/^(\d+)i$/i},m:{method:f=>this._beatsToUnits(parseInt(f,10)*this._getTimeSignature()),regexp:/^(\d+)m$/i},n:{method:(f,O)=>{const I=parseInt(f,10),V="."===O?1.5:1;return 1===I?this._beatsToUnits(this._getTimeSignature())*V:this._beatsToUnits(4/I)*V},regexp:/^(\d+)n(\.?)$/i},number:{method:f=>this._expressions[this.defaultUnits].method.call(this,f),regexp:/^(\d+(?:\.\d+)?)$/},s:{method:f=>this._secondsToUnits(parseFloat(f)),regexp:/^(\d+(?:\.\d+)?)s$/},samples:{method:f=>parseInt(f,10)/this.context.sampleRate,regexp:/^(\d+)samples$/},t:{method:f=>{const O=parseInt(f,10);return this._beatsToUnits(8/(3*Math.floor(O)))},regexp:/^(\d+)t$/i},tr:{method:(f,O,I)=>{let V=0;return f&&"0"!==f&&(V+=this._beatsToUnits(this._getTimeSignature()*parseFloat(f))),O&&"0"!==O&&(V+=this._beatsToUnits(parseFloat(O))),I&&"0"!==I&&(V+=this._beatsToUnits(parseFloat(I)/4)),V},regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?$/}}}valueOf(){if(this._val instanceof Qi&&this.fromType(this._val),Fn(this._val))return this._noArg();if(zn(this._val)&&Fn(this._units)){for(const f in this._expressions)if(this._expressions[f].regexp.test(this._val.trim())){this._units=f;break}}else if(Pn(this._val)){let f=0;for(const O in this._val)if(In(this._val[O])){const I=this._val[O];f+=new this.constructor(this.context,O).valueOf()*I}return f}if(In(this._units)){const f=this._expressions[this._units],O=this._val.toString().trim().match(f.regexp);return O?f.method.apply(this,O.slice(1)):f.method.call(this,this._val)}return zn(this._val)?parseFloat(this._val):this._val}_frequencyToUnits(f){return 1/f}_beatsToUnits(f){return 60/this._getBpm()*f}_secondsToUnits(f){return f}_ticksToUnits(f){return f*this._beatsToUnits(1)/this._getPPQ()}_noArg(){return this._now()}_getBpm(){return this.context.transport.bpm.value}_getTimeSignature(){return this.context.transport.timeSignature}_getPPQ(){return this.context.transport.PPQ}fromType(f){switch(this._units=void 0,this.defaultUnits){case"s":this._val=f.toSeconds();break;case"i":this._val=f.toTicks();break;case"hz":this._val=f.toFrequency();break;case"midi":this._val=f.toMidi()}return this}toFrequency(){return 1/this.toSeconds()}toSamples(){return this.toSeconds()*this.context.sampleRate}toMilliseconds(){return 1e3*this.toSeconds()}}class Zi extends Qi{constructor(){super(...arguments),this.name="TimeClass"}_getExpressions(){return Object.assign(super._getExpressions(),{now:{method:f=>this._now()+new this.constructor(this.context,f).valueOf(),regexp:/^\+(.+)/},quantize:{method:f=>{const O=new Zi(this.context,f).valueOf();return this._secondsToUnits(this.context.transport.nextSubdivision(O))},regexp:/^@(.+)/}})}quantize(f,O=1){const I=new this.constructor(this.context,f).valueOf(),V=this.valueOf();return V+(Math.round(V/I)*I-V)*O}toNotation(){const f=this.toSeconds(),O=["1m"];for(let f=1;f<9;f++){const I=Math.pow(2,f);O.push(I+"n."),O.push(I+"n"),O.push(I+"t")}O.push("0");let I=O[0],V=new Zi(this.context,O[0]).toSeconds();return O.forEach((O=>{const F=new Zi(this.context,O).toSeconds();Math.abs(F-f)<Math.abs(V-f)&&(I=O,V=F)})),I}toBarsBeatsSixteenths(){const f=this._beatsToUnits(1);let O=this.valueOf()/f;O=parseFloat(O.toFixed(4));const I=Math.floor(O/this._getTimeSignature());let V=O%1*4;O=Math.floor(O)%this._getTimeSignature();const F=V.toString();return F.length>3&&(V=parseFloat(parseFloat(F).toFixed(3))),[I,O,V].join(":")}toTicks(){const f=this._beatsToUnits(1);return this.valueOf()/f*this._getPPQ()}toSeconds(){return this.valueOf()}toMidi(){return Bi(this.toFrequency())}_now(){return this.context.now()}}function Xi(f,O){return new Zi(Vi(),f,O)}class Yi extends Zi{constructor(){super(...arguments),this.name="Frequency",this.defaultUnits="hz"}static get A4(){return Fa}static set A4(f){!function(f){Fa=f}(f)}_getExpressions(){return Object.assign({},super._getExpressions(),{midi:{regexp:/^(\d+(?:\.\d+)?midi)/,method(f){return"midi"===this.defaultUnits?f:Yi.mtof(f)}},note:{regexp:/^([a-g]{1}(?:b|#|##|x|bb|###|#x|x#|bbb)?)(-?[0-9]+)/i,method(f,O){const I=gc[f.toLowerCase()]+12*(parseInt(O,10)+1);return"midi"===this.defaultUnits?I:Yi.mtof(I)}},tr:{regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method(f,O,I){let V=1;return f&&"0"!==f&&(V*=this._beatsToUnits(this._getTimeSignature()*parseFloat(f))),O&&"0"!==O&&(V*=this._beatsToUnits(parseFloat(O))),I&&"0"!==I&&(V*=this._beatsToUnits(parseFloat(I)/4)),V}}})}transpose(f){return new Yi(this.context,this.valueOf()*zi(f))}harmonize(f){return f.map((f=>this.transpose(f)))}toMidi(){return Bi(this.valueOf())}toNote(){const f=this.toFrequency(),O=Math.log2(f/Yi.A4);let I=Math.round(12*O)+57;const V=Math.floor(I/12);return V<0&&(I+=-12*V),yc[I%12]+V.toString()}toSeconds(){return 1/super.toSeconds()}toTicks(){const f=this._beatsToUnits(1),O=this.valueOf()/f;return Math.floor(O*this._getPPQ())}_noArg(){return 0}_frequencyToUnits(f){return f}_ticksToUnits(f){return 1/(60*f/(this._getBpm()*this._getPPQ()))}_beatsToUnits(f){return 1/super._beatsToUnits(f)}_secondsToUnits(f){return 1/f}static mtof(f){return Gi(f)}static ftom(f){return Bi(f)}}const gc={cbbb:-3,cbb:-2,cb:-1,c:0,"c#":1,cx:2,"c##":2,"c###":3,"cx#":3,"c#x":3,dbbb:-1,dbb:0,db:1,d:2,"d#":3,dx:4,"d##":4,"d###":5,"dx#":5,"d#x":5,ebbb:1,ebb:2,eb:3,e:4,"e#":5,ex:6,"e##":6,"e###":7,"ex#":7,"e#x":7,fbbb:2,fbb:3,fb:4,f:5,"f#":6,fx:7,"f##":7,"f###":8,"fx#":8,"f#x":8,gbbb:4,gbb:5,gb:6,g:7,"g#":8,gx:9,"g##":9,"g###":10,"gx#":10,"g#x":10,abbb:6,abb:7,ab:8,a:9,"a#":10,ax:11,"a##":11,"a###":12,"ax#":12,"a#x":12,bbbb:8,bbb:9,bb:10,b:11,"b#":12,bx:13,"b##":13,"b###":14,"bx#":14,"b#x":14},yc=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];function Ji(f,O){return new Yi(Vi(),f,O)}class Ki extends Zi{constructor(){super(...arguments),this.name="TransportTime"}_now(){return this.context.transport.seconds}}function to(f,O){return new Ki(Vi(),f,O)}class eo extends fi{constructor(){super();const f=ui(eo.getDefaults(),arguments,["context"]);this.defaultContext?this.context=this.defaultContext:this.context=f.context}static getDefaults(){return{context:Vi()}}now(){return this.context.currentTime+this.context.lookAhead}immediate(){return this.context.currentTime}get sampleTime(){return 1/this.context.sampleRate}get blockTime(){return 128/this.context.sampleRate}toSeconds(f){return Yn(f),new Zi(this.context,f).toSeconds()}toFrequency(f){return new Yi(this.context,f).toFrequency()}toTicks(f){return new Ki(this.context,f).toTicks()}_getPartialProperties(f){const O=this.get();return Object.keys(O).forEach((I=>{Fn(f[I])&&delete O[I]})),O}get(){const f=this.constructor.getDefaults();return Object.keys(f).forEach((O=>{if(Reflect.has(this,O)){const I=this[O];In(I)&&In(I.value)&&In(I.setValueAtTime)?f[O]=I.value:I instanceof eo?f[O]=I._getPartialProperties(f[O]):Ln(I)||Nn(I)||zn(I)||jn(I)?f[O]=I:delete f[O]}})),f}set(f){return Object.keys(f).forEach((O=>{Reflect.has(this,O)&&In(this[O])&&(this[O]&&In(this[O].value)&&In(this[O].setValueAtTime)?this[O].value!==f[O]&&(this[O].value=f[O]):this[O]instanceof eo?this[O].set(f[O]):this[O]=f[O])})),this}}class so extends wi{constructor(f="stopped"){super(),this.name="StateTimeline",this._initial=f,this.setStateAtTime(this._initial,0)}getValueAtTime(f){const O=this.get(f);return null!==O?O.state:this._initial}setStateAtTime(f,O,I){return Un(O,0),this.add(Object.assign({},I,{state:f,time:O})),this}getLastState(f,O){for(let I=this._search(O);I>=0;I--){const O=this._timeline[I];if(O.state===f)return O}}getNextState(f,O){const I=this._search(O);if(-1!==I)for(let O=I;O<this._timeline.length;O++){const I=this._timeline[O];if(I.state===f)return I}}}class no extends eo{constructor(){super(ui(no.getDefaults(),arguments,["param","units","convert"])),this.name="Param",this.overridden=!1,this._minOutput=1e-7;const f=ui(no.getDefaults(),arguments,["param","units","convert"]);for(Bn(In(f.param)&&(oi(f.param)||f.param instanceof no),"param must be an AudioParam");!oi(f.param);)f.param=f.param._param;this._swappable=!!In(f.swappable)&&f.swappable,this._swappable?(this.input=this.context.createGain(),this._param=f.param,this.input.connect(this._param)):this._param=this.input=f.param,this._events=new wi(1e3),this._initialValue=this._param.defaultValue,this.units=f.units,this.convert=f.convert,this._minValue=f.minValue,this._maxValue=f.maxValue,In(f.value)&&f.value!==this._toType(this._initialValue)&&this.setValueAtTime(f.value,0)}static getDefaults(){return Object.assign(eo.getDefaults(),{convert:!0,units:"number"})}get value(){const f=this.now();return this.getValueAtTime(f)}set value(f){this.cancelScheduledValues(this.now()),this.setValueAtTime(f,this.now())}get minValue(){return In(this._minValue)?this._minValue:"time"===this.units||"frequency"===this.units||"normalRange"===this.units||"positive"===this.units||"transportTime"===this.units||"ticks"===this.units||"bpm"===this.units||"hertz"===this.units||"samples"===this.units?0:"audioRange"===this.units?-1:"decibels"===this.units?-1/0:this._param.minValue}get maxValue(){return In(this._maxValue)?this._maxValue:"normalRange"===this.units||"audioRange"===this.units?1:this._param.maxValue}_is(f,O){return this.units===O}_assertRange(f){return In(this.maxValue)&&In(this.minValue)&&Un(f,this._fromType(this.minValue),this._fromType(this.maxValue)),f}_fromType(f){return this.convert&&!this.overridden?this._is(f,"time")?this.toSeconds(f):this._is(f,"decibels")?ji(f):this._is(f,"frequency")?this.toFrequency(f):f:this.overridden?0:f}_toType(f){return this.convert&&"decibels"===this.units?Li(f):f}setValueAtTime(f,O){const I=this.toSeconds(O),V=this._fromType(f);return Bn(isFinite(V)&&isFinite(I),`Invalid argument(s) to setValueAtTime: ${JSON.stringify(f)}, ${JSON.stringify(O)}`),this._assertRange(V),this.log(this.units,"setValueAtTime",f,I),this._events.add({time:I,type:"setValueAtTime",value:V}),this._param.setValueAtTime(V,I),this}getValueAtTime(f){const O=Math.max(this.toSeconds(f),0),I=this._events.getAfter(O),V=this._events.get(O);let F=this._initialValue;if(null===V)F=this._initialValue;else if("setTargetAtTime"!==V.type||null!==I&&"setValueAtTime"!==I.type)if(null===I)F=V.value;else if("linearRampToValueAtTime"===I.type||"exponentialRampToValueAtTime"===I.type){let f=V.value;if("setTargetAtTime"===V.type){const O=this._events.getBefore(V.time);f=null===O?this._initialValue:O.value}F="linearRampToValueAtTime"===I.type?this._linearInterpolate(V.time,f,I.time,I.value,O):this._exponentialInterpolate(V.time,f,I.time,I.value,O)}else F=V.value;else{const f=this._events.getBefore(V.time);let I;I=null===f?this._initialValue:f.value,"setTargetAtTime"===V.type&&(F=this._exponentialApproach(V.time,I,V.value,V.constant,O))}return this._toType(F)}setRampPoint(f){f=this.toSeconds(f);let O=this.getValueAtTime(f);return this.cancelAndHoldAtTime(f),0===this._fromType(O)&&(O=this._toType(this._minOutput)),this.setValueAtTime(O,f),this}linearRampToValueAtTime(f,O){const I=this._fromType(f),V=this.toSeconds(O);return Bn(isFinite(I)&&isFinite(V),`Invalid argument(s) to linearRampToValueAtTime: ${JSON.stringify(f)}, ${JSON.stringify(O)}`),this._assertRange(I),this._events.add({time:V,type:"linearRampToValueAtTime",value:I}),this.log(this.units,"linearRampToValueAtTime",f,V),this._param.linearRampToValueAtTime(I,V),this}exponentialRampToValueAtTime(f,O){let I=this._fromType(f);I=yi(I,0)?this._minOutput:I,this._assertRange(I);const V=this.toSeconds(O);return Bn(isFinite(I)&&isFinite(V),`Invalid argument(s) to exponentialRampToValueAtTime: ${JSON.stringify(f)}, ${JSON.stringify(O)}`),this._events.add({time:V,type:"exponentialRampToValueAtTime",value:I}),this.log(this.units,"exponentialRampToValueAtTime",f,V),this._param.exponentialRampToValueAtTime(I,V),this}exponentialRampTo(f,O,I){return I=this.toSeconds(I),this.setRampPoint(I),this.exponentialRampToValueAtTime(f,I+this.toSeconds(O)),this}linearRampTo(f,O,I){return I=this.toSeconds(I),this.setRampPoint(I),this.linearRampToValueAtTime(f,I+this.toSeconds(O)),this}targetRampTo(f,O,I){return I=this.toSeconds(I),this.setRampPoint(I),this.exponentialApproachValueAtTime(f,I,O),this}exponentialApproachValueAtTime(f,O,I){O=this.toSeconds(O),I=this.toSeconds(I);const V=Math.log(I+1)/Math.log(200);return this.setTargetAtTime(f,O,V),this.cancelAndHoldAtTime(O+.9*I),this.linearRampToValueAtTime(f,O+I),this}setTargetAtTime(f,O,I){const V=this._fromType(f);Bn(isFinite(I)&&I>0,"timeConstant must be a number greater than 0");const F=this.toSeconds(O);return this._assertRange(V),Bn(isFinite(V)&&isFinite(F),`Invalid argument(s) to setTargetAtTime: ${JSON.stringify(f)}, ${JSON.stringify(O)}`),this._events.add({constant:I,time:F,type:"setTargetAtTime",value:V}),this.log(this.units,"setTargetAtTime",f,F,I),this._param.setTargetAtTime(V,F,I),this}setValueCurveAtTime(f,O,I,V=1){I=this.toSeconds(I),O=this.toSeconds(O);const F=this._fromType(f[0])*V;this.setValueAtTime(this._toType(F),O);const P=I/(f.length-1);for(let I=1;I<f.length;I++){const F=this._fromType(f[I])*V;this.linearRampToValueAtTime(this._toType(F),O+I*P)}return this}cancelScheduledValues(f){const O=this.toSeconds(f);return Bn(isFinite(O),`Invalid argument to cancelScheduledValues: ${JSON.stringify(f)}`),this._events.cancel(O),this._param.cancelScheduledValues(O),this.log(this.units,"cancelScheduledValues",O),this}cancelAndHoldAtTime(f){const O=this.toSeconds(f),I=this._fromType(this.getValueAtTime(O));Bn(isFinite(O),`Invalid argument to cancelAndHoldAtTime: ${JSON.stringify(f)}`),this.log(this.units,"cancelAndHoldAtTime",O,"value="+I);const V=this._events.get(O),F=this._events.getAfter(O);return V&&yi(V.time,O)?F?(this._param.cancelScheduledValues(F.time),this._events.cancel(F.time)):(this._param.cancelAndHoldAtTime(O),this._events.cancel(O+this.sampleTime)):F&&(this._param.cancelScheduledValues(F.time),this._events.cancel(F.time),"linearRampToValueAtTime"===F.type?this.linearRampToValueAtTime(this._toType(I),O):"exponentialRampToValueAtTime"===F.type&&this.exponentialRampToValueAtTime(this._toType(I),O)),this._events.add({time:O,type:"setValueAtTime",value:I}),this._param.setValueAtTime(I,O),this}rampTo(f,O=.1,I){return"frequency"===this.units||"bpm"===this.units||"decibels"===this.units?this.exponentialRampTo(f,O,I):this.linearRampTo(f,O,I),this}apply(f){const O=this.context.currentTime;f.setValueAtTime(this.getValueAtTime(O),O);const I=this._events.get(O);if(I&&"setTargetAtTime"===I.type){const V=this._events.getAfter(I.time),F=V?V.time:O+2,P=(F-O)/10;for(let I=O;I<F;I+=P)f.linearRampToValueAtTime(this.getValueAtTime(I),I)}return this._events.forEachAfter(this.context.currentTime,(O=>{"cancelScheduledValues"===O.type?f.cancelScheduledValues(O.time):"setTargetAtTime"===O.type?f.setTargetAtTime(O.value,O.time,O.constant):f[O.type](O.value,O.time)})),this}setParam(f){Bn(this._swappable,"The Param must be assigned as 'swappable' in the constructor");const O=this.input;return O.disconnect(this._param),this.apply(f),this._param=f,O.connect(this._param),this}dispose(){return super.dispose(),this._events.dispose(),this}get defaultValue(){return this._toType(this._param.defaultValue)}_exponentialApproach(f,O,I,V,F){return I+(O-I)*Math.exp(-(F-f)/V)}_linearInterpolate(f,O,I,V,F){return O+(F-f)/(I-f)*(V-O)}_exponentialInterpolate(f,O,I,V,F){return O*Math.pow(V/O,(F-f)/(I-f))}}class io extends eo{constructor(){super(...arguments),this._internalChannels=[]}get numberOfInputs(){return In(this.input)?oi(this.input)||this.input instanceof no?1:this.input.numberOfInputs:0}get numberOfOutputs(){return In(this.output)?this.output.numberOfOutputs:0}_isAudioNode(f){return In(f)&&(f instanceof io||ri(f))}_getInternalNodes(){const f=this._internalChannels.slice(0);return this._isAudioNode(this.input)&&f.push(this.input),this._isAudioNode(this.output)&&this.input!==this.output&&f.push(this.output),f}_setChannelProperties(f){this._getInternalNodes().forEach((O=>{O.channelCount=f.channelCount,O.channelCountMode=f.channelCountMode,O.channelInterpretation=f.channelInterpretation}))}_getChannelProperties(){const f=this._getInternalNodes();Bn(f.length>0,"ToneAudioNode does not have any internal nodes");const O=f[0];return{channelCount:O.channelCount,channelCountMode:O.channelCountMode,channelInterpretation:O.channelInterpretation}}get channelCount(){return this._getChannelProperties().channelCount}set channelCount(f){const O=this._getChannelProperties();this._setChannelProperties(Object.assign(O,{channelCount:f}))}get channelCountMode(){return this._getChannelProperties().channelCountMode}set channelCountMode(f){const O=this._getChannelProperties();this._setChannelProperties(Object.assign(O,{channelCountMode:f}))}get channelInterpretation(){return this._getChannelProperties().channelInterpretation}set channelInterpretation(f){const O=this._getChannelProperties();this._setChannelProperties(Object.assign(O,{channelInterpretation:f}))}connect(f,O=0,I=0){return ro(this,f,O,I),this}toDestination(){return this.connect(this.context.destination),this}toMaster(){return Kn("toMaster() has been renamed toDestination()"),this.toDestination()}disconnect(f,O=0,I=0){return ao(this,f,O,I),this}chain(...f){return oo(this,...f),this}fan(...f){return f.forEach((f=>this.connect(f))),this}dispose(){return super.dispose(),In(this.input)&&(this.input instanceof io?this.input.dispose():ri(this.input)&&this.input.disconnect()),In(this.output)&&(this.output instanceof io?this.output.dispose():ri(this.output)&&this.output.disconnect()),this._internalChannels=[],this}}function oo(...f){const O=f.shift();f.reduce(((f,O)=>(f instanceof io?f.connect(O):ri(f)&&ro(f,O),O)),O)}function ro(f,O,I=0,V=0){for(Bn(In(f),"Cannot connect from undefined node"),Bn(In(O),"Cannot connect to undefined node"),(O instanceof io||ri(O))&&Bn(O.numberOfInputs>0,"Cannot connect to node with no inputs"),Bn(f.numberOfOutputs>0,"Cannot connect from node with no outputs");O instanceof io||O instanceof no;)In(O.input)&&(O=O.input);for(;f instanceof io;)In(f.output)&&(f=f.output);oi(O)?f.connect(O,I):f.connect(O,I,V)}function ao(f,O,I=0,V=0){if(In(O))for(;O instanceof io;)O=O.input;for(;!ri(f);)In(f.output)&&(f=f.output);oi(O)?f.disconnect(O,I):ri(O)?f.disconnect(O,I,V):f.disconnect()}function co(...f){const O=f.pop();In(O)&&f.forEach((f=>ro(f,O)))}class ho extends io{constructor(){super(ui(ho.getDefaults(),arguments,["gain","units"])),this.name="Gain",this._gainNode=this.context.createGain(),this.input=this._gainNode,this.output=this._gainNode;const f=ui(ho.getDefaults(),arguments,["gain","units"]);this.gain=new no({context:this.context,convert:f.convert,param:this._gainNode.gain,units:f.units,value:f.gain,minValue:f.minValue,maxValue:f.maxValue}),Oi(this,"gain")}static getDefaults(){return Object.assign(io.getDefaults(),{convert:!0,gain:1,units:"gain"})}dispose(){return super.dispose(),this._gainNode.disconnect(),this.gain.dispose(),this}}class lo extends io{constructor(f){super(f),this.onended=Ei,this._startTime=-1,this._stopTime=-1,this._timeout=-1,this.output=new ho({context:this.context,gain:0}),this._gainNode=this.output,this.getStateAtTime=function(f){const O=this.toSeconds(f);return-1!==this._startTime&&O>=this._startTime&&(-1===this._stopTime||O<=this._stopTime)?"started":"stopped"},this._fadeIn=f.fadeIn,this._fadeOut=f.fadeOut,this._curve=f.curve,this.onended=f.onended}static getDefaults(){return Object.assign(io.getDefaults(),{curve:"linear",fadeIn:0,fadeOut:0,onended:Ei})}_startGain(f,O=1){Bn(-1===this._startTime,"Source cannot be started more than once");const I=this.toSeconds(this._fadeIn);return this._startTime=f+I,this._startTime=Math.max(this._startTime,this.context.currentTime),I>0?(this._gainNode.gain.setValueAtTime(0,f),"linear"===this._curve?this._gainNode.gain.linearRampToValueAtTime(O,f+I):this._gainNode.gain.exponentialApproachValueAtTime(O,f,I)):this._gainNode.gain.setValueAtTime(O,f),this}stop(f){return this.log("stop",f),this._stopGain(this.toSeconds(f)),this}_stopGain(f){Bn(-1!==this._startTime,"'start' must be called before 'stop'"),this.cancelStop();const O=this.toSeconds(this._fadeOut);return this._stopTime=this.toSeconds(f)+O,this._stopTime=Math.max(this._stopTime,this.now()),O>0?"linear"===this._curve?this._gainNode.gain.linearRampTo(0,O,f):this._gainNode.gain.targetRampTo(0,O,f):(this._gainNode.gain.cancelAndHoldAtTime(f),this._gainNode.gain.setValueAtTime(0,f)),this.context.clearTimeout(this._timeout),this._timeout=this.context.setTimeout((()=>{const f="exponential"===this._curve?2*O:0;this._stopSource(this.now()+f),this._onended()}),this._stopTime-this.context.currentTime),this}_onended(){if(this.onended!==Ei&&(this.onended(this),this.onended=Ei,!this.context.isOffline)){const t=()=>this.dispose();void 0!==window.requestIdleCallback?window.requestIdleCallback(t):setTimeout(t,1e3)}}get state(){return this.getStateAtTime(this.now())}cancelStop(){return this.log("cancelStop"),Bn(-1!==this._startTime,"Source is not started"),this._gainNode.gain.cancelScheduledValues(this._startTime+this.sampleTime),this.context.clearTimeout(this._timeout),this._stopTime=-1,this}dispose(){return super.dispose(),this._gainNode.dispose(),this.onended=Ei,this}}class uo extends lo{constructor(){super(ui(uo.getDefaults(),arguments,["offset"])),this.name="ToneConstantSource",this._source=this.context.createConstantSource();const f=ui(uo.getDefaults(),arguments,["offset"]);ro(this._source,this._gainNode),this.offset=new no({context:this.context,convert:f.convert,param:this._source.offset,units:f.units,value:f.offset,minValue:f.minValue,maxValue:f.maxValue})}static getDefaults(){return Object.assign(lo.getDefaults(),{convert:!0,offset:1,units:"number"})}start(f){const O=this.toSeconds(f);return this.log("start",O),this._startGain(O),this._source.start(O),this}_stopSource(f){this._source.stop(f)}dispose(){return super.dispose(),"started"===this.state&&this.stop(),this._source.disconnect(),this.offset.dispose(),this}}class po extends io{constructor(){super(ui(po.getDefaults(),arguments,["value","units"])),this.name="Signal",this.override=!0;const f=ui(po.getDefaults(),arguments,["value","units"]);this.output=this._constantSource=new uo({context:this.context,convert:f.convert,offset:f.value,units:f.units,minValue:f.minValue,maxValue:f.maxValue}),this._constantSource.start(0),this.input=this._param=this._constantSource.offset}static getDefaults(){return Object.assign(io.getDefaults(),{convert:!0,units:"number",value:0})}connect(f,O=0,I=0){return fo(this,f,O,I),this}dispose(){return super.dispose(),this._param.dispose(),this._constantSource.dispose(),this}setValueAtTime(f,O){return this._param.setValueAtTime(f,O),this}getValueAtTime(f){return this._param.getValueAtTime(f)}setRampPoint(f){return this._param.setRampPoint(f),this}linearRampToValueAtTime(f,O){return this._param.linearRampToValueAtTime(f,O),this}exponentialRampToValueAtTime(f,O){return this._param.exponentialRampToValueAtTime(f,O),this}exponentialRampTo(f,O,I){return this._param.exponentialRampTo(f,O,I),this}linearRampTo(f,O,I){return this._param.linearRampTo(f,O,I),this}targetRampTo(f,O,I){return this._param.targetRampTo(f,O,I),this}exponentialApproachValueAtTime(f,O,I){return this._param.exponentialApproachValueAtTime(f,O,I),this}setTargetAtTime(f,O,I){return this._param.setTargetAtTime(f,O,I),this}setValueCurveAtTime(f,O,I,V){return this._param.setValueCurveAtTime(f,O,I,V),this}cancelScheduledValues(f){return this._param.cancelScheduledValues(f),this}cancelAndHoldAtTime(f){return this._param.cancelAndHoldAtTime(f),this}rampTo(f,O,I){return this._param.rampTo(f,O,I),this}get value(){return this._param.value}set value(f){this._param.value=f}get convert(){return this._param.convert}set convert(f){this._param.convert=f}get units(){return this._param.units}get overridden(){return this._param.overridden}set overridden(f){this._param.overridden=f}get maxValue(){return this._param.maxValue}get minValue(){return this._param.minValue}apply(f){return this._param.apply(f),this}}function fo(f,O,I,V){(O instanceof no||oi(O)||O instanceof po&&O.override)&&(O.cancelScheduledValues(0),O.setValueAtTime(0,0),O instanceof po&&(O.overridden=!0)),ro(f,O,I,V)}class _o extends no{constructor(){super(ui(_o.getDefaults(),arguments,["value"])),this.name="TickParam",this._events=new wi(1/0),this._multiplier=1;const f=ui(_o.getDefaults(),arguments,["value"]);this._multiplier=f.multiplier,this._events.cancel(0),this._events.add({ticks:0,time:0,type:"setValueAtTime",value:this._fromType(f.value)}),this.setValueAtTime(f.value,0)}static getDefaults(){return Object.assign(no.getDefaults(),{multiplier:1,units:"hertz",value:1})}setTargetAtTime(f,O,I){O=this.toSeconds(O),this.setRampPoint(O);const V=this._fromType(f),F=this._events.get(O),P=Math.round(Math.max(1/I,1));for(let f=0;f<=P;f++){const P=I*f+O,ut=this._exponentialApproach(F.time,F.value,V,I,P);this.linearRampToValueAtTime(this._toType(ut),P)}return this}setValueAtTime(f,O){const I=this.toSeconds(O);super.setValueAtTime(f,O);const V=this._events.get(I),F=this._events.previousEvent(V),P=this._getTicksUntilEvent(F,I);return V.ticks=Math.max(P,0),this}linearRampToValueAtTime(f,O){const I=this.toSeconds(O);super.linearRampToValueAtTime(f,O);const V=this._events.get(I),F=this._events.previousEvent(V),P=this._getTicksUntilEvent(F,I);return V.ticks=Math.max(P,0),this}exponentialRampToValueAtTime(f,O){O=this.toSeconds(O);const I=this._fromType(f),V=this._events.get(O),F=Math.round(Math.max(10*(O-V.time),1)),P=(O-V.time)/F;for(let f=0;f<=F;f++){const F=P*f+V.time,ut=this._exponentialInterpolate(V.time,V.value,O,I,F);this.linearRampToValueAtTime(this._toType(ut),F)}return this}_getTicksUntilEvent(f,O){if(null===f)f={ticks:0,time:0,type:"setValueAtTime",value:0};else if(Fn(f.ticks)){const O=this._events.previousEvent(f);f.ticks=this._getTicksUntilEvent(O,f.time)}const I=this._fromType(this.getValueAtTime(f.time));let V=this._fromType(this.getValueAtTime(O));const F=this._events.get(O);return F&&F.time===O&&"setValueAtTime"===F.type&&(V=this._fromType(this.getValueAtTime(O-this.sampleTime))),.5*(O-f.time)*(I+V)+f.ticks}getTicksAtTime(f){const O=this.toSeconds(f),I=this._events.get(O);return Math.max(this._getTicksUntilEvent(I,O),0)}getDurationOfTicks(f,O){const I=this.toSeconds(O),V=this.getTicksAtTime(O);return this.getTimeOfTick(V+f)-I}getTimeOfTick(f){const O=this._events.get(f,"ticks"),I=this._events.getAfter(f,"ticks");if(O&&O.ticks===f)return O.time;if(O&&I&&"linearRampToValueAtTime"===I.type&&O.value!==I.value){const V=this._fromType(this.getValueAtTime(O.time)),F=(this._fromType(this.getValueAtTime(I.time))-V)/(I.time-O.time),P=Math.sqrt(Math.pow(V,2)-2*F*(O.ticks-f)),ut=(-V+P)/F,mt=(-V-P)/F;return(ut>0?ut:mt)+O.time}return O?0===O.value?1/0:O.time+(f-O.ticks)/O.value:f/this._initialValue}ticksToTime(f,O){return this.getDurationOfTicks(f,O)}timeToTicks(f,O){const I=this.toSeconds(O),V=this.toSeconds(f),F=this.getTicksAtTime(I);return this.getTicksAtTime(I+V)-F}_fromType(f){return"bpm"===this.units&&this.multiplier?1/(60/f/this.multiplier):super._fromType(f)}_toType(f){return"bpm"===this.units&&this.multiplier?f/this.multiplier*60:super._toType(f)}get multiplier(){return this._multiplier}set multiplier(f){const O=this.value;this._multiplier=f,this.cancelScheduledValues(0),this.setValueAtTime(O,0)}}class mo extends po{constructor(){super(ui(mo.getDefaults(),arguments,["value"])),this.name="TickSignal";const f=ui(mo.getDefaults(),arguments,["value"]);this.input=this._param=new _o({context:this.context,convert:f.convert,multiplier:f.multiplier,param:this._constantSource.offset,units:f.units,value:f.value})}static getDefaults(){return Object.assign(po.getDefaults(),{multiplier:1,units:"hertz",value:1})}ticksToTime(f,O){return this._param.ticksToTime(f,O)}timeToTicks(f,O){return this._param.timeToTicks(f,O)}getTimeOfTick(f){return this._param.getTimeOfTick(f)}getDurationOfTicks(f,O){return this._param.getDurationOfTicks(f,O)}getTicksAtTime(f){return this._param.getTicksAtTime(f)}get multiplier(){return this._param.multiplier}set multiplier(f){this._param.multiplier=f}dispose(){return super.dispose(),this._param.dispose(),this}}class go extends eo{constructor(){super(ui(go.getDefaults(),arguments,["frequency"])),this.name="TickSource",this._state=new so,this._tickOffset=new wi,this._ticksAtTime=new wi,this._secondsAtTime=new wi;const f=ui(go.getDefaults(),arguments,["frequency"]);this.frequency=new mo({context:this.context,units:f.units,value:f.frequency}),Oi(this,"frequency"),this._state.setStateAtTime("stopped",0),this.setTicksAtTime(0,0)}static getDefaults(){return Object.assign({frequency:1,units:"hertz"},eo.getDefaults())}get state(){return this.getStateAtTime(this.now())}start(f,O){const I=this.toSeconds(f);return"started"!==this._state.getValueAtTime(I)&&(this._state.setStateAtTime("started",I),In(O)&&this.setTicksAtTime(O,I),this._ticksAtTime.cancel(I),this._secondsAtTime.cancel(I)),this}stop(f){const O=this.toSeconds(f);if("stopped"===this._state.getValueAtTime(O)){const f=this._state.get(O);f&&f.time>0&&(this._tickOffset.cancel(f.time),this._state.cancel(f.time))}return this._state.cancel(O),this._state.setStateAtTime("stopped",O),this.setTicksAtTime(0,O),this._ticksAtTime.cancel(O),this._secondsAtTime.cancel(O),this}pause(f){const O=this.toSeconds(f);return"started"===this._state.getValueAtTime(O)&&(this._state.setStateAtTime("paused",O),this._ticksAtTime.cancel(O),this._secondsAtTime.cancel(O)),this}cancel(f){return f=this.toSeconds(f),this._state.cancel(f),this._tickOffset.cancel(f),this._ticksAtTime.cancel(f),this._secondsAtTime.cancel(f),this}getTicksAtTime(f){const O=this.toSeconds(f),I=this._state.getLastState("stopped",O),V=this._ticksAtTime.get(O),F={state:"paused",time:O};this._state.add(F);let P=V||I,ut=V?V.ticks:0,mt=null;return this._state.forEachBetween(P.time,O+this.sampleTime,(f=>{let O=P.time;const I=this._tickOffset.get(f.time);I&&I.time>=P.time&&(ut=I.ticks,O=I.time),"started"===P.state&&"started"!==f.state&&(ut+=this.frequency.getTicksAtTime(f.time)-this.frequency.getTicksAtTime(O),f.time!==F.time&&(mt={state:f.state,time:f.time,ticks:ut})),P=f})),this._state.remove(F),mt&&this._ticksAtTime.add(mt),ut}get ticks(){return this.getTicksAtTime(this.now())}set ticks(f){this.setTicksAtTime(f,this.now())}get seconds(){return this.getSecondsAtTime(this.now())}set seconds(f){const O=this.now(),I=this.frequency.timeToTicks(f,O);this.setTicksAtTime(I,O)}getSecondsAtTime(f){f=this.toSeconds(f);const O=this._state.getLastState("stopped",f),I={state:"paused",time:f};this._state.add(I);const V=this._secondsAtTime.get(f);let F=V||O,P=V?V.seconds:0,ut=null;return this._state.forEachBetween(F.time,f+this.sampleTime,(f=>{let O=F.time;const V=this._tickOffset.get(f.time);V&&V.time>=F.time&&(P=V.seconds,O=V.time),"started"===F.state&&"started"!==f.state&&(P+=f.time-O,f.time!==I.time&&(ut={state:f.state,time:f.time,seconds:P})),F=f})),this._state.remove(I),ut&&this._secondsAtTime.add(ut),P}setTicksAtTime(f,O){return O=this.toSeconds(O),this._tickOffset.cancel(O),this._tickOffset.add({seconds:this.frequency.getDurationOfTicks(f,O),ticks:f,time:O}),this._ticksAtTime.cancel(O),this._secondsAtTime.cancel(O),this}getStateAtTime(f){return f=this.toSeconds(f),this._state.getValueAtTime(f)}getTimeOfTick(f,O=this.now()){const I=this._tickOffset.get(O),V=this._state.get(O),F=Math.max(I.time,V.time),P=this.frequency.getTicksAtTime(F)+f-I.ticks;return this.frequency.getTimeOfTick(P)}forEachTickBetween(f,O,I){let V=this._state.get(f);this._state.forEachBetween(f,O,(O=>{V&&"started"===V.state&&"started"!==O.state&&this.forEachTickBetween(Math.max(V.time,f),O.time-this.sampleTime,I),V=O}));let F=null;if(V&&"started"===V.state){const P=Math.max(V.time,f),ut=this.frequency.getTicksAtTime(P),mt=ut-this.frequency.getTicksAtTime(V.time);let gt=Math.ceil(mt)-mt;gt=yi(gt,1)?0:gt;let vt=this.frequency.getTimeOfTick(ut+gt);for(;vt<O;){try{I(vt,Math.round(this.getTicksAtTime(vt)))}catch(f){F=f;break}vt+=this.frequency.getDurationOfTicks(1,vt)}}if(F)throw F;return this}dispose(){return super.dispose(),this._state.dispose(),this._tickOffset.dispose(),this._ticksAtTime.dispose(),this._secondsAtTime.dispose(),this.frequency.dispose(),this}}class vo extends eo{constructor(){super(ui(vo.getDefaults(),arguments,["callback","frequency"])),this.name="Clock",this.callback=Ei,this._lastUpdate=0,this._state=new so("stopped"),this._boundLoop=this._loop.bind(this);const f=ui(vo.getDefaults(),arguments,["callback","frequency"]);this.callback=f.callback,this._tickSource=new go({context:this.context,frequency:f.frequency,units:f.units}),this._lastUpdate=0,this.frequency=this._tickSource.frequency,Oi(this,"frequency"),this._state.setStateAtTime("stopped",0),this.context.on("tick",this._boundLoop)}static getDefaults(){return Object.assign(eo.getDefaults(),{callback:Ei,frequency:1,units:"hertz"})}get state(){return this._state.getValueAtTime(this.now())}start(f,O){Gn(this.context);const I=this.toSeconds(f);return this.log("start",I),"started"!==this._state.getValueAtTime(I)&&(this._state.setStateAtTime("started",I),this._tickSource.start(I,O),I<this._lastUpdate&&this.emit("start",I,O)),this}stop(f){const O=this.toSeconds(f);return this.log("stop",O),this._state.cancel(O),this._state.setStateAtTime("stopped",O),this._tickSource.stop(O),O<this._lastUpdate&&this.emit("stop",O),this}pause(f){const O=this.toSeconds(f);return"started"===this._state.getValueAtTime(O)&&(this._state.setStateAtTime("paused",O),this._tickSource.pause(O),O<this._lastUpdate&&this.emit("pause",O)),this}get ticks(){return Math.ceil(this.getTicksAtTime(this.now()))}set ticks(f){this._tickSource.ticks=f}get seconds(){return this._tickSource.seconds}set seconds(f){this._tickSource.seconds=f}getSecondsAtTime(f){return this._tickSource.getSecondsAtTime(f)}setTicksAtTime(f,O){return this._tickSource.setTicksAtTime(f,O),this}getTimeOfTick(f,O=this.now()){return this._tickSource.getTimeOfTick(f,O)}getTicksAtTime(f){return this._tickSource.getTicksAtTime(f)}nextTickTime(f,O){const I=this.toSeconds(O),V=this.getTicksAtTime(I);return this._tickSource.getTimeOfTick(V+f,I)}_loop(){const f=this._lastUpdate,O=this.now();this._lastUpdate=O,this.log("loop",f,O),f!==O&&(this._state.forEachBetween(f,O,(f=>{switch(f.state){case"started":const O=this._tickSource.getTicksAtTime(f.time);this.emit("start",f.time,O);break;case"stopped":0!==f.time&&this.emit("stop",f.time);break;case"paused":this.emit("pause",f.time)}})),this._tickSource.forEachTickBetween(f,O,((f,O)=>{this.callback(f,O)})))}getStateAtTime(f){const O=this.toSeconds(f);return this._state.getValueAtTime(O)}dispose(){return super.dispose(),this.context.off("tick",this._boundLoop),this._tickSource.dispose(),this._state.dispose(),this}}Ai.mixin(vo);class yo extends io{constructor(){super(ui(yo.getDefaults(),arguments,["delayTime","maxDelay"])),this.name="Delay";const f=ui(yo.getDefaults(),arguments,["delayTime","maxDelay"]),O=this.toSeconds(f.maxDelay);this._maxDelay=Math.max(O,this.toSeconds(f.delayTime)),this._delayNode=this.input=this.output=this.context.createDelay(O),this.delayTime=new no({context:this.context,param:this._delayNode.delayTime,units:"time",value:f.delayTime,minValue:0,maxValue:this.maxDelay}),Oi(this,"delayTime")}static getDefaults(){return Object.assign(io.getDefaults(),{delayTime:0,maxDelay:1})}get maxDelay(){return this._maxDelay}dispose(){return super.dispose(),this._delayNode.disconnect(),this.delayTime.dispose(),this}}function xo(f,O,I=2,V=Vi().sampleRate){return ni(this,void 0,void 0,(function*(){const F=Vi(),P=new qi(I,O,V);Ni(P),yield f(P);const ut=P.render();Ni(F);const mt=yield ut;return new Ri(mt)}))}class wo extends fi{constructor(){super(),this.name="ToneAudioBuffers",this._buffers=new Map,this._loadingCount=0;const f=ui(wo.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");this.baseUrl=f.baseUrl,Object.keys(f.urls).forEach((O=>{this._loadingCount++;const I=f.urls[O];this.add(O,I,this._bufferLoaded.bind(this,f.onload),f.onerror)}))}static getDefaults(){return{baseUrl:"",onerror:Ei,onload:Ei,urls:{}}}has(f){return this._buffers.has(f.toString())}get(f){return Bn(this.has(f),`ToneAudioBuffers has no buffer named: ${f}`),this._buffers.get(f.toString())}_bufferLoaded(f){this._loadingCount--,0===this._loadingCount&&f&&f()}get loaded(){return Array.from(this._buffers).every((([f,O])=>O.loaded))}add(f,O,I=Ei,V=Ei){return zn(O)?(this.baseUrl&&"data:audio/"===O.trim().substring(0,11).toLowerCase()&&(this.baseUrl=""),this._buffers.set(f.toString(),new Ri(this.baseUrl+O,I,V))):this._buffers.set(f.toString(),new Ri(O,I,V)),this}dispose(){return super.dispose(),this._buffers.forEach((f=>f.dispose())),this._buffers.clear(),this}}class bo extends Yi{constructor(){super(...arguments),this.name="MidiClass",this.defaultUnits="midi"}_frequencyToUnits(f){return Bi(super._frequencyToUnits(f))}_ticksToUnits(f){return Bi(super._ticksToUnits(f))}_beatsToUnits(f){return Bi(super._beatsToUnits(f))}_secondsToUnits(f){return Bi(super._secondsToUnits(f))}toMidi(){return this.valueOf()}toFrequency(){return Gi(this.toMidi())}transpose(f){return new bo(this.context,this.toMidi()+f)}}function To(f,O){return new bo(Vi(),f,O)}class So extends Ki{constructor(){super(...arguments),this.name="Ticks",this.defaultUnits="i"}_now(){return this.context.transport.ticks}_beatsToUnits(f){return this._getPPQ()*f}_secondsToUnits(f){return Math.floor(f/(60/this._getBpm())*this._getPPQ())}_ticksToUnits(f){return f}toTicks(){return this.valueOf()}toSeconds(){return this.valueOf()/this._getPPQ()*(60/this._getBpm())}}function ko(f,O){return new So(Vi(),f,O)}class Ao extends eo{constructor(){super(...arguments),this.name="Draw",this.expiration=.25,this.anticipation=.008,this._events=new wi,this._boundDrawLoop=this._drawLoop.bind(this),this._animationFrame=-1}schedule(f,O){return this._events.add({callback:f,time:this.toSeconds(O)}),1===this._events.length&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop)),this}cancel(f){return this._events.cancel(this.toSeconds(f)),this}_drawLoop(){const f=this.context.currentTime;for(;this._events.length&&this._events.peek().time-this.anticipation<=f;){const O=this._events.shift();O&&f-O.time<=this.expiration&&O.callback()}this._events.length>0&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop))}dispose(){return super.dispose(),this._events.dispose(),cancelAnimationFrame(this._animationFrame),this}}Ti((f=>{f.draw=new Ao({context:f})})),ki((f=>{f.draw.dispose()}));class Co extends fi{constructor(){super(...arguments),this.name="IntervalTimeline",this._root=null,this._length=0}add(f){Bn(In(f.time),"Events must have a time property"),Bn(In(f.duration),"Events must have a duration parameter"),f.time=f.time.valueOf();let O=new Do(f.time,f.time+f.duration,f);for(null===this._root?this._root=O:this._root.insert(O),this._length++;null!==O;)O.updateHeight(),O.updateMax(),this._rebalance(O),O=O.parent;return this}remove(f){if(null!==this._root){const O=[];this._root.search(f.time,O);for(const I of O)if(I.event===f){this._removeNode(I),this._length--;break}}return this}get length(){return this._length}cancel(f){return this.forEachFrom(f,(f=>this.remove(f))),this}_setRoot(f){this._root=f,null!==this._root&&(this._root.parent=null)}_replaceNodeInParent(f,O){null!==f.parent?(f.isLeftChild()?f.parent.left=O:f.parent.right=O,this._rebalance(f.parent)):this._setRoot(O)}_removeNode(f){if(null===f.left&&null===f.right)this._replaceNodeInParent(f,null);else if(null===f.right)this._replaceNodeInParent(f,f.left);else if(null===f.left)this._replaceNodeInParent(f,f.right);else{let O,I=null;if(f.getBalance()>0)if(null===f.left.right)O=f.left,O.right=f.right,I=O;else{for(O=f.left.right;null!==O.right;)O=O.right;O.parent&&(O.parent.right=O.left,I=O.parent,O.left=f.left,O.right=f.right)}else if(null===f.right.left)O=f.right,O.left=f.left,I=O;else{for(O=f.right.left;null!==O.left;)O=O.left;O.parent&&(O.parent.left=O.right,I=O.parent,O.left=f.left,O.right=f.right)}null!==f.parent?f.isLeftChild()?f.parent.left=O:f.parent.right=O:this._setRoot(O),I&&this._rebalance(I)}f.dispose()}_rotateLeft(f){const O=f.parent,I=f.isLeftChild(),V=f.right;V&&(f.right=V.left,V.left=f),null!==O?I?O.left=V:O.right=V:this._setRoot(V)}_rotateRight(f){const O=f.parent,I=f.isLeftChild(),V=f.left;V&&(f.left=V.right,V.right=f),null!==O?I?O.left=V:O.right=V:this._setRoot(V)}_rebalance(f){const O=f.getBalance();O>1&&f.left?f.left.getBalance()<0?this._rotateLeft(f.left):this._rotateRight(f):O<-1&&f.right&&(f.right.getBalance()>0?this._rotateRight(f.right):this._rotateLeft(f))}get(f){if(null!==this._root){const O=[];if(this._root.search(f,O),O.length>0){let f=O[0];for(let I=1;I<O.length;I++)O[I].low>f.low&&(f=O[I]);return f.event}}return null}forEach(f){if(null!==this._root){const O=[];this._root.traverse((f=>O.push(f))),O.forEach((O=>{O.event&&f(O.event)}))}return this}forEachAtTime(f,O){if(null!==this._root){const I=[];this._root.search(f,I),I.forEach((f=>{f.event&&O(f.event)}))}return this}forEachFrom(f,O){if(null!==this._root){const I=[];this._root.searchAfter(f,I),I.forEach((f=>{f.event&&O(f.event)}))}return this}dispose(){return super.dispose(),null!==this._root&&this._root.traverse((f=>f.dispose())),this._root=null,this}}class Do{constructor(f,O,I){this._left=null,this._right=null,this.parent=null,this.height=0,this.event=I,this.low=f,this.high=O,this.max=this.high}insert(f){f.low<=this.low?null===this.left?this.left=f:this.left.insert(f):null===this.right?this.right=f:this.right.insert(f)}search(f,O){f>this.max||(null!==this.left&&this.left.search(f,O),this.low<=f&&this.high>f&&O.push(this),this.low>f||null!==this.right&&this.right.search(f,O))}searchAfter(f,O){this.low>=f&&(O.push(this),null!==this.left&&this.left.searchAfter(f,O)),null!==this.right&&this.right.searchAfter(f,O)}traverse(f){f(this),null!==this.left&&this.left.traverse(f),null!==this.right&&this.right.traverse(f)}updateHeight(){null!==this.left&&null!==this.right?this.height=Math.max(this.left.height,this.right.height)+1:null!==this.right?this.height=this.right.height+1:null!==this.left?this.height=this.left.height+1:this.height=0}updateMax(){this.max=this.high,null!==this.left&&(this.max=Math.max(this.max,this.left.max)),null!==this.right&&(this.max=Math.max(this.max,this.right.max))}getBalance(){let f=0;return null!==this.left&&null!==this.right?f=this.left.height-this.right.height:null!==this.left?f=this.left.height+1:null!==this.right&&(f=-(this.right.height+1)),f}isLeftChild(){return null!==this.parent&&this.parent.left===this}get left(){return this._left}set left(f){this._left=f,null!==f&&(f.parent=this),this.updateHeight(),this.updateMax()}get right(){return this._right}set right(f){this._right=f,null!==f&&(f.parent=this),this.updateHeight(),this.updateMax()}dispose(){this.parent=null,this._left=null,this._right=null,this.event=null}}class Oo extends io{constructor(){super(ui(Oo.getDefaults(),arguments,["volume"])),this.name="Volume";const f=ui(Oo.getDefaults(),arguments,["volume"]);this.input=this.output=new ho({context:this.context,gain:f.volume,units:"decibels"}),this.volume=this.output.gain,Oi(this,"volume"),this._unmutedVolume=f.volume,this.mute=f.mute}static getDefaults(){return Object.assign(io.getDefaults(),{mute:!1,volume:0})}get mute(){return this.volume.value===-1/0}set mute(f){!this.mute&&f?(this._unmutedVolume=this.volume.value,this.volume.value=-1/0):this.mute&&!f&&(this.volume.value=this._unmutedVolume)}dispose(){return super.dispose(),this.input.dispose(),this.volume.dispose(),this}}class Mo extends io{constructor(){super(ui(Mo.getDefaults(),arguments)),this.name="Destination",this.input=new Oo({context:this.context}),this.output=new ho({context:this.context}),this.volume=this.input.volume;const f=ui(Mo.getDefaults(),arguments);oo(this.input,this.output,this.context.rawContext.destination),this.mute=f.mute,this._internalChannels=[this.input,this.context.rawContext.destination,this.output]}static getDefaults(){return Object.assign(io.getDefaults(),{mute:!1,volume:0})}get mute(){return this.input.mute}set mute(f){this.input.mute=f}chain(...f){return this.input.disconnect(),f.unshift(this.input),f.push(this.output),oo(...f),this}get maxChannelCount(){return this.context.rawContext.destination.maxChannelCount}dispose(){return super.dispose(),this.volume.dispose(),this}}Ti((f=>{f.destination=new Mo({context:f})})),ki((f=>{f.destination.dispose()}));class Eo extends fi{constructor(f){super(),this.name="TimelineValue",this._timeline=new wi({memory:10}),this._initialValue=f}set(f,O){return this._timeline.add({value:f,time:O}),this}get(f){const O=this._timeline.get(f);return O?O.value:this._initialValue}}class Ro extends io{constructor(){super(Object.assign(ui(Ro.getDefaults(),arguments,["context"])))}connect(f,O=0,I=0){return fo(this,f,O,I),this}}class qo extends Ro{constructor(){super(Object.assign(ui(qo.getDefaults(),arguments,["mapping","length"]))),this.name="WaveShaper",this._shaper=this.context.createWaveShaper(),this.input=this._shaper,this.output=this._shaper;const f=ui(qo.getDefaults(),arguments,["mapping","length"]);Ln(f.mapping)||f.mapping instanceof Float32Array?this.curve=Float32Array.from(f.mapping):Vn(f.mapping)&&this.setMap(f.mapping,f.length)}static getDefaults(){return Object.assign(po.getDefaults(),{length:1024})}setMap(f,O=1024){const I=new Float32Array(O);for(let V=0,F=O;V<F;V++){const O=V/(F-1)*2-1;I[V]=f(O,V)}return this.curve=I,this}get curve(){return this._shaper.curve}set curve(f){this._shaper.curve=f}get oversample(){return this._shaper.oversample}set oversample(f){Bn(["none","2x","4x"].some((O=>O.includes(f))),"oversampling must be either 'none', '2x', or '4x'"),this._shaper.oversample=f}dispose(){return super.dispose(),this._shaper.disconnect(),this}}class Fo extends Ro{constructor(){super(Object.assign(ui(Fo.getDefaults(),arguments,["value"]))),this.name="Pow";const f=ui(Fo.getDefaults(),arguments,["value"]);this._exponentScaler=this.input=this.output=new qo({context:this.context,mapping:this._expFunc(f.value),length:8192}),this._exponent=f.value}static getDefaults(){return Object.assign(Ro.getDefaults(),{value:1})}_expFunc(f){return O=>Math.pow(Math.abs(O),f)}get value(){return this._exponent}set value(f){this._exponent=f,this._exponentScaler.setMap(this._expFunc(this._exponent))}dispose(){return super.dispose(),this._exponentScaler.dispose(),this}}class Io{constructor(f,O){this.id=Io._eventId++,this._remainderTime=0;const I=Object.assign(Io.getDefaults(),O);this.transport=f,this.callback=I.callback,this._once=I.once,this.time=Math.floor(I.time),this._remainderTime=I.time-this.time}static getDefaults(){return{callback:Ei,once:!1,time:0}}get floatTime(){return this.time+this._remainderTime}invoke(f){if(this.callback){const O=this.transport.bpm.getDurationOfTicks(1,f);this.callback(f+this._remainderTime*O),this._once&&this.transport.clear(this.id)}}dispose(){return this.callback=void 0,this}}Io._eventId=0;class Vo extends Io{constructor(f,O){super(f,O),this._currentId=-1,this._nextId=-1,this._nextTick=this.time,this._boundRestart=this._restart.bind(this);const I=Object.assign(Vo.getDefaults(),O);this.duration=I.duration,this._interval=I.interval,this._nextTick=I.time,this.transport.on("start",this._boundRestart),this.transport.on("loopStart",this._boundRestart),this.transport.on("ticks",this._boundRestart),this.context=this.transport.context,this._restart()}static getDefaults(){return Object.assign({},Io.getDefaults(),{duration:1/0,interval:1,once:!1})}invoke(f){this._createEvents(f),super.invoke(f)}_createEvent(){return vi(this._nextTick,this.floatTime+this.duration)?this.transport.scheduleOnce(this.invoke.bind(this),new So(this.context,this._nextTick).toSeconds()):-1}_createEvents(f){vi(this._nextTick+this._interval,this.floatTime+this.duration)&&(this._nextTick+=this._interval,this._currentId=this._nextId,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new So(this.context,this._nextTick).toSeconds()))}_restart(f){this.transport.clear(this._currentId),this.transport.clear(this._nextId),this._nextTick=this.floatTime;const O=this.transport.getTicksAtTime(f);mi(O,this.time)&&(this._nextTick=this.floatTime+Math.ceil((O-this.floatTime)/this._interval)*this._interval),this._currentId=this._createEvent(),this._nextTick+=this._interval,this._nextId=this._createEvent()}dispose(){return super.dispose(),this.transport.clear(this._currentId),this.transport.clear(this._nextId),this.transport.off("start",this._boundRestart),this.transport.off("loopStart",this._boundRestart),this.transport.off("ticks",this._boundRestart),this}}class No extends eo{constructor(){super(ui(No.getDefaults(),arguments)),this.name="Transport",this._loop=new Eo(!1),this._loopStart=0,this._loopEnd=0,this._scheduledEvents={},this._timeline=new wi,this._repeatedEvents=new Co,this._syncedSignals=[],this._swingAmount=0;const f=ui(No.getDefaults(),arguments);this._ppq=f.ppq,this._clock=new vo({callback:this._processTick.bind(this),context:this.context,frequency:0,units:"bpm"}),this._bindClockEvents(),this.bpm=this._clock.frequency,this._clock.frequency.multiplier=f.ppq,this.bpm.setValueAtTime(f.bpm,0),Oi(this,"bpm"),this._timeSignature=f.timeSignature,this._swingTicks=f.ppq/2}static getDefaults(){return Object.assign(eo.getDefaults(),{bpm:120,loopEnd:"4m",loopStart:0,ppq:192,swing:0,swingSubdivision:"8n",timeSignature:4})}_processTick(f,O){if(this._loop.get(f)&&O>=this._loopEnd&&(this.emit("loopEnd",f),this._clock.setTicksAtTime(this._loopStart,f),O=this._loopStart,this.emit("loopStart",f,this._clock.getSecondsAtTime(f)),this.emit("loop",f)),this._swingAmount>0&&O%this._ppq!=0&&O%(2*this._swingTicks)!=0){const I=O%(2*this._swingTicks)/(2*this._swingTicks),V=Math.sin(I*Math.PI)*this._swingAmount;f+=new So(this.context,2*this._swingTicks/3).toSeconds()*V}Xn(!0),this._timeline.forEachAtTime(O,(O=>O.invoke(f))),Xn(!1)}schedule(f,O){const I=new Io(this,{callback:f,time:new Ki(this.context,O).toTicks()});return this._addEvent(I,this._timeline)}scheduleRepeat(f,O,I,V=1/0){const F=new Vo(this,{callback:f,duration:new Zi(this.context,V).toTicks(),interval:new Zi(this.context,O).toTicks(),time:new Ki(this.context,I).toTicks()});return this._addEvent(F,this._repeatedEvents)}scheduleOnce(f,O){const I=new Io(this,{callback:f,once:!0,time:new Ki(this.context,O).toTicks()});return this._addEvent(I,this._timeline)}clear(f){if(this._scheduledEvents.hasOwnProperty(f)){const O=this._scheduledEvents[f.toString()];O.timeline.remove(O.event),O.event.dispose(),delete this._scheduledEvents[f.toString()]}return this}_addEvent(f,O){return this._scheduledEvents[f.id.toString()]={event:f,timeline:O},O.add(f),f.id}cancel(f=0){const O=this.toTicks(f);return this._timeline.forEachFrom(O,(f=>this.clear(f.id))),this._repeatedEvents.forEachFrom(O,(f=>this.clear(f.id))),this}_bindClockEvents(){this._clock.on("start",((f,O)=>{O=new So(this.context,O).toSeconds(),this.emit("start",f,O)})),this._clock.on("stop",(f=>{this.emit("stop",f)})),this._clock.on("pause",(f=>{this.emit("pause",f)}))}get state(){return this._clock.getStateAtTime(this.now())}start(f,O){let I;return this.context.resume(),In(O)&&(I=this.toTicks(O)),this._clock.start(f,I),this}stop(f){return this._clock.stop(f),this}pause(f){return this._clock.pause(f),this}toggle(f){return f=this.toSeconds(f),"started"!==this._clock.getStateAtTime(f)?this.start(f):this.stop(f),this}get timeSignature(){return this._timeSignature}set timeSignature(f){Ln(f)&&(f=f[0]/f[1]*4),this._timeSignature=f}get loopStart(){return new Zi(this.context,this._loopStart,"i").toSeconds()}set loopStart(f){this._loopStart=this.toTicks(f)}get loopEnd(){return new Zi(this.context,this._loopEnd,"i").toSeconds()}set loopEnd(f){this._loopEnd=this.toTicks(f)}get loop(){return this._loop.get(this.now())}set loop(f){this._loop.set(f,this.now())}setLoopPoints(f,O){return this.loopStart=f,this.loopEnd=O,this}get swing(){return this._swingAmount}set swing(f){this._swingAmount=f}get swingSubdivision(){return new So(this.context,this._swingTicks).toNotation()}set swingSubdivision(f){this._swingTicks=this.toTicks(f)}get position(){const f=this.now(),O=this._clock.getTicksAtTime(f);return new So(this.context,O).toBarsBeatsSixteenths()}set position(f){const O=this.toTicks(f);this.ticks=O}get seconds(){return this._clock.seconds}set seconds(f){const O=this.now(),I=this._clock.frequency.timeToTicks(f,O);this.ticks=I}get progress(){if(this.loop){const f=this.now();return(this._clock.getTicksAtTime(f)-this._loopStart)/(this._loopEnd-this._loopStart)}return 0}get ticks(){return this._clock.ticks}set ticks(f){if(this._clock.ticks!==f){const O=this.now();if("started"===this.state){const I=this._clock.getTicksAtTime(O),V=O+this._clock.frequency.getDurationOfTicks(Math.ceil(I)-I,O);this.emit("stop",V),this._clock.setTicksAtTime(f,V),this.emit("start",V,this._clock.getSecondsAtTime(V))}else this.emit("ticks",O),this._clock.setTicksAtTime(f,O)}}getTicksAtTime(f){return this._clock.getTicksAtTime(f)}getSecondsAtTime(f){return this._clock.getSecondsAtTime(f)}get PPQ(){return this._clock.frequency.multiplier}set PPQ(f){this._clock.frequency.multiplier=f}nextSubdivision(f){if(f=this.toTicks(f),"started"!==this.state)return 0;{const O=this.now(),I=f-this.getTicksAtTime(O)%f;return this._clock.nextTickTime(I,O)}}syncSignal(f,O){const I=this.now();let V=this.bpm,F=1/(60/V.getValueAtTime(I)/this.PPQ),P=[];if("time"===f.units){const f=1/64/F,O=new ho(f),I=new Fo(-1),ut=new ho(f);V.chain(O,I,ut),V=ut,F=1/F,P=[O,I,ut]}O||(O=0!==f.getValueAtTime(I)?f.getValueAtTime(I)/F:0);const ut=new ho(O);return V.connect(ut),ut.connect(f._param),P.push(ut),this._syncedSignals.push({initial:f.value,nodes:P,signal:f}),f.value=0,this}unsyncSignal(f){for(let O=this._syncedSignals.length-1;O>=0;O--){const I=this._syncedSignals[O];I.signal===f&&(I.nodes.forEach((f=>f.dispose())),I.signal.value=I.initial,this._syncedSignals.splice(O,1))}return this}dispose(){return super.dispose(),this._clock.dispose(),Mi(this,"bpm"),this._timeline.dispose(),this._repeatedEvents.dispose(),this}}Ai.mixin(No),Ti((f=>{f.transport=new No({context:f})})),ki((f=>{f.transport.dispose()}));class Po extends io{constructor(f){super(f),this.input=void 0,this._state=new so("stopped"),this._synced=!1,this._scheduled=[],this._syncedStart=Ei,this._syncedStop=Ei,this._state.memory=100,this._state.increasing=!0,this._volume=this.output=new Oo({context:this.context,mute:f.mute,volume:f.volume}),this.volume=this._volume.volume,Oi(this,"volume"),this.onstop=f.onstop}static getDefaults(){return Object.assign(io.getDefaults(),{mute:!1,onstop:Ei,volume:0})}get state(){return this._synced?"started"===this.context.transport.state?this._state.getValueAtTime(this.context.transport.seconds):"stopped":this._state.getValueAtTime(this.now())}get mute(){return this._volume.mute}set mute(f){this._volume.mute=f}_clampToCurrentTime(f){return this._synced?f:Math.max(f,this.context.currentTime)}start(f,O,I){let V=Fn(f)&&this._synced?this.context.transport.seconds:this.toSeconds(f);if(V=this._clampToCurrentTime(V),this._synced||"started"!==this._state.getValueAtTime(V))if(this.log("start",V),this._state.setStateAtTime("started",V),this._synced){const f=this._state.get(V);f&&(f.offset=this.toSeconds(pi(O,0)),f.duration=I?this.toSeconds(I):void 0);const F=this.context.transport.schedule((f=>{this._start(f,O,I)}),V);this._scheduled.push(F),"started"===this.context.transport.state&&this.context.transport.getSecondsAtTime(this.immediate())>V&&this._syncedStart(this.now(),this.context.transport.seconds)}else Gn(this.context),this._start(V,O,I);else Bn(mi(V,this._state.get(V).time),"Start time must be strictly greater than previous start time"),this._state.cancel(V),this._state.setStateAtTime("started",V),this.log("restart",V),this.restart(V,O,I);return this}stop(f){let O=Fn(f)&&this._synced?this.context.transport.seconds:this.toSeconds(f);if(O=this._clampToCurrentTime(O),"started"===this._state.getValueAtTime(O)||In(this._state.getNextState("started",O))){if(this.log("stop",O),this._synced){const f=this.context.transport.schedule(this._stop.bind(this),O);this._scheduled.push(f)}else this._stop(O);this._state.cancel(O),this._state.setStateAtTime("stopped",O)}return this}restart(f,O,I){return f=this.toSeconds(f),"started"===this._state.getValueAtTime(f)&&(this._state.cancel(f),this._restart(f,O,I)),this}sync(){return this._synced||(this._synced=!0,this._syncedStart=(f,O)=>{if(mi(O,0)){const I=this._state.get(O);if(I&&"started"===I.state&&I.time!==O){const V=O-this.toSeconds(I.time);let F;I.duration&&(F=this.toSeconds(I.duration)-V),this._start(f,this.toSeconds(I.offset)+V,F)}}},this._syncedStop=f=>{const O=this.context.transport.getSecondsAtTime(Math.max(f-this.sampleTime,0));"started"===this._state.getValueAtTime(O)&&this._stop(f)},this.context.transport.on("start",this._syncedStart),this.context.transport.on("loopStart",this._syncedStart),this.context.transport.on("stop",this._syncedStop),this.context.transport.on("pause",this._syncedStop),this.context.transport.on("loopEnd",this._syncedStop)),this}unsync(){return this._synced&&(this.context.transport.off("stop",this._syncedStop),this.context.transport.off("pause",this._syncedStop),this.context.transport.off("loopEnd",this._syncedStop),this.context.transport.off("start",this._syncedStart),this.context.transport.off("loopStart",this._syncedStart)),this._synced=!1,this._scheduled.forEach((f=>this.context.transport.clear(f))),this._scheduled=[],this._state.cancel(0),this._stop(0),this}dispose(){return super.dispose(),this.onstop=Ei,this.unsync(),this._volume.dispose(),this._state.dispose(),this}}class jo extends lo{constructor(){super(ui(jo.getDefaults(),arguments,["url","onload"])),this.name="ToneBufferSource",this._source=this.context.createBufferSource(),this._internalChannels=[this._source],this._sourceStarted=!1,this._sourceStopped=!1;const f=ui(jo.getDefaults(),arguments,["url","onload"]);ro(this._source,this._gainNode),this._source.onended=()=>this._stopSource(),this.playbackRate=new no({context:this.context,param:this._source.playbackRate,units:"positive",value:f.playbackRate}),this.loop=f.loop,this.loopStart=f.loopStart,this.loopEnd=f.loopEnd,this._buffer=new Ri(f.url,f.onload,f.onerror),this._internalChannels.push(this._source)}static getDefaults(){return Object.assign(lo.getDefaults(),{url:new Ri,loop:!1,loopEnd:0,loopStart:0,onload:Ei,onerror:Ei,playbackRate:1})}get fadeIn(){return this._fadeIn}set fadeIn(f){this._fadeIn=f}get fadeOut(){return this._fadeOut}set fadeOut(f){this._fadeOut=f}get curve(){return this._curve}set curve(f){this._curve=f}start(f,O,I,V=1){Bn(this.buffer.loaded,"buffer is either not set or not loaded");const F=this.toSeconds(f);this._startGain(F,V),O=this.loop?pi(O,this.loopStart):pi(O,0);let P=Math.max(this.toSeconds(O),0);if(this.loop){const f=this.toSeconds(this.loopEnd)||this.buffer.duration,O=this.toSeconds(this.loopStart),I=f-O;gi(P,f)&&(P=(P-O)%I+O),yi(P,this.buffer.duration)&&(P=0)}if(this._source.buffer=this.buffer.get(),this._source.loopEnd=this.toSeconds(this.loopEnd)||this.buffer.duration,vi(P,this.buffer.duration)&&(this._sourceStarted=!0,this._source.start(F,P)),In(I)){let f=this.toSeconds(I);f=Math.max(f,0),this.stop(F+f)}return this}_stopSource(f){!this._sourceStopped&&this._sourceStarted&&(this._sourceStopped=!0,this._source.stop(this.toSeconds(f)),this._onended())}get loopStart(){return this._source.loopStart}set loopStart(f){this._source.loopStart=this.toSeconds(f)}get loopEnd(){return this._source.loopEnd}set loopEnd(f){this._source.loopEnd=this.toSeconds(f)}get buffer(){return this._buffer}set buffer(f){this._buffer.set(f)}get loop(){return this._source.loop}set loop(f){this._source.loop=f,this._sourceStarted&&this.cancelStop()}dispose(){return super.dispose(),this._source.onended=null,this._source.disconnect(),this._buffer.dispose(),this.playbackRate.dispose(),this}}class Lo extends Po{constructor(){super(ui(Lo.getDefaults(),arguments,["type"])),this.name="Noise",this._source=null;const f=ui(Lo.getDefaults(),arguments,["type"]);this._playbackRate=f.playbackRate,this.type=f.type,this._fadeIn=f.fadeIn,this._fadeOut=f.fadeOut}static getDefaults(){return Object.assign(Po.getDefaults(),{fadeIn:0,fadeOut:0,playbackRate:1,type:"white"})}get type(){return this._type}set type(f){if(Bn(f in Sc,"Noise: invalid type: "+f),this._type!==f&&(this._type=f,"started"===this.state)){const f=this.now();this._stop(f),this._start(f)}}get playbackRate(){return this._playbackRate}set playbackRate(f){this._playbackRate=f,this._source&&(this._source.playbackRate.value=f)}_start(f){const O=Sc[this._type];this._source=new jo({url:O,context:this.context,fadeIn:this._fadeIn,fadeOut:this._fadeOut,loop:!0,onended:()=>this.onstop(this),playbackRate:this._playbackRate}).connect(this.output),this._source.start(this.toSeconds(f),Math.random()*(O.duration-.001))}_stop(f){this._source&&(this._source.stop(this.toSeconds(f)),this._source=null)}get fadeIn(){return this._fadeIn}set fadeIn(f){this._fadeIn=f,this._source&&(this._source.fadeIn=this._fadeIn)}get fadeOut(){return this._fadeOut}set fadeOut(f){this._fadeOut=f,this._source&&(this._source.fadeOut=this._fadeOut)}_restart(f){this._stop(f),this._start(f)}dispose(){return super.dispose(),this._source&&this._source.disconnect(),this}}const xc=220500,bc={brown:null,pink:null,white:null},Sc={get brown(){if(!bc.brown){const f=[];for(let O=0;O<2;O++){const I=new Float32Array(xc);f[O]=I;let V=0;for(let f=0;f<xc;f++){const O=2*Math.random()-1;I[f]=(V+.02*O)/1.02,V=I[f],I[f]*=3.5}}bc.brown=(new Ri).fromArray(f)}return bc.brown},get pink(){if(!bc.pink){const f=[];for(let O=0;O<2;O++){const I=new Float32Array(xc);let V,F,P,ut,mt,gt,vt;f[O]=I,V=F=P=ut=mt=gt=vt=0;for(let f=0;f<xc;f++){const O=2*Math.random()-1;V=.99886*V+.0555179*O,F=.99332*F+.0750759*O,P=.969*P+.153852*O,ut=.8665*ut+.3104856*O,mt=.55*mt+.5329522*O,gt=-.7616*gt-.016898*O,I[f]=V+F+P+ut+mt+gt+vt+.5362*O,I[f]*=.11,vt=.115926*O}}bc.pink=(new Ri).fromArray(f)}return bc.pink},get white(){if(!bc.white){const f=[];for(let O=0;O<2;O++){const I=new Float32Array(xc);f[O]=I;for(let f=0;f<xc;f++)I[f]=2*Math.random()-1}bc.white=(new Ri).fromArray(f)}return bc.white}};class Uo extends io{constructor(){super(ui(Uo.getDefaults(),arguments,["volume"])),this.name="UserMedia";const f=ui(Uo.getDefaults(),arguments,["volume"]);this._volume=this.output=new Oo({context:this.context,volume:f.volume}),this.volume=this._volume.volume,Oi(this,"volume"),this.mute=f.mute}static getDefaults(){return Object.assign(io.getDefaults(),{mute:!1,volume:0})}open(f){return ni(this,void 0,void 0,(function*(){Bn(Uo.supported,"UserMedia is not supported"),"started"===this.state&&this.close();const O=yield Uo.enumerateDevices();Nn(f)?this._device=O[f]:(this._device=O.find((O=>O.label===f||O.deviceId===f)),!this._device&&O.length>0&&(this._device=O[0]),Bn(In(this._device),`No matching device ${f}`));const I={audio:{echoCancellation:!1,sampleRate:this.context.sampleRate,noiseSuppression:!1,mozNoiseSuppression:!1}};this._device&&(I.audio.deviceId=this._device.deviceId);const V=yield navigator.mediaDevices.getUserMedia(I);if(!this._stream){this._stream=V;const f=this.context.createMediaStreamSource(V);ro(f,this.output),this._mediaStream=f}return this}))}close(){return this._stream&&this._mediaStream&&(this._stream.getAudioTracks().forEach((f=>{f.stop()})),this._stream=void 0,this._mediaStream.disconnect(),this._mediaStream=void 0),this._device=void 0,this}static enumerateDevices(){return ni(this,void 0,void 0,(function*(){return(yield navigator.mediaDevices.enumerateDevices()).filter((f=>"audioinput"===f.kind))}))}get state(){return this._stream&&this._stream.active?"started":"stopped"}get deviceId(){return this._device?this._device.deviceId:void 0}get groupId(){return this._device?this._device.groupId:void 0}get label(){return this._device?this._device.label:void 0}get mute(){return this._volume.mute}set mute(f){this._volume.mute=f}dispose(){return super.dispose(),this.close(),this._volume.dispose(),this.volume.dispose(),this}static get supported(){return In(navigator.mediaDevices)&&In(navigator.mediaDevices.getUserMedia)}}function Go(f,O){return ni(this,void 0,void 0,(function*(){const I=O/f.context.sampleRate,V=new qi(1,I,f.context.sampleRate);return new f.constructor(Object.assign(f.get(),{frequency:2/I,detune:0,context:V})).toDestination().start(0),(yield V.render()).getChannelData(0)}))}class Qo extends lo{constructor(){super(ui(Qo.getDefaults(),arguments,["frequency","type"])),this.name="ToneOscillatorNode",this._oscillator=this.context.createOscillator(),this._internalChannels=[this._oscillator];const f=ui(Qo.getDefaults(),arguments,["frequency","type"]);ro(this._oscillator,this._gainNode),this.type=f.type,this.frequency=new no({context:this.context,param:this._oscillator.frequency,units:"frequency",value:f.frequency}),this.detune=new no({context:this.context,param:this._oscillator.detune,units:"cents",value:f.detune}),Oi(this,["frequency","detune"])}static getDefaults(){return Object.assign(lo.getDefaults(),{detune:0,frequency:440,type:"sine"})}start(f){const O=this.toSeconds(f);return this.log("start",O),this._startGain(O),this._oscillator.start(O),this}_stopSource(f){this._oscillator.stop(f)}setPeriodicWave(f){return this._oscillator.setPeriodicWave(f),this}get type(){return this._oscillator.type}set type(f){this._oscillator.type=f}dispose(){return super.dispose(),"started"===this.state&&this.stop(),this._oscillator.disconnect(),this.frequency.dispose(),this.detune.dispose(),this}}class Zo extends Po{constructor(){super(ui(Zo.getDefaults(),arguments,["frequency","type"])),this.name="Oscillator",this._oscillator=null;const f=ui(Zo.getDefaults(),arguments,["frequency","type"]);this.frequency=new po({context:this.context,units:"frequency",value:f.frequency}),Oi(this,"frequency"),this.detune=new po({context:this.context,units:"cents",value:f.detune}),Oi(this,"detune"),this._partials=f.partials,this._partialCount=f.partialCount,this._type=f.type,f.partialCount&&"custom"!==f.type&&(this._type=this.baseType+f.partialCount.toString()),this.phase=f.phase}static getDefaults(){return Object.assign(Po.getDefaults(),{detune:0,frequency:440,partialCount:0,partials:[],phase:0,type:"sine"})}_start(f){const O=this.toSeconds(f),I=new Qo({context:this.context,onended:()=>this.onstop(this)});this._oscillator=I,this._wave?this._oscillator.setPeriodicWave(this._wave):this._oscillator.type=this._type,this._oscillator.connect(this.output),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.start(O)}_stop(f){const O=this.toSeconds(f);this._oscillator&&this._oscillator.stop(O)}_restart(f){const O=this.toSeconds(f);return this.log("restart",O),this._oscillator&&this._oscillator.cancelStop(),this._state.cancel(O),this}syncFrequency(){return this.context.transport.syncSignal(this.frequency),this}unsyncFrequency(){return this.context.transport.unsyncSignal(this.frequency),this}_getCachedPeriodicWave(){if("custom"===this._type)return Zo._periodicWaveCache.find((f=>{return f.phase===this._phase&&(O=f.partials,I=this._partials,O.length===I.length&&O.every(((f,O)=>I[O]===f)));var O,I}));{const f=Zo._periodicWaveCache.find((f=>f.type===this._type&&f.phase===this._phase));return this._partialCount=f?f.partialCount:this._partialCount,f}}get type(){return this._type}set type(f){this._type=f;const O=-1!==["sine","square","sawtooth","triangle"].indexOf(f);if(0===this._phase&&O)this._wave=void 0,this._partialCount=0,null!==this._oscillator&&(this._oscillator.type=f);else{const O=this._getCachedPeriodicWave();if(In(O)){const{partials:f,wave:I}=O;this._wave=I,this._partials=f,null!==this._oscillator&&this._oscillator.setPeriodicWave(this._wave)}else{const[O,I]=this._getRealImaginary(f,this._phase),V=this.context.createPeriodicWave(O,I);this._wave=V,null!==this._oscillator&&this._oscillator.setPeriodicWave(this._wave),Zo._periodicWaveCache.push({imag:I,partialCount:this._partialCount,partials:this._partials,phase:this._phase,real:O,type:this._type,wave:this._wave}),Zo._periodicWaveCache.length>100&&Zo._periodicWaveCache.shift()}}}get baseType(){return this._type.replace(this.partialCount.toString(),"")}set baseType(f){this.partialCount&&"custom"!==this._type&&"custom"!==f?this.type=f+this.partialCount:this.type=f}get partialCount(){return this._partialCount}set partialCount(f){Un(f,0);let O=this._type;const I=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(this._type);if(I&&(O=I[1]),"custom"!==this._type)this.type=0===f?O:O+f.toString();else{const O=new Float32Array(f);this._partials.forEach(((f,I)=>O[I]=f)),this._partials=Array.from(O),this.type=this._type}}_getRealImaginary(f,O){let I=2048;const V=new Float32Array(I),F=new Float32Array(I);let P=1;if("custom"===f){if(P=this._partials.length+1,this._partialCount=this._partials.length,I=P,0===this._partials.length)return[V,F]}else{const O=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(f);O?(P=parseInt(O[2],10)+1,this._partialCount=parseInt(O[2],10),f=O[1],P=Math.max(P,2),I=P):this._partialCount=0,this._partials=[]}for(let ut=1;ut<I;++ut){const I=2/(ut*Math.PI);let mt;switch(f){case"sine":mt=ut<=P?1:0,this._partials[ut-1]=mt;break;case"square":mt=1&ut?2*I:0,this._partials[ut-1]=mt;break;case"sawtooth":mt=I*(1&ut?1:-1),this._partials[ut-1]=mt;break;case"triangle":mt=1&ut?I*I*2*(ut-1>>1&1?-1:1):0,this._partials[ut-1]=mt;break;case"custom":mt=this._partials[ut-1];break;default:throw new TypeError("Oscillator: invalid type: "+f)}0!==mt?(V[ut]=-mt*Math.sin(O*ut),F[ut]=mt*Math.cos(O*ut)):(V[ut]=0,F[ut]=0)}return[V,F]}_inverseFFT(f,O,I){let V=0;const F=f.length;for(let P=0;P<F;P++)V+=f[P]*Math.cos(P*I)+O[P]*Math.sin(P*I);return V}getInitialValue(){const[f,O]=this._getRealImaginary(this._type,0);let I=0;const V=2*Math.PI;for(let F=0;F<32;F++)I=Math.max(this._inverseFFT(f,O,F/32*V),I);return xi(-this._inverseFFT(f,O,this._phase)/I,-1,1)}get partials(){return this._partials.slice(0,this.partialCount)}set partials(f){this._partials=f,this._partialCount=this._partials.length,f.length&&(this.type="custom")}get phase(){return this._phase*(180/Math.PI)}set phase(f){this._phase=f*Math.PI/180,this.type=this._type}asArray(f=1024){return ni(this,void 0,void 0,(function*(){return Go(this,f)}))}dispose(){return super.dispose(),null!==this._oscillator&&this._oscillator.dispose(),this._wave=void 0,this.frequency.dispose(),this.detune.dispose(),this}}Zo._periodicWaveCache=[];class Xo extends Ro{constructor(){super(...arguments),this.name="AudioToGain",this._norm=new qo({context:this.context,mapping:f=>(f+1)/2}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class Yo extends po{constructor(){super(Object.assign(ui(Yo.getDefaults(),arguments,["value"]))),this.name="Multiply",this.override=!1;const f=ui(Yo.getDefaults(),arguments,["value"]);this._mult=this.input=this.output=new ho({context:this.context,minValue:f.minValue,maxValue:f.maxValue}),this.factor=this._param=this._mult.gain,this.factor.setValueAtTime(f.value,0)}static getDefaults(){return Object.assign(po.getDefaults(),{value:0})}dispose(){return super.dispose(),this._mult.dispose(),this}}class $o extends Po{constructor(){super(ui($o.getDefaults(),arguments,["frequency","type","modulationType"])),this.name="AMOscillator",this._modulationScale=new Xo({context:this.context}),this._modulationNode=new ho({context:this.context});const f=ui($o.getDefaults(),arguments,["frequency","type","modulationType"]);this._carrier=new Zo({context:this.context,detune:f.detune,frequency:f.frequency,onstop:()=>this.onstop(this),phase:f.phase,type:f.type}),this.frequency=this._carrier.frequency,this.detune=this._carrier.detune,this._modulator=new Zo({context:this.context,phase:f.phase,type:f.modulationType}),this.harmonicity=new Yo({context:this.context,units:"positive",value:f.harmonicity}),this.frequency.chain(this.harmonicity,this._modulator.frequency),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output),Oi(this,["frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(Zo.getDefaults(),{harmonicity:1,modulationType:"square"})}_start(f){this._modulator.start(f),this._carrier.start(f)}_stop(f){this._modulator.stop(f),this._carrier.stop(f)}_restart(f){this._modulator.restart(f),this._carrier.restart(f)}get type(){return this._carrier.type}set type(f){this._carrier.type=f}get baseType(){return this._carrier.baseType}set baseType(f){this._carrier.baseType=f}get partialCount(){return this._carrier.partialCount}set partialCount(f){this._carrier.partialCount=f}get modulationType(){return this._modulator.type}set modulationType(f){this._modulator.type=f}get phase(){return this._carrier.phase}set phase(f){this._carrier.phase=f,this._modulator.phase=f}get partials(){return this._carrier.partials}set partials(f){this._carrier.partials=f}asArray(f=1024){return ni(this,void 0,void 0,(function*(){return Go(this,f)}))}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this._modulationScale.dispose(),this}}class Ho extends Po{constructor(){super(ui(Ho.getDefaults(),arguments,["frequency","type","modulationType"])),this.name="FMOscillator",this._modulationNode=new ho({context:this.context,gain:0});const f=ui(Ho.getDefaults(),arguments,["frequency","type","modulationType"]);this._carrier=new Zo({context:this.context,detune:f.detune,frequency:0,onstop:()=>this.onstop(this),phase:f.phase,type:f.type}),this.detune=this._carrier.detune,this.frequency=new po({context:this.context,units:"frequency",value:f.frequency}),this._modulator=new Zo({context:this.context,phase:f.phase,type:f.modulationType}),this.harmonicity=new Yo({context:this.context,units:"positive",value:f.harmonicity}),this.modulationIndex=new Yo({context:this.context,units:"positive",value:f.modulationIndex}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output),this.detune.connect(this._modulator.detune),Oi(this,["modulationIndex","frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(Zo.getDefaults(),{harmonicity:1,modulationIndex:2,modulationType:"square"})}_start(f){this._modulator.start(f),this._carrier.start(f)}_stop(f){this._modulator.stop(f),this._carrier.stop(f)}_restart(f){return this._modulator.restart(f),this._carrier.restart(f),this}get type(){return this._carrier.type}set type(f){this._carrier.type=f}get baseType(){return this._carrier.baseType}set baseType(f){this._carrier.baseType=f}get partialCount(){return this._carrier.partialCount}set partialCount(f){this._carrier.partialCount=f}get modulationType(){return this._modulator.type}set modulationType(f){this._modulator.type=f}get phase(){return this._carrier.phase}set phase(f){this._carrier.phase=f,this._modulator.phase=f}get partials(){return this._carrier.partials}set partials(f){this._carrier.partials=f}asArray(f=1024){return ni(this,void 0,void 0,(function*(){return Go(this,f)}))}dispose(){return super.dispose(),this.frequency.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this.modulationIndex.dispose(),this}}class Jo extends Po{constructor(){super(ui(Jo.getDefaults(),arguments,["frequency","width"])),this.name="PulseOscillator",this._widthGate=new ho({context:this.context,gain:0}),this._thresh=new qo({context:this.context,mapping:f=>f<=0?-1:1});const f=ui(Jo.getDefaults(),arguments,["frequency","width"]);this.width=new po({context:this.context,units:"audioRange",value:f.width}),this._triangle=new Zo({context:this.context,detune:f.detune,frequency:f.frequency,onstop:()=>this.onstop(this),phase:f.phase,type:"triangle"}),this.frequency=this._triangle.frequency,this.detune=this._triangle.detune,this._triangle.chain(this._thresh,this.output),this.width.chain(this._widthGate,this._thresh),Oi(this,["width","frequency","detune"])}static getDefaults(){return Object.assign(Po.getDefaults(),{detune:0,frequency:440,phase:0,type:"pulse",width:.2})}_start(f){f=this.toSeconds(f),this._triangle.start(f),this._widthGate.gain.setValueAtTime(1,f)}_stop(f){f=this.toSeconds(f),this._triangle.stop(f),this._widthGate.gain.cancelScheduledValues(f),this._widthGate.gain.setValueAtTime(0,f)}_restart(f){this._triangle.restart(f),this._widthGate.gain.cancelScheduledValues(f),this._widthGate.gain.setValueAtTime(1,f)}get phase(){return this._triangle.phase}set phase(f){this._triangle.phase=f}get type(){return"pulse"}get baseType(){return"pulse"}get partials(){return[]}get partialCount(){return 0}set carrierType(f){this._triangle.type=f}asArray(f=1024){return ni(this,void 0,void 0,(function*(){return Go(this,f)}))}dispose(){return super.dispose(),this._triangle.dispose(),this.width.dispose(),this._widthGate.dispose(),this._thresh.dispose(),this}}class Ko extends Po{constructor(){super(ui(Ko.getDefaults(),arguments,["frequency","type","spread"])),this.name="FatOscillator",this._oscillators=[];const f=ui(Ko.getDefaults(),arguments,["frequency","type","spread"]);this.frequency=new po({context:this.context,units:"frequency",value:f.frequency}),this.detune=new po({context:this.context,units:"cents",value:f.detune}),this._spread=f.spread,this._type=f.type,this._phase=f.phase,this._partials=f.partials,this._partialCount=f.partialCount,this.count=f.count,Oi(this,["frequency","detune"])}static getDefaults(){return Object.assign(Zo.getDefaults(),{count:3,spread:20,type:"sawtooth"})}_start(f){f=this.toSeconds(f),this._forEach((O=>O.start(f)))}_stop(f){f=this.toSeconds(f),this._forEach((O=>O.stop(f)))}_restart(f){this._forEach((O=>O.restart(f)))}_forEach(f){for(let O=0;O<this._oscillators.length;O++)f(this._oscillators[O],O)}get type(){return this._type}set type(f){this._type=f,this._forEach((O=>O.type=f))}get spread(){return this._spread}set spread(f){if(this._spread=f,this._oscillators.length>1){const O=-f/2,I=f/(this._oscillators.length-1);this._forEach(((f,V)=>f.detune.value=O+I*V))}}get count(){return this._oscillators.length}set count(f){if(Un(f,1),this._oscillators.length!==f){this._forEach((f=>f.dispose())),this._oscillators=[];for(let O=0;O<f;O++){const I=new Zo({context:this.context,volume:-6-1.1*f,type:this._type,phase:this._phase+O/f*360,partialCount:this._partialCount,onstop:0===O?()=>this.onstop(this):Ei});"custom"===this.type&&(I.partials=this._partials),this.frequency.connect(I.frequency),this.detune.connect(I.detune),I.detune.overridden=!1,I.connect(this.output),this._oscillators[O]=I}this.spread=this._spread,"started"===this.state&&this._forEach((f=>f.start()))}}get phase(){return this._phase}set phase(f){this._phase=f,this._forEach(((f,O)=>f.phase=this._phase+O/this.count*360))}get baseType(){return this._oscillators[0].baseType}set baseType(f){this._forEach((O=>O.baseType=f)),this._type=this._oscillators[0].type}get partials(){return this._oscillators[0].partials}set partials(f){this._partials=f,this._partialCount=this._partials.length,f.length&&(this._type="custom",this._forEach((O=>O.partials=f)))}get partialCount(){return this._oscillators[0].partialCount}set partialCount(f){this._partialCount=f,this._forEach((O=>O.partialCount=f)),this._type=this._oscillators[0].type}asArray(f=1024){return ni(this,void 0,void 0,(function*(){return Go(this,f)}))}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this._forEach((f=>f.dispose())),this}}class tr extends Po{constructor(){super(ui(tr.getDefaults(),arguments,["frequency","modulationFrequency"])),this.name="PWMOscillator",this.sourceType="pwm",this._scale=new Yo({context:this.context,value:2});const f=ui(tr.getDefaults(),arguments,["frequency","modulationFrequency"]);this._pulse=new Jo({context:this.context,frequency:f.modulationFrequency}),this._pulse.carrierType="sine",this.modulationFrequency=this._pulse.frequency,this._modulator=new Zo({context:this.context,detune:f.detune,frequency:f.frequency,onstop:()=>this.onstop(this),phase:f.phase}),this.frequency=this._modulator.frequency,this.detune=this._modulator.detune,this._modulator.chain(this._scale,this._pulse.width),this._pulse.connect(this.output),Oi(this,["modulationFrequency","frequency","detune"])}static getDefaults(){return Object.assign(Po.getDefaults(),{detune:0,frequency:440,modulationFrequency:.4,phase:0,type:"pwm"})}_start(f){f=this.toSeconds(f),this._modulator.start(f),this._pulse.start(f)}_stop(f){f=this.toSeconds(f),this._modulator.stop(f),this._pulse.stop(f)}_restart(f){this._modulator.restart(f),this._pulse.restart(f)}get type(){return"pwm"}get baseType(){return"pwm"}get partials(){return[]}get partialCount(){return 0}get phase(){return this._modulator.phase}set phase(f){this._modulator.phase=f}asArray(f=1024){return ni(this,void 0,void 0,(function*(){return Go(this,f)}))}dispose(){return super.dispose(),this._pulse.dispose(),this._scale.dispose(),this._modulator.dispose(),this}}const Ac={am:$o,fat:Ko,fm:Ho,oscillator:Zo,pulse:Jo,pwm:tr};class sr extends Po{constructor(){super(ui(sr.getDefaults(),arguments,["frequency","type"])),this.name="OmniOscillator";const f=ui(sr.getDefaults(),arguments,["frequency","type"]);this.frequency=new po({context:this.context,units:"frequency",value:f.frequency}),this.detune=new po({context:this.context,units:"cents",value:f.detune}),Oi(this,["frequency","detune"]),this.set(f)}static getDefaults(){return Object.assign(Zo.getDefaults(),Ho.getDefaults(),$o.getDefaults(),Ko.getDefaults(),Jo.getDefaults(),tr.getDefaults())}_start(f){this._oscillator.start(f)}_stop(f){this._oscillator.stop(f)}_restart(f){return this._oscillator.restart(f),this}get type(){let f="";return["am","fm","fat"].some((f=>this._sourceType===f))&&(f=this._sourceType),f+this._oscillator.type}set type(f){"fm"===f.substr(0,2)?(this._createNewOscillator("fm"),this._oscillator=this._oscillator,this._oscillator.type=f.substr(2)):"am"===f.substr(0,2)?(this._createNewOscillator("am"),this._oscillator=this._oscillator,this._oscillator.type=f.substr(2)):"fat"===f.substr(0,3)?(this._createNewOscillator("fat"),this._oscillator=this._oscillator,this._oscillator.type=f.substr(3)):"pwm"===f?(this._createNewOscillator("pwm"),this._oscillator=this._oscillator):"pulse"===f?this._createNewOscillator("pulse"):(this._createNewOscillator("oscillator"),this._oscillator=this._oscillator,this._oscillator.type=f)}get partials(){return this._oscillator.partials}set partials(f){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||(this._oscillator.partials=f)}get partialCount(){return this._oscillator.partialCount}set partialCount(f){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||(this._oscillator.partialCount=f)}set(f){return Reflect.has(f,"type")&&f.type&&(this.type=f.type),super.set(f),this}_createNewOscillator(f){if(f!==this._sourceType){this._sourceType=f;const O=Ac[f],I=this.now();if(this._oscillator){const f=this._oscillator;f.stop(I),this.context.setTimeout((()=>f.dispose()),this.blockTime)}this._oscillator=new O({context:this.context}),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.connect(this.output),this._oscillator.onstop=()=>this.onstop(this),"started"===this.state&&this._oscillator.start(I)}}get phase(){return this._oscillator.phase}set phase(f){this._oscillator.phase=f}get sourceType(){return this._sourceType}set sourceType(f){let O="sine";"pwm"!==this._oscillator.type&&"pulse"!==this._oscillator.type&&(O=this._oscillator.type),"fm"===f?this.type="fm"+O:"am"===f?this.type="am"+O:"fat"===f?this.type="fat"+O:"oscillator"===f?this.type=O:"pulse"===f?this.type="pulse":"pwm"===f&&(this.type="pwm")}_getOscType(f,O){return f instanceof Ac[O]}get baseType(){return this._oscillator.baseType}set baseType(f){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||"pulse"===f||"pwm"===f||(this._oscillator.baseType=f)}get width(){return this._getOscType(this._oscillator,"pulse")?this._oscillator.width:void 0}get count(){return this._getOscType(this._oscillator,"fat")?this._oscillator.count:void 0}set count(f){this._getOscType(this._oscillator,"fat")&&Nn(f)&&(this._oscillator.count=f)}get spread(){return this._getOscType(this._oscillator,"fat")?this._oscillator.spread:void 0}set spread(f){this._getOscType(this._oscillator,"fat")&&Nn(f)&&(this._oscillator.spread=f)}get modulationType(){return this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am")?this._oscillator.modulationType:void 0}set modulationType(f){(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))&&zn(f)&&(this._oscillator.modulationType=f)}get modulationIndex(){return this._getOscType(this._oscillator,"fm")?this._oscillator.modulationIndex:void 0}get harmonicity(){return this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am")?this._oscillator.harmonicity:void 0}get modulationFrequency(){return this._getOscType(this._oscillator,"pwm")?this._oscillator.modulationFrequency:void 0}asArray(f=1024){return ni(this,void 0,void 0,(function*(){return Go(this,f)}))}dispose(){return super.dispose(),this.detune.dispose(),this.frequency.dispose(),this._oscillator.dispose(),this}}class nr extends po{constructor(){super(Object.assign(ui(nr.getDefaults(),arguments,["value"]))),this.override=!1,this.name="Add",this._sum=new ho({context:this.context}),this.input=this._sum,this.output=this._sum,this.addend=this._param,oo(this._constantSource,this._sum)}static getDefaults(){return Object.assign(po.getDefaults(),{value:0})}dispose(){return super.dispose(),this._sum.dispose(),this}}class ir extends Ro{constructor(){super(Object.assign(ui(ir.getDefaults(),arguments,["min","max"]))),this.name="Scale";const f=ui(ir.getDefaults(),arguments,["min","max"]);this._mult=this.input=new Yo({context:this.context,value:f.max-f.min}),this._add=this.output=new nr({context:this.context,value:f.min}),this._min=f.min,this._max=f.max,this.input.connect(this.output)}static getDefaults(){return Object.assign(Ro.getDefaults(),{max:1,min:0})}get min(){return this._min}set min(f){this._min=f,this._setRange()}get max(){return this._max}set max(f){this._max=f,this._setRange()}_setRange(){this._add.value=this._min,this._mult.value=this._max-this._min}dispose(){return super.dispose(),this._add.dispose(),this._mult.dispose(),this}}class or extends Ro{constructor(){super(Object.assign(ui(or.getDefaults(),arguments))),this.name="Zero",this._gain=new ho({context:this.context}),this.output=this._gain,this.input=void 0,ro(this.context.getConstant(0),this._gain)}dispose(){return super.dispose(),ao(this.context.getConstant(0),this._gain),this}}class rr extends io{constructor(){super(ui(rr.getDefaults(),arguments,["frequency","min","max"])),this.name="LFO",this._stoppedValue=0,this._units="number",this.convert=!0,this._fromType=no.prototype._fromType,this._toType=no.prototype._toType,this._is=no.prototype._is,this._clampValue=no.prototype._clampValue;const f=ui(rr.getDefaults(),arguments,["frequency","min","max"]);this._oscillator=new Zo(f),this.frequency=this._oscillator.frequency,this._amplitudeGain=new ho({context:this.context,gain:f.amplitude,units:"normalRange"}),this.amplitude=this._amplitudeGain.gain,this._stoppedSignal=new po({context:this.context,units:"audioRange",value:0}),this._zeros=new or({context:this.context}),this._a2g=new Xo({context:this.context}),this._scaler=this.output=new ir({context:this.context,max:f.max,min:f.min}),this.units=f.units,this.min=f.min,this.max=f.max,this._oscillator.chain(this._amplitudeGain,this._a2g,this._scaler),this._zeros.connect(this._a2g),this._stoppedSignal.connect(this._a2g),Oi(this,["amplitude","frequency"]),this.phase=f.phase}static getDefaults(){return Object.assign(Zo.getDefaults(),{amplitude:1,frequency:"4n",max:1,min:0,type:"sine",units:"number"})}start(f){return f=this.toSeconds(f),this._stoppedSignal.setValueAtTime(0,f),this._oscillator.start(f),this}stop(f){return f=this.toSeconds(f),this._stoppedSignal.setValueAtTime(this._stoppedValue,f),this._oscillator.stop(f),this}sync(){return this._oscillator.sync(),this._oscillator.syncFrequency(),this}unsync(){return this._oscillator.unsync(),this._oscillator.unsyncFrequency(),this}_setStoppedValue(){this._stoppedValue=this._oscillator.getInitialValue(),this._stoppedSignal.value=this._stoppedValue}get min(){return this._toType(this._scaler.min)}set min(f){f=this._fromType(f),this._scaler.min=f}get max(){return this._toType(this._scaler.max)}set max(f){f=this._fromType(f),this._scaler.max=f}get type(){return this._oscillator.type}set type(f){this._oscillator.type=f,this._setStoppedValue()}get partials(){return this._oscillator.partials}set partials(f){this._oscillator.partials=f,this._setStoppedValue()}get phase(){return this._oscillator.phase}set phase(f){this._oscillator.phase=f,this._setStoppedValue()}get units(){return this._units}set units(f){const O=this.min,I=this.max;this._units=f,this.min=O,this.max=I}get state(){return this._oscillator.state}connect(f,O,I){return(f instanceof no||f instanceof po)&&(this.convert=f.convert,this.units=f.units),fo(this,f,O,I),this}dispose(){return super.dispose(),this._oscillator.dispose(),this._stoppedSignal.dispose(),this._zeros.dispose(),this._scaler.dispose(),this._a2g.dispose(),this._amplitudeGain.dispose(),this.amplitude.dispose(),this}}function ar(f,O=1/0){const I=new WeakMap;return function(V,F){Reflect.defineProperty(V,F,{configurable:!0,enumerable:!0,get:function(){return I.get(this)},set:function(V){Un(V,f,O),I.set(this,V)}})}}function cr(f,O=1/0){const I=new WeakMap;return function(V,F){Reflect.defineProperty(V,F,{configurable:!0,enumerable:!0,get:function(){return I.get(this)},set:function(V){Un(this.toSeconds(V),f,O),I.set(this,V)}})}}class hr extends Po{constructor(){super(ui(hr.getDefaults(),arguments,["url","onload"])),this.name="Player",this._activeSources=new Set;const f=ui(hr.getDefaults(),arguments,["url","onload"]);this._buffer=new Ri({onload:this._onload.bind(this,f.onload),onerror:f.onerror,reverse:f.reverse,url:f.url}),this.autostart=f.autostart,this._loop=f.loop,this._loopStart=f.loopStart,this._loopEnd=f.loopEnd,this._playbackRate=f.playbackRate,this.fadeIn=f.fadeIn,this.fadeOut=f.fadeOut}static getDefaults(){return Object.assign(Po.getDefaults(),{autostart:!1,fadeIn:0,fadeOut:0,loop:!1,loopEnd:0,loopStart:0,onload:Ei,onerror:Ei,playbackRate:1,reverse:!1})}load(f){return ni(this,void 0,void 0,(function*(){return yield this._buffer.load(f),this._onload(),this}))}_onload(f=Ei){f(),this.autostart&&this.start()}_onSourceEnd(f){this.onstop(this),this._activeSources.delete(f),0!==this._activeSources.size||this._synced||"started"!==this._state.getValueAtTime(this.now())||(this._state.cancel(this.now()),this._state.setStateAtTime("stopped",this.now()))}start(f,O,I){return super.start(f,O,I),this}_start(f,O,I){O=this._loop?pi(O,this._loopStart):pi(O,0);const V=this.toSeconds(O),F=I;I=pi(I,Math.max(this._buffer.duration-V,0));let P=this.toSeconds(I);P/=this._playbackRate,f=this.toSeconds(f);const ut=new jo({url:this._buffer,context:this.context,fadeIn:this.fadeIn,fadeOut:this.fadeOut,loop:this._loop,loopEnd:this._loopEnd,loopStart:this._loopStart,onended:this._onSourceEnd.bind(this),playbackRate:this._playbackRate}).connect(this.output);this._loop||this._synced||(this._state.cancel(f+P),this._state.setStateAtTime("stopped",f+P,{implicitEnd:!0})),this._activeSources.add(ut),this._loop&&Fn(F)?ut.start(f,V):ut.start(f,V,P-this.toSeconds(this.fadeOut))}_stop(f){const O=this.toSeconds(f);this._activeSources.forEach((f=>f.stop(O)))}restart(f,O,I){return super.restart(f,O,I),this}_restart(f,O,I){var V;null===(V=[...this._activeSources].pop())||void 0===V||V.stop(f),this._start(f,O,I)}seek(f,O){const I=this.toSeconds(O);if("started"===this._state.getValueAtTime(I)){const O=this.toSeconds(f);this._stop(I),this._start(I,O)}return this}setLoopPoints(f,O){return this.loopStart=f,this.loopEnd=O,this}get loopStart(){return this._loopStart}set loopStart(f){this._loopStart=f,this.buffer.loaded&&Un(this.toSeconds(f),0,this.buffer.duration),this._activeSources.forEach((O=>{O.loopStart=f}))}get loopEnd(){return this._loopEnd}set loopEnd(f){this._loopEnd=f,this.buffer.loaded&&Un(this.toSeconds(f),0,this.buffer.duration),this._activeSources.forEach((O=>{O.loopEnd=f}))}get buffer(){return this._buffer}set buffer(f){this._buffer.set(f)}get loop(){return this._loop}set loop(f){if(this._loop!==f&&(this._loop=f,this._activeSources.forEach((O=>{O.loop=f})),f)){const f=this._state.getNextState("stopped",this.now());f&&this._state.cancel(f.time)}}get playbackRate(){return this._playbackRate}set playbackRate(f){this._playbackRate=f;const O=this.now(),I=this._state.getNextState("stopped",O);I&&I.implicitEnd&&(this._state.cancel(I.time),this._activeSources.forEach((f=>f.cancelStop()))),this._activeSources.forEach((I=>{I.playbackRate.setValueAtTime(f,O)}))}get reverse(){return this._buffer.reverse}set reverse(f){this._buffer.reverse=f}get loaded(){return this._buffer.loaded}dispose(){return super.dispose(),this._activeSources.forEach((f=>f.dispose())),this._activeSources.clear(),this._buffer.dispose(),this}}si([cr(0)],hr.prototype,"fadeIn",void 0),si([cr(0)],hr.prototype,"fadeOut",void 0);class lr extends io{constructor(){super(ui(lr.getDefaults(),arguments,["urls","onload"],"urls")),this.name="Players",this.input=void 0,this._players=new Map;const f=ui(lr.getDefaults(),arguments,["urls","onload"],"urls");this._volume=this.output=new Oo({context:this.context,volume:f.volume}),this.volume=this._volume.volume,Oi(this,"volume"),this._buffers=new wo({urls:f.urls,onload:f.onload,baseUrl:f.baseUrl,onerror:f.onerror}),this.mute=f.mute,this._fadeIn=f.fadeIn,this._fadeOut=f.fadeOut}static getDefaults(){return Object.assign(Po.getDefaults(),{baseUrl:"",fadeIn:0,fadeOut:0,mute:!1,onload:Ei,onerror:Ei,urls:{},volume:0})}get mute(){return this._volume.mute}set mute(f){this._volume.mute=f}get fadeIn(){return this._fadeIn}set fadeIn(f){this._fadeIn=f,this._players.forEach((O=>{O.fadeIn=f}))}get fadeOut(){return this._fadeOut}set fadeOut(f){this._fadeOut=f,this._players.forEach((O=>{O.fadeOut=f}))}get state(){return Array.from(this._players).some((([f,O])=>"started"===O.state))?"started":"stopped"}has(f){return this._buffers.has(f)}player(f){if(Bn(this.has(f),`No Player with the name ${f} exists on this object`),!this._players.has(f)){const O=new hr({context:this.context,fadeIn:this._fadeIn,fadeOut:this._fadeOut,url:this._buffers.get(f)}).connect(this.output);this._players.set(f,O)}return this._players.get(f)}get loaded(){return this._buffers.loaded}add(f,O,I){return Bn(!this._buffers.has(f),"A buffer with that name already exists on this object"),this._buffers.add(f,O,I),this}stopAll(f){return this._players.forEach((O=>O.stop(f))),this}dispose(){return super.dispose(),this._volume.dispose(),this.volume.dispose(),this._players.forEach((f=>f.dispose())),this._buffers.dispose(),this}}class ur extends Po{constructor(){super(ui(ur.getDefaults(),arguments,["url","onload"])),this.name="GrainPlayer",this._loopStart=0,this._loopEnd=0,this._activeSources=[];const f=ui(ur.getDefaults(),arguments,["url","onload"]);this.buffer=new Ri({onload:f.onload,onerror:f.onerror,reverse:f.reverse,url:f.url}),this._clock=new vo({context:this.context,callback:this._tick.bind(this),frequency:1/f.grainSize}),this._playbackRate=f.playbackRate,this._grainSize=f.grainSize,this._overlap=f.overlap,this.detune=f.detune,this.overlap=f.overlap,this.loop=f.loop,this.playbackRate=f.playbackRate,this.grainSize=f.grainSize,this.loopStart=f.loopStart,this.loopEnd=f.loopEnd,this.reverse=f.reverse,this._clock.on("stop",this._onstop.bind(this))}static getDefaults(){return Object.assign(Po.getDefaults(),{onload:Ei,onerror:Ei,overlap:.1,grainSize:.2,playbackRate:1,detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1})}_start(f,O,I){O=pi(O,0),O=this.toSeconds(O),f=this.toSeconds(f);const V=1/this._clock.frequency.getValueAtTime(f);this._clock.start(f,O/V),I&&this.stop(f+this.toSeconds(I))}restart(f,O,I){return super.restart(f,O,I),this}_restart(f,O,I){this._stop(f),this._start(f,O,I)}_stop(f){this._clock.stop(f)}_onstop(f){this._activeSources.forEach((O=>{O.fadeOut=0,O.stop(f)})),this.onstop(this)}_tick(f){const O=this._clock.getTicksAtTime(f),I=O*this._grainSize;if(this.log("offset",I),!this.loop&&I>this.buffer.duration)return void this.stop(f);const V=I<this._overlap?0:this._overlap,F=new jo({context:this.context,url:this.buffer,fadeIn:V,fadeOut:this._overlap,loop:this.loop,loopStart:this._loopStart,loopEnd:this._loopEnd,playbackRate:zi(this.detune/100)}).connect(this.output);F.start(f,this._grainSize*O),F.stop(f+this._grainSize/this.playbackRate),this._activeSources.push(F),F.onended=()=>{const f=this._activeSources.indexOf(F);-1!==f&&this._activeSources.splice(f,1)}}get playbackRate(){return this._playbackRate}set playbackRate(f){Un(f,.001),this._playbackRate=f,this.grainSize=this._grainSize}get loopStart(){return this._loopStart}set loopStart(f){this.buffer.loaded&&Un(this.toSeconds(f),0,this.buffer.duration),this._loopStart=this.toSeconds(f)}get loopEnd(){return this._loopEnd}set loopEnd(f){this.buffer.loaded&&Un(this.toSeconds(f),0,this.buffer.duration),this._loopEnd=this.toSeconds(f)}get reverse(){return this.buffer.reverse}set reverse(f){this.buffer.reverse=f}get grainSize(){return this._grainSize}set grainSize(f){this._grainSize=this.toSeconds(f),this._clock.frequency.setValueAtTime(this._playbackRate/this._grainSize,this.now())}get overlap(){return this._overlap}set overlap(f){const O=this.toSeconds(f);Un(O,0),this._overlap=O}get loaded(){return this.buffer.loaded}dispose(){return super.dispose(),this.buffer.dispose(),this._clock.dispose(),this._activeSources.forEach((f=>f.dispose())),this}}class pr extends Ro{constructor(){super(...arguments),this.name="Abs",this._abs=new qo({context:this.context,mapping:f=>Math.abs(f)<.001?0:Math.abs(f)}),this.input=this._abs,this.output=this._abs}dispose(){return super.dispose(),this._abs.dispose(),this}}class dr extends Ro{constructor(){super(...arguments),this.name="GainToAudio",this._norm=new qo({context:this.context,mapping:f=>2*Math.abs(f)-1}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class fr extends Ro{constructor(){super(...arguments),this.name="Negate",this._multiply=new Yo({context:this.context,value:-1}),this.input=this._multiply,this.output=this._multiply}dispose(){return super.dispose(),this._multiply.dispose(),this}}class _r extends po{constructor(){super(Object.assign(ui(_r.getDefaults(),arguments,["value"]))),this.override=!1,this.name="Subtract",this._sum=new ho({context:this.context}),this.input=this._sum,this.output=this._sum,this._neg=new fr({context:this.context}),this.subtrahend=this._param,oo(this._constantSource,this._neg,this._sum)}static getDefaults(){return Object.assign(po.getDefaults(),{value:0})}dispose(){return super.dispose(),this._neg.dispose(),this._sum.dispose(),this}}class mr extends Ro{constructor(){super(Object.assign(ui(mr.getDefaults(),arguments))),this.name="GreaterThanZero",this._thresh=this.output=new qo({context:this.context,length:127,mapping:f=>f<=0?0:1}),this._scale=this.input=new Yo({context:this.context,value:1e4}),this._scale.connect(this._thresh)}dispose(){return super.dispose(),this._scale.dispose(),this._thresh.dispose(),this}}class gr extends po{constructor(){super(Object.assign(ui(gr.getDefaults(),arguments,["value"]))),this.name="GreaterThan",this.override=!1;const f=ui(gr.getDefaults(),arguments,["value"]);this._subtract=this.input=new _r({context:this.context,value:f.value}),this._gtz=this.output=new mr({context:this.context}),this.comparator=this._param=this._subtract.subtrahend,Oi(this,"comparator"),this._subtract.connect(this._gtz)}static getDefaults(){return Object.assign(po.getDefaults(),{value:0})}dispose(){return super.dispose(),this._gtz.dispose(),this._subtract.dispose(),this.comparator.dispose(),this}}class vr extends ir{constructor(){super(Object.assign(ui(vr.getDefaults(),arguments,["min","max","exponent"]))),this.name="ScaleExp";const f=ui(vr.getDefaults(),arguments,["min","max","exponent"]);this.input=this._exp=new Fo({context:this.context,value:f.exponent}),this._exp.connect(this._mult)}static getDefaults(){return Object.assign(ir.getDefaults(),{exponent:1})}get exponent(){return this._exp.value}set exponent(f){this._exp.value=f}dispose(){return super.dispose(),this._exp.dispose(),this}}class yr extends po{constructor(){super(ui(po.getDefaults(),arguments,["value","units"])),this.name="SyncedSignal",this.override=!1;const f=ui(po.getDefaults(),arguments,["value","units"]);this._lastVal=f.value,this._synced=this.context.transport.scheduleRepeat(this._onTick.bind(this),"1i"),this._syncedCallback=this._anchorValue.bind(this),this.context.transport.on("start",this._syncedCallback),this.context.transport.on("pause",this._syncedCallback),this.context.transport.on("stop",this._syncedCallback),this._constantSource.disconnect(),this._constantSource.stop(0),this._constantSource=this.output=new uo({context:this.context,offset:f.value,units:f.units}).start(0),this.setValueAtTime(f.value,0)}_onTick(f){const O=super.getValueAtTime(this.context.transport.seconds);this._lastVal!==O&&(this._lastVal=O,this._constantSource.offset.setValueAtTime(O,f))}_anchorValue(f){const O=super.getValueAtTime(this.context.transport.seconds);this._lastVal=O,this._constantSource.offset.cancelAndHoldAtTime(f),this._constantSource.offset.setValueAtTime(O,f)}getValueAtTime(f){const O=new Ki(this.context,f).toSeconds();return super.getValueAtTime(O)}setValueAtTime(f,O){const I=new Ki(this.context,O).toSeconds();return super.setValueAtTime(f,I),this}linearRampToValueAtTime(f,O){const I=new Ki(this.context,O).toSeconds();return super.linearRampToValueAtTime(f,I),this}exponentialRampToValueAtTime(f,O){const I=new Ki(this.context,O).toSeconds();return super.exponentialRampToValueAtTime(f,I),this}setTargetAtTime(f,O,I){const V=new Ki(this.context,O).toSeconds();return super.setTargetAtTime(f,V,I),this}cancelScheduledValues(f){const O=new Ki(this.context,f).toSeconds();return super.cancelScheduledValues(O),this}setValueCurveAtTime(f,O,I,V){const F=new Ki(this.context,O).toSeconds();return I=this.toSeconds(I),super.setValueCurveAtTime(f,F,I,V),this}cancelAndHoldAtTime(f){const O=new Ki(this.context,f).toSeconds();return super.cancelAndHoldAtTime(O),this}setRampPoint(f){const O=new Ki(this.context,f).toSeconds();return super.setRampPoint(O),this}exponentialRampTo(f,O,I){const V=new Ki(this.context,I).toSeconds();return super.exponentialRampTo(f,O,V),this}linearRampTo(f,O,I){const V=new Ki(this.context,I).toSeconds();return super.linearRampTo(f,O,V),this}targetRampTo(f,O,I){const V=new Ki(this.context,I).toSeconds();return super.targetRampTo(f,O,V),this}dispose(){return super.dispose(),this.context.transport.clear(this._synced),this.context.transport.off("start",this._syncedCallback),this.context.transport.off("pause",this._syncedCallback),this.context.transport.off("stop",this._syncedCallback),this._constantSource.dispose(),this}}class xr extends io{constructor(){super(ui(xr.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="Envelope",this._sig=new po({context:this.context,value:0}),this.output=this._sig,this.input=void 0;const f=ui(xr.getDefaults(),arguments,["attack","decay","sustain","release"]);this.attack=f.attack,this.decay=f.decay,this.sustain=f.sustain,this.release=f.release,this.attackCurve=f.attackCurve,this.releaseCurve=f.releaseCurve,this.decayCurve=f.decayCurve}static getDefaults(){return Object.assign(io.getDefaults(),{attack:.01,attackCurve:"linear",decay:.1,decayCurve:"exponential",release:1,releaseCurve:"exponential",sustain:.5})}get value(){return this.getValueAtTime(this.now())}_getCurve(f,O){if(zn(f))return f;{let I;for(I in Oc)if(Oc[I][O]===f)return I;return f}}_setCurve(f,O,I){if(zn(I)&&Reflect.has(Oc,I)){const V=Oc[I];Pn(V)?"_decayCurve"!==f&&(this[f]=V[O]):this[f]=V}else{if(!Ln(I)||"_decayCurve"===f)throw new Error("Envelope: invalid curve: "+I);this[f]=I}}get attackCurve(){return this._getCurve(this._attackCurve,"In")}set attackCurve(f){this._setCurve("_attackCurve","In",f)}get releaseCurve(){return this._getCurve(this._releaseCurve,"Out")}set releaseCurve(f){this._setCurve("_releaseCurve","Out",f)}get decayCurve(){return this._getCurve(this._decayCurve,"Out")}set decayCurve(f){this._setCurve("_decayCurve","Out",f)}triggerAttack(f,O=1){this.log("triggerAttack",f,O),f=this.toSeconds(f);let I=this.toSeconds(this.attack);const V=this.toSeconds(this.decay),F=this.getValueAtTime(f);if(F>0&&(I=(1-F)/(1/I)),I<this.sampleTime)this._sig.cancelScheduledValues(f),this._sig.setValueAtTime(O,f);else if("linear"===this._attackCurve)this._sig.linearRampTo(O,I,f);else if("exponential"===this._attackCurve)this._sig.targetRampTo(O,I,f);else{this._sig.cancelAndHoldAtTime(f);let V=this._attackCurve;for(let f=1;f<V.length;f++)if(V[f-1]<=F&&F<=V[f]){V=this._attackCurve.slice(f),V[0]=F;break}this._sig.setValueCurveAtTime(V,f,I,O)}if(V&&this.sustain<1){const F=O*this.sustain,P=f+I;this.log("decay",P),"linear"===this._decayCurve?this._sig.linearRampToValueAtTime(F,V+P):this._sig.exponentialApproachValueAtTime(F,P,V)}return this}triggerRelease(f){this.log("triggerRelease",f),f=this.toSeconds(f);const O=this.getValueAtTime(f);if(O>0){const I=this.toSeconds(this.release);I<this.sampleTime?this._sig.setValueAtTime(0,f):"linear"===this._releaseCurve?this._sig.linearRampTo(0,I,f):"exponential"===this._releaseCurve?this._sig.targetRampTo(0,I,f):(Bn(Ln(this._releaseCurve),"releaseCurve must be either 'linear', 'exponential' or an array"),this._sig.cancelAndHoldAtTime(f),this._sig.setValueCurveAtTime(this._releaseCurve,f,I,O))}return this}getValueAtTime(f){return this._sig.getValueAtTime(f)}triggerAttackRelease(f,O,I=1){return O=this.toSeconds(O),this.triggerAttack(O,I),this.triggerRelease(O+this.toSeconds(f)),this}cancel(f){return this._sig.cancelScheduledValues(this.toSeconds(f)),this}connect(f,O=0,I=0){return fo(this,f,O,I),this}asArray(f=1024){return ni(this,void 0,void 0,(function*(){const O=f/this.context.sampleRate,I=new qi(1,O,this.context.sampleRate),V=this.toSeconds(this.attack)+this.toSeconds(this.decay),F=V+this.toSeconds(this.release),P=.1*F,ut=F+P,mt=new this.constructor(Object.assign(this.get(),{attack:O*this.toSeconds(this.attack)/ut,decay:O*this.toSeconds(this.decay)/ut,release:O*this.toSeconds(this.release)/ut,context:I}));return mt._sig.toDestination(),mt.triggerAttackRelease(O*(V+P)/ut,0),(yield I.render()).getChannelData(0)}))}dispose(){return super.dispose(),this._sig.dispose(),this}}si([cr(0)],xr.prototype,"attack",void 0),si([cr(0)],xr.prototype,"decay",void 0),si([ar(0,1)],xr.prototype,"sustain",void 0),si([cr(0)],xr.prototype,"release",void 0);const Oc=(()=>{const f=128;let O,I;const V=[];for(O=0;O<f;O++)V[O]=Math.sin(O/127*(Math.PI/2));const F=[];for(O=0;O<127;O++){I=O/127;const f=Math.sin(I*(2*Math.PI)*6.4-Math.PI/2)+1;F[O]=f/10+.83*I}F[127]=1;const P=[];for(O=0;O<f;O++)P[O]=Math.ceil(O/127*5)/5;const ut=[];for(O=0;O<f;O++)I=O/127,ut[O]=.5*(1-Math.cos(Math.PI*I));const mt=[];for(O=0;O<f;O++){I=O/127;const f=4*Math.pow(I,3)+.2,V=Math.cos(f*Math.PI*2*I);mt[O]=Math.abs(V*(1-I))}function c(f){const O=new Array(f.length);for(let I=0;I<f.length;I++)O[I]=1-f[I];return O}return{bounce:{In:c(mt),Out:mt},cosine:{In:V,Out:(gt=V,gt.slice(0).reverse())},exponential:"exponential",linear:"linear",ripple:{In:F,Out:c(F)},sine:{In:ut,Out:c(ut)},step:{In:P,Out:c(P)}};var gt})();class br extends io{constructor(){super(ui(br.getDefaults(),arguments)),this._scheduledEvents=[],this._synced=!1,this._original_triggerAttack=this.triggerAttack,this._original_triggerRelease=this.triggerRelease,this._syncedRelease=f=>this._original_triggerRelease(f);const f=ui(br.getDefaults(),arguments);this._volume=this.output=new Oo({context:this.context,volume:f.volume}),this.volume=this._volume.volume,Oi(this,"volume")}static getDefaults(){return Object.assign(io.getDefaults(),{volume:0})}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",0),this.context.transport.on("stop",this._syncedRelease),this.context.transport.on("pause",this._syncedRelease),this.context.transport.on("loopEnd",this._syncedRelease)),this}_syncState(){let f=!1;return this._synced||(this._synced=!0,f=!0),f}_syncMethod(f,O){const I=this["_original_"+f]=this[f];this[f]=(...f)=>{const V=f[O],F=this.context.transport.schedule((V=>{f[O]=V,I.apply(this,f)}),V);this._scheduledEvents.push(F)}}unsync(){return this._scheduledEvents.forEach((f=>this.context.transport.clear(f))),this._scheduledEvents=[],this._synced&&(this._synced=!1,this.triggerAttack=this._original_triggerAttack,this.triggerRelease=this._original_triggerRelease,this.context.transport.off("stop",this._syncedRelease),this.context.transport.off("pause",this._syncedRelease),this.context.transport.off("loopEnd",this._syncedRelease)),this}triggerAttackRelease(f,O,I,V){const F=this.toSeconds(I),P=this.toSeconds(O);return this.triggerAttack(f,F,V),this.triggerRelease(F+P),this}dispose(){return super.dispose(),this._volume.dispose(),this.unsync(),this._scheduledEvents=[],this}}class Tr extends br{constructor(){super(ui(Tr.getDefaults(),arguments));const f=ui(Tr.getDefaults(),arguments);this.portamento=f.portamento,this.onsilence=f.onsilence}static getDefaults(){return Object.assign(br.getDefaults(),{detune:0,onsilence:Ei,portamento:0})}triggerAttack(f,O,I=1){this.log("triggerAttack",f,O,I);const V=this.toSeconds(O);return this._triggerEnvelopeAttack(V,I),this.setNote(f,V),this}triggerRelease(f){this.log("triggerRelease",f);const O=this.toSeconds(f);return this._triggerEnvelopeRelease(O),this}setNote(f,O){const I=this.toSeconds(O),V=f instanceof Yi?f.toFrequency():f;if(this.portamento>0&&this.getLevelAtTime(I)>.05){const f=this.toSeconds(this.portamento);this.frequency.exponentialRampTo(V,f,I)}else this.frequency.setValueAtTime(V,I);return this}}si([cr(0)],Tr.prototype,"portamento",void 0);class Sr extends xr{constructor(){super(ui(Sr.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="AmplitudeEnvelope",this._gainNode=new ho({context:this.context,gain:0}),this.output=this._gainNode,this.input=this._gainNode,this._sig.connect(this._gainNode.gain),this.output=this._gainNode,this.input=this._gainNode}dispose(){return super.dispose(),this._gainNode.dispose(),this}}class kr extends Tr{constructor(){super(ui(kr.getDefaults(),arguments)),this.name="Synth";const f=ui(kr.getDefaults(),arguments);this.oscillator=new sr(Object.assign({context:this.context,detune:f.detune,onstop:()=>this.onsilence(this)},f.oscillator)),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.envelope=new Sr(Object.assign({context:this.context},f.envelope)),this.oscillator.chain(this.envelope,this.output),Oi(this,["oscillator","frequency","detune","envelope"])}static getDefaults(){return Object.assign(Tr.getDefaults(),{envelope:Object.assign(di(xr.getDefaults(),Object.keys(io.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.3}),oscillator:Object.assign(di(sr.getDefaults(),[...Object.keys(Po.getDefaults()),"frequency","detune"]),{type:"triangle"})})}_triggerEnvelopeAttack(f,O){if(this.envelope.triggerAttack(f,O),this.oscillator.start(f),0===this.envelope.sustain){const O=this.toSeconds(this.envelope.attack),I=this.toSeconds(this.envelope.decay);this.oscillator.stop(f+O+I)}}_triggerEnvelopeRelease(f){this.envelope.triggerRelease(f),this.oscillator.stop(f+this.toSeconds(this.envelope.release))}getLevelAtTime(f){return f=this.toSeconds(f),this.envelope.getValueAtTime(f)}dispose(){return super.dispose(),this.oscillator.dispose(),this.envelope.dispose(),this}}class Ar extends Tr{constructor(){super(ui(Ar.getDefaults(),arguments)),this.name="ModulationSynth";const f=ui(Ar.getDefaults(),arguments);this._carrier=new kr({context:this.context,oscillator:f.oscillator,envelope:f.envelope,onsilence:()=>this.onsilence(this),volume:-10}),this._modulator=new kr({context:this.context,oscillator:f.modulation,envelope:f.modulationEnvelope,volume:-10}),this.oscillator=this._carrier.oscillator,this.envelope=this._carrier.envelope,this.modulation=this._modulator.oscillator,this.modulationEnvelope=this._modulator.envelope,this.frequency=new po({context:this.context,units:"frequency"}),this.detune=new po({context:this.context,value:f.detune,units:"cents"}),this.harmonicity=new Yo({context:this.context,value:f.harmonicity,minValue:0}),this._modulationNode=new ho({context:this.context,gain:0}),Oi(this,["frequency","harmonicity","oscillator","envelope","modulation","modulationEnvelope","detune"])}static getDefaults(){return Object.assign(Tr.getDefaults(),{harmonicity:3,oscillator:Object.assign(di(sr.getDefaults(),[...Object.keys(Po.getDefaults()),"frequency","detune"]),{type:"sine"}),envelope:Object.assign(di(xr.getDefaults(),Object.keys(io.getDefaults())),{attack:.01,decay:.01,sustain:1,release:.5}),modulation:Object.assign(di(sr.getDefaults(),[...Object.keys(Po.getDefaults()),"frequency","detune"]),{type:"square"}),modulationEnvelope:Object.assign(di(xr.getDefaults(),Object.keys(io.getDefaults())),{attack:.5,decay:0,sustain:1,release:.5})})}_triggerEnvelopeAttack(f,O){this._carrier._triggerEnvelopeAttack(f,O),this._modulator._triggerEnvelopeAttack(f,O)}_triggerEnvelopeRelease(f){return this._carrier._triggerEnvelopeRelease(f),this._modulator._triggerEnvelopeRelease(f),this}getLevelAtTime(f){return f=this.toSeconds(f),this.envelope.getValueAtTime(f)}dispose(){return super.dispose(),this._carrier.dispose(),this._modulator.dispose(),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._modulationNode.dispose(),this}}class Cr extends Ar{constructor(){super(ui(Cr.getDefaults(),arguments)),this.name="AMSynth",this._modulationScale=new Xo({context:this.context}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.detune.fan(this._carrier.detune,this._modulator.detune),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output)}dispose(){return super.dispose(),this._modulationScale.dispose(),this}}class Dr extends io{constructor(){super(ui(Dr.getDefaults(),arguments,["frequency","type"])),this.name="BiquadFilter";const f=ui(Dr.getDefaults(),arguments,["frequency","type"]);this._filter=this.context.createBiquadFilter(),this.input=this.output=this._filter,this.Q=new no({context:this.context,units:"number",value:f.Q,param:this._filter.Q}),this.frequency=new no({context:this.context,units:"frequency",value:f.frequency,param:this._filter.frequency}),this.detune=new no({context:this.context,units:"cents",value:f.detune,param:this._filter.detune}),this.gain=new no({context:this.context,units:"decibels",convert:!1,value:f.gain,param:this._filter.gain}),this.type=f.type}static getDefaults(){return Object.assign(io.getDefaults(),{Q:1,type:"lowpass",frequency:350,detune:0,gain:0})}get type(){return this._filter.type}set type(f){Bn(-1!==["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"].indexOf(f),`Invalid filter type: ${f}`),this._filter.type=f}getFrequencyResponse(f=128){const O=new Float32Array(f);for(let I=0;I<f;I++){const V=19980*Math.pow(I/f,2)+20;O[I]=V}const I=new Float32Array(f),V=new Float32Array(f),F=this.context.createBiquadFilter();return F.type=this.type,F.Q.value=this.Q.value,F.frequency.value=this.frequency.value,F.gain.value=this.gain.value,F.getFrequencyResponse(O,I,V),I}dispose(){return super.dispose(),this._filter.disconnect(),this.Q.dispose(),this.frequency.dispose(),this.gain.dispose(),this.detune.dispose(),this}}class Or extends io{constructor(){super(ui(Or.getDefaults(),arguments,["frequency","type","rolloff"])),this.name="Filter",this.input=new ho({context:this.context}),this.output=new ho({context:this.context}),this._filters=[];const f=ui(Or.getDefaults(),arguments,["frequency","type","rolloff"]);this._filters=[],this.Q=new po({context:this.context,units:"positive",value:f.Q}),this.frequency=new po({context:this.context,units:"frequency",value:f.frequency}),this.detune=new po({context:this.context,units:"cents",value:f.detune}),this.gain=new po({context:this.context,units:"decibels",convert:!1,value:f.gain}),this._type=f.type,this.rolloff=f.rolloff,Oi(this,["detune","frequency","gain","Q"])}static getDefaults(){return Object.assign(io.getDefaults(),{Q:1,detune:0,frequency:350,gain:0,rolloff:-12,type:"lowpass"})}get type(){return this._type}set type(f){Bn(-1!==["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"].indexOf(f),`Invalid filter type: ${f}`),this._type=f,this._filters.forEach((O=>O.type=f))}get rolloff(){return this._rolloff}set rolloff(f){const O=Nn(f)?f:parseInt(f,10),I=[-12,-24,-48,-96];let V=I.indexOf(O);Bn(-1!==V,`rolloff can only be ${I.join(", ")}`),V+=1,this._rolloff=O,this.input.disconnect(),this._filters.forEach((f=>f.disconnect())),this._filters=new Array(V);for(let f=0;f<V;f++){const O=new Dr({context:this.context});O.type=this._type,this.frequency.connect(O.frequency),this.detune.connect(O.detune),this.Q.connect(O.Q),this.gain.connect(O.gain),this._filters[f]=O}this._internalChannels=this._filters,oo(this.input,...this._internalChannels,this.output)}getFrequencyResponse(f=128){const O=new Dr({frequency:this.frequency.value,gain:this.gain.value,Q:this.Q.value,type:this._type,detune:this.detune.value}),I=new Float32Array(f).map((()=>1));return this._filters.forEach((()=>{O.getFrequencyResponse(f).forEach(((f,O)=>I[O]*=f))})),O.dispose(),I}dispose(){return super.dispose(),this._filters.forEach((f=>{f.dispose()})),Mi(this,["detune","frequency","gain","Q"]),this.frequency.dispose(),this.Q.dispose(),this.detune.dispose(),this.gain.dispose(),this}}class Mr extends xr{constructor(){super(ui(Mr.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="FrequencyEnvelope";const f=ui(Mr.getDefaults(),arguments,["attack","decay","sustain","release"]);this._octaves=f.octaves,this._baseFrequency=this.toFrequency(f.baseFrequency),this._exponent=this.input=new Fo({context:this.context,value:f.exponent}),this._scale=this.output=new ir({context:this.context,min:this._baseFrequency,max:this._baseFrequency*Math.pow(2,this._octaves)}),this._sig.chain(this._exponent,this._scale)}static getDefaults(){return Object.assign(xr.getDefaults(),{baseFrequency:200,exponent:1,octaves:4})}get baseFrequency(){return this._baseFrequency}set baseFrequency(f){const O=this.toFrequency(f);Un(O,0),this._baseFrequency=O,this._scale.min=this._baseFrequency,this.octaves=this._octaves}get octaves(){return this._octaves}set octaves(f){this._octaves=f,this._scale.max=this._baseFrequency*Math.pow(2,f)}get exponent(){return this._exponent.value}set exponent(f){this._exponent.value=f}dispose(){return super.dispose(),this._exponent.dispose(),this._scale.dispose(),this}}class Er extends Tr{constructor(){super(ui(Er.getDefaults(),arguments)),this.name="MonoSynth";const f=ui(Er.getDefaults(),arguments);this.oscillator=new sr(Object.assign(f.oscillator,{context:this.context,detune:f.detune,onstop:()=>this.onsilence(this)})),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.filter=new Or(Object.assign(f.filter,{context:this.context})),this.filterEnvelope=new Mr(Object.assign(f.filterEnvelope,{context:this.context})),this.envelope=new Sr(Object.assign(f.envelope,{context:this.context})),this.oscillator.chain(this.filter,this.envelope,this.output),this.filterEnvelope.connect(this.filter.frequency),Oi(this,["oscillator","frequency","detune","filter","filterEnvelope","envelope"])}static getDefaults(){return Object.assign(Tr.getDefaults(),{envelope:Object.assign(di(xr.getDefaults(),Object.keys(io.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.9}),filter:Object.assign(di(Or.getDefaults(),Object.keys(io.getDefaults())),{Q:1,rolloff:-12,type:"lowpass"}),filterEnvelope:Object.assign(di(Mr.getDefaults(),Object.keys(io.getDefaults())),{attack:.6,baseFrequency:200,decay:.2,exponent:2,octaves:3,release:2,sustain:.5}),oscillator:Object.assign(di(sr.getDefaults(),Object.keys(Po.getDefaults())),{type:"sawtooth"})})}_triggerEnvelopeAttack(f,O=1){if(this.envelope.triggerAttack(f,O),this.filterEnvelope.triggerAttack(f),this.oscillator.start(f),0===this.envelope.sustain){const O=this.toSeconds(this.envelope.attack),I=this.toSeconds(this.envelope.decay);this.oscillator.stop(f+O+I)}}_triggerEnvelopeRelease(f){this.envelope.triggerRelease(f),this.filterEnvelope.triggerRelease(f),this.oscillator.stop(f+this.toSeconds(this.envelope.release))}getLevelAtTime(f){return f=this.toSeconds(f),this.envelope.getValueAtTime(f)}dispose(){return super.dispose(),this.oscillator.dispose(),this.envelope.dispose(),this.filterEnvelope.dispose(),this.filter.dispose(),this}}class Rr extends Tr{constructor(){super(ui(Rr.getDefaults(),arguments)),this.name="DuoSynth";const f=ui(Rr.getDefaults(),arguments);this.voice0=new Er(Object.assign(f.voice0,{context:this.context,onsilence:()=>this.onsilence(this)})),this.voice1=new Er(Object.assign(f.voice1,{context:this.context})),this.harmonicity=new Yo({context:this.context,units:"positive",value:f.harmonicity}),this._vibrato=new rr({frequency:f.vibratoRate,context:this.context,min:-50,max:50}),this._vibrato.start(),this.vibratoRate=this._vibrato.frequency,this._vibratoGain=new ho({context:this.context,units:"normalRange",gain:f.vibratoAmount}),this.vibratoAmount=this._vibratoGain.gain,this.frequency=new po({context:this.context,units:"frequency",value:440}),this.detune=new po({context:this.context,units:"cents",value:f.detune}),this.frequency.connect(this.voice0.frequency),this.frequency.chain(this.harmonicity,this.voice1.frequency),this._vibrato.connect(this._vibratoGain),this._vibratoGain.fan(this.voice0.detune,this.voice1.detune),this.detune.fan(this.voice0.detune,this.voice1.detune),this.voice0.connect(this.output),this.voice1.connect(this.output),Oi(this,["voice0","voice1","frequency","vibratoAmount","vibratoRate"])}getLevelAtTime(f){return f=this.toSeconds(f),this.voice0.envelope.getValueAtTime(f)+this.voice1.envelope.getValueAtTime(f)}static getDefaults(){return li(Tr.getDefaults(),{vibratoAmount:.5,vibratoRate:5,harmonicity:1.5,voice0:li(di(Er.getDefaults(),Object.keys(Tr.getDefaults())),{filterEnvelope:{attack:.01,decay:0,sustain:1,release:.5},envelope:{attack:.01,decay:0,sustain:1,release:.5}}),voice1:li(di(Er.getDefaults(),Object.keys(Tr.getDefaults())),{filterEnvelope:{attack:.01,decay:0,sustain:1,release:.5},envelope:{attack:.01,decay:0,sustain:1,release:.5}})})}_triggerEnvelopeAttack(f,O){this.voice0._triggerEnvelopeAttack(f,O),this.voice1._triggerEnvelopeAttack(f,O)}_triggerEnvelopeRelease(f){return this.voice0._triggerEnvelopeRelease(f),this.voice1._triggerEnvelopeRelease(f),this}dispose(){return super.dispose(),this.voice0.dispose(),this.voice1.dispose(),this.frequency.dispose(),this.detune.dispose(),this._vibrato.dispose(),this.vibratoRate.dispose(),this._vibratoGain.dispose(),this.harmonicity.dispose(),this}}class qr extends Ar{constructor(){super(ui(qr.getDefaults(),arguments)),this.name="FMSynth";const f=ui(qr.getDefaults(),arguments);this.modulationIndex=new Yo({context:this.context,value:f.modulationIndex}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this.detune.fan(this._carrier.detune,this._modulator.detune),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output)}static getDefaults(){return Object.assign(Ar.getDefaults(),{modulationIndex:10})}dispose(){return super.dispose(),this.modulationIndex.dispose(),this}}const Dc=[1,1.483,1.932,2.546,2.63,3.897];class Ir extends Tr{constructor(){super(ui(Ir.getDefaults(),arguments)),this.name="MetalSynth",this._oscillators=[],this._freqMultipliers=[];const f=ui(Ir.getDefaults(),arguments);this.detune=new po({context:this.context,units:"cents",value:f.detune}),this.frequency=new po({context:this.context,units:"frequency"}),this._amplitude=new ho({context:this.context,gain:0}).connect(this.output),this._highpass=new Or({Q:0,context:this.context,type:"highpass"}).connect(this._amplitude);for(let O=0;O<Dc.length;O++){const I=new Ho({context:this.context,harmonicity:f.harmonicity,modulationIndex:f.modulationIndex,modulationType:"square",onstop:0===O?()=>this.onsilence(this):Ei,type:"square"});I.connect(this._highpass),this._oscillators[O]=I;const V=new Yo({context:this.context,value:Dc[O]});this._freqMultipliers[O]=V,this.frequency.chain(V,I.frequency),this.detune.connect(I.detune)}this._filterFreqScaler=new ir({context:this.context,max:7e3,min:this.toFrequency(f.resonance)}),this.envelope=new xr({attack:f.envelope.attack,attackCurve:"linear",context:this.context,decay:f.envelope.decay,release:f.envelope.release,sustain:0}),this.envelope.chain(this._filterFreqScaler,this._highpass.frequency),this.envelope.connect(this._amplitude.gain),this._octaves=f.octaves,this.octaves=f.octaves}static getDefaults(){return li(Tr.getDefaults(),{envelope:Object.assign(di(xr.getDefaults(),Object.keys(io.getDefaults())),{attack:.001,decay:1.4,release:.2}),harmonicity:5.1,modulationIndex:32,octaves:1.5,resonance:4e3})}_triggerEnvelopeAttack(f,O=1){return this.envelope.triggerAttack(f,O),this._oscillators.forEach((O=>O.start(f))),0===this.envelope.sustain&&this._oscillators.forEach((O=>{O.stop(f+this.toSeconds(this.envelope.attack)+this.toSeconds(this.envelope.decay))})),this}_triggerEnvelopeRelease(f){return this.envelope.triggerRelease(f),this._oscillators.forEach((O=>O.stop(f+this.toSeconds(this.envelope.release)))),this}getLevelAtTime(f){return f=this.toSeconds(f),this.envelope.getValueAtTime(f)}get modulationIndex(){return this._oscillators[0].modulationIndex.value}set modulationIndex(f){this._oscillators.forEach((O=>O.modulationIndex.value=f))}get harmonicity(){return this._oscillators[0].harmonicity.value}set harmonicity(f){this._oscillators.forEach((O=>O.harmonicity.value=f))}get resonance(){return this._filterFreqScaler.min}set resonance(f){this._filterFreqScaler.min=this.toFrequency(f),this.octaves=this._octaves}get octaves(){return this._octaves}set octaves(f){this._octaves=f,this._filterFreqScaler.max=this._filterFreqScaler.min*Math.pow(2,f)}dispose(){return super.dispose(),this._oscillators.forEach((f=>f.dispose())),this._freqMultipliers.forEach((f=>f.dispose())),this.frequency.dispose(),this.detune.dispose(),this._filterFreqScaler.dispose(),this._amplitude.dispose(),this.envelope.dispose(),this._highpass.dispose(),this}}class Vr extends kr{constructor(){super(ui(Vr.getDefaults(),arguments)),this.name="MembraneSynth",this.portamento=0;const f=ui(Vr.getDefaults(),arguments);this.pitchDecay=f.pitchDecay,this.octaves=f.octaves,Oi(this,["oscillator","envelope"])}static getDefaults(){return li(Tr.getDefaults(),kr.getDefaults(),{envelope:{attack:.001,attackCurve:"exponential",decay:.4,release:1.4,sustain:.01},octaves:10,oscillator:{type:"sine"},pitchDecay:.05})}setNote(f,O){const I=this.toSeconds(O),V=this.toFrequency(f instanceof Yi?f.toFrequency():f),F=V*this.octaves;return this.oscillator.frequency.setValueAtTime(F,I),this.oscillator.frequency.exponentialRampToValueAtTime(V,I+this.toSeconds(this.pitchDecay)),this}dispose(){return super.dispose(),this}}si([ar(0)],Vr.prototype,"octaves",void 0),si([cr(0)],Vr.prototype,"pitchDecay",void 0);class Nr extends br{constructor(){super(ui(Nr.getDefaults(),arguments)),this.name="NoiseSynth";const f=ui(Nr.getDefaults(),arguments);this.noise=new Lo(Object.assign({context:this.context},f.noise)),this.envelope=new Sr(Object.assign({context:this.context},f.envelope)),this.noise.chain(this.envelope,this.output)}static getDefaults(){return Object.assign(br.getDefaults(),{envelope:Object.assign(di(xr.getDefaults(),Object.keys(io.getDefaults())),{decay:.1,sustain:0}),noise:Object.assign(di(Lo.getDefaults(),Object.keys(Po.getDefaults())),{type:"white"})})}triggerAttack(f,O=1){return f=this.toSeconds(f),this.envelope.triggerAttack(f,O),this.noise.start(f),0===this.envelope.sustain&&this.noise.stop(f+this.toSeconds(this.envelope.attack)+this.toSeconds(this.envelope.decay)),this}triggerRelease(f){return f=this.toSeconds(f),this.envelope.triggerRelease(f),this.noise.stop(f+this.toSeconds(this.envelope.release)),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",0),this._syncMethod("triggerRelease",0)),this}triggerAttackRelease(f,O,I=1){return O=this.toSeconds(O),f=this.toSeconds(f),this.triggerAttack(O,I),this.triggerRelease(O+f),this}dispose(){return super.dispose(),this.noise.dispose(),this.envelope.dispose(),this}}const Mc=new Set;function jr(f){Mc.add(f)}function Lr(f,O){const I=`registerProcessor("${f}", ${O})`;Mc.add(I)}class zr extends io{constructor(f){super(f),this.name="ToneAudioWorklet",this.workletOptions={},this.onprocessorerror=Ei;const O=URL.createObjectURL(new Blob([Array.from(Mc).join("\n")],{type:"text/javascript"})),I=this._audioWorkletName();this._dummyGain=this.context.createGain(),this._dummyParam=this._dummyGain.gain,this.context.addAudioWorkletModule(O).then((()=>{this.disposed||(this._worklet=this.context.createAudioWorkletNode(I,this.workletOptions),this._worklet.onprocessorerror=this.onprocessorerror.bind(this),this.onReady(this._worklet))}))}dispose(){return super.dispose(),this._dummyGain.disconnect(),this._worklet&&(this._worklet.port.postMessage("dispose"),this._worklet.disconnect()),this}}jr('\n\t/**\n\t * The base AudioWorkletProcessor for use in Tone.js. Works with the {@link ToneAudioWorklet}. \n\t */\n\tclass ToneAudioWorkletProcessor extends AudioWorkletProcessor {\n\n\t\tconstructor(options) {\n\t\t\t\n\t\t\tsuper(options);\n\t\t\t/**\n\t\t\t * If the processor was disposed or not. Keep alive until it\'s disposed.\n\t\t\t */\n\t\t\tthis.disposed = false;\n\t\t   \t/** \n\t\t\t * The number of samples in the processing block\n\t\t\t */\n\t\t\tthis.blockSize = 128;\n\t\t\t/**\n\t\t\t * the sample rate\n\t\t\t */\n\t\t\tthis.sampleRate = sampleRate;\n\n\t\t\tthis.port.onmessage = (event) => {\n\t\t\t\t// when it receives a dispose \n\t\t\t\tif (event.data === "dispose") {\n\t\t\t\t\tthis.disposed = true;\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t}\n'),jr("\n\t/**\n\t * Abstract class for a single input/output processor. \n\t * has a 'generate' function which processes one sample at a time\n\t */\n\tclass SingleIOProcessor extends ToneAudioWorkletProcessor {\n\n\t\tconstructor(options) {\n\t\t\tsuper(Object.assign(options, {\n\t\t\t\tnumberOfInputs: 1,\n\t\t\t\tnumberOfOutputs: 1\n\t\t\t}));\n\t\t\t/**\n\t\t\t * Holds the name of the parameter and a single value of that\n\t\t\t * parameter at the current sample\n\t\t\t * @type { [name: string]: number }\n\t\t\t */\n\t\t\tthis.params = {}\n\t\t}\n\n\t\t/**\n\t\t * Generate an output sample from the input sample and parameters\n\t\t * @abstract\n\t\t * @param input number\n\t\t * @param channel number\n\t\t * @param parameters { [name: string]: number }\n\t\t * @returns number\n\t\t */\n\t\tgenerate(){}\n\n\t\t/**\n\t\t * Update the private params object with the \n\t\t * values of the parameters at the given index\n\t\t * @param parameters { [name: string]: Float32Array },\n\t\t * @param index number\n\t\t */\n\t\tupdateParams(parameters, index) {\n\t\t\tfor (const paramName in parameters) {\n\t\t\t\tconst param = parameters[paramName];\n\t\t\t\tif (param.length > 1) {\n\t\t\t\t\tthis.params[paramName] = parameters[paramName][index];\n\t\t\t\t} else {\n\t\t\t\t\tthis.params[paramName] = parameters[paramName][0];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Process a single frame of the audio\n\t\t * @param inputs Float32Array[][]\n\t\t * @param outputs Float32Array[][]\n\t\t */\n\t\tprocess(inputs, outputs, parameters) {\n\t\t\tconst input = inputs[0];\n\t\t\tconst output = outputs[0];\n\t\t\t// get the parameter values\n\t\t\tconst channelCount = Math.max(input && input.length || 0, output.length);\n\t\t\tfor (let sample = 0; sample < this.blockSize; sample++) {\n\t\t\t\tthis.updateParams(parameters, sample);\n\t\t\t\tfor (let channel = 0; channel < channelCount; channel++) {\n\t\t\t\t\tconst inputSample = input && input.length ? input[channel][sample] : 0;\n\t\t\t\t\toutput[channel][sample] = this.generate(inputSample, channel, this.params);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn !this.disposed;\n\t\t}\n\t};\n"),jr("\n\t/**\n\t * A multichannel buffer for use within an AudioWorkletProcessor as a delay line\n\t */\n\tclass DelayLine {\n\t\t\n\t\tconstructor(size, channels) {\n\t\t\tthis.buffer = [];\n\t\t\tthis.writeHead = []\n\t\t\tthis.size = size;\n\n\t\t\t// create the empty channels\n\t\t\tfor (let i = 0; i < channels; i++) {\n\t\t\t\tthis.buffer[i] = new Float32Array(this.size);\n\t\t\t\tthis.writeHead[i] = 0;\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Push a value onto the end\n\t\t * @param channel number\n\t\t * @param value number\n\t\t */\n\t\tpush(channel, value) {\n\t\t\tthis.writeHead[channel] += 1;\n\t\t\tif (this.writeHead[channel] > this.size) {\n\t\t\t\tthis.writeHead[channel] = 0;\n\t\t\t}\n\t\t\tthis.buffer[channel][this.writeHead[channel]] = value;\n\t\t}\n\n\t\t/**\n\t\t * Get the recorded value of the channel given the delay\n\t\t * @param channel number\n\t\t * @param delay number delay samples\n\t\t */\n\t\tget(channel, delay) {\n\t\t\tlet readHead = this.writeHead[channel] - Math.floor(delay);\n\t\t\tif (readHead < 0) {\n\t\t\t\treadHead += this.size;\n\t\t\t}\n\t\t\treturn this.buffer[channel][readHead];\n\t\t}\n\t}\n");const Rc="feedback-comb-filter";Lr(Rc,'\n\tclass FeedbackCombFilterWorklet extends SingleIOProcessor {\n\n\t\tconstructor(options) {\n\t\t\tsuper(options);\n\t\t\tthis.delayLine = new DelayLine(this.sampleRate, options.channelCount || 2);\n\t\t}\n\n\t\tstatic get parameterDescriptors() {\n\t\t\treturn [{\n\t\t\t\tname: "delayTime",\n\t\t\t\tdefaultValue: 0.1,\n\t\t\t\tminValue: 0,\n\t\t\t\tmaxValue: 1,\n\t\t\t\tautomationRate: "k-rate"\n\t\t\t}, {\n\t\t\t\tname: "feedback",\n\t\t\t\tdefaultValue: 0.5,\n\t\t\t\tminValue: 0,\n\t\t\t\tmaxValue: 0.9999,\n\t\t\t\tautomationRate: "k-rate"\n\t\t\t}];\n\t\t}\n\n\t\tgenerate(input, channel, parameters) {\n\t\t\tconst delayedSample = this.delayLine.get(channel, parameters.delayTime * this.sampleRate);\n\t\t\tthis.delayLine.push(channel, input + delayedSample * parameters.feedback);\n\t\t\treturn delayedSample;\n\t\t}\n\t}\n');class Br extends zr{constructor(){super(ui(Br.getDefaults(),arguments,["delayTime","resonance"])),this.name="FeedbackCombFilter";const f=ui(Br.getDefaults(),arguments,["delayTime","resonance"]);this.input=new ho({context:this.context}),this.output=new ho({context:this.context}),this.delayTime=new no({context:this.context,value:f.delayTime,units:"time",minValue:0,maxValue:1,param:this._dummyParam,swappable:!0}),this.resonance=new no({context:this.context,value:f.resonance,units:"normalRange",param:this._dummyParam,swappable:!0}),Oi(this,["resonance","delayTime"])}_audioWorkletName(){return Rc}static getDefaults(){return Object.assign(io.getDefaults(),{delayTime:.1,resonance:.5})}onReady(f){oo(this.input,f,this.output);const O=f.parameters.get("delayTime");this.delayTime.setParam(O);const I=f.parameters.get("feedback");this.resonance.setParam(I)}dispose(){return super.dispose(),this.input.dispose(),this.output.dispose(),this.delayTime.dispose(),this.resonance.dispose(),this}}class Ur extends io{constructor(){super(ui(Ur.getDefaults(),arguments,["frequency","type"])),this.name="OnePoleFilter";const f=ui(Ur.getDefaults(),arguments,["frequency","type"]);this._frequency=f.frequency,this._type=f.type,this.input=new ho({context:this.context}),this.output=new ho({context:this.context}),this._createFilter()}static getDefaults(){return Object.assign(io.getDefaults(),{frequency:880,type:"lowpass"})}_createFilter(){const f=this._filter,O=this.toFrequency(this._frequency),I=1/(2*Math.PI*O);if("lowpass"===this._type){const f=1/(I*this.context.sampleRate),O=f-1;this._filter=this.context.createIIRFilter([f,0],[1,O])}else{const f=1/(I*this.context.sampleRate)-1;this._filter=this.context.createIIRFilter([1,-1],[1,f])}this.input.chain(this._filter,this.output),f&&this.context.setTimeout((()=>{this.disposed||(this.input.disconnect(f),f.disconnect())}),this.blockTime)}get frequency(){return this._frequency}set frequency(f){this._frequency=f,this._createFilter()}get type(){return this._type}set type(f){this._type=f,this._createFilter()}getFrequencyResponse(f=128){const O=new Float32Array(f);for(let I=0;I<f;I++){const V=19980*Math.pow(I/f,2)+20;O[I]=V}const I=new Float32Array(f),V=new Float32Array(f);return this._filter.getFrequencyResponse(O,I,V),I}dispose(){return super.dispose(),this.input.dispose(),this.output.dispose(),this._filter.disconnect(),this}}class Gr extends io{constructor(){super(ui(Gr.getDefaults(),arguments,["delayTime","resonance","dampening"])),this.name="LowpassCombFilter";const f=ui(Gr.getDefaults(),arguments,["delayTime","resonance","dampening"]);this._combFilter=this.output=new Br({context:this.context,delayTime:f.delayTime,resonance:f.resonance}),this.delayTime=this._combFilter.delayTime,this.resonance=this._combFilter.resonance,this._lowpass=this.input=new Ur({context:this.context,frequency:f.dampening,type:"lowpass"}),this._lowpass.connect(this._combFilter)}static getDefaults(){return Object.assign(io.getDefaults(),{dampening:3e3,delayTime:.1,resonance:.5})}get dampening(){return this._lowpass.frequency}set dampening(f){this._lowpass.frequency=f}dispose(){return super.dispose(),this._combFilter.dispose(),this._lowpass.dispose(),this}}class Qr extends br{constructor(){super(ui(Qr.getDefaults(),arguments)),this.name="PluckSynth";const f=ui(Qr.getDefaults(),arguments);this._noise=new Lo({context:this.context,type:"pink"}),this.attackNoise=f.attackNoise,this._lfcf=new Gr({context:this.context,dampening:f.dampening,resonance:f.resonance}),this.resonance=f.resonance,this.release=f.release,this._noise.connect(this._lfcf),this._lfcf.connect(this.output)}static getDefaults(){return li(br.getDefaults(),{attackNoise:1,dampening:4e3,resonance:.7,release:1})}get dampening(){return this._lfcf.dampening}set dampening(f){this._lfcf.dampening=f}triggerAttack(f,O){const I=this.toFrequency(f);O=this.toSeconds(O);const V=1/I;return this._lfcf.delayTime.setValueAtTime(V,O),this._noise.start(O),this._noise.stop(O+V*this.attackNoise),this._lfcf.resonance.cancelScheduledValues(O),this._lfcf.resonance.setValueAtTime(this.resonance,O),this}triggerRelease(f){return this._lfcf.resonance.linearRampTo(0,this.release,f),this}dispose(){return super.dispose(),this._noise.dispose(),this._lfcf.dispose(),this}}class Zr extends br{constructor(){super(ui(Zr.getDefaults(),arguments,["voice","options"])),this.name="PolySynth",this._availableVoices=[],this._activeVoices=[],this._voices=[],this._gcTimeout=-1,this._averageActiveVoices=0,this._syncedRelease=f=>this.releaseAll(f);const f=ui(Zr.getDefaults(),arguments,["voice","options"]);Bn(!Nn(f.voice),"DEPRECATED: The polyphony count is no longer the first argument.");const O=f.voice.getDefaults();this.options=Object.assign(O,f.options),this.voice=f.voice,this.maxPolyphony=f.maxPolyphony,this._dummyVoice=this._getNextAvailableVoice();const I=this._voices.indexOf(this._dummyVoice);this._voices.splice(I,1),this._gcTimeout=this.context.setInterval(this._collectGarbage.bind(this),1)}static getDefaults(){return Object.assign(br.getDefaults(),{maxPolyphony:32,options:{},voice:kr})}get activeVoices(){return this._activeVoices.length}_makeVoiceAvailable(f){this._availableVoices.push(f);const O=this._activeVoices.findIndex((O=>O.voice===f));this._activeVoices.splice(O,1)}_getNextAvailableVoice(){if(this._availableVoices.length)return this._availableVoices.shift();if(this._voices.length<this.maxPolyphony){const f=new this.voice(Object.assign(this.options,{context:this.context,onsilence:this._makeVoiceAvailable.bind(this)}));return Bn(f instanceof Tr,"Voice must extend Monophonic class"),f.connect(this.output),this._voices.push(f),f}Kn("Max polyphony exceeded. Note dropped.")}_collectGarbage(){if(this._averageActiveVoices=Math.max(.95*this._averageActiveVoices,this.activeVoices),this._availableVoices.length&&this._voices.length>Math.ceil(this._averageActiveVoices+1)){const f=this._availableVoices.shift(),O=this._voices.indexOf(f);this._voices.splice(O,1),this.context.isOffline||f.dispose()}}_triggerAttack(f,O,I){f.forEach((f=>{const V=new bo(this.context,f).toMidi(),F=this._getNextAvailableVoice();F&&(F.triggerAttack(f,O,I),this._activeVoices.push({midi:V,voice:F,released:!1}),this.log("triggerAttack",f,O))}))}_triggerRelease(f,O){f.forEach((f=>{const I=new bo(this.context,f).toMidi(),V=this._activeVoices.find((({midi:f,released:O})=>f===I&&!O));V&&(V.voice.triggerRelease(O),V.released=!0,this.log("triggerRelease",f,O))}))}_scheduleEvent(f,O,I,V){Bn(!this.disposed,"Synth was already disposed"),I<=this.now()?"attack"===f?this._triggerAttack(O,I,V):this._triggerRelease(O,I):this.context.setTimeout((()=>{this.disposed||this._scheduleEvent(f,O,I,V)}),I-this.now())}triggerAttack(f,O,I){Array.isArray(f)||(f=[f]);const V=this.toSeconds(O);return this._scheduleEvent("attack",f,V,I),this}triggerRelease(f,O){Array.isArray(f)||(f=[f]);const I=this.toSeconds(O);return this._scheduleEvent("release",f,I),this}triggerAttackRelease(f,O,I,V){const F=this.toSeconds(I);if(this.triggerAttack(f,F,V),Ln(O)){Bn(Ln(f),"If the duration is an array, the notes must also be an array");for(let I=0;I<f.length;I++){const V=O[Math.min(I,O.length-1)],P=this.toSeconds(V);Bn(P>0,"The duration must be greater than 0"),this.triggerRelease(f[I],F+P)}}else{const I=this.toSeconds(O);Bn(I>0,"The duration must be greater than 0"),this.triggerRelease(f,F+I)}return this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1),this.context.transport.on("stop",this._syncedRelease),this.context.transport.on("pause",this._syncedRelease),this.context.transport.on("loopEnd",this._syncedRelease)),this}set(f){const O=di(f,["onsilence","context"]);return this.options=li(this.options,O),this._voices.forEach((f=>f.set(O))),this._dummyVoice.set(O),this}get(){return this._dummyVoice.get()}releaseAll(f){const O=this.toSeconds(f);return this._activeVoices.forEach((({voice:f})=>{f.triggerRelease(O)})),this}dispose(){return super.dispose(),this._dummyVoice.dispose(),this._voices.forEach((f=>f.dispose())),this._activeVoices=[],this._availableVoices=[],this.context.clearInterval(this._gcTimeout),this}}class Xr extends br{constructor(){super(ui(Xr.getDefaults(),arguments,["urls","onload","baseUrl"],"urls")),this.name="Sampler",this._activeSources=new Map;const f=ui(Xr.getDefaults(),arguments,["urls","onload","baseUrl"],"urls"),O={};Object.keys(f.urls).forEach((I=>{const V=parseInt(I,10);if(Bn(Wn(I)||Nn(V)&&isFinite(V),`url key is neither a note or midi pitch: ${I}`),Wn(I)){const V=new Yi(this.context,I).toMidi();O[V]=f.urls[I]}else Nn(V)&&isFinite(V)&&(O[V]=f.urls[V])})),this._buffers=new wo({urls:O,onload:f.onload,baseUrl:f.baseUrl,onerror:f.onerror}),this.attack=f.attack,this.release=f.release,this.curve=f.curve,this._buffers.loaded&&Promise.resolve().then(f.onload)}static getDefaults(){return Object.assign(br.getDefaults(),{attack:0,baseUrl:"",curve:"exponential",onload:Ei,onerror:Ei,release:.1,urls:{}})}_findClosest(f){let O=0;for(;O<96;){if(this._buffers.has(f+O))return-O;if(this._buffers.has(f-O))return O;O++}throw new Error(`No available buffers for note: ${f}`)}triggerAttack(f,O,I=1){return this.log("triggerAttack",f,O,I),Array.isArray(f)||(f=[f]),f.forEach((f=>{const V=Ui(new Yi(this.context,f).toFrequency()),F=Math.round(V),P=V-F,ut=this._findClosest(F),mt=F-ut,gt=this._buffers.get(mt),vt=zi(ut+P),yt=new jo({url:gt,context:this.context,curve:this.curve,fadeIn:this.attack,fadeOut:this.release,playbackRate:vt}).connect(this.output);yt.start(O,0,gt.duration/vt,I),Ln(this._activeSources.get(F))||this._activeSources.set(F,[]),this._activeSources.get(F).push(yt),yt.onended=()=>{if(this._activeSources&&this._activeSources.has(F)){const f=this._activeSources.get(F),O=f.indexOf(yt);-1!==O&&f.splice(O,1)}}})),this}triggerRelease(f,O){return this.log("triggerRelease",f,O),Array.isArray(f)||(f=[f]),f.forEach((f=>{const I=new Yi(this.context,f).toMidi();if(this._activeSources.has(I)&&this._activeSources.get(I).length){const f=this._activeSources.get(I);O=this.toSeconds(O),f.forEach((f=>{f.stop(O)})),this._activeSources.set(I,[])}})),this}releaseAll(f){const O=this.toSeconds(f);return this._activeSources.forEach((f=>{for(;f.length;)f.shift().stop(O)})),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1)),this}triggerAttackRelease(f,O,I,V=1){const F=this.toSeconds(I);return this.triggerAttack(f,F,V),Ln(O)?(Bn(Ln(f),"notes must be an array when duration is array"),f.forEach(((f,I)=>{const V=O[Math.min(I,O.length-1)];this.triggerRelease(f,F+this.toSeconds(V))}))):this.triggerRelease(f,F+this.toSeconds(O)),this}add(f,O,I){if(Bn(Wn(f)||isFinite(f),`note must be a pitch or midi: ${f}`),Wn(f)){const V=new Yi(this.context,f).toMidi();this._buffers.add(V,O,I)}else this._buffers.add(f,O,I);return this}get loaded(){return this._buffers.loaded}dispose(){return super.dispose(),this._buffers.dispose(),this._activeSources.forEach((f=>{f.forEach((f=>f.dispose()))})),this._activeSources.clear(),this}}si([cr(0)],Xr.prototype,"attack",void 0),si([cr(0)],Xr.prototype,"release",void 0);class Yr extends eo{constructor(){super(ui(Yr.getDefaults(),arguments,["callback","value"])),this.name="ToneEvent",this._state=new so("stopped"),this._startOffset=0;const f=ui(Yr.getDefaults(),arguments,["callback","value"]);this._loop=f.loop,this.callback=f.callback,this.value=f.value,this._loopStart=this.toTicks(f.loopStart),this._loopEnd=this.toTicks(f.loopEnd),this._playbackRate=f.playbackRate,this._probability=f.probability,this._humanize=f.humanize,this.mute=f.mute,this._playbackRate=f.playbackRate,this._state.increasing=!0,this._rescheduleEvents()}static getDefaults(){return Object.assign(eo.getDefaults(),{callback:Ei,humanize:!1,loop:!1,loopEnd:"1m",loopStart:0,mute:!1,playbackRate:1,probability:1,value:null})}_rescheduleEvents(f=-1){this._state.forEachFrom(f,(f=>{let O;if("started"===f.state){-1!==f.id&&this.context.transport.clear(f.id);const I=f.time+Math.round(this.startOffset/this._playbackRate);if(!0===this._loop||Nn(this._loop)&&this._loop>1){O=1/0,Nn(this._loop)&&(O=this._loop*this._getLoopDuration());const V=this._state.getAfter(I);null!==V&&(O=Math.min(O,V.time-I)),O!==1/0&&(O=new So(this.context,O));const F=new So(this.context,this._getLoopDuration());f.id=this.context.transport.scheduleRepeat(this._tick.bind(this),F,new So(this.context,I),O)}else f.id=this.context.transport.schedule(this._tick.bind(this),new So(this.context,I))}}))}get state(){return this._state.getValueAtTime(this.context.transport.ticks)}get startOffset(){return this._startOffset}set startOffset(f){this._startOffset=f}get probability(){return this._probability}set probability(f){this._probability=f}get humanize(){return this._humanize}set humanize(f){this._humanize=f}start(f){const O=this.toTicks(f);return"stopped"===this._state.getValueAtTime(O)&&(this._state.add({id:-1,state:"started",time:O}),this._rescheduleEvents(O)),this}stop(f){this.cancel(f);const O=this.toTicks(f);if("started"===this._state.getValueAtTime(O)){this._state.setStateAtTime("stopped",O,{id:-1});const f=this._state.getBefore(O);let I=O;null!==f&&(I=f.time),this._rescheduleEvents(I)}return this}cancel(f){f=pi(f,-1/0);const O=this.toTicks(f);return this._state.forEachFrom(O,(f=>{this.context.transport.clear(f.id)})),this._state.cancel(O),this}_tick(f){const O=this.context.transport.getTicksAtTime(f);if(!this.mute&&"started"===this._state.getValueAtTime(O)){if(this.probability<1&&Math.random()>this.probability)return;if(this.humanize){let O=.02;jn(this.humanize)||(O=this.toSeconds(this.humanize)),f+=(2*Math.random()-1)*O}this.callback(f,this.value)}}_getLoopDuration(){return(this._loopEnd-this._loopStart)/this._playbackRate}get loop(){return this._loop}set loop(f){this._loop=f,this._rescheduleEvents()}get playbackRate(){return this._playbackRate}set playbackRate(f){this._playbackRate=f,this._rescheduleEvents()}get loopEnd(){return new So(this.context,this._loopEnd).toSeconds()}set loopEnd(f){this._loopEnd=this.toTicks(f),this._loop&&this._rescheduleEvents()}get loopStart(){return new So(this.context,this._loopStart).toSeconds()}set loopStart(f){this._loopStart=this.toTicks(f),this._loop&&this._rescheduleEvents()}get progress(){if(this._loop){const f=this.context.transport.ticks,O=this._state.get(f);if(null!==O&&"started"===O.state){const I=this._getLoopDuration();return(f-O.time)%I/I}return 0}return 0}dispose(){return super.dispose(),this.cancel(),this._state.dispose(),this}}class $r extends eo{constructor(){super(ui($r.getDefaults(),arguments,["callback","interval"])),this.name="Loop";const f=ui($r.getDefaults(),arguments,["callback","interval"]);this._event=new Yr({context:this.context,callback:this._tick.bind(this),loop:!0,loopEnd:f.interval,playbackRate:f.playbackRate,probability:f.probability,humanize:f.humanize}),this.callback=f.callback,this.iterations=f.iterations}static getDefaults(){return Object.assign(eo.getDefaults(),{interval:"4n",callback:Ei,playbackRate:1,iterations:1/0,probability:1,mute:!1,humanize:!1})}start(f){return this._event.start(f),this}stop(f){return this._event.stop(f),this}cancel(f){return this._event.cancel(f),this}_tick(f){this.callback(f)}get state(){return this._event.state}get progress(){return this._event.progress}get interval(){return this._event.loopEnd}set interval(f){this._event.loopEnd=f}get playbackRate(){return this._event.playbackRate}set playbackRate(f){this._event.playbackRate=f}get humanize(){return this._event.humanize}set humanize(f){this._event.humanize=f}get probability(){return this._event.probability}set probability(f){this._event.probability=f}get mute(){return this._event.mute}set mute(f){this._event.mute=f}get iterations(){return!0===this._event.loop?1/0:this._event.loop}set iterations(f){this._event.loop=f===1/0||f}dispose(){return super.dispose(),this._event.dispose(),this}}class Hr extends Yr{constructor(){super(ui(Hr.getDefaults(),arguments,["callback","events"])),this.name="Part",this._state=new so("stopped"),this._events=new Set;const f=ui(Hr.getDefaults(),arguments,["callback","events"]);this._state.increasing=!0,f.events.forEach((f=>{Ln(f)?this.add(f[0],f[1]):this.add(f)}))}static getDefaults(){return Object.assign(Yr.getDefaults(),{events:[]})}start(f,O){const I=this.toTicks(f);if("started"!==this._state.getValueAtTime(I)){O=pi(O,this._loop?this._loopStart:0),O=this._loop?pi(O,this._loopStart):pi(O,0);const f=this.toTicks(O);this._state.add({id:-1,offset:f,state:"started",time:I}),this._forEach((O=>{this._startNote(O,I,f)}))}return this}_startNote(f,O,I){O-=I,this._loop?f.startOffset>=this._loopStart&&f.startOffset<this._loopEnd?(f.startOffset<I&&(O+=this._getLoopDuration()),f.start(new So(this.context,O))):f.startOffset<this._loopStart&&f.startOffset>=I&&(f.loop=!1,f.start(new So(this.context,O))):f.startOffset>=I&&f.start(new So(this.context,O))}get startOffset(){return this._startOffset}set startOffset(f){this._startOffset=f,this._forEach((f=>{f.startOffset+=this._startOffset}))}stop(f){const O=this.toTicks(f);return this._state.cancel(O),this._state.setStateAtTime("stopped",O),this._forEach((O=>{O.stop(f)})),this}at(f,O){const I=new Ki(this.context,f).toTicks(),V=new So(this.context,1).toSeconds(),F=this._events.values();let P=F.next();for(;!P.done;){const f=P.value;if(Math.abs(I-f.startOffset)<V)return In(O)&&(f.value=O),f;P=F.next()}return In(O)?(this.add(f,O),this.at(f)):null}add(f,O){f instanceof Object&&Reflect.has(f,"time")&&(f=(O=f).time);const I=this.toTicks(f);let V;return O instanceof Yr?(V=O,V.callback=this._tick.bind(this)):V=new Yr({callback:this._tick.bind(this),context:this.context,value:O}),V.startOffset=I,V.set({humanize:this.humanize,loop:this.loop,loopEnd:this.loopEnd,loopStart:this.loopStart,playbackRate:this.playbackRate,probability:this.probability}),this._events.add(V),this._restartEvent(V),this}_restartEvent(f){this._state.forEach((O=>{"started"===O.state?this._startNote(f,O.time,O.offset):f.stop(new So(this.context,O.time))}))}remove(f,O){return Pn(f)&&f.hasOwnProperty("time")&&(f=(O=f).time),f=this.toTicks(f),this._events.forEach((I=>{I.startOffset===f&&(Fn(O)||In(O)&&I.value===O)&&(this._events.delete(I),I.dispose())})),this}clear(){return this._forEach((f=>f.dispose())),this._events.clear(),this}cancel(f){return this._forEach((O=>O.cancel(f))),this._state.cancel(this.toTicks(f)),this}_forEach(f){return this._events&&this._events.forEach((O=>{O instanceof Hr?O._forEach(f):f(O)})),this}_setAll(f,O){this._forEach((I=>{I[f]=O}))}_tick(f,O){this.mute||this.callback(f,O)}_testLoopBoundries(f){this._loop&&(f.startOffset<this._loopStart||f.startOffset>=this._loopEnd)?f.cancel(0):"stopped"===f.state&&this._restartEvent(f)}get probability(){return this._probability}set probability(f){this._probability=f,this._setAll("probability",f)}get humanize(){return this._humanize}set humanize(f){this._humanize=f,this._setAll("humanize",f)}get loop(){return this._loop}set loop(f){this._loop=f,this._forEach((O=>{O.loopStart=this.loopStart,O.loopEnd=this.loopEnd,O.loop=f,this._testLoopBoundries(O)}))}get loopEnd(){return new So(this.context,this._loopEnd).toSeconds()}set loopEnd(f){this._loopEnd=this.toTicks(f),this._loop&&this._forEach((O=>{O.loopEnd=f,this._testLoopBoundries(O)}))}get loopStart(){return new So(this.context,this._loopStart).toSeconds()}set loopStart(f){this._loopStart=this.toTicks(f),this._loop&&this._forEach((f=>{f.loopStart=this.loopStart,this._testLoopBoundries(f)}))}get playbackRate(){return this._playbackRate}set playbackRate(f){this._playbackRate=f,this._setAll("playbackRate",f)}get length(){return this._events.size}dispose(){return super.dispose(),this.clear(),this}}function*Jr(f){let O=0;for(;O<f;)O=xi(O,0,f-1),yield O,O++}function*Kr(f){let O=f-1;for(;O>=0;)O=xi(O,0,f-1),yield O,O--}function*ta(f,O){for(;;)yield*O(f)}function*ea(f,O){let I=O?0:f-1;for(;;)I=xi(I,0,f-1),yield I,O?(I++,I>=f-1&&(O=!1)):(I--,I<=0&&(O=!0))}function*sa(f){let O=0,I=0;for(;O<f;)O=xi(O,0,f-1),yield O,I++,O+=I%2?2:-1}function*na(f){let O=f-1,I=0;for(;O>=0;)O=xi(O,0,f-1),yield O,I++,O+=I%2?-2:1}function*ia(f){const O=[];for(let I=0;I<f;I++)O.push(I);for(;O.length>0;){const I=xi(O.splice(Math.floor(O.length*Math.random()),1)[0],0,f-1);yield I}}function*oa(f,O="up",I=0){switch(Bn(f>=1,"The number of values must be at least one"),O){case"up":yield*ta(f,Jr);case"down":yield*ta(f,Kr);case"upDown":yield*ea(f,!0);case"downUp":yield*ea(f,!1);case"alternateUp":yield*ta(f,sa);case"alternateDown":yield*ta(f,na);case"random":yield*function*(f){for(;;){const O=Math.floor(Math.random()*f);yield O}}(f);case"randomOnce":yield*ta(f,ia);case"randomWalk":yield*function*(f){let O=Math.floor(Math.random()*f);for(;;)0===O?O++:O===f-1||Math.random()<.5?O--:O++,yield O}(f)}}class ra extends $r{constructor(){super(ui(ra.getDefaults(),arguments,["callback","values","pattern"])),this.name="Pattern";const f=ui(ra.getDefaults(),arguments,["callback","values","pattern"]);this.callback=f.callback,this._values=f.values,this._pattern=oa(f.values.length,f.pattern),this._type=f.pattern}static getDefaults(){return Object.assign($r.getDefaults(),{pattern:"up",values:[],callback:Ei})}_tick(f){const O=this._pattern.next();this._index=O.value,this._value=this._values[O.value],this.callback(f,this._value)}get values(){return this._values}set values(f){this._values=f,this.pattern=this._type}get value(){return this._value}get index(){return this._index}get pattern(){return this._type}set pattern(f){this._type=f,this._pattern=oa(this._values.length,this._type)}}class aa extends Yr{constructor(){super(ui(aa.getDefaults(),arguments,["callback","events","subdivision"])),this.name="Sequence",this._part=new Hr({callback:this._seqCallback.bind(this),context:this.context}),this._events=[],this._eventsArray=[];const f=ui(aa.getDefaults(),arguments,["callback","events","subdivision"]);this._subdivision=this.toTicks(f.subdivision),this.events=f.events,this.loop=f.loop,this.loopStart=f.loopStart,this.loopEnd=f.loopEnd,this.playbackRate=f.playbackRate,this.probability=f.probability,this.humanize=f.humanize,this.mute=f.mute,this.playbackRate=f.playbackRate}static getDefaults(){return Object.assign(di(Yr.getDefaults(),["value"]),{events:[],loop:!0,loopEnd:0,loopStart:0,subdivision:"8n"})}_seqCallback(f,O){null===O||this.mute||this.callback(f,O)}get events(){return this._events}set events(f){this.clear(),this._eventsArray=f,this._events=this._createSequence(this._eventsArray),this._eventsUpdated()}start(f,O){return this._part.start(f,O?this._indexTime(O):O),this}stop(f){return this._part.stop(f),this}get subdivision(){return new So(this.context,this._subdivision).toSeconds()}_createSequence(f){return new Proxy(f,{get:(f,O)=>f[O],set:(f,O,I)=>(zn(O)&&isFinite(parseInt(O,10))&&Ln(I)?f[O]=this._createSequence(I):f[O]=I,this._eventsUpdated(),!0)})}_eventsUpdated(){this._part.clear(),this._rescheduleSequence(this._eventsArray,this._subdivision,this.startOffset),this.loopEnd=this.loopEnd}_rescheduleSequence(f,O,I){f.forEach(((f,V)=>{const F=V*O+I;if(Ln(f))this._rescheduleSequence(f,O/f.length,F);else{const O=new So(this.context,F,"i").toSeconds();this._part.add(O,f)}}))}_indexTime(f){return new So(this.context,f*this._subdivision+this.startOffset).toSeconds()}clear(){return this._part.clear(),this}dispose(){return super.dispose(),this._part.dispose(),this}get loop(){return this._part.loop}set loop(f){this._part.loop=f}get loopStart(){return this._loopStart}set loopStart(f){this._loopStart=f,this._part.loopStart=this._indexTime(f)}get loopEnd(){return this._loopEnd}set loopEnd(f){this._loopEnd=f,this._part.loopEnd=0===f?this._indexTime(this._eventsArray.length):this._indexTime(f)}get startOffset(){return this._part.startOffset}set startOffset(f){this._part.startOffset=f}get playbackRate(){return this._part.playbackRate}set playbackRate(f){this._part.playbackRate=f}get probability(){return this._part.probability}set probability(f){this._part.probability=f}get progress(){return this._part.progress}get humanize(){return this._part.humanize}set humanize(f){this._part.humanize=f}get length(){return this._part.length}}class ca extends io{constructor(){super(Object.assign(ui(ca.getDefaults(),arguments,["fade"]))),this.name="CrossFade",this._panner=this.context.createStereoPanner(),this._split=this.context.createChannelSplitter(2),this._g2a=new dr({context:this.context}),this.a=new ho({context:this.context,gain:0}),this.b=new ho({context:this.context,gain:0}),this.output=new ho({context:this.context}),this._internalChannels=[this.a,this.b];const f=ui(ca.getDefaults(),arguments,["fade"]);this.fade=new po({context:this.context,units:"normalRange",value:f.fade}),Oi(this,"fade"),this.context.getConstant(1).connect(this._panner),this._panner.connect(this._split),this._panner.channelCount=1,this._panner.channelCountMode="explicit",ro(this._split,this.a.gain,0),ro(this._split,this.b.gain,1),this.fade.chain(this._g2a,this._panner.pan),this.a.connect(this.output),this.b.connect(this.output)}static getDefaults(){return Object.assign(io.getDefaults(),{fade:.5})}dispose(){return super.dispose(),this.a.dispose(),this.b.dispose(),this.output.dispose(),this.fade.dispose(),this._g2a.dispose(),this._panner.disconnect(),this._split.disconnect(),this}}class ha extends io{constructor(f){super(f),this.name="Effect",this._dryWet=new ca({context:this.context}),this.wet=this._dryWet.fade,this.effectSend=new ho({context:this.context}),this.effectReturn=new ho({context:this.context}),this.input=new ho({context:this.context}),this.output=this._dryWet,this.input.fan(this._dryWet.a,this.effectSend),this.effectReturn.connect(this._dryWet.b),this.wet.setValueAtTime(f.wet,0),this._internalChannels=[this.effectReturn,this.effectSend],Oi(this,"wet")}static getDefaults(){return Object.assign(io.getDefaults(),{wet:1})}connectEffect(f){return this._internalChannels.push(f),this.effectSend.chain(f,this.effectReturn),this}dispose(){return super.dispose(),this._dryWet.dispose(),this.effectSend.dispose(),this.effectReturn.dispose(),this.wet.dispose(),this}}class la extends ha{constructor(f){super(f),this.name="LFOEffect",this._lfo=new rr({context:this.context,frequency:f.frequency,amplitude:f.depth}),this.depth=this._lfo.amplitude,this.frequency=this._lfo.frequency,this.type=f.type,Oi(this,["frequency","depth"])}static getDefaults(){return Object.assign(ha.getDefaults(),{frequency:1,type:"sine",depth:1})}start(f){return this._lfo.start(f),this}stop(f){return this._lfo.stop(f),this}sync(){return this._lfo.sync(),this}unsync(){return this._lfo.unsync(),this}get type(){return this._lfo.type}set type(f){this._lfo.type=f}dispose(){return super.dispose(),this._lfo.dispose(),this.frequency.dispose(),this.depth.dispose(),this}}class ua extends la{constructor(){super(ui(ua.getDefaults(),arguments,["frequency","baseFrequency","octaves"])),this.name="AutoFilter";const f=ui(ua.getDefaults(),arguments,["frequency","baseFrequency","octaves"]);this.filter=new Or(Object.assign(f.filter,{context:this.context})),this.connectEffect(this.filter),this._lfo.connect(this.filter.frequency),this.octaves=f.octaves,this.baseFrequency=f.baseFrequency}static getDefaults(){return Object.assign(la.getDefaults(),{baseFrequency:200,octaves:2.6,filter:{type:"lowpass",rolloff:-12,Q:1}})}get baseFrequency(){return this._lfo.min}set baseFrequency(f){this._lfo.min=this.toFrequency(f),this.octaves=this._octaves}get octaves(){return this._octaves}set octaves(f){this._octaves=f,this._lfo.max=this._lfo.min*Math.pow(2,f)}dispose(){return super.dispose(),this.filter.dispose(),this}}class pa extends io{constructor(){super(Object.assign(ui(pa.getDefaults(),arguments,["pan"]))),this.name="Panner",this._panner=this.context.createStereoPanner(),this.input=this._panner,this.output=this._panner;const f=ui(pa.getDefaults(),arguments,["pan"]);this.pan=new no({context:this.context,param:this._panner.pan,value:f.pan,minValue:-1,maxValue:1}),this._panner.channelCount=f.channelCount,this._panner.channelCountMode="explicit",Oi(this,"pan")}static getDefaults(){return Object.assign(io.getDefaults(),{pan:0,channelCount:1})}dispose(){return super.dispose(),this._panner.disconnect(),this.pan.dispose(),this}}class da extends la{constructor(){super(ui(da.getDefaults(),arguments,["frequency"])),this.name="AutoPanner";const f=ui(da.getDefaults(),arguments,["frequency"]);this._panner=new pa({context:this.context,channelCount:f.channelCount}),this.connectEffect(this._panner),this._lfo.connect(this._panner.pan),this._lfo.min=-1,this._lfo.max=1}static getDefaults(){return Object.assign(la.getDefaults(),{channelCount:1})}dispose(){return super.dispose(),this._panner.dispose(),this}}class fa extends io{constructor(){super(ui(fa.getDefaults(),arguments,["smoothing"])),this.name="Follower";const f=ui(fa.getDefaults(),arguments,["smoothing"]);this._abs=this.input=new pr({context:this.context}),this._lowpass=this.output=new Ur({context:this.context,frequency:1/this.toSeconds(f.smoothing),type:"lowpass"}),this._abs.connect(this._lowpass),this._smoothing=f.smoothing}static getDefaults(){return Object.assign(io.getDefaults(),{smoothing:.05})}get smoothing(){return this._smoothing}set smoothing(f){this._smoothing=f,this._lowpass.frequency=1/this.toSeconds(this.smoothing)}dispose(){return super.dispose(),this._abs.dispose(),this._lowpass.dispose(),this}}class _a extends ha{constructor(){super(ui(_a.getDefaults(),arguments,["baseFrequency","octaves","sensitivity"])),this.name="AutoWah";const f=ui(_a.getDefaults(),arguments,["baseFrequency","octaves","sensitivity"]);this._follower=new fa({context:this.context,smoothing:f.follower}),this._sweepRange=new vr({context:this.context,min:0,max:1,exponent:.5}),this._baseFrequency=this.toFrequency(f.baseFrequency),this._octaves=f.octaves,this._inputBoost=new ho({context:this.context}),this._bandpass=new Or({context:this.context,rolloff:-48,frequency:0,Q:f.Q}),this._peaking=new Or({context:this.context,type:"peaking"}),this._peaking.gain.value=f.gain,this.gain=this._peaking.gain,this.Q=this._bandpass.Q,this.effectSend.chain(this._inputBoost,this._follower,this._sweepRange),this._sweepRange.connect(this._bandpass.frequency),this._sweepRange.connect(this._peaking.frequency),this.effectSend.chain(this._bandpass,this._peaking,this.effectReturn),this._setSweepRange(),this.sensitivity=f.sensitivity,Oi(this,["gain","Q"])}static getDefaults(){return Object.assign(ha.getDefaults(),{baseFrequency:100,octaves:6,sensitivity:0,Q:2,gain:2,follower:.2})}get octaves(){return this._octaves}set octaves(f){this._octaves=f,this._setSweepRange()}get follower(){return this._follower.smoothing}set follower(f){this._follower.smoothing=f}get baseFrequency(){return this._baseFrequency}set baseFrequency(f){this._baseFrequency=this.toFrequency(f),this._setSweepRange()}get sensitivity(){return Li(1/this._inputBoost.gain.value)}set sensitivity(f){this._inputBoost.gain.value=1/ji(f)}_setSweepRange(){this._sweepRange.min=this._baseFrequency,this._sweepRange.max=Math.min(this._baseFrequency*Math.pow(2,this._octaves),this.context.sampleRate/2)}dispose(){return super.dispose(),this._follower.dispose(),this._sweepRange.dispose(),this._bandpass.dispose(),this._peaking.dispose(),this._inputBoost.dispose(),this}}const Ec="bit-crusher";Lr(Ec,"\n\tclass BitCrusherWorklet extends SingleIOProcessor {\n\n\t\tstatic get parameterDescriptors() {\n\t\t\treturn [{\n\t\t\t\tname: \"bits\",\n\t\t\t\tdefaultValue: 12,\n\t\t\t\tminValue: 1,\n\t\t\t\tmaxValue: 16,\n\t\t\t\tautomationRate: 'k-rate'\n\t\t\t}];\n\t\t}\n\n\t\tgenerate(input, _channel, parameters) {\n\t\t\tconst step = Math.pow(0.5, parameters.bits - 1);\n\t\t\tconst val = step * Math.floor(input / step + 0.5);\n\t\t\treturn val;\n\t\t}\n\t}\n");class ga extends ha{constructor(){super(ui(ga.getDefaults(),arguments,["bits"])),this.name="BitCrusher";const f=ui(ga.getDefaults(),arguments,["bits"]);this._bitCrusherWorklet=new va({context:this.context,bits:f.bits}),this.connectEffect(this._bitCrusherWorklet),this.bits=this._bitCrusherWorklet.bits}static getDefaults(){return Object.assign(ha.getDefaults(),{bits:4})}dispose(){return super.dispose(),this._bitCrusherWorklet.dispose(),this}}class va extends zr{constructor(){super(ui(va.getDefaults(),arguments)),this.name="BitCrusherWorklet";const f=ui(va.getDefaults(),arguments);this.input=new ho({context:this.context}),this.output=new ho({context:this.context}),this.bits=new no({context:this.context,value:f.bits,units:"positive",minValue:1,maxValue:16,param:this._dummyParam,swappable:!0})}static getDefaults(){return Object.assign(zr.getDefaults(),{bits:12})}_audioWorkletName(){return Ec}onReady(f){oo(this.input,f,this.output);const O=f.parameters.get("bits");this.bits.setParam(O)}dispose(){return super.dispose(),this.input.dispose(),this.output.dispose(),this.bits.dispose(),this}}class ya extends ha{constructor(){super(ui(ya.getDefaults(),arguments,["order"])),this.name="Chebyshev";const f=ui(ya.getDefaults(),arguments,["order"]);this._shaper=new qo({context:this.context,length:4096}),this._order=f.order,this.connectEffect(this._shaper),this.order=f.order,this.oversample=f.oversample}static getDefaults(){return Object.assign(ha.getDefaults(),{order:1,oversample:"none"})}_getCoefficient(f,O,I){return I.has(O)||(0===O?I.set(O,0):1===O?I.set(O,f):I.set(O,2*f*this._getCoefficient(f,O-1,I)-this._getCoefficient(f,O-2,I))),I.get(O)}get order(){return this._order}set order(f){Bn(Number.isInteger(f),"'order' must be an integer"),this._order=f,this._shaper.setMap((O=>this._getCoefficient(O,f,new Map)))}get oversample(){return this._shaper.oversample}set oversample(f){this._shaper.oversample=f}dispose(){return super.dispose(),this._shaper.dispose(),this}}class xa extends io{constructor(){super(ui(xa.getDefaults(),arguments,["channels"])),this.name="Split";const f=ui(xa.getDefaults(),arguments,["channels"]);this._splitter=this.input=this.output=this.context.createChannelSplitter(f.channels),this._internalChannels=[this._splitter]}static getDefaults(){return Object.assign(io.getDefaults(),{channels:2})}dispose(){return super.dispose(),this._splitter.disconnect(),this}}class wa extends io{constructor(){super(ui(wa.getDefaults(),arguments,["channels"])),this.name="Merge";const f=ui(wa.getDefaults(),arguments,["channels"]);this._merger=this.output=this.input=this.context.createChannelMerger(f.channels)}static getDefaults(){return Object.assign(io.getDefaults(),{channels:2})}dispose(){return super.dispose(),this._merger.disconnect(),this}}class ba extends io{constructor(f){super(f),this.name="StereoEffect",this.input=new ho({context:this.context}),this.input.channelCount=2,this.input.channelCountMode="explicit",this._dryWet=this.output=new ca({context:this.context,fade:f.wet}),this.wet=this._dryWet.fade,this._split=new xa({context:this.context,channels:2}),this._merge=new wa({context:this.context,channels:2}),this.input.connect(this._split),this.input.connect(this._dryWet.a),this._merge.connect(this._dryWet.b),Oi(this,["wet"])}connectEffectLeft(...f){this._split.connect(f[0],0,0),oo(...f),ro(f[f.length-1],this._merge,0,0)}connectEffectRight(...f){this._split.connect(f[0],1,0),oo(...f),ro(f[f.length-1],this._merge,0,1)}static getDefaults(){return Object.assign(io.getDefaults(),{wet:1})}dispose(){return super.dispose(),this._dryWet.dispose(),this._split.dispose(),this._merge.dispose(),this}}class Ta extends ba{constructor(f){super(f),this.feedback=new po({context:this.context,value:f.feedback,units:"normalRange"}),this._feedbackL=new ho({context:this.context}),this._feedbackR=new ho({context:this.context}),this._feedbackSplit=new xa({context:this.context,channels:2}),this._feedbackMerge=new wa({context:this.context,channels:2}),this._merge.connect(this._feedbackSplit),this._feedbackMerge.connect(this._split),this._feedbackSplit.connect(this._feedbackL,0,0),this._feedbackL.connect(this._feedbackMerge,0,0),this._feedbackSplit.connect(this._feedbackR,1,0),this._feedbackR.connect(this._feedbackMerge,0,1),this.feedback.fan(this._feedbackL.gain,this._feedbackR.gain),Oi(this,["feedback"])}static getDefaults(){return Object.assign(ba.getDefaults(),{feedback:.5})}dispose(){return super.dispose(),this.feedback.dispose(),this._feedbackL.dispose(),this._feedbackR.dispose(),this._feedbackSplit.dispose(),this._feedbackMerge.dispose(),this}}class Sa extends Ta{constructor(){super(ui(Sa.getDefaults(),arguments,["frequency","delayTime","depth"])),this.name="Chorus";const f=ui(Sa.getDefaults(),arguments,["frequency","delayTime","depth"]);this._depth=f.depth,this._delayTime=f.delayTime/1e3,this._lfoL=new rr({context:this.context,frequency:f.frequency,min:0,max:1}),this._lfoR=new rr({context:this.context,frequency:f.frequency,min:0,max:1,phase:180}),this._delayNodeL=new yo({context:this.context}),this._delayNodeR=new yo({context:this.context}),this.frequency=this._lfoL.frequency,Oi(this,["frequency"]),this._lfoL.frequency.connect(this._lfoR.frequency),this.connectEffectLeft(this._delayNodeL),this.connectEffectRight(this._delayNodeR),this._lfoL.connect(this._delayNodeL.delayTime),this._lfoR.connect(this._delayNodeR.delayTime),this.depth=this._depth,this.type=f.type,this.spread=f.spread}static getDefaults(){return Object.assign(Ta.getDefaults(),{frequency:1.5,delayTime:3.5,depth:.7,type:"sine",spread:180,feedback:0,wet:.5})}get depth(){return this._depth}set depth(f){this._depth=f;const O=this._delayTime*f;this._lfoL.min=Math.max(this._delayTime-O,0),this._lfoL.max=this._delayTime+O,this._lfoR.min=Math.max(this._delayTime-O,0),this._lfoR.max=this._delayTime+O}get delayTime(){return 1e3*this._delayTime}set delayTime(f){this._delayTime=f/1e3,this.depth=this._depth}get type(){return this._lfoL.type}set type(f){this._lfoL.type=f,this._lfoR.type=f}get spread(){return this._lfoR.phase-this._lfoL.phase}set spread(f){this._lfoL.phase=90-f/2,this._lfoR.phase=f/2+90}start(f){return this._lfoL.start(f),this._lfoR.start(f),this}stop(f){return this._lfoL.stop(f),this._lfoR.stop(f),this}sync(){return this._lfoL.sync(),this._lfoR.sync(),this}unsync(){return this._lfoL.unsync(),this._lfoR.unsync(),this}dispose(){return super.dispose(),this._lfoL.dispose(),this._lfoR.dispose(),this._delayNodeL.dispose(),this._delayNodeR.dispose(),this.frequency.dispose(),this}}class ka extends ha{constructor(){super(ui(ka.getDefaults(),arguments,["distortion"])),this.name="Distortion";const f=ui(ka.getDefaults(),arguments,["distortion"]);this._shaper=new qo({context:this.context,length:4096}),this._distortion=f.distortion,this.connectEffect(this._shaper),this.distortion=f.distortion,this.oversample=f.oversample}static getDefaults(){return Object.assign(ha.getDefaults(),{distortion:.4,oversample:"none"})}get distortion(){return this._distortion}set distortion(f){this._distortion=f;const O=100*f,I=Math.PI/180;this._shaper.setMap((f=>Math.abs(f)<.001?0:(3+O)*f*20*I/(Math.PI+O*Math.abs(f))))}get oversample(){return this._shaper.oversample}set oversample(f){this._shaper.oversample=f}dispose(){return super.dispose(),this._shaper.dispose(),this}}class Aa extends ha{constructor(f){super(f),this.name="FeedbackEffect",this._feedbackGain=new ho({context:this.context,gain:f.feedback,units:"normalRange"}),this.feedback=this._feedbackGain.gain,Oi(this,"feedback"),this.effectReturn.chain(this._feedbackGain,this.effectSend)}static getDefaults(){return Object.assign(ha.getDefaults(),{feedback:.125})}dispose(){return super.dispose(),this._feedbackGain.dispose(),this.feedback.dispose(),this}}class Ca extends Aa{constructor(){super(ui(Ca.getDefaults(),arguments,["delayTime","feedback"])),this.name="FeedbackDelay";const f=ui(Ca.getDefaults(),arguments,["delayTime","feedback"]);this._delayNode=new yo({context:this.context,delayTime:f.delayTime,maxDelay:f.maxDelay}),this.delayTime=this._delayNode.delayTime,this.connectEffect(this._delayNode),Oi(this,"delayTime")}static getDefaults(){return Object.assign(Aa.getDefaults(),{delayTime:.25,maxDelay:1})}dispose(){return super.dispose(),this._delayNode.dispose(),this.delayTime.dispose(),this}}class Da extends io{constructor(f){super(f),this.name="PhaseShiftAllpass",this.input=new ho({context:this.context}),this.output=new ho({context:this.context}),this.offset90=new ho({context:this.context}),this._bank0=this._createAllPassFilterBank([.6923878,.9360654322959,.988229522686,.9987488452737]),this._bank1=this._createAllPassFilterBank([.4021921162426,.856171088242,.9722909545651,.9952884791278]),this._oneSampleDelay=this.context.createIIRFilter([0,1],[1,0]),oo(this.input,...this._bank0,this._oneSampleDelay,this.output),oo(this.input,...this._bank1,this.offset90)}_createAllPassFilterBank(f){return f.map((f=>{const O=[[f*f,0,-1],[1,0,-f*f]];return this.context.createIIRFilter(O[0],O[1])}))}dispose(){return super.dispose(),this.input.dispose(),this.output.dispose(),this.offset90.dispose(),this._bank0.forEach((f=>f.disconnect())),this._bank1.forEach((f=>f.disconnect())),this._oneSampleDelay.disconnect(),this}}class Oa extends ha{constructor(){super(ui(Oa.getDefaults(),arguments,["frequency"])),this.name="FrequencyShifter";const f=ui(Oa.getDefaults(),arguments,["frequency"]);this.frequency=new po({context:this.context,units:"frequency",value:f.frequency,minValue:-this.context.sampleRate/2,maxValue:this.context.sampleRate/2}),this._sine=new Qo({context:this.context,type:"sine"}),this._cosine=new Zo({context:this.context,phase:-90,type:"sine"}),this._sineMultiply=new Yo({context:this.context}),this._cosineMultiply=new Yo({context:this.context}),this._negate=new fr({context:this.context}),this._add=new nr({context:this.context}),this._phaseShifter=new Da({context:this.context}),this.effectSend.connect(this._phaseShifter),this.frequency.fan(this._sine.frequency,this._cosine.frequency),this._phaseShifter.offset90.connect(this._cosineMultiply),this._cosine.connect(this._cosineMultiply.factor),this._phaseShifter.connect(this._sineMultiply),this._sine.connect(this._sineMultiply.factor),this._sineMultiply.connect(this._negate),this._cosineMultiply.connect(this._add),this._negate.connect(this._add.addend),this._add.connect(this.effectReturn);const O=this.immediate();this._sine.start(O),this._cosine.start(O)}static getDefaults(){return Object.assign(ha.getDefaults(),{frequency:0})}dispose(){return super.dispose(),this.frequency.dispose(),this._add.dispose(),this._cosine.dispose(),this._cosineMultiply.dispose(),this._negate.dispose(),this._phaseShifter.dispose(),this._sine.dispose(),this._sineMultiply.dispose(),this}}const qc=[1557/44100,1617/44100,1491/44100,1422/44100,1277/44100,1356/44100,1188/44100,1116/44100],Ic=[225,556,441,341];class Ra extends ba{constructor(){super(ui(Ra.getDefaults(),arguments,["roomSize","dampening"])),this.name="Freeverb",this._combFilters=[],this._allpassFiltersL=[],this._allpassFiltersR=[];const f=ui(Ra.getDefaults(),arguments,["roomSize","dampening"]);this.roomSize=new po({context:this.context,value:f.roomSize,units:"normalRange"}),this._allpassFiltersL=Ic.map((f=>{const O=this.context.createBiquadFilter();return O.type="allpass",O.frequency.value=f,O})),this._allpassFiltersR=Ic.map((f=>{const O=this.context.createBiquadFilter();return O.type="allpass",O.frequency.value=f,O})),this._combFilters=qc.map(((O,I)=>{const V=new Gr({context:this.context,dampening:f.dampening,delayTime:O});return I<qc.length/2?this.connectEffectLeft(V,...this._allpassFiltersL):this.connectEffectRight(V,...this._allpassFiltersR),this.roomSize.connect(V.resonance),V})),Oi(this,["roomSize"])}static getDefaults(){return Object.assign(ba.getDefaults(),{roomSize:.7,dampening:3e3})}get dampening(){return this._combFilters[0].dampening}set dampening(f){this._combFilters.forEach((O=>O.dampening=f))}dispose(){return super.dispose(),this._allpassFiltersL.forEach((f=>f.disconnect())),this._allpassFiltersR.forEach((f=>f.disconnect())),this._combFilters.forEach((f=>f.dispose())),this.roomSize.dispose(),this}}const Vc=[.06748,.06404,.08212,.09004],Fc=[.773,.802,.753,.733],Pc=[347,113,37];class Va extends ba{constructor(){super(ui(Va.getDefaults(),arguments,["roomSize"])),this.name="JCReverb",this._allpassFilters=[],this._feedbackCombFilters=[];const f=ui(Va.getDefaults(),arguments,["roomSize"]);this.roomSize=new po({context:this.context,value:f.roomSize,units:"normalRange"}),this._scaleRoomSize=new ir({context:this.context,min:-.733,max:.197}),this._allpassFilters=Pc.map((f=>{const O=this.context.createBiquadFilter();return O.type="allpass",O.frequency.value=f,O})),this._feedbackCombFilters=Vc.map(((f,O)=>{const I=new Br({context:this.context,delayTime:f});return this._scaleRoomSize.connect(I.resonance),I.resonance.value=Fc[O],O<Vc.length/2?this.connectEffectLeft(...this._allpassFilters,I):this.connectEffectRight(...this._allpassFilters,I),I})),this.roomSize.connect(this._scaleRoomSize),Oi(this,["roomSize"])}static getDefaults(){return Object.assign(ba.getDefaults(),{roomSize:.5})}dispose(){return super.dispose(),this._allpassFilters.forEach((f=>f.disconnect())),this._feedbackCombFilters.forEach((f=>f.dispose())),this.roomSize.dispose(),this._scaleRoomSize.dispose(),this}}class Na extends Ta{constructor(f){super(f),this._feedbackL.disconnect(),this._feedbackL.connect(this._feedbackMerge,0,1),this._feedbackR.disconnect(),this._feedbackR.connect(this._feedbackMerge,0,0),Oi(this,["feedback"])}}class Pa extends Na{constructor(){super(ui(Pa.getDefaults(),arguments,["delayTime","feedback"])),this.name="PingPongDelay";const f=ui(Pa.getDefaults(),arguments,["delayTime","feedback"]);this._leftDelay=new yo({context:this.context,maxDelay:f.maxDelay}),this._rightDelay=new yo({context:this.context,maxDelay:f.maxDelay}),this._rightPreDelay=new yo({context:this.context,maxDelay:f.maxDelay}),this.delayTime=new po({context:this.context,units:"time",value:f.delayTime}),this.connectEffectLeft(this._leftDelay),this.connectEffectRight(this._rightPreDelay,this._rightDelay),this.delayTime.fan(this._leftDelay.delayTime,this._rightDelay.delayTime,this._rightPreDelay.delayTime),this._feedbackL.disconnect(),this._feedbackL.connect(this._rightDelay),Oi(this,["delayTime"])}static getDefaults(){return Object.assign(Na.getDefaults(),{delayTime:.25,maxDelay:1})}dispose(){return super.dispose(),this._leftDelay.dispose(),this._rightDelay.dispose(),this._rightPreDelay.dispose(),this.delayTime.dispose(),this}}class ja extends Aa{constructor(){super(ui(ja.getDefaults(),arguments,["pitch"])),this.name="PitchShift";const f=ui(ja.getDefaults(),arguments,["pitch"]);this._frequency=new po({context:this.context}),this._delayA=new yo({maxDelay:1,context:this.context}),this._lfoA=new rr({context:this.context,min:0,max:.1,type:"sawtooth"}).connect(this._delayA.delayTime),this._delayB=new yo({maxDelay:1,context:this.context}),this._lfoB=new rr({context:this.context,min:0,max:.1,type:"sawtooth",phase:180}).connect(this._delayB.delayTime),this._crossFade=new ca({context:this.context}),this._crossFadeLFO=new rr({context:this.context,min:0,max:1,type:"triangle",phase:90}).connect(this._crossFade.fade),this._feedbackDelay=new yo({delayTime:f.delayTime,context:this.context}),this.delayTime=this._feedbackDelay.delayTime,Oi(this,"delayTime"),this._pitch=f.pitch,this._windowSize=f.windowSize,this._delayA.connect(this._crossFade.a),this._delayB.connect(this._crossFade.b),this._frequency.fan(this._lfoA.frequency,this._lfoB.frequency,this._crossFadeLFO.frequency),this.effectSend.fan(this._delayA,this._delayB),this._crossFade.chain(this._feedbackDelay,this.effectReturn);const O=this.now();this._lfoA.start(O),this._lfoB.start(O),this._crossFadeLFO.start(O),this.windowSize=this._windowSize}static getDefaults(){return Object.assign(Aa.getDefaults(),{pitch:0,windowSize:.1,delayTime:0,feedback:0})}get pitch(){return this._pitch}set pitch(f){this._pitch=f;let O=0;f<0?(this._lfoA.min=0,this._lfoA.max=this._windowSize,this._lfoB.min=0,this._lfoB.max=this._windowSize,O=zi(f-1)+1):(this._lfoA.min=this._windowSize,this._lfoA.max=0,this._lfoB.min=this._windowSize,this._lfoB.max=0,O=zi(f)-1),this._frequency.value=O*(1.2/this._windowSize)}get windowSize(){return this._windowSize}set windowSize(f){this._windowSize=this.toSeconds(f),this.pitch=this._pitch}dispose(){return super.dispose(),this._frequency.dispose(),this._delayA.dispose(),this._delayB.dispose(),this._lfoA.dispose(),this._lfoB.dispose(),this._crossFade.dispose(),this._crossFadeLFO.dispose(),this._feedbackDelay.dispose(),this}}class La extends ba{constructor(){super(ui(La.getDefaults(),arguments,["frequency","octaves","baseFrequency"])),this.name="Phaser";const f=ui(La.getDefaults(),arguments,["frequency","octaves","baseFrequency"]);this._lfoL=new rr({context:this.context,frequency:f.frequency,min:0,max:1}),this._lfoR=new rr({context:this.context,frequency:f.frequency,min:0,max:1,phase:180}),this._baseFrequency=this.toFrequency(f.baseFrequency),this._octaves=f.octaves,this.Q=new po({context:this.context,value:f.Q,units:"positive"}),this._filtersL=this._makeFilters(f.stages,this._lfoL),this._filtersR=this._makeFilters(f.stages,this._lfoR),this.frequency=this._lfoL.frequency,this.frequency.value=f.frequency,this.connectEffectLeft(...this._filtersL),this.connectEffectRight(...this._filtersR),this._lfoL.frequency.connect(this._lfoR.frequency),this.baseFrequency=f.baseFrequency,this.octaves=f.octaves,this._lfoL.start(),this._lfoR.start(),Oi(this,["frequency","Q"])}static getDefaults(){return Object.assign(ba.getDefaults(),{frequency:.5,octaves:3,stages:10,Q:10,baseFrequency:350})}_makeFilters(f,O){const I=[];for(let V=0;V<f;V++){const f=this.context.createBiquadFilter();f.type="allpass",this.Q.connect(f.Q),O.connect(f.frequency),I.push(f)}return I}get octaves(){return this._octaves}set octaves(f){this._octaves=f;const O=this._baseFrequency*Math.pow(2,f);this._lfoL.max=O,this._lfoR.max=O}get baseFrequency(){return this._baseFrequency}set baseFrequency(f){this._baseFrequency=this.toFrequency(f),this._lfoL.min=this._baseFrequency,this._lfoR.min=this._baseFrequency,this.octaves=this._octaves}dispose(){return super.dispose(),this.Q.dispose(),this._lfoL.dispose(),this._lfoR.dispose(),this._filtersL.forEach((f=>f.disconnect())),this._filtersR.forEach((f=>f.disconnect())),this.frequency.dispose(),this}}class za extends ha{constructor(){super(ui(za.getDefaults(),arguments,["decay"])),this.name="Reverb",this._convolver=this.context.createConvolver(),this.ready=Promise.resolve();const f=ui(za.getDefaults(),arguments,["decay"]);this._decay=f.decay,this._preDelay=f.preDelay,this.generate(),this.connectEffect(this._convolver)}static getDefaults(){return Object.assign(ha.getDefaults(),{decay:1.5,preDelay:.01})}get decay(){return this._decay}set decay(f){Un(f=this.toSeconds(f),.001),this._decay=f,this.generate()}get preDelay(){return this._preDelay}set preDelay(f){Un(f=this.toSeconds(f),0),this._preDelay=f,this.generate()}generate(){return ni(this,void 0,void 0,(function*(){const f=this.ready,O=new qi(2,this._decay+this._preDelay,this.context.sampleRate),I=new Lo({context:O}),V=new Lo({context:O}),F=new wa({context:O});I.connect(F,0,0),V.connect(F,0,1);const P=new ho({context:O}).toDestination();F.connect(P),I.start(0),V.start(0),P.gain.setValueAtTime(0,0),P.gain.setValueAtTime(1,this._preDelay),P.gain.exponentialApproachValueAtTime(0,this._preDelay,this.decay);const ut=O.render();return this.ready=ut.then(Ei),yield f,this._convolver.buffer=(yield ut).get(),this}))}dispose(){return super.dispose(),this._convolver.disconnect(),this}}class Wa extends io{constructor(){super(ui(Wa.getDefaults(),arguments)),this.name="MidSideSplit",this._split=this.input=new xa({channels:2,context:this.context}),this._midAdd=new nr({context:this.context}),this.mid=new Yo({context:this.context,value:Math.SQRT1_2}),this._sideSubtract=new _r({context:this.context}),this.side=new Yo({context:this.context,value:Math.SQRT1_2}),this._split.connect(this._midAdd,0),this._split.connect(this._midAdd.addend,1),this._split.connect(this._sideSubtract,0),this._split.connect(this._sideSubtract.subtrahend,1),this._midAdd.connect(this.mid),this._sideSubtract.connect(this.side)}dispose(){return super.dispose(),this.mid.dispose(),this.side.dispose(),this._midAdd.dispose(),this._sideSubtract.dispose(),this._split.dispose(),this}}class Ba extends io{constructor(){super(ui(Ba.getDefaults(),arguments)),this.name="MidSideMerge",this.mid=new ho({context:this.context}),this.side=new ho({context:this.context}),this._left=new nr({context:this.context}),this._leftMult=new Yo({context:this.context,value:Math.SQRT1_2}),this._right=new _r({context:this.context}),this._rightMult=new Yo({context:this.context,value:Math.SQRT1_2}),this._merge=this.output=new wa({context:this.context}),this.mid.fan(this._left),this.side.connect(this._left.addend),this.mid.connect(this._right),this.side.connect(this._right.subtrahend),this._left.connect(this._leftMult),this._right.connect(this._rightMult),this._leftMult.connect(this._merge,0,0),this._rightMult.connect(this._merge,0,1)}dispose(){return super.dispose(),this.mid.dispose(),this.side.dispose(),this._leftMult.dispose(),this._rightMult.dispose(),this._left.dispose(),this._right.dispose(),this}}class Ua extends ha{constructor(f){super(f),this.name="MidSideEffect",this._midSideMerge=new Ba({context:this.context}),this._midSideSplit=new Wa({context:this.context}),this._midSend=this._midSideSplit.mid,this._sideSend=this._midSideSplit.side,this._midReturn=this._midSideMerge.mid,this._sideReturn=this._midSideMerge.side,this.effectSend.connect(this._midSideSplit),this._midSideMerge.connect(this.effectReturn)}connectEffectMid(...f){this._midSend.chain(...f,this._midReturn)}connectEffectSide(...f){this._sideSend.chain(...f,this._sideReturn)}dispose(){return super.dispose(),this._midSideSplit.dispose(),this._midSideMerge.dispose(),this._midSend.dispose(),this._sideSend.dispose(),this._midReturn.dispose(),this._sideReturn.dispose(),this}}class Ga extends Ua{constructor(){super(ui(Ga.getDefaults(),arguments,["width"])),this.name="StereoWidener";const f=ui(Ga.getDefaults(),arguments,["width"]);this.width=new po({context:this.context,value:f.width,units:"normalRange"}),Oi(this,["width"]),this._twoTimesWidthMid=new Yo({context:this.context,value:2}),this._twoTimesWidthSide=new Yo({context:this.context,value:2}),this._midMult=new Yo({context:this.context}),this._twoTimesWidthMid.connect(this._midMult.factor),this.connectEffectMid(this._midMult),this._oneMinusWidth=new _r({context:this.context}),this._oneMinusWidth.connect(this._twoTimesWidthMid),ro(this.context.getConstant(1),this._oneMinusWidth),this.width.connect(this._oneMinusWidth.subtrahend),this._sideMult=new Yo({context:this.context}),this.width.connect(this._twoTimesWidthSide),this._twoTimesWidthSide.connect(this._sideMult.factor),this.connectEffectSide(this._sideMult)}static getDefaults(){return Object.assign(Ua.getDefaults(),{width:.5})}dispose(){return super.dispose(),this.width.dispose(),this._midMult.dispose(),this._sideMult.dispose(),this._twoTimesWidthMid.dispose(),this._twoTimesWidthSide.dispose(),this._oneMinusWidth.dispose(),this}}class Qa extends ba{constructor(){super(ui(Qa.getDefaults(),arguments,["frequency","depth"])),this.name="Tremolo";const f=ui(Qa.getDefaults(),arguments,["frequency","depth"]);this._lfoL=new rr({context:this.context,type:f.type,min:1,max:0}),this._lfoR=new rr({context:this.context,type:f.type,min:1,max:0}),this._amplitudeL=new ho({context:this.context}),this._amplitudeR=new ho({context:this.context}),this.frequency=new po({context:this.context,value:f.frequency,units:"frequency"}),this.depth=new po({context:this.context,value:f.depth,units:"normalRange"}),Oi(this,["frequency","depth"]),this.connectEffectLeft(this._amplitudeL),this.connectEffectRight(this._amplitudeR),this._lfoL.connect(this._amplitudeL.gain),this._lfoR.connect(this._amplitudeR.gain),this.frequency.fan(this._lfoL.frequency,this._lfoR.frequency),this.depth.fan(this._lfoR.amplitude,this._lfoL.amplitude),this.spread=f.spread}static getDefaults(){return Object.assign(ba.getDefaults(),{frequency:10,type:"sine",depth:.5,spread:180})}start(f){return this._lfoL.start(f),this._lfoR.start(f),this}stop(f){return this._lfoL.stop(f),this._lfoR.stop(f),this}sync(){return this._lfoL.sync(),this._lfoR.sync(),this.context.transport.syncSignal(this.frequency),this}unsync(){return this._lfoL.unsync(),this._lfoR.unsync(),this.context.transport.unsyncSignal(this.frequency),this}get type(){return this._lfoL.type}set type(f){this._lfoL.type=f,this._lfoR.type=f}get spread(){return this._lfoR.phase-this._lfoL.phase}set spread(f){this._lfoL.phase=90-f/2,this._lfoR.phase=f/2+90}dispose(){return super.dispose(),this._lfoL.dispose(),this._lfoR.dispose(),this._amplitudeL.dispose(),this._amplitudeR.dispose(),this.frequency.dispose(),this.depth.dispose(),this}}class Za extends ha{constructor(){super(ui(Za.getDefaults(),arguments,["frequency","depth"])),this.name="Vibrato";const f=ui(Za.getDefaults(),arguments,["frequency","depth"]);this._delayNode=new yo({context:this.context,delayTime:0,maxDelay:f.maxDelay}),this._lfo=new rr({context:this.context,type:f.type,min:0,max:f.maxDelay,frequency:f.frequency,phase:-90}).start().connect(this._delayNode.delayTime),this.frequency=this._lfo.frequency,this.depth=this._lfo.amplitude,this.depth.value=f.depth,Oi(this,["frequency","depth"]),this.effectSend.chain(this._delayNode,this.effectReturn)}static getDefaults(){return Object.assign(ha.getDefaults(),{maxDelay:.005,frequency:5,depth:.1,type:"sine"})}get type(){return this._lfo.type}set type(f){this._lfo.type=f}dispose(){return super.dispose(),this._delayNode.dispose(),this._lfo.dispose(),this.frequency.dispose(),this.depth.dispose(),this}}class Xa extends io{constructor(){super(ui(Xa.getDefaults(),arguments,["type","size"])),this.name="Analyser",this._analysers=[],this._buffers=[];const f=ui(Xa.getDefaults(),arguments,["type","size"]);this.input=this.output=this._gain=new ho({context:this.context}),this._split=new xa({context:this.context,channels:f.channels}),this.input.connect(this._split),Un(f.channels,1);for(let O=0;O<f.channels;O++)this._analysers[O]=this.context.createAnalyser(),this._split.connect(this._analysers[O],O,0);this.size=f.size,this.type=f.type,this.smoothing=f.smoothing}static getDefaults(){return Object.assign(io.getDefaults(),{size:1024,smoothing:.8,type:"fft",channels:1})}getValue(){return this._analysers.forEach(((f,O)=>{const I=this._buffers[O];"fft"===this._type?f.getFloatFrequencyData(I):"waveform"===this._type&&f.getFloatTimeDomainData(I)})),1===this.channels?this._buffers[0]:this._buffers}get size(){return this._analysers[0].frequencyBinCount}set size(f){this._analysers.forEach(((O,I)=>{O.fftSize=2*f,this._buffers[I]=new Float32Array(f)}))}get channels(){return this._analysers.length}get type(){return this._type}set type(f){Bn("waveform"===f||"fft"===f,`Analyser: invalid type: ${f}`),this._type=f}get smoothing(){return this._analysers[0].smoothingTimeConstant}set smoothing(f){this._analysers.forEach((O=>O.smoothingTimeConstant=f))}dispose(){return super.dispose(),this._analysers.forEach((f=>f.disconnect())),this._split.dispose(),this._gain.dispose(),this}}class Ya extends io{constructor(){super(ui(Ya.getDefaults(),arguments)),this.name="MeterBase",this.input=this.output=this._analyser=new Xa({context:this.context,size:256,type:"waveform"})}dispose(){return super.dispose(),this._analyser.dispose(),this}}class $a extends Ya{constructor(){super(ui($a.getDefaults(),arguments,["smoothing"])),this.name="Meter";const f=ui($a.getDefaults(),arguments,["smoothing"]);this.input=this.output=this._analyser=new Xa({context:this.context,size:256,type:"waveform",channels:f.channelCount}),this.smoothing=f.smoothing,this.normalRange=f.normalRange,this._rms=new Array(f.channelCount),this._rms.fill(0)}static getDefaults(){return Object.assign(Ya.getDefaults(),{smoothing:.8,normalRange:!1,channelCount:1})}getLevel(){return Kn("'getLevel' has been changed to 'getValue'"),this.getValue()}getValue(){const f=this._analyser.getValue(),O=(1===this.channels?[f]:f).map(((f,O)=>{const I=f.reduce(((f,O)=>f+O*O),0),V=Math.sqrt(I/f.length);return this._rms[O]=Math.max(V,this._rms[O]*this.smoothing),this.normalRange?this._rms[O]:Li(this._rms[O])}));return 1===this.channels?O[0]:O}get channels(){return this._analyser.channels}dispose(){return super.dispose(),this._analyser.dispose(),this}}class Ha extends Ya{constructor(){super(ui(Ha.getDefaults(),arguments,["size"])),this.name="FFT";const f=ui(Ha.getDefaults(),arguments,["size"]);this.normalRange=f.normalRange,this._analyser.type="fft",this.size=f.size}static getDefaults(){return Object.assign(io.getDefaults(),{normalRange:!1,size:1024,smoothing:.8})}getValue(){return this._analyser.getValue().map((f=>this.normalRange?ji(f):f))}get size(){return this._analyser.size}set size(f){this._analyser.size=f}get smoothing(){return this._analyser.smoothing}set smoothing(f){this._analyser.smoothing=f}getFrequencyOfIndex(f){return Bn(0<=f&&f<this.size,`index must be greater than or equal to 0 and less than ${this.size}`),f*this.context.sampleRate/(2*this.size)}}class Ja extends Ya{constructor(){super(ui(Ja.getDefaults(),arguments)),this.name="DCMeter",this._analyser.type="waveform",this._analyser.size=256}getValue(){return this._analyser.getValue()[0]}}class Ka extends Ya{constructor(){super(ui(Ka.getDefaults(),arguments,["size"])),this.name="Waveform";const f=ui(Ka.getDefaults(),arguments,["size"]);this._analyser.type="waveform",this.size=f.size}static getDefaults(){return Object.assign(Ya.getDefaults(),{size:1024})}getValue(){return this._analyser.getValue()}get size(){return this._analyser.size}set size(f){this._analyser.size=f}}class tc extends io{constructor(){super(ui(tc.getDefaults(),arguments,["solo"])),this.name="Solo";const f=ui(tc.getDefaults(),arguments,["solo"]);this.input=this.output=new ho({context:this.context}),tc._allSolos.has(this.context)||tc._allSolos.set(this.context,new Set),tc._allSolos.get(this.context).add(this),this.solo=f.solo}static getDefaults(){return Object.assign(io.getDefaults(),{solo:!1})}get solo(){return this._isSoloed()}set solo(f){f?this._addSolo():this._removeSolo(),tc._allSolos.get(this.context).forEach((f=>f._updateSolo()))}get muted(){return 0===this.input.gain.value}_addSolo(){tc._soloed.has(this.context)||tc._soloed.set(this.context,new Set),tc._soloed.get(this.context).add(this)}_removeSolo(){tc._soloed.has(this.context)&&tc._soloed.get(this.context).delete(this)}_isSoloed(){return tc._soloed.has(this.context)&&tc._soloed.get(this.context).has(this)}_noSolos(){return!tc._soloed.has(this.context)||tc._soloed.has(this.context)&&0===tc._soloed.get(this.context).size}_updateSolo(){this._isSoloed()||this._noSolos()?this.input.gain.value=1:this.input.gain.value=0}dispose(){return super.dispose(),tc._allSolos.get(this.context).delete(this),this._removeSolo(),this}}tc._allSolos=new Map,tc._soloed=new Map;class ec extends io{constructor(){super(ui(ec.getDefaults(),arguments,["pan","volume"])),this.name="PanVol";const f=ui(ec.getDefaults(),arguments,["pan","volume"]);this._panner=this.input=new pa({context:this.context,pan:f.pan,channelCount:f.channelCount}),this.pan=this._panner.pan,this._volume=this.output=new Oo({context:this.context,volume:f.volume}),this.volume=this._volume.volume,this._panner.connect(this._volume),this.mute=f.mute,Oi(this,["pan","volume"])}static getDefaults(){return Object.assign(io.getDefaults(),{mute:!1,pan:0,volume:0,channelCount:1})}get mute(){return this._volume.mute}set mute(f){this._volume.mute=f}dispose(){return super.dispose(),this._panner.dispose(),this.pan.dispose(),this._volume.dispose(),this.volume.dispose(),this}}class sc extends io{constructor(){super(ui(sc.getDefaults(),arguments,["volume","pan"])),this.name="Channel";const f=ui(sc.getDefaults(),arguments,["volume","pan"]);this._solo=this.input=new tc({solo:f.solo,context:this.context}),this._panVol=this.output=new ec({context:this.context,pan:f.pan,volume:f.volume,mute:f.mute,channelCount:f.channelCount}),this.pan=this._panVol.pan,this.volume=this._panVol.volume,this._solo.connect(this._panVol),Oi(this,["pan","volume"])}static getDefaults(){return Object.assign(io.getDefaults(),{pan:0,volume:0,mute:!1,solo:!1,channelCount:1})}get solo(){return this._solo.solo}set solo(f){this._solo.solo=f}get muted(){return this._solo.muted||this.mute}get mute(){return this._panVol.mute}set mute(f){this._panVol.mute=f}_getBus(f){return sc.buses.has(f)||sc.buses.set(f,new ho({context:this.context})),sc.buses.get(f)}send(f,O=0){const I=this._getBus(f),V=new ho({context:this.context,units:"decibels",gain:O});return this.connect(V),V.connect(I),V}receive(f){return this._getBus(f).connect(this),this}dispose(){return super.dispose(),this._panVol.dispose(),this.pan.dispose(),this.volume.dispose(),this._solo.dispose(),this}}sc.buses=new Map;class nc extends io{constructor(){super(ui(nc.getDefaults(),arguments)),this.name="Mono",this.input=new ho({context:this.context}),this._merge=this.output=new wa({channels:2,context:this.context}),this.input.connect(this._merge,0,0),this.input.connect(this._merge,0,1)}dispose(){return super.dispose(),this._merge.dispose(),this.input.dispose(),this}}class ic extends io{constructor(){super(ui(ic.getDefaults(),arguments,["lowFrequency","highFrequency"])),this.name="MultibandSplit",this.input=new ho({context:this.context}),this.output=void 0,this.low=new Or({context:this.context,frequency:0,type:"lowpass"}),this._lowMidFilter=new Or({context:this.context,frequency:0,type:"highpass"}),this.mid=new Or({context:this.context,frequency:0,type:"lowpass"}),this.high=new Or({context:this.context,frequency:0,type:"highpass"}),this._internalChannels=[this.low,this.mid,this.high];const f=ui(ic.getDefaults(),arguments,["lowFrequency","highFrequency"]);this.lowFrequency=new po({context:this.context,units:"frequency",value:f.lowFrequency}),this.highFrequency=new po({context:this.context,units:"frequency",value:f.highFrequency}),this.Q=new po({context:this.context,units:"positive",value:f.Q}),this.input.fan(this.low,this.high),this.input.chain(this._lowMidFilter,this.mid),this.lowFrequency.fan(this.low.frequency,this._lowMidFilter.frequency),this.highFrequency.fan(this.mid.frequency,this.high.frequency),this.Q.connect(this.low.Q),this.Q.connect(this._lowMidFilter.Q),this.Q.connect(this.mid.Q),this.Q.connect(this.high.Q),Oi(this,["high","mid","low","highFrequency","lowFrequency"])}static getDefaults(){return Object.assign(io.getDefaults(),{Q:1,highFrequency:2500,lowFrequency:400})}dispose(){return super.dispose(),Mi(this,["high","mid","low","highFrequency","lowFrequency"]),this.low.dispose(),this._lowMidFilter.dispose(),this.mid.dispose(),this.high.dispose(),this.lowFrequency.dispose(),this.highFrequency.dispose(),this.Q.dispose(),this}}class oc extends io{constructor(){super(...arguments),this.name="Listener",this.positionX=new no({context:this.context,param:this.context.rawContext.listener.positionX}),this.positionY=new no({context:this.context,param:this.context.rawContext.listener.positionY}),this.positionZ=new no({context:this.context,param:this.context.rawContext.listener.positionZ}),this.forwardX=new no({context:this.context,param:this.context.rawContext.listener.forwardX}),this.forwardY=new no({context:this.context,param:this.context.rawContext.listener.forwardY}),this.forwardZ=new no({context:this.context,param:this.context.rawContext.listener.forwardZ}),this.upX=new no({context:this.context,param:this.context.rawContext.listener.upX}),this.upY=new no({context:this.context,param:this.context.rawContext.listener.upY}),this.upZ=new no({context:this.context,param:this.context.rawContext.listener.upZ})}static getDefaults(){return Object.assign(io.getDefaults(),{positionX:0,positionY:0,positionZ:0,forwardX:0,forwardY:0,forwardZ:-1,upX:0,upY:1,upZ:0})}dispose(){return super.dispose(),this.positionX.dispose(),this.positionY.dispose(),this.positionZ.dispose(),this.forwardX.dispose(),this.forwardY.dispose(),this.forwardZ.dispose(),this.upX.dispose(),this.upY.dispose(),this.upZ.dispose(),this}}Ti((f=>{f.listener=new oc({context:f})})),ki((f=>{f.listener.dispose()}));class rc extends io{constructor(){super(ui(rc.getDefaults(),arguments,["positionX","positionY","positionZ"])),this.name="Panner3D";const f=ui(rc.getDefaults(),arguments,["positionX","positionY","positionZ"]);this._panner=this.input=this.output=this.context.createPanner(),this.panningModel=f.panningModel,this.maxDistance=f.maxDistance,this.distanceModel=f.distanceModel,this.coneOuterGain=f.coneOuterGain,this.coneOuterAngle=f.coneOuterAngle,this.coneInnerAngle=f.coneInnerAngle,this.refDistance=f.refDistance,this.rolloffFactor=f.rolloffFactor,this.positionX=new no({context:this.context,param:this._panner.positionX,value:f.positionX}),this.positionY=new no({context:this.context,param:this._panner.positionY,value:f.positionY}),this.positionZ=new no({context:this.context,param:this._panner.positionZ,value:f.positionZ}),this.orientationX=new no({context:this.context,param:this._panner.orientationX,value:f.orientationX}),this.orientationY=new no({context:this.context,param:this._panner.orientationY,value:f.orientationY}),this.orientationZ=new no({context:this.context,param:this._panner.orientationZ,value:f.orientationZ})}static getDefaults(){return Object.assign(io.getDefaults(),{coneInnerAngle:360,coneOuterAngle:360,coneOuterGain:0,distanceModel:"inverse",maxDistance:1e4,orientationX:0,orientationY:0,orientationZ:0,panningModel:"equalpower",positionX:0,positionY:0,positionZ:0,refDistance:1,rolloffFactor:1})}setPosition(f,O,I){return this.positionX.value=f,this.positionY.value=O,this.positionZ.value=I,this}setOrientation(f,O,I){return this.orientationX.value=f,this.orientationY.value=O,this.orientationZ.value=I,this}get panningModel(){return this._panner.panningModel}set panningModel(f){this._panner.panningModel=f}get refDistance(){return this._panner.refDistance}set refDistance(f){this._panner.refDistance=f}get rolloffFactor(){return this._panner.rolloffFactor}set rolloffFactor(f){this._panner.rolloffFactor=f}get distanceModel(){return this._panner.distanceModel}set distanceModel(f){this._panner.distanceModel=f}get coneInnerAngle(){return this._panner.coneInnerAngle}set coneInnerAngle(f){this._panner.coneInnerAngle=f}get coneOuterAngle(){return this._panner.coneOuterAngle}set coneOuterAngle(f){this._panner.coneOuterAngle=f}get coneOuterGain(){return this._panner.coneOuterGain}set coneOuterGain(f){this._panner.coneOuterGain=f}get maxDistance(){return this._panner.maxDistance}set maxDistance(f){this._panner.maxDistance=f}dispose(){return super.dispose(),this._panner.disconnect(),this.orientationX.dispose(),this.orientationY.dispose(),this.orientationZ.dispose(),this.positionX.dispose(),this.positionY.dispose(),this.positionZ.dispose(),this}}class ac extends io{constructor(){super(ui(ac.getDefaults(),arguments)),this.name="Recorder";const f=ui(ac.getDefaults(),arguments);this.input=new ho({context:this.context}),Bn(ac.supported,"Media Recorder API is not available"),this._stream=this.context.createMediaStreamDestination(),this.input.connect(this._stream),this._recorder=new MediaRecorder(this._stream.stream,{mimeType:f.mimeType})}static getDefaults(){return io.getDefaults()}get mimeType(){return this._recorder.mimeType}static get supported(){return null!==Pr&&Reflect.has(Pr,"MediaRecorder")}get state(){return"inactive"===this._recorder.state?"stopped":"paused"===this._recorder.state?"paused":"started"}start(){return ni(this,void 0,void 0,(function*(){Bn("started"!==this.state,"Recorder is already started");const f=new Promise((f=>{const e=()=>{this._recorder.removeEventListener("start",e,!1),f()};this._recorder.addEventListener("start",e,!1)}));return this._recorder.start(),yield f}))}stop(){return ni(this,void 0,void 0,(function*(){Bn("stopped"!==this.state,"Recorder is not started");const f=new Promise((f=>{const e=O=>{this._recorder.removeEventListener("dataavailable",e,!1),f(O.data)};this._recorder.addEventListener("dataavailable",e,!1)}));return this._recorder.stop(),yield f}))}pause(){return Bn("started"===this.state,"Recorder must be started"),this._recorder.pause(),this}dispose(){return super.dispose(),this.input.dispose(),this._stream.disconnect(),this}}class cc extends io{constructor(){super(ui(cc.getDefaults(),arguments,["threshold","ratio"])),this.name="Compressor",this._compressor=this.context.createDynamicsCompressor(),this.input=this._compressor,this.output=this._compressor;const f=ui(cc.getDefaults(),arguments,["threshold","ratio"]);this.threshold=new no({minValue:this._compressor.threshold.minValue,maxValue:this._compressor.threshold.maxValue,context:this.context,convert:!1,param:this._compressor.threshold,units:"decibels",value:f.threshold}),this.attack=new no({minValue:this._compressor.attack.minValue,maxValue:this._compressor.attack.maxValue,context:this.context,param:this._compressor.attack,units:"time",value:f.attack}),this.release=new no({minValue:this._compressor.release.minValue,maxValue:this._compressor.release.maxValue,context:this.context,param:this._compressor.release,units:"time",value:f.release}),this.knee=new no({minValue:this._compressor.knee.minValue,maxValue:this._compressor.knee.maxValue,context:this.context,convert:!1,param:this._compressor.knee,units:"decibels",value:f.knee}),this.ratio=new no({minValue:this._compressor.ratio.minValue,maxValue:this._compressor.ratio.maxValue,context:this.context,convert:!1,param:this._compressor.ratio,units:"positive",value:f.ratio}),Oi(this,["knee","release","attack","ratio","threshold"])}static getDefaults(){return Object.assign(io.getDefaults(),{attack:.003,knee:30,ratio:12,release:.25,threshold:-24})}get reduction(){return this._compressor.reduction}dispose(){return super.dispose(),this._compressor.disconnect(),this.attack.dispose(),this.release.dispose(),this.threshold.dispose(),this.ratio.dispose(),this.knee.dispose(),this}}class hc extends io{constructor(){super(Object.assign(ui(hc.getDefaults(),arguments,["threshold","smoothing"]))),this.name="Gate";const f=ui(hc.getDefaults(),arguments,["threshold","smoothing"]);this._follower=new fa({context:this.context,smoothing:f.smoothing}),this._gt=new gr({context:this.context,value:ji(f.threshold)}),this.input=new ho({context:this.context}),this._gate=this.output=new ho({context:this.context}),this.input.connect(this._gate),this.input.chain(this._follower,this._gt,this._gate.gain)}static getDefaults(){return Object.assign(io.getDefaults(),{smoothing:.1,threshold:-40})}get threshold(){return Li(this._gt.value)}set threshold(f){this._gt.value=ji(f)}get smoothing(){return this._follower.smoothing}set smoothing(f){this._follower.smoothing=f}dispose(){return super.dispose(),this.input.dispose(),this._follower.dispose(),this._gt.dispose(),this._gate.dispose(),this}}class lc extends io{constructor(){super(Object.assign(ui(lc.getDefaults(),arguments,["threshold"]))),this.name="Limiter";const f=ui(lc.getDefaults(),arguments,["threshold"]);this._compressor=this.input=this.output=new cc({context:this.context,ratio:20,attack:.003,release:.01,threshold:f.threshold}),this.threshold=this._compressor.threshold,Oi(this,"threshold")}static getDefaults(){return Object.assign(io.getDefaults(),{threshold:-12})}get reduction(){return this._compressor.reduction}dispose(){return super.dispose(),this._compressor.dispose(),this.threshold.dispose(),this}}class uc extends io{constructor(){super(Object.assign(ui(uc.getDefaults(),arguments))),this.name="MidSideCompressor";const f=ui(uc.getDefaults(),arguments);this._midSideSplit=this.input=new Wa({context:this.context}),this._midSideMerge=this.output=new Ba({context:this.context}),this.mid=new cc(Object.assign(f.mid,{context:this.context})),this.side=new cc(Object.assign(f.side,{context:this.context})),this._midSideSplit.mid.chain(this.mid,this._midSideMerge.mid),this._midSideSplit.side.chain(this.side,this._midSideMerge.side),Oi(this,["mid","side"])}static getDefaults(){return Object.assign(io.getDefaults(),{mid:{ratio:3,threshold:-24,release:.03,attack:.02,knee:16},side:{ratio:6,threshold:-30,release:.25,attack:.03,knee:10}})}dispose(){return super.dispose(),this.mid.dispose(),this.side.dispose(),this._midSideSplit.dispose(),this._midSideMerge.dispose(),this}}class pc extends io{constructor(){super(Object.assign(ui(pc.getDefaults(),arguments))),this.name="MultibandCompressor";const f=ui(pc.getDefaults(),arguments);this._splitter=this.input=new ic({context:this.context,lowFrequency:f.lowFrequency,highFrequency:f.highFrequency}),this.lowFrequency=this._splitter.lowFrequency,this.highFrequency=this._splitter.highFrequency,this.output=new ho({context:this.context}),this.low=new cc(Object.assign(f.low,{context:this.context})),this.mid=new cc(Object.assign(f.mid,{context:this.context})),this.high=new cc(Object.assign(f.high,{context:this.context})),this._splitter.low.chain(this.low,this.output),this._splitter.mid.chain(this.mid,this.output),this._splitter.high.chain(this.high,this.output),Oi(this,["high","mid","low","highFrequency","lowFrequency"])}static getDefaults(){return Object.assign(io.getDefaults(),{lowFrequency:250,highFrequency:2e3,low:{ratio:6,threshold:-30,release:.25,attack:.03,knee:10},mid:{ratio:3,threshold:-24,release:.03,attack:.02,knee:16},high:{ratio:3,threshold:-24,release:.03,attack:.02,knee:16}})}dispose(){return super.dispose(),this._splitter.dispose(),this.low.dispose(),this.mid.dispose(),this.high.dispose(),this.output.dispose(),this}}class dc extends io{constructor(){super(ui(dc.getDefaults(),arguments,["low","mid","high"])),this.name="EQ3",this.output=new ho({context:this.context}),this._internalChannels=[];const f=ui(dc.getDefaults(),arguments,["low","mid","high"]);this.input=this._multibandSplit=new ic({context:this.context,highFrequency:f.highFrequency,lowFrequency:f.lowFrequency}),this._lowGain=new ho({context:this.context,gain:f.low,units:"decibels"}),this._midGain=new ho({context:this.context,gain:f.mid,units:"decibels"}),this._highGain=new ho({context:this.context,gain:f.high,units:"decibels"}),this.low=this._lowGain.gain,this.mid=this._midGain.gain,this.high=this._highGain.gain,this.Q=this._multibandSplit.Q,this.lowFrequency=this._multibandSplit.lowFrequency,this.highFrequency=this._multibandSplit.highFrequency,this._multibandSplit.low.chain(this._lowGain,this.output),this._multibandSplit.mid.chain(this._midGain,this.output),this._multibandSplit.high.chain(this._highGain,this.output),Oi(this,["low","mid","high","lowFrequency","highFrequency"]),this._internalChannels=[this._multibandSplit]}static getDefaults(){return Object.assign(io.getDefaults(),{high:0,highFrequency:2500,low:0,lowFrequency:400,mid:0})}dispose(){return super.dispose(),Mi(this,["low","mid","high","lowFrequency","highFrequency"]),this._multibandSplit.dispose(),this.lowFrequency.dispose(),this.highFrequency.dispose(),this._lowGain.dispose(),this._midGain.dispose(),this._highGain.dispose(),this.low.dispose(),this.mid.dispose(),this.high.dispose(),this.Q.dispose(),this}}class fc extends io{constructor(){super(ui(fc.getDefaults(),arguments,["url","onload"])),this.name="Convolver",this._convolver=this.context.createConvolver();const f=ui(fc.getDefaults(),arguments,["url","onload"]);this._buffer=new Ri(f.url,(O=>{this.buffer=O,f.onload()})),this.input=new ho({context:this.context}),this.output=new ho({context:this.context}),this._buffer.loaded&&(this.buffer=this._buffer),this.normalize=f.normalize,this.input.chain(this._convolver,this.output)}static getDefaults(){return Object.assign(io.getDefaults(),{normalize:!0,onload:Ei})}load(f){return ni(this,void 0,void 0,(function*(){this.buffer=yield this._buffer.load(f)}))}get buffer(){return this._buffer.length?this._buffer:null}set buffer(f){f&&this._buffer.set(f),this._convolver.buffer&&(this.input.disconnect(),this._convolver.disconnect(),this._convolver=this.context.createConvolver(),this.input.chain(this._convolver,this.output));const O=this._buffer.get();this._convolver.buffer=O||null}get normalize(){return this._convolver.normalize}set normalize(f){this._convolver.normalize=f}dispose(){return super.dispose(),this._buffer.dispose(),this._convolver.disconnect(),this}}function _c(){return Vi().now()}function mc(){return Vi().immediate()}const Nc=Vi().transport;function vc(){return Vi().transport}const jc=Vi().destination,Lc=Vi().destination;function wc(){return Vi().destination}const Bc=Vi().listener;function Tc(){return Vi().listener}const zc=Vi().draw;function kc(){return Vi().draw}const Wc=Vi();function Cc(){return Ri.loaded()}const Uc=Ri,Gc=wo,Yc=jo})(),I})()));

